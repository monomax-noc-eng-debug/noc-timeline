import{d as H,r as a,j as e,f as T,T as Ae,X as ne,L as Ee,R as X,g as kr,A as le,C as kt,F as Ze,h as et,S as jr,i as yr,k as tt,l as jt,P as re,m as L,n as xe,o as yt,p as rt,q as nt,s as Le,t as zr,v as Nr,D as Cr,b as zt,U as Sr,w as Ir,a as Mr,x as mt}from"./index-MAGVuFXp.js";import{i as J}from"./incidentService-xFEryJp6.js";import{u as Nt,a as Er}from"./useTicketOptions-3UDdasBf.js";import{H as we}from"./hash-BO-q3r9t.js";import{T as se,P as he}from"./trash-2-BdamKxn_.js";import{C as st}from"./chevron-right-DTq5YanC.js";import{L as Ye}from"./layers-CJP-7rgY.js";import{D as De}from"./download-DAelW4Jg.js";import{S as Rr}from"./search-Bxbmmfzn.js";import{S as Dr}from"./sliders-horizontal-i6lRQ9LF.js";import{C as ae}from"./circle-alert-D1lHDAhV.js";import{R as _r}from"./refresh-cw-BtK66Euz.js";import{C as Pr}from"./chevron-left-FbdOXN27.js";import{C as Tr,P as de,u as Ct}from"./index-CsCvLynJ.js";import{C as Ar}from"./chevron-down-5bDJwHze.js";import{C as ue}from"./clock-BZ2Y9gWt.js";import{C as _e}from"./circle-check-CUPGGApo.js";import{S as ge}from"./shield-check-Dp-TSrkl.js";import{P as St}from"./panels-top-left-z0TyHoQf.js";import{S as It}from"./save-Iw2YQ2me.js";import{C as Lr}from"./check-CmwnjSEm.js";import{C as Or}from"./copy-B14TQYku.js";import{c as Fr}from"./configService-DT_i63n4.js";import{Z as Mt}from"./zap-wYsbUquJ.js";import{S as $r,B as me}from"./button-D0InLzOc.js";import{u as qe,c as Et,R as Ur,A as Gr,h as Br,a as Hr,b as Wr,F as Kr,C as Vr,d as Zr}from"./Combination-DeRa23dv.js";import{A as Yr}from"./arrow-left-DttoDBtu.js";import{f as Rt}from"./format-DwWD4j_p.js";import{H as qr,L as Jr}from"./layout-list-BlYAZKdL.js";import{T as Xr}from"./tag-CH1Mmsk6.js";import{A as Qr}from"./arrow-right-cgORnAnD.js";import"./firebaseConfig-ZmQab4ju.js";import"./firebaseErrorHandler-CK0dtUN1.js";import"./useBaseQuery-mzdAQ7XD.js";import"./index-BwbJbACc.js";const en=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],tn=H("ban",en);const rn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],nn=H("circle-x",rn);const sn=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],an=H("cloud-upload",sn);const on=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],cn=H("ellipsis",on);const ln=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],dn=H("file-plus-corner",ln);const un=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],xn=H("fingerprint-pattern",un);const mn=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],pn=H("flag",mn);const bn=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],pt=H("folder-kanban",bn);const hn=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],at=H("image-off",hn);const gn=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],fn=H("image-plus",gn);const vn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],wn=H("image",vn);const kn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],bt=H("inbox",kn);const jn=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],yn=H("layout-dashboard",jn);const zn=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Nn=H("link",zn);const Cn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ht=H("maximize-2",Cn);const Sn=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Je=H("message-square",Sn);const In=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],gt=H("minimize-2",In);const Mn=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],En=H("move",Mn);const Rn=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Dn=H("workflow",Rn);const _n=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Pn=H("wrench",_n),Tn=()=>{const[t,r]=a.useState([]),[n,s]=a.useState(null),[o,c]=a.useState(!0),[d,i]=a.useState(null),[m,g]=a.useState(""),[l,u]=a.useState("All"),[f,S]=a.useState("All");a.useEffect(()=>{c(!0),i(null);const y=J.subscribeIncidents(M=>{const w=(M||[]).map(z=>({...z,_searchString:`${z.subject||""} ${z.project||""} ${z.ticket||""} ${z.createdBy&&typeof z.createdBy=="object"?z.createdBy.name:z.createdBy||""} ${z.status||""} ${z.type||""}`.toLowerCase()}));r(w),c(!1),i(null)},M=>{console.error("useIncidents error:",M),i(M.message||"Failed to connect to database"),c(!1)});return()=>{typeof y=="function"&&y()}},[]);const h=a.useMemo(()=>{const y=m.toLowerCase().trim();return t.filter(w=>{const z=!y||(w._searchString||"").includes(y),U=l==="All"||w.status===l,A=f==="All"||w.type===f;return z&&U&&A}).sort((w,z)=>{const U=w.createdAt?new Date(w.createdAt).getTime():0;return(z.createdAt?new Date(z.createdAt).getTime():0)-U})},[t,m,l,f]),k=a.useMemo(()=>{const y={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((M,w)=>{M.total++;const z=w.status?.replace(/\s+/g,"").replace(/^\w/,U=>U.toLowerCase());return M[z]!==void 0?M[z]++:w.status==="In Progress"&&M.inProgress++,M},y)},[t]),v=a.useCallback(()=>{g(""),u("All"),S("All")},[]);return{incidents:t,filteredIncidents:h,selectedId:n,setSelectedId:s,loading:o,error:d,searchTerm:m,setSearchTerm:g,filterStatus:l,setFilterStatus:u,filterType:f,setFilterType:S,clearFilters:v,hasActiveFilters:!!m||l!=="All"||f!=="All",stats:k}},An=t=>{const[r,n]=a.useState([]),[s,o]=a.useState(!1);a.useEffect(()=>{if(!t){setTimeout(()=>{n([])},0);return}const d=J.subscribeEvents(t,i=>{const m=(i||[]).map(g=>({...g,_sortTime:new Date(`${g.date||"1970-01-01"}T${g.time||"00:00"}`).getTime()}));n(m),o(!1)});return()=>d&&d()},[t]);const c=a.useMemo(()=>[...r].sort((d,i)=>i._sortTime-d._sortTime),[r]);return{events:r,sortedEvents:c,loading:s}},pe=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),ft=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},Ln=(t,r)=>{const n=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s;const c=r.endsWith(".csv")?r:`${r}.csv`;o.download=c,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(s)},0)},On=t=>{switch(t){case"Open":return{dot:"bg-rose-500",text:"text-rose-600",bg:"bg-rose-50 dark:bg-rose-500/10",border:"border-rose-200 dark:border-rose-500/20"};case"In Progress":return{dot:"bg-indigo-500",text:"text-indigo-600",bg:"bg-indigo-50 dark:bg-indigo-500/10",border:"border-indigo-200 dark:border-indigo-500/20"};case"Monitoring":case"Pending":return{dot:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-500/10",border:"border-amber-200 dark:border-amber-500/20"};case"Succeed":case"Resolved":return{dot:"bg-emerald-500",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-500/10",border:"border-emerald-200 dark:border-emerald-500/20"};case"Closed":return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"};default:return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"}}},Fn=a.memo(({incident:t,isSelected:r,onClick:n,onDelete:s})=>{const o=On(t.status),c=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative flex flex-col gap-2 p-3 rounded-lg border transition-all duration-200 cursor-pointer mb-2",r?"bg-white dark:bg-zinc-800/80 border-indigo-500/50 shadow-md transform scale-[1.01] z-10":"bg-white dark:bg-[#09090b] border-zinc-100 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-900"),children:[r&&e.jsx("div",{className:"absolute left-0 top-3 bottom-3 w-1 bg-indigo-500 rounded-r-full"}),e.jsxs("div",{className:T("flex justify-between items-start gap-2",r?"pl-2":""),children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-wrap",children:[e.jsx("div",{className:T("w-2 h-2 rounded-full shrink-0",o.dot)}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.project||"CORE"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase",children:t.type}),e.jsx("span",{className:"text-[10px] text-zinc-300 dark:text-zinc-700",children:"•"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400 uppercase flex items-center gap-1",children:[e.jsx(we,{size:10}),t.ticket||"-"]}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase ml-auto sm:ml-0",children:c})]}),!r&&e.jsx("button",{onClick:d=>{d.stopPropagation(),s(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:e.jsx(se,{size:12})})]}),e.jsx("div",{className:T("pr-4",r?"pl-2":""),children:e.jsx("h3",{className:T("text-sm font-bold leading-snug line-clamp-2 transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.subject||"Untitled Incident"})}),e.jsxs("div",{className:T("flex justify-between items-center mt-1",r?"pl-2":""),children:[e.jsx("span",{className:T("text-[10px] font-bold uppercase px-2 py-0.5 rounded-full border",o.bg,o.text,o.border),children:t.status}),r&&e.jsx(st,{size:14,className:"text-indigo-500"})]})]})}),$n=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},vt=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Un=a.memo(({log:t,isSelected:r,onClick:n})=>{const s=t.createdAt?new Date(t.createdAt):null,o=s?s.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative p-4 rounded-[2rem] border transition-all duration-300 cursor-pointer overflow-hidden mb-3",r?"bg-white dark:bg-[#09090b] border-zinc-900 dark:border-zinc-500 shadow-xl shadow-zinc-200/50 dark:shadow-none scale-[1.02] z-10":"bg-white dark:bg-[#0c0c0e] border-zinc-100 dark:border-zinc-800/50 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-1"),children:[r&&e.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-2 bg-zinc-900 dark:bg-white"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:T("px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border",$n(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:o})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:T("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(Ae,{size:10,className:T("shrink-0",vt(t.severity))}),e.jsx("span",{className:T("text-[9px] font-black uppercase tracking-widest",vt(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(st,{size:18,className:"text-zinc-300"})})]})});function Gn(t,r){const[n,s]=a.useState(t);return a.useEffect(()=>{const o=setTimeout(()=>s(t),r);return()=>clearTimeout(o)},[t,r]),n}const Bn=({filteredIncidents:t,selectedId:r,onSelect:n,onAddIncident:s,onDeleteIncident:o,onExportCSV:c,onSync:d,stats:i,logs:m,selectedLogId:g,onSelectLog:l,logsLoading:u,viewMode:f,onViewModeChange:S,searchTerm:h,setSearchTerm:k,filterStatus:v,setFilterStatus:p,filterType:y,setFilterType:M,clearFilters:w,hasActiveFilters:z,loading:U,error:A,canEdit:O})=>{const{ticketOptions:F}=Nt(),[D,G]=a.useState(h),x=Gn(D,300),[C,_]=a.useState(!1);a.useEffect(()=>{k(x)},[x,k]),a.useEffect(()=>{G(h)},[h]);const[b,I]=a.useState(20),P=a.useRef(null),E=f==="logs",N=E?m:t,W=E?u:U;a.useEffect(()=>{I(20)},[N?.length,f,v,y,x]),a.useEffect(()=>{const j=new IntersectionObserver(Z=>{Z[0].isIntersecting&&N?.length>b&&I(Y=>Y+20)},{threshold:.1});return P.current&&j.observe(P.current),()=>j.disconnect()},[N,b]);const $=j=>{p(j===v?"All":j)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsxs("header",{className:"shrink-0 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 transition-colors ${E?"bg-indigo-600 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-black"}`,children:E?e.jsx(bt,{size:16}):e.jsx(Ye,{size:16})}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>S("incidents"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${E?"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300":"bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm"}`,children:"Cases"}),e.jsx("button",{onClick:()=>S("logs"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${E?"bg-white dark:bg-zinc-800 text-indigo-600 dark:text-indigo-400 shadow-sm":"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,children:"Logs"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center gap-1.5",children:!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c(t),className:"hidden sm:flex w-8 h-8 items-center justify-center rounded-lg text-zinc-400 hover:text-indigo-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",title:"Export CSV",children:e.jsx(De,{size:16})}),O&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 h-8 px-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[10px] font-bold uppercase tracking-wide shadow hover:opacity-90 transition-all",children:[e.jsx(dn,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"New"})]})]})})]}),e.jsxs("div",{className:"flex gap-2 px-3 pb-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Rr,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:D,onChange:j=>G(j.target.value),placeholder:E?"Search logs...":"Search cases...",className:"w-full h-8 pl-8 pr-7 rounded-lg bg-zinc-100 dark:bg-zinc-900 border-none text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),D&&e.jsx("button",{onClick:()=>G(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ne,{size:12})})]}),e.jsx("button",{onClick:()=>_(!0),className:`h-8 w-8 flex items-center justify-center rounded-lg transition-all ${z?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600":"bg-zinc-100 dark:bg-zinc-900 text-zinc-500"}`,children:e.jsx(Dr,{size:14})})]}),!E&&i&&e.jsx("div",{className:"flex gap-1.5 px-3 pb-2 overflow-x-auto no-scrollbar",children:[{label:"Open",count:i.open,color:"bg-red-500"},{label:"Pending",count:i.pending,color:"bg-amber-500"},{label:"Resolved",count:i.resolved,color:"bg-emerald-500"}].map(j=>e.jsxs("button",{onClick:()=>$(j.label),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[9px] font-bold uppercase tracking-wide transition-all whitespace-nowrap shrink-0 ${v===j.label?"bg-zinc-900 dark:bg-white text-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${j.color}`}),j.label,e.jsxs("span",{className:"opacity-50",children:["(",j.count,")"]})]},j.label))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:A&&!E?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(ae,{className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:A})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(_r,{size:12}),"Retry"]})]}):W&&b===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(Ee,{className:"animate-spin text-indigo-600",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):N?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[E?e.jsx(bt,{size:40,strokeWidth:1}):e.jsx(Ye,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),z&&e.jsx("button",{onClick:w,className:"mt-2 text-xs text-indigo-500 font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[N.slice(0,b).map(j=>E?e.jsx(Un,{log:j,isSelected:g===(j.ticketNumber||j.id),onClick:()=>l(j)},j.ticketNumber||j.id):e.jsx(Fn,{incident:j,isSelected:r===j.id,onClick:()=>n(j.id),onDelete:o},j.id)),e.jsx("div",{ref:P,className:"h-4 w-full"})]})}),C&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>_(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-2xl p-5 shadow-2xl animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h3",{className:"text-base font-black text-zinc-900 dark:text-white",children:"Filters"}),e.jsx("button",{onClick:()=>_(!1),className:"p-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-full",children:e.jsx(ne,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.statuses].map(j=>e.jsx("button",{onClick:()=>p(j),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${v===j?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.types].map(j=>e.jsx("button",{onClick:()=>M(j),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${y===j?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{onClick:()=>{w(),_(!1)},className:"flex-1 py-3 text-red-500 font-bold bg-red-50 dark:bg-red-900/20 rounded-xl hover:bg-red-100 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>_(!1),className:"flex-[2] py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors text-sm",children:"Apply"})]})]})]}),!E&&O&&e.jsx("button",{onClick:s,className:"md:hidden absolute bottom-5 right-5 z-40 w-12 h-12 bg-indigo-600 text-white rounded-2xl shadow-xl shadow-indigo-600/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(he,{size:22})})]})},Hn=a.memo(Bn),ke=t=>{if(!t)return"";try{const r=new URL(t);if(r.hostname.includes("drive.google.com")||r.hostname.includes("docs.google.com")){let n=r.searchParams.get("id");if(!n){const s=r.pathname.split("/"),o=s.indexOf("d");o!==-1&&s[o+1]&&(n=s[o+1])}if(n)return`https://drive.google.com/thumbnail?id=${n}&sz=w1000`}return t}catch{return t}},Wn=(t,r=[320,640,960,1280,1920])=>t?t.includes("drive.google.com")||t.includes("docs.google.com")?{srcset:t,sizes:"100vw"}:{srcset:r.map(o=>`${t}?w=${o} ${o}w`).join(", "),sizes:"(max-width: 640px) 320px, (max-width: 960px) 640px, (max-width: 1280px) 960px, 1280px"}:{srcset:"",sizes:""},Kn=t=>!t||typeof t!="string"?!1:t.includes("drive.google.com")||t.includes("docs.google.com"),Vn=async t=>Kn(t)?Promise.resolve("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"):new Promise(r=>{const n=new Image;n.crossOrigin="anonymous";const s=setTimeout(()=>{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},3e3);n.onload=()=>{clearTimeout(s);const o=document.createElement("canvas");o.width=20,o.height=20,o.getContext("2d").drawImage(n,0,0,20,20);try{const d=o.toDataURL("image/jpeg",.5);r(d)}catch{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")}},n.onerror=()=>{clearTimeout(s),r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},n.src=t}),Zn=t=>new Promise((r,n)=>{const s=new Image;s.onload=()=>r(),s.onerror=()=>n(new Error("Failed to preload image")),s.src=t});function Yn({src:t,alt:r="",className:n="",onClick:s,sizes:o,loading:c="lazy",placeholder:d="blur",fallback:i,onLoad:m,onError:g,...l}){const[u,f]=a.useState(null),[S,h]=a.useState(null),[k,v]=a.useState(!1),[p,y]=a.useState(c!=="lazy"),M=X.useRef(null),w=X.useRef(null),z=X.useRef(null);a.useEffect(()=>{if(!t){setTimeout(()=>f(null),0);return}try{if(typeof t=="object"&&(t instanceof File||t instanceof Blob)){const D=URL.createObjectURL(t);return setTimeout(()=>f(D),0),()=>URL.revokeObjectURL(D)}if(typeof t=="string"){const D=ke(t);setTimeout(()=>f(D),0),d==="blur"&&D&&(D.includes("drive.google.com")||D.includes("docs.google.com")?setTimeout(()=>h("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0):Vn(D).then(x=>{setTimeout(()=>h(x),0)}).catch(()=>{setTimeout(()=>h("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0)}))}}catch(D){console.error("Error processing image source:",D),setTimeout(()=>f(null),0)}},[t,d]),a.useEffect(()=>{if(c!=="lazy"){setTimeout(()=>y(!0),0);return}const D=w.current||M.current;if(!D){const G=setTimeout(()=>y(!0),50);return()=>clearTimeout(G)}if(!p)return z.current=new IntersectionObserver(G=>{G.forEach(x=>{x.isIntersecting&&(y(!0),z.current&&z.current.disconnect())})},{rootMargin:"50px",threshold:.01}),z.current.observe(D),()=>{z.current&&z.current.disconnect()}},[c,p]);const{srcset:U,sizesAttr:A}=a.useMemo(()=>u?Wn(u):{srcset:"",sizesAttr:""},[u]),O=D=>{m&&m(D)},F=D=>{v(!0),i&&D.target.src!==i?(D.target.src=i,v(!1)):g&&g(D)};return a.useEffect(()=>{p&&u&&!k&&Zn(u).catch(()=>{})},[p,u,k]),k&&!i?e.jsxs("div",{className:T("flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",n),onClick:s,children:[e.jsx(at,{className:"text-zinc-400 mb-1",size:20}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase",children:"Failed to load"})]}):c==="lazy"&&!p?e.jsx("div",{className:T("relative overflow-hidden bg-zinc-100 dark:bg-zinc-900",n),ref:w,children:S&&e.jsx("img",{src:S,alt:"",className:"absolute inset-0 w-full h-full object-cover filter blur-xl scale-110 opacity-50","aria-hidden":"true"})}):e.jsx("img",{ref:M,src:u||i,srcSet:U||void 0,sizes:o||A||void 0,alt:r,className:T(n),loading:c,onLoad:O,onError:F,onClick:s,decoding:"async",...l})}function qn({isOpen:t,onClose:r,imageUrl:n,allImages:s=[],initialIndex:o=0}){const[c,d]=a.useState(o),[i,m]=a.useState(1),[g,l]=a.useState({x:0,y:0}),[u,f]=a.useState(!1),[S,h]=a.useState({x:0,y:0}),k=s.length>0?s:[n],v=k[c]||n,p=X.useRef(null),[y,M]=a.useState(!1);a.useEffect(()=>{const x=()=>M(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",x),()=>document.removeEventListener("fullscreenchange",x)},[]);const w=X.useCallback(()=>{m(1),l({x:0,y:0})},[]),z=X.useCallback(x=>{x?.stopPropagation(),d(C=>(C+1)%k.length),w()},[k.length,w]),U=X.useCallback(x=>{x?.stopPropagation(),d(C=>(C-1+k.length)%k.length),w()},[k.length,w]),A=X.useCallback(x=>{x?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():p.current?.requestFullscreen().catch(C=>{console.error("Fullscreen failed:",C)})},[]);if(a.useEffect(()=>{const x=C=>{if(t)switch(C.key){case"ArrowRight":z();break;case"ArrowLeft":U();break;case"Escape":document.fullscreenElement?document.exitFullscreen():r();break;case"f":case"F":A();break;case"0":w();break}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[t,z,U,r,w,A]),a.useEffect(()=>{const x=p.current;if(!x)return;const C=_=>{if(!t)return;_.preventDefault();const I=-_.deltaY>0?1.1:.9,P=Math.min(Math.max(i*I,.5),10);m(P),P<=1&&l({x:0,y:0})};return x.addEventListener("wheel",C,{passive:!1}),()=>x.removeEventListener("wheel",C)},[t,i]),a.useEffect(()=>{let x=!0,C=null;return t?C=setTimeout(()=>{if(!x)return;const _=o||(n&&s.indexOf(n)>=0?s.indexOf(n):0);d(_),w(),document.body.style.overflow="hidden"},0):document.body.style.overflow="",()=>{x=!1,C&&clearTimeout(C),document.body.style.overflow=""}},[t,o,n,s,w]),!t)return null;const O=x=>{i<=1||(x.preventDefault(),f(!0),h({x:x.clientX-g.x,y:x.clientY-g.y}))},F=x=>{!u||i<=1||(x.preventDefault(),l({x:x.clientX-S.x,y:x.clientY-S.y}))},D=()=>{f(!1)},G=x=>{x?.stopPropagation(),i===1?m(2.5):w()};return kr.createPortal(e.jsxs("div",{ref:p,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${u?"cursor-grabbing":""}`,onClick:r,onMouseMove:F,onMouseUp:D,onMouseLeave:D,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:A,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:y?e.jsx(gt,{size:24,className:"text-white"}):e.jsx(ht,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",c+1," of ",k.length," • Click to ",y?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:G,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${i>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:i>1?"Reset Zoom":"Quick Zoom",children:i>1?e.jsx(gt,{size:22}):e.jsx(ht,{size:22})}),e.jsx("a",{href:ke(v),download:!0,target:"_blank",rel:"noreferrer",onClick:x=>x.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(De,{size:22})}),e.jsx("button",{onClick:r,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(ne,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${g.x}px, ${g.y}px) scale(${i})`,cursor:i>1?u?"grabbing":"grab":"zoom-in"},onClick:x=>{x.stopPropagation(),i===1?m(2.5):w()},onMouseDown:O,children:[e.jsx(Yn,{src:v,alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},loading:"eager",fallback:"https://placehold.co/1200x800?text=Failed+to+load+image"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:i===1&&e.jsx(En,{size:64,className:"text-white/10"})})]})}),k.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(Pr,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:z,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(st,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[k.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:k.map((x,C)=>e.jsx("button",{onClick:_=>{_.stopPropagation(),d(C),w()},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${c===C?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},C))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",v.split("/").pop().substring(0,60)]})})]})]}),document.body)}const Jn=t=>{const r=t.type?.toLowerCase()||"",n=t.desc?.toLowerCase()||"",s={message:Je,alert:ae,check:_e,clock:ue,update:de},o=t.iconType?s[t.iconType]:null;return r==="create"||n.includes("created")?{icon:o||he,colorClass:"text-indigo-600 bg-indigo-50 dark:bg-indigo-900/30 border-indigo-200 dark:border-indigo-800"}:r==="update"||n.includes("updated")?{icon:o||de,colorClass:"text-amber-600 bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-800"}:r==="status_change"||n.includes("resolved")||n.includes("closed")||n.includes("succeed")?{icon:o||_e,colorClass:"text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-800"}:r==="alert"||n.includes("alert")||n.includes("error")||n.includes("failed")?{icon:o||ae,colorClass:"text-rose-600 bg-rose-50 dark:bg-rose-900/30 border-rose-200 dark:border-rose-800"}:{icon:o||Je,colorClass:"text-zinc-500 bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700"}},Xn=t=>{switch(t){case"rose":return"bg-rose-50 text-rose-700 border-rose-200 dark:bg-rose-900/40 dark:text-rose-300 dark:border-rose-800";case"emerald":return"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-300 dark:border-emerald-800";case"white":default:return"bg-zinc-50 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}},Qn=t=>{switch(t){case"rose":return"text-rose-600 bg-rose-50 border-rose-200 dark:bg-rose-900/20 dark:border-rose-800";case"emerald":return"text-emerald-600 bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-800";case"white":return"text-zinc-500 bg-white border-zinc-200 dark:bg-zinc-800 dark:border-zinc-700";default:return null}},es=({src:t,index:r,onClick:n,className:s})=>{const[o,c]=a.useState(!1),[d,i]=a.useState(null);return a.useEffect(()=>{c(!1)},[t]),a.useEffect(()=>{if(!t){i(null);return}let m=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(m=URL.createObjectURL(t),i(m)):typeof t=="string"&&i(ke(t)),()=>{m&&URL.revokeObjectURL(m)}},[t]),o||!d?e.jsx("div",{className:T(s,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(at,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>n(t),className:T("relative group/img overflow-hidden cursor-zoom-in",s),children:[e.jsx("img",{src:d,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>c(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(wn,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function ts({event:t,index:r,isLastItem:n,onEdit:s,onDelete:o,onMove:c}){const[d,i]=a.useState(null),{icon:m,colorClass:g}=Jn(t),u=Qn(t.statusOnLineColor)||g,S=(t.date?new Date(t.date):new Date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),h=t.time||"00:00";let k=(t.imageUrls||[]).filter(v=>v);return!k.length&&t.image&&(k=[t.image]),e.jsxs("div",{className:"group relative flex w-full gap-4 pb-8",children:[e.jsx("div",{className:"relative shrink-0 w-4 flex flex-col items-center",children:e.jsx("div",{className:T("absolute left-1/2 -translate-x-1/2 w-[2px] bg-zinc-700 dark:bg-zinc-600 z-0",r===0?"top-4":"-top-4",n?"bottom-auto h-12":"-bottom-4")})}),e.jsx("div",{className:"flex flex-col items-end shrink-0 w-14 pt-1 relative",children:e.jsxs("div",{className:"flex flex-col items-end w-full pr-1 relative z-10 transition-transform group-hover:scale-105",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 tabular-nums leading-none tracking-tight",children:h}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase mt-1 leading-none",children:S})]})}),e.jsxs("div",{className:"relative shrink-0 flex flex-col items-center pt-1 h-full",children:[t.statusOnLine&&e.jsx("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 z-30 whitespace-nowrap pb-1",children:e.jsx("div",{className:T("text-[9px] font-black uppercase px-2.5 py-0.5 rounded-full border shadow-sm bg-white dark:bg-black",Xn(t.statusOnLineColor||"white")),children:t.statusOnLine})}),e.jsx("div",{className:T("w-8 h-8 rounded-full flex items-center justify-center border-2 shadow-sm z-20 transition-all duration-300 bg-white dark:bg-[#09090b]",u),children:e.jsx(m,{size:14,strokeWidth:2.5})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative bg-white dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 shadow-sm hover:shadow-md hover:border-zinc-300 dark:hover:border-zinc-700 transition-all duration-300 group/card",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2 pb-2 border-b border-zinc-100 dark:border-zinc-800/50 border-dashed",children:[e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-white leading-snug break-words",children:t.title||"Operational Update"}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 opacity-100 sm:opacity-0 group-hover/card:opacity-100 transition-opacity",children:[c&&e.jsxs("div",{className:"hidden sm:flex items-center bg-zinc-100 dark:bg-zinc-800/50 rounded-lg p-0.5 border border-zinc-200 dark:border-zinc-700 mr-2",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),c(r,"up")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Tr,{size:12})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),c(r,"down")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Ar,{size:12})})]}),e.jsx("button",{onClick:()=>s(t),className:"p-1.5 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded-lg transition-colors",title:"Edit",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-zinc-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(se,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-normal break-words max-w-full",children:t.desc||t.details}),k.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-2 border-t border-zinc-100 dark:border-zinc-800/50 border-dashed",children:k.map((v,p)=>e.jsx(es,{index:p,src:v,onClick:i,className:"w-20 h-20 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm"},p))}),(t.updatedBy||t.createdBy)&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-indigo-500 flex items-center justify-center text-[7px] font-bold text-white shadow-sm",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})})]})}),e.jsx(qn,{isOpen:!!d,onClose:()=>i(null),imageUrl:d,allImages:k})]})}const rs=a.memo(ts),Dt="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec",ns=async t=>new Promise((r,n)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=async()=>{try{const o=s.result.split(",")[1],c=await fetch(Dt,{method:"POST",body:JSON.stringify({action:"upload",name:t.name,mimeType:t.type,base64:o})});r(await c.json())}catch(o){n(o)}}}),Se=async t=>{if(!t)return;let r=t;t.includes("id=")&&(r=new URLSearchParams(new URL(t).search).get("id"));try{return await(await fetch(Dt,{method:"POST",body:JSON.stringify({action:"delete",fileId:r})})).json()}catch(n){console.error("Drive Delete Error:",n)}},Be=a.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),He=a.memo(({error:t,className:r,...n})=>e.jsx("input",{...n,className:T("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-indigo-500/50 focus:ring-4 focus:ring-indigo-500/5",t?"border-rose-500":"",r)})),Ie=a.memo(({children:t,title:r,icon:n,badge:s})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[n&&e.jsx(n,{size:14,className:"text-zinc-400 group-hover/row:text-indigo-500 transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase tracking-[0.2em]",children:r})]}),s&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:s})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function ss({isOpen:t,onClose:r,onSubmit:n,onDelete:s,initialData:o,saving:c=!1}){const[d,i]=a.useState({date:"",time:"",desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]}),[m,g]=a.useState(""),[l,u]=a.useState(!1),[f,S]=a.useState(0),[h,k]=a.useState(""),[v,p]=a.useState(null),[y,M]=a.useState({}),[w,z]=a.useState({isOpen:!1,type:null,index:null}),[U,A]=a.useState({}),O=a.useRef(null),F=a.useRef(null);a.useEffect(()=>{const b=I=>{I.key==="Escape"&&!c&&r()};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[r,c]),a.useEffect(()=>{if(t){if(o){let b=o.imageUrls||[];!b.length&&o.image&&(b=[o.image]),i({...o,imageUrls:b})}else{const b=new Date;i({date:b.toISOString().split("T")[0],time:`${String(b.getHours()).padStart(2,"0")}:${String(b.getMinutes()).padStart(2,"0")}`,desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]})}k(""),p(null),g(""),M({}),A({})}},[t,o]);const D=async b=>{b&&(b.stopPropagation(),b.preventDefault()),F.current&&F.current.abort(),u(!1),S(0),v&&(await Se(v),p(null)),k("Transmission Purged")},G=b=>{const I=b||m;I&&!d.imageUrls.includes(I)&&(i(P=>({...P,imageUrls:[...P.imageUrls,I]})),g(""))},x=async b=>{const I=b.target.files[0];if(I){u(!0),S(15),k(""),F.current=new AbortController;try{const P=await ns(I);if(F.current.signal.aborted){P.fileId&&await Se(P.fileId);return}if(P.result==="success")p(P.fileId),S(100),G(P.url),setTimeout(()=>{u(!1),S(0)},500);else throw new Error(P.error||"Sync Error")}catch(P){P.name==="AbortError"?k("Canceled"):(k("Upload Failed"),console.error(P)),u(!1)}finally{F.current=null,b.target.value=""}}},C=async()=>{if(w.type==="item"){if(d.imageUrls?.length>0)for(const b of d.imageUrls)await Se(b);s&&o?.id&&(s(o.id),r())}else if(w.type==="image"){const b=d.imageUrls[w.index];await Se(b),i(I=>({...I,imageUrls:I.imageUrls.filter((P,E)=>E!==w.index)}))}z({isOpen:!1,type:null,index:null})},_=b=>{if(b.preventDefault(),!d.desc?.trim()){M({desc:!0});return}n(d)};return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-zinc-950/80 backdrop-blur-sm animate-in fade-in",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#09090b] rounded-[2.5rem] shadow-2xl border border-zinc-100 dark:border-white/5 flex flex-col max-h-[92vh] animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"shrink-0 p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:o?"Edit Operation":"New Deployment"}),e.jsx("p",{className:"text-[8px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"Cloud Sync Tier-1 Enabled"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(ne,{size:18})})]}),e.jsxs("form",{id:"event-form",onSubmit:_,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsx(Ie,{title:"Temporal Matrix",icon:ue,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Be,{label:"Deployment Date"}),e.jsx(He,{type:"date",value:d.date,onChange:b=>i({...d,date:b.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Be,{label:"Sync Time"}),e.jsx(He,{type:"time",value:d.time,onChange:b=>i({...d,time:b.target.value})})]})]})}),e.jsx(Ie,{title:"Visual Personalization",icon:xn,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-xl border border-zinc-100 dark:border-white/5",children:[e.jsx(Be,{label:"Marker Status",icon:we}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(b=>e.jsx("button",{type:"button",onClick:()=>i({...d,statusOnLineColor:b}),className:T("w-5 h-5 rounded-full border-2 transition-all",b==="white"?"bg-white border-zinc-200":b==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",d.statusOnLineColor===b?"ring-4 ring-indigo-500/20 scale-110 shadow-lg border-indigo-500":"opacity-30 border-transparent")},b))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl",children:[{id:"message",icon:Je},{id:"alert",icon:ae},{id:"check",icon:_e},{id:"clock",icon:ue},{id:"update",icon:de},{id:"activity",icon:le}].map(b=>e.jsx("button",{type:"button",onClick:()=>i({...d,iconType:b.id}),className:T("h-9 flex items-center justify-center rounded-lg transition-all",d.iconType===b.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(b.icon,{size:14,strokeWidth:2.5})},b.id))})]})}),e.jsx(Ie,{title:"Operational Narrative",icon:St,children:e.jsx("textarea",{className:T("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",y.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:d.desc,onChange:b=>i({...d,desc:b.target.value})})}),e.jsx(Ie,{title:"Intelligence Evidence",icon:fn,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(He,{placeholder:"Asset URL...",value:m,onChange:b=>g(b.target.value)}),e.jsx(Nn,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>G(),disabled:!m,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(he,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>O.current.click(),disabled:l,className:"h-10 w-10 flex items-center justify-center bg-indigo-600 text-white rounded-xl transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:O,className:"hidden",accept:"image/*",onChange:x}),l?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(an,{size:16})]})]}),(l||h)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-2xl p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:12,className:"animate-spin text-indigo-500"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-indigo-500 tabular-nums",children:[Math.round(f),"%"]}),e.jsx("button",{type:"button",onClick:D,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(tn,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${f}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(ae,{size:12}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:h})]})}),d.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:d.imageUrls.map((b,I)=>e.jsxs("div",{className:"group relative aspect-square rounded-xl overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[U[I]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(at,{size:16})}):e.jsx("img",{src:ke(b),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>A(P=>({...P,[I]:!0}))}),e.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),z({isOpen:!0,type:"image",index:I})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(se,{size:16})})]},I))})]})})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center gap-3",children:[o&&e.jsx("button",{type:"button",onClick:()=>z({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-2xl bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(se,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:c||l,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[c?e.jsx(Ee,{size:18,className:"animate-spin"}):e.jsx(It,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em]",children:"Commit Record"})]})]})]}),e.jsx(kt,{isOpen:w.isOpen,onClose:()=>z({isOpen:!1,type:null,index:null}),title:w.type==="item"?"Purge Record?":"Remove Asset?",message:w.type==="item"?"This operational record will be permanently purged from the timeline. This action cannot be undone.":"This image asset will be removed from this record and purged from cloud storage.",onConfirm:C,isDanger:!0})]}):null}function as({isOpen:t,onClose:r,text:n,incident:s}){const[o,c]=X.useState(!1),[d,i]=X.useState("preview"),m=a.useMemo(()=>{if(s)return{meta:{Project:s.project||"-",Subject:s.subject||"-",Status:s.status||"-",Ticket:s.ticket||"-"},details:{Impact:s.impact||"-","Root Cause":s.root_cause||"-","Action Taken":s.action||"-"},timeline:(s.events||[]).map(h=>({date:h.date?new Date(h.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:h.time,desc:h.desc||h.title,originalDate:h.date,imageUrls:h.imageUrls||(h.image?[h.image]:[])}))};if(!n)return null;const l={meta:{},details:{},timeline:[]},u=n.split(`
`);let f=!1,S="";return u.forEach(h=>{const k=h.trim();if(!k)return;const v=h.indexOf(":");if(!f&&v!==-1&&v<20){const p=h.substring(0,v).trim(),y=h.substring(v+1).trim();["Project","Subject","Status","Ticket"].includes(p)?l.meta[p]=y:(["Impact","Root Cause","Action Taken"].includes(p),l.details[p]=y)}else if(f=!0,k.length<20&&/\d/.test(k)&&!k.includes("-"))S=k;else{const y=k.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);y?l.timeline.push({date:S,time:y[1],desc:y[2]||""}):l.timeline.push({date:S,time:null,desc:k})}}),l},[n,s]),g=async()=>{try{await navigator.clipboard.writeText(n),c(!0),setTimeout(()=>{c(!1),r()},1e3)}catch(l){console.error("Failed to copy:",l);const u=document.createElement("textarea");u.value=n,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),c(!0),setTimeout(()=>{c(!1),r()},1e3)}};return X.useEffect(()=>{const l=u=>{u.key==="Escape"&&t&&r()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[t,r]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-all",onClick:r,children:e.jsxs("div",{className:"bg-white dark:bg-[#09090b] w-full max-w-3xl h-[85vh] rounded-3xl border border-zinc-200 dark:border-zinc-800 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 relative",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(Ze,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>i("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>i("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(ne,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",children:d==="raw"?e.jsx("textarea",{readOnly:!0,value:n,className:"w-full h-full p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m?.meta&&Object.entries(m.meta).map(([l,u])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:l}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:u})]},l))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(le,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m?.details&&Object.entries(m.details).map(([l,u])=>{let f=le;return l.includes("Impact")&&(f=Ae),l.includes("Root")&&(f=Dn),l.includes("Action")&&(f=Pn),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:l})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:u==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):u})]},l)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(ue,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),m?.timeline.map((l,u)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(u===0||l.date!==m.timeline[u-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(et,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:l.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[l.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:l.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:l.desc}),l.imageUrls&&l.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:l.imageUrls.map((f,S)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ke(f),alt:`Evidence ${S+1}`,className:"w-full h-full object-cover",onError:h=>{h.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},S))})]})]},u)),m?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}),e.jsx("div",{className:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",children:e.jsx("button",{onClick:g,disabled:o,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${o?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Lr,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{size:16})," Copy to Clipboard"]})})})]})}):null}function os(){const[t,r]=a.useState([]),[n,s]=a.useState(!0);return a.useEffect(()=>{const o=Fr.subscribeProjects(c=>{r(c),s(!1)});return()=>o()},[]),{projects:t,loading:n}}function is({isOpen:t,onClose:r,incident:n,onUpdate:s,onDelete:o}){const{ticketOptions:c}=Nt(),{projects:d}=os(),[i,m]=a.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});a.useEffect(()=>{n&&setTimeout(()=>{m({subject:n.subject||"",project:n.project||"",type:n.type||"Incident",ticket:n.ticket||"",status:n.status||"Open",priority:n.priority||"Medium",impact:n.impact||"",root_cause:n.root_cause||"",action:n.action||""})},0)},[n,t]);const g=i.subject?.includes("|")&&i.subject?.includes("-"),l=p=>{let y={subject:p};if(p.includes("|")&&p.includes("-")){const M=p.split("|").map(w=>w.trim());if(M.length>=2){const w=M[0].split("-").map(z=>z.trim());if(w.length>=2){y.ticket=w[0],y.project=w[1];const z=c?.types||["Incident","Request","Maintenance"];y.type=z.find(U=>U.toLowerCase()===M[1].toLowerCase())||M[1],M.length>=3&&(y.subject=M.slice(2).join(" | "))}}}m(M=>({...M,...y}))};if(!t)return null;const u=p=>{p.preventDefault(),s(i),r()},f=p=>{const y={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:ae},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:ue},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:_e},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:nn}};return y[p]||y.Open},S=p=>{const y={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-indigo-500",bg:"bg-indigo-500/10"}};return y[p]||y.Medium},h="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",k="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 outline-none transition-all",v="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-xs font-black uppercase tracking-widest focus:ring-4 focus:ring-blue-500/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-[#08080a] w-full max-w-2xl rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-white/5 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 max-h-[92vh]",children:[e.jsxs("div",{className:"shrink-0 px-6 py-5 flex items-center justify-between bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(ne,{size:18})})]}),e.jsxs("form",{onSubmit:u,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-2xl bg-indigo-500/5 border border-indigo-500/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:T(h,"text-indigo-600 dark:text-indigo-400"),children:[e.jsx(St,{size:10})," Protocol Signature (Subject)"]}),g&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Mt,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-xl p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:i.subject,onChange:p=>l(p.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(le,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(v,f(i.status).color),value:i.status,onChange:p=>m({...i,status:p.target.value}),children:(c.statuses||["Open","Pending","Succeed","Closed"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(ue,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(pn,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(v,S(i.priority).color),value:i.priority,onChange:p=>m({...i,priority:p.target.value}),children:(c.severities||["Critical","High","Medium","Low"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(Ae,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(we,{size:10,className:"text-blue-500"})," Ticket Identity"]}),e.jsx("input",{type:"text",className:k,value:i.ticket,onChange:p=>m({...i,ticket:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(pt,{size:10,className:"text-indigo-500"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:v,value:i.project,onChange:p=>m({...i,project:p.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(d&&d.length>0?d:["MONOMAX","MONO29","3BB GIGATV"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))]}),e.jsx(pt,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(ae,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[80px] resize-none transition-all",value:i.impact,onChange:p=>m({...i,impact:p.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(jr,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.root_cause,onChange:p=>m({...i,root_cause:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(ge,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.action,onChange:p=>m({...i,action:p.target.value}),placeholder:""})]})]})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center justify-between border-t border-zinc-100 dark:border-white/5",children:[e.jsxs("button",{type:"button",onClick:o,className:"h-11 px-5 rounded-xl bg-rose-500/10 text-rose-500 font-black uppercase text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(se,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"h-11 px-6 rounded-xl text-[9px] font-black uppercase tracking-widest text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl text-[9px] font-black uppercase tracking-widest shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(It,{size:14})," Commit Changes"]})]})]})]})]})})}const _t=yr("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Re({className:t,variant:r,asChild:n=!1,...s}){const o=n?$r:"span";return e.jsx(o,{"data-slot":"badge",className:T(_t({variant:r}),t),...s})}Re.variants=_t;var We="rovingFocusGroup.onEntryFocus",cs={bubbles:!1,cancelable:!0},je="RovingFocusGroup",[Xe,Pt,ls]=jt(je),[ds,Tt]=tt(je,[ls]),[us,xs]=ds(je),At=a.forwardRef((t,r)=>e.jsx(Xe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Xe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ms,{...t,ref:r})})}));At.displayName=je;var ms=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:o=!1,dir:c,currentTabStopId:d,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:m,onEntryFocus:g,preventScrollOnEntryFocus:l=!1,...u}=t,f=a.useRef(null),S=xe(r,f),h=Ct(c),[k,v]=yt({prop:d,defaultProp:i??null,onChange:m,caller:je}),[p,y]=a.useState(!1),M=rt(g),w=Pt(n),z=a.useRef(!1),[U,A]=a.useState(0);return a.useEffect(()=>{const O=f.current;if(O)return O.addEventListener(We,M),()=>O.removeEventListener(We,M)},[M]),e.jsx(us,{scope:n,orientation:s,dir:h,loop:o,currentTabStopId:k,onItemFocus:a.useCallback(O=>v(O),[v]),onItemShiftTab:a.useCallback(()=>y(!0),[]),onFocusableItemAdd:a.useCallback(()=>A(O=>O+1),[]),onFocusableItemRemove:a.useCallback(()=>A(O=>O-1),[]),children:e.jsx(re.div,{tabIndex:p||U===0?-1:0,"data-orientation":s,...u,ref:S,style:{outline:"none",...t.style},onMouseDown:L(t.onMouseDown,()=>{z.current=!0}),onFocus:L(t.onFocus,O=>{const F=!z.current;if(O.target===O.currentTarget&&F&&!p){const D=new CustomEvent(We,cs);if(O.currentTarget.dispatchEvent(D),!D.defaultPrevented){const G=w().filter(I=>I.focusable),x=G.find(I=>I.active),C=G.find(I=>I.id===k),b=[x,C,...G].filter(Boolean).map(I=>I.ref.current);Ft(b,l)}}z.current=!1}),onBlur:L(t.onBlur,()=>y(!1))})})}),Lt="RovingFocusGroupItem",Ot=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:o=!1,tabStopId:c,children:d,...i}=t,m=qe(),g=c||m,l=xs(Lt,n),u=l.currentTabStopId===g,f=Pt(n),{onFocusableItemAdd:S,onFocusableItemRemove:h,currentTabStopId:k}=l;return a.useEffect(()=>{if(s)return S(),()=>h()},[s,S,h]),e.jsx(Xe.ItemSlot,{scope:n,id:g,focusable:s,active:o,children:e.jsx(re.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...i,ref:r,onMouseDown:L(t.onMouseDown,v=>{s?l.onItemFocus(g):v.preventDefault()}),onFocus:L(t.onFocus,()=>l.onItemFocus(g)),onKeyDown:L(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){l.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const p=hs(v,l.orientation,l.dir);if(p!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let M=f().filter(w=>w.focusable).map(w=>w.ref.current);if(p==="last")M.reverse();else if(p==="prev"||p==="next"){p==="prev"&&M.reverse();const w=M.indexOf(v.currentTarget);M=l.loop?gs(M,w+1):M.slice(w+1)}setTimeout(()=>Ft(M))}}),children:typeof d=="function"?d({isCurrentTabStop:u,hasTabStop:k!=null}):d})})});Ot.displayName=Lt;var ps={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function bs(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function hs(t,r,n){const s=bs(t.key,n);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return ps[s]}function Ft(t,r=!1){const n=document.activeElement;for(const s of t)if(s===n||(s.focus({preventScroll:r}),document.activeElement!==n))return}function gs(t,r){return t.map((n,s)=>t[(r+s)%t.length])}var fs=At,vs=Ot;function ws(t){const r=ks(t),n=a.forwardRef((s,o)=>{const{children:c,...d}=s,i=a.Children.toArray(c),m=i.find(ys);if(m){const g=m.props.children,l=i.map(u=>u===m?a.Children.count(g)>1?a.Children.only(null):a.isValidElement(g)?g.props.children:null:u);return e.jsx(r,{...d,ref:o,children:a.isValidElement(g)?a.cloneElement(g,void 0,l):null})}return e.jsx(r,{...d,ref:o,children:c})});return n.displayName=`${t}.Slot`,n}function ks(t){const r=a.forwardRef((n,s)=>{const{children:o,...c}=n;if(a.isValidElement(o)){const d=Ns(o),i=zs(c,o.props);return o.type!==a.Fragment&&(i.ref=s?nt(s,d):d),a.cloneElement(o,i)}return a.Children.count(o)>1?a.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var js=Symbol("radix.slottable");function ys(t){return a.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===js}function zs(t,r){const n={...r};for(const s in r){const o=t[s],c=r[s];/^on[A-Z]/.test(s)?o&&c?n[s]=(...i)=>{const m=c(...i);return o(...i),m}:o&&(n[s]=o):s==="style"?n[s]={...o,...c}:s==="className"&&(n[s]=[o,c].filter(Boolean).join(" "))}return{...t,...n}}function Ns(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Qe=["Enter"," "],Cs=["ArrowDown","PageUp","Home"],$t=["ArrowUp","PageDown","End"],Ss=[...Cs,...$t],Is={ltr:[...Qe,"ArrowRight"],rtl:[...Qe,"ArrowLeft"]},Ms={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ye="Menu",[fe,Es,Rs]=jt(ye),[oe,Ut]=tt(ye,[Rs,Et,Tt]),Oe=Et(),Gt=Tt(),[Ds,ie]=oe(ye),[_s,ze]=oe(ye),Bt=t=>{const{__scopeMenu:r,open:n=!1,children:s,dir:o,onOpenChange:c,modal:d=!0}=t,i=Oe(r),[m,g]=a.useState(null),l=a.useRef(!1),u=rt(c),f=Ct(o);return a.useEffect(()=>{const S=()=>{l.current=!0,document.addEventListener("pointerdown",h,{capture:!0,once:!0}),document.addEventListener("pointermove",h,{capture:!0,once:!0})},h=()=>l.current=!1;return document.addEventListener("keydown",S,{capture:!0}),()=>{document.removeEventListener("keydown",S,{capture:!0}),document.removeEventListener("pointerdown",h,{capture:!0}),document.removeEventListener("pointermove",h,{capture:!0})}},[]),e.jsx(Ur,{...i,children:e.jsx(Ds,{scope:r,open:n,onOpenChange:u,content:m,onContentChange:g,children:e.jsx(_s,{scope:r,onClose:a.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:l,dir:f,modal:d,children:s})})})};Bt.displayName=ye;var Ps="MenuAnchor",ot=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,o=Oe(n);return e.jsx(Gr,{...o,...s,ref:r})});ot.displayName=Ps;var it="MenuPortal",[Ts,Ht]=oe(it,{forceMount:void 0}),Wt=t=>{const{__scopeMenu:r,forceMount:n,children:s,container:o}=t,c=ie(it,r);return e.jsx(Ts,{scope:r,forceMount:n,children:e.jsx(Le,{present:n||c.open,children:e.jsx(zr,{asChild:!0,container:o,children:s})})})};Wt.displayName=it;var q="MenuContent",[As,ct]=oe(q),Kt=a.forwardRef((t,r)=>{const n=Ht(q,t.__scopeMenu),{forceMount:s=n.forceMount,...o}=t,c=ie(q,t.__scopeMenu),d=ze(q,t.__scopeMenu);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Le,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:d.modal?e.jsx(Ls,{...o,ref:r}):e.jsx(Os,{...o,ref:r})})})})}),Ls=a.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu),s=a.useRef(null),o=xe(r,s);return a.useEffect(()=>{const c=s.current;if(c)return Br(c)},[]),e.jsx(lt,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:L(t.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Os=a.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu);return e.jsx(lt,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Fs=ws("MenuContent.ScrollLock"),lt=a.forwardRef((t,r)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:d,disableOutsidePointerEvents:i,onEntryFocus:m,onEscapeKeyDown:g,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:f,onDismiss:S,disableOutsideScroll:h,...k}=t,v=ie(q,n),p=ze(q,n),y=Oe(n),M=Gt(n),w=Es(n),[z,U]=a.useState(null),A=a.useRef(null),O=xe(r,A,v.onContentChange),F=a.useRef(0),D=a.useRef(""),G=a.useRef(0),x=a.useRef(null),C=a.useRef("right"),_=a.useRef(0),b=h?Wr:a.Fragment,I=h?{as:Fs,allowPinchZoom:!0}:void 0,P=N=>{const W=D.current+N,$=w().filter(K=>!K.disabled),j=document.activeElement,Z=$.find(K=>K.ref.current===j)?.textValue,Y=$.map(K=>K.textValue),ce=Js(Y,W,Z),Q=$.find(K=>K.textValue===ce)?.ref.current;(function K(R){D.current=R,window.clearTimeout(F.current),R!==""&&(F.current=window.setTimeout(()=>K(""),1e3))})(W),Q&&setTimeout(()=>Q.focus())};a.useEffect(()=>()=>window.clearTimeout(F.current),[]),Hr();const E=a.useCallback(N=>C.current===x.current?.side&&Qs(N,x.current?.area),[]);return e.jsx(As,{scope:n,searchRef:D,onItemEnter:a.useCallback(N=>{E(N)&&N.preventDefault()},[E]),onItemLeave:a.useCallback(N=>{E(N)||(A.current?.focus(),U(null))},[E]),onTriggerLeave:a.useCallback(N=>{E(N)&&N.preventDefault()},[E]),pointerGraceTimerRef:G,onPointerGraceIntentChange:a.useCallback(N=>{x.current=N},[]),children:e.jsx(b,{...I,children:e.jsx(Kr,{asChild:!0,trapped:o,onMountAutoFocus:L(c,N=>{N.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:e.jsx(Cr,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:g,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:f,onDismiss:S,children:e.jsx(fs,{asChild:!0,...M,dir:p.dir,orientation:"vertical",loop:s,currentTabStopId:z,onCurrentTabStopIdChange:U,onEntryFocus:L(m,N=>{p.isUsingKeyboardRef.current||N.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Vr,{role:"menu","aria-orientation":"vertical","data-state":cr(v.open),"data-radix-menu-content":"",dir:p.dir,...y,...k,ref:O,style:{outline:"none",...k.style},onKeyDown:L(k.onKeyDown,N=>{const $=N.target.closest("[data-radix-menu-content]")===N.currentTarget,j=N.ctrlKey||N.altKey||N.metaKey,Z=N.key.length===1;$&&(N.key==="Tab"&&N.preventDefault(),!j&&Z&&P(N.key));const Y=A.current;if(N.target!==Y||!Ss.includes(N.key))return;N.preventDefault();const Q=w().filter(K=>!K.disabled).map(K=>K.ref.current);$t.includes(N.key)&&Q.reverse(),Ys(Q)}),onBlur:L(t.onBlur,N=>{N.currentTarget.contains(N.target)||(window.clearTimeout(F.current),D.current="")}),onPointerMove:L(t.onPointerMove,ve(N=>{const W=N.target,$=_.current!==N.clientX;if(N.currentTarget.contains(W)&&$){const j=N.clientX>_.current?"right":"left";C.current=j,_.current=N.clientX}}))})})})})})})});Kt.displayName=q;var $s="MenuGroup",dt=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"group",...s,ref:r})});dt.displayName=$s;var Us="MenuLabel",Vt=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{...s,ref:r})});Vt.displayName=Us;var Pe="MenuItem",wt="menu.itemSelect",Fe=a.forwardRef((t,r)=>{const{disabled:n=!1,onSelect:s,...o}=t,c=a.useRef(null),d=ze(Pe,t.__scopeMenu),i=ct(Pe,t.__scopeMenu),m=xe(r,c),g=a.useRef(!1),l=()=>{const u=c.current;if(!n&&u){const f=new CustomEvent(wt,{bubbles:!0,cancelable:!0});u.addEventListener(wt,S=>s?.(S),{once:!0}),Nr(u,f),f.defaultPrevented?g.current=!1:d.onClose()}};return e.jsx(Zt,{...o,ref:m,disabled:n,onClick:L(t.onClick,l),onPointerDown:u=>{t.onPointerDown?.(u),g.current=!0},onPointerUp:L(t.onPointerUp,u=>{g.current||u.currentTarget?.click()}),onKeyDown:L(t.onKeyDown,u=>{const f=i.searchRef.current!=="";n||f&&u.key===" "||Qe.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Fe.displayName=Pe;var Zt=a.forwardRef((t,r)=>{const{__scopeMenu:n,disabled:s=!1,textValue:o,...c}=t,d=ct(Pe,n),i=Gt(n),m=a.useRef(null),g=xe(r,m),[l,u]=a.useState(!1),[f,S]=a.useState("");return a.useEffect(()=>{const h=m.current;h&&S((h.textContent??"").trim())},[c.children]),e.jsx(fe.ItemSlot,{scope:n,disabled:s,textValue:o??f,children:e.jsx(vs,{asChild:!0,...i,focusable:!s,children:e.jsx(re.div,{role:"menuitem","data-highlighted":l?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...c,ref:g,onPointerMove:L(t.onPointerMove,ve(h=>{s?d.onItemLeave(h):(d.onItemEnter(h),h.defaultPrevented||h.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:L(t.onPointerLeave,ve(h=>d.onItemLeave(h))),onFocus:L(t.onFocus,()=>u(!0)),onBlur:L(t.onBlur,()=>u(!1))})})})}),Gs="MenuCheckboxItem",Yt=a.forwardRef((t,r)=>{const{checked:n=!1,onCheckedChange:s,...o}=t;return e.jsx(er,{scope:t.__scopeMenu,checked:n,children:e.jsx(Fe,{role:"menuitemcheckbox","aria-checked":Te(n)?"mixed":n,...o,ref:r,"data-state":xt(n),onSelect:L(o.onSelect,()=>s?.(Te(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Yt.displayName=Gs;var qt="MenuRadioGroup",[Bs,Hs]=oe(qt,{value:void 0,onValueChange:()=>{}}),Jt=a.forwardRef((t,r)=>{const{value:n,onValueChange:s,...o}=t,c=rt(s);return e.jsx(Bs,{scope:t.__scopeMenu,value:n,onValueChange:c,children:e.jsx(dt,{...o,ref:r})})});Jt.displayName=qt;var Xt="MenuRadioItem",Qt=a.forwardRef((t,r)=>{const{value:n,...s}=t,o=Hs(Xt,t.__scopeMenu),c=n===o.value;return e.jsx(er,{scope:t.__scopeMenu,checked:c,children:e.jsx(Fe,{role:"menuitemradio","aria-checked":c,...s,ref:r,"data-state":xt(c),onSelect:L(s.onSelect,()=>o.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Qt.displayName=Xt;var ut="MenuItemIndicator",[er,Ws]=oe(ut,{checked:!1}),tr=a.forwardRef((t,r)=>{const{__scopeMenu:n,forceMount:s,...o}=t,c=Ws(ut,n);return e.jsx(Le,{present:s||Te(c.checked)||c.checked===!0,children:e.jsx(re.span,{...o,ref:r,"data-state":xt(c.checked)})})});tr.displayName=ut;var Ks="MenuSeparator",rr=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"separator","aria-orientation":"horizontal",...s,ref:r})});rr.displayName=Ks;var Vs="MenuArrow",nr=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,o=Oe(n);return e.jsx(Zr,{...o,...s,ref:r})});nr.displayName=Vs;var Zs="MenuSub",[Fo,sr]=oe(Zs),be="MenuSubTrigger",ar=a.forwardRef((t,r)=>{const n=ie(be,t.__scopeMenu),s=ze(be,t.__scopeMenu),o=sr(be,t.__scopeMenu),c=ct(be,t.__scopeMenu),d=a.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:m}=c,g={__scopeMenu:t.__scopeMenu},l=a.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return a.useEffect(()=>l,[l]),a.useEffect(()=>{const u=i.current;return()=>{window.clearTimeout(u),m(null)}},[i,m]),e.jsx(ot,{asChild:!0,...g,children:e.jsx(Zt,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":cr(n.open),...t,ref:nt(r,o.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:L(t.onPointerMove,ve(u=>{c.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!d.current&&(c.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{n.onOpenChange(!0),l()},100))})),onPointerLeave:L(t.onPointerLeave,ve(u=>{l();const f=n.content?.getBoundingClientRect();if(f){const S=n.content?.dataset.side,h=S==="right",k=h?-5:5,v=f[h?"left":"right"],p=f[h?"right":"left"];c.onPointerGraceIntentChange({area:[{x:u.clientX+k,y:u.clientY},{x:v,y:f.top},{x:p,y:f.top},{x:p,y:f.bottom},{x:v,y:f.bottom}],side:S}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(u),u.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:L(t.onKeyDown,u=>{const f=c.searchRef.current!=="";t.disabled||f&&u.key===" "||Is[s.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});ar.displayName=be;var or="MenuSubContent",ir=a.forwardRef((t,r)=>{const n=Ht(q,t.__scopeMenu),{forceMount:s=n.forceMount,...o}=t,c=ie(q,t.__scopeMenu),d=ze(q,t.__scopeMenu),i=sr(or,t.__scopeMenu),m=a.useRef(null),g=xe(r,m);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Le,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:e.jsx(lt,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:g,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:l=>{d.isUsingKeyboardRef.current&&m.current?.focus(),l.preventDefault()},onCloseAutoFocus:l=>l.preventDefault(),onFocusOutside:L(t.onFocusOutside,l=>{l.target!==i.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:L(t.onEscapeKeyDown,l=>{d.onClose(),l.preventDefault()}),onKeyDown:L(t.onKeyDown,l=>{const u=l.currentTarget.contains(l.target),f=Ms[d.dir].includes(l.key);u&&f&&(c.onOpenChange(!1),i.trigger?.focus(),l.preventDefault())})})})})})});ir.displayName=or;function cr(t){return t?"open":"closed"}function Te(t){return t==="indeterminate"}function xt(t){return Te(t)?"indeterminate":t?"checked":"unchecked"}function Ys(t){const r=document.activeElement;for(const n of t)if(n===r||(n.focus(),document.activeElement!==r))return}function qs(t,r){return t.map((n,s)=>t[(r+s)%t.length])}function Js(t,r,n){const o=r.length>1&&Array.from(r).every(g=>g===r[0])?r[0]:r,c=n?t.indexOf(n):-1;let d=qs(t,Math.max(c,0));o.length===1&&(d=d.filter(g=>g!==n));const m=d.find(g=>g.toLowerCase().startsWith(o.toLowerCase()));return m!==n?m:void 0}function Xs(t,r){const{x:n,y:s}=t;let o=!1;for(let c=0,d=r.length-1;c<r.length;d=c++){const i=r[c],m=r[d],g=i.x,l=i.y,u=m.x,f=m.y;l>s!=f>s&&n<(u-g)*(s-l)/(f-l)+g&&(o=!o)}return o}function Qs(t,r){if(!r)return!1;const n={x:t.clientX,y:t.clientY};return Xs(n,r)}function ve(t){return r=>r.pointerType==="mouse"?t(r):void 0}var ea=Bt,ta=ot,ra=Wt,na=Kt,sa=dt,aa=Vt,oa=Fe,ia=Yt,ca=Jt,la=Qt,da=tr,ua=rr,xa=nr,ma=ar,pa=ir,$e="DropdownMenu",[ba]=tt($e,[Ut]),V=Ut(),[ha,lr]=ba($e),dr=t=>{const{__scopeDropdownMenu:r,children:n,dir:s,open:o,defaultOpen:c,onOpenChange:d,modal:i=!0}=t,m=V(r),g=a.useRef(null),[l,u]=yt({prop:o,defaultProp:c??!1,onChange:d,caller:$e});return e.jsx(ha,{scope:r,triggerId:qe(),triggerRef:g,contentId:qe(),open:l,onOpenChange:u,onOpenToggle:a.useCallback(()=>u(f=>!f),[u]),modal:i,children:e.jsx(ea,{...m,open:l,onOpenChange:u,dir:s,modal:i,children:n})})};dr.displayName=$e;var ur="DropdownMenuTrigger",xr=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...o}=t,c=lr(ur,n),d=V(n);return e.jsx(ta,{asChild:!0,...d,children:e.jsx(re.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:nt(r,c.triggerRef),onPointerDown:L(t.onPointerDown,i=>{!s&&i.button===0&&i.ctrlKey===!1&&(c.onOpenToggle(),c.open||i.preventDefault())}),onKeyDown:L(t.onKeyDown,i=>{s||(["Enter"," "].includes(i.key)&&c.onOpenToggle(),i.key==="ArrowDown"&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});xr.displayName=ur;var ga="DropdownMenuPortal",mr=t=>{const{__scopeDropdownMenu:r,...n}=t,s=V(r);return e.jsx(ra,{...s,...n})};mr.displayName=ga;var pr="DropdownMenuContent",br=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=lr(pr,n),c=V(n),d=a.useRef(!1);return e.jsx(na,{id:o.contentId,"aria-labelledby":o.triggerId,...c,...s,ref:r,onCloseAutoFocus:L(t.onCloseAutoFocus,i=>{d.current||o.triggerRef.current?.focus(),d.current=!1,i.preventDefault()}),onInteractOutside:L(t.onInteractOutside,i=>{const m=i.detail.originalEvent,g=m.button===0&&m.ctrlKey===!0,l=m.button===2||g;(!o.modal||l)&&(d.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});br.displayName=pr;var fa="DropdownMenuGroup",va=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(sa,{...o,...s,ref:r})});va.displayName=fa;var wa="DropdownMenuLabel",ka=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(aa,{...o,...s,ref:r})});ka.displayName=wa;var ja="DropdownMenuItem",hr=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(oa,{...o,...s,ref:r})});hr.displayName=ja;var ya="DropdownMenuCheckboxItem",za=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ia,{...o,...s,ref:r})});za.displayName=ya;var Na="DropdownMenuRadioGroup",Ca=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ca,{...o,...s,ref:r})});Ca.displayName=Na;var Sa="DropdownMenuRadioItem",Ia=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(la,{...o,...s,ref:r})});Ia.displayName=Sa;var Ma="DropdownMenuItemIndicator",Ea=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(da,{...o,...s,ref:r})});Ea.displayName=Ma;var Ra="DropdownMenuSeparator",gr=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ua,{...o,...s,ref:r})});gr.displayName=Ra;var Da="DropdownMenuArrow",_a=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(xa,{...o,...s,ref:r})});_a.displayName=Da;var Pa="DropdownMenuSubTrigger",Ta=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ma,{...o,...s,ref:r})});Ta.displayName=Pa;var Aa="DropdownMenuSubContent",La=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(pa,{...o,...s,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});La.displayName=Aa;var Oa=dr,Fa=xr,$a=mr,Ua=br,Ga=hr,Ba=gr;function Ha({...t}){return e.jsx(Oa,{"data-slot":"dropdown-menu",...t})}function Wa({...t}){return e.jsx(Fa,{"data-slot":"dropdown-menu-trigger",...t})}function Ka({className:t,sideOffset:r=4,...n}){return e.jsx($a,{children:e.jsx(Ua,{"data-slot":"dropdown-menu-content",sideOffset:r,className:T("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...n})})}function Me({className:t,inset:r,variant:n="default",...s}){return e.jsx(Ga,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":n,className:T("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function Va({className:t,...r}){return e.jsx(Ba,{"data-slot":"dropdown-menu-separator",className:T("bg-border -mx-1 my-1 h-px",t),...r})}function Za({incident:t,onBack:r,onExport:n,onGenerateReport:s,onEdit:o,onDelete:c,canEdit:d}){if(!t)return null;const i=m=>{switch(m?.toLowerCase()){case"resolved":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"succeed":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"closed":return"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700";case"open":return"bg-blue-500/15 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"pending":return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800";default:return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800"}};return e.jsx("div",{className:"px-3 md:px-5 py-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:r,className:"mt-0.5 p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all active:scale-95 lg:hidden shrink-0",children:e.jsx(Yr,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(we,{size:10}),t.ticket||"NO-TICKET"]}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-600",children:"•"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(et,{size:10}),t.createdAt?Rt(new Date(t.createdAt),"dd MMM yy"):"-"]})]}),e.jsx("h1",{className:"text-base md:text-lg font-black text-zinc-900 dark:text-zinc-100 leading-tight truncate",children:t.subject}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 flex-wrap",children:[e.jsx(Re,{variant:"outline",className:T("rounded-md border text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5",i(t.status)),children:t.status}),e.jsx(Re,{variant:"outline",className:"rounded-md border-zinc-200 dark:border-zinc-700 text-[9px] font-bold text-zinc-500 bg-zinc-50 dark:bg-zinc-900 px-1.5 py-0.5",children:t.type}),t.project&&e.jsx(Re,{variant:"secondary",className:"rounded-md text-[9px] font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5",children:t.project})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[e.jsx(me,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Export CSV",children:e.jsx(De,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Generate Report",children:e.jsx(Ze,{size:14})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-800 mx-0.5"}),e.jsx(me,{variant:"ghost",size:"icon",onClick:o,className:"h-8 w-8 text-zinc-400 hover:text-zinc-900 dark:hover:text-white",title:"Edit Details",children:e.jsx(de,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 text-zinc-400 hover:text-red-600",title:"Delete Case",children:e.jsx(se,{size:14})})]})]}),e.jsxs(Ha,{children:[e.jsx(Wa,{asChild:!0,className:"md:hidden",children:e.jsx(me,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-400",children:e.jsx(cn,{size:16})})}),e.jsxs(Ka,{align:"end",className:"w-44",children:[e.jsxs(Me,{onClick:n,className:"gap-2",children:[e.jsx(De,{size:14}),"Export CSV"]}),e.jsxs(Me,{onClick:s,className:"gap-2",children:[e.jsx(Ze,{size:14}),"Generate Report"]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Va,{}),e.jsxs(Me,{onClick:o,className:"gap-2",children:[e.jsx(de,{size:14}),"Edit Details"]}),e.jsxs(Me,{onClick:c,className:"gap-2 text-red-600 focus:text-red-600",children:[e.jsx(se,{size:14}),"Delete Case"]})]})]})]})]})]})})}function Ya({incident:t,isLoading:r,onUpdateIncident:n,onAddEvent:s,onDeleteEvent:o,onUpdateEvent:c,onReorderEvent:d,onDeleteIncident:i,onBack:m,canEdit:g}){const{currentUser:l}=zt(),u=a.useRef(null),f=a.useRef(null),[S,h]=a.useState(!1),[k,v]=a.useState(!1),[p,y]=a.useState(null),[M,w]=a.useState(!1),[z,U]=a.useState(""),A=a.useMemo(()=>t?.events?[...t.events].sort((x,C)=>{if(typeof x.order=="number"&&typeof C.order=="number"&&x.order!==C.order)return x.order-C.order;const _=`${x.date||"1970-01-01"}T${x.time||"00:00"}`,b=`${C.date||"1970-01-01"}T${C.time||"00:00"}`;return _<b?1:_>b?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-6 shadow-xl shadow-zinc-200/50 dark:shadow-zinc-950/50",children:e.jsx(le,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-bold text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs text-center",children:"Select an incident to view details"})]})]});const O=(x,C)=>{const _=[...A],b=C==="up"?x-1:x+1;if(b<0||b>=_.length)return;[_[x],_[b]]=[_[b],_[x]];const I=_.map((P,E)=>({...P,order:E}));d&&d(t.id,I)},F=x=>{const C=typeof l=="object"?l?.name:l;n(t.id,{...x,updatedBy:C})},D=async()=>{if(t)try{const x=$=>{if($==null)return"";const j=String($);return j.includes(",")||j.includes(`
`)||j.includes('"')?`"${j.replace(/"/g,'""')}"`:j},C=[...t.events||[]].sort(($,j)=>{const Z=`${$.date||"1970-01-01"}T${$.time||"00:00"}`,Y=`${j.date||"1970-01-01"}T${j.time||"00:00"}`;return Z<Y?-1:Z>Y?1:0}),_=[`Incident,${x(t.subject)}`,`Project,${x(t.project)}`,`Ticket ID,${x(t.ticket)}`,`Current Status,${x(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],b=["Date","Time","Status","Description","Images"].join(","),I=C.map($=>{const j=$.date?new Date($.date).toLocaleDateString("en-GB"):"-",Z=$.time||"-",Y=x($.statusOnLine||""),ce=x($.desc||$.title||""),Q=x(($.imageUrls||[]).join(" ; "));return[j,Z,Y,ce,Q].join(",")}),P="\uFEFF"+[..._,b,...I].join(`
`),E=new Blob([P],{type:"text/csv;charset=utf-8;"}),N=URL.createObjectURL(E),W=document.createElement("a");W.href=N,W.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(N)}catch(x){console.error("Export failed:",x),alert("Failed to export CSV. Please check console.")}},G=()=>{if(!t)return;let x=`[INCIDENT REPORT]
`;x+=`Project : ${t.project||"-"}
`,x+=`Ticket  : ${t.ticket||"-"}
`,x+=`Subject : ${t.subject||"-"}
`,x+=`Status  : ${t.status||"-"}

`,x+=`[DETAILS]
`,x+=`Impact     : ${t.impact||"-"}
`,x+=`Root Cause : ${t.root_cause||"-"}
`,x+=`Action     : ${t.action||"-"}

`,x+=`[TIMELINE]
`;const C=[...t.events||[]].sort((b,I)=>{const P=`${b.date||"1970-01-01"}T${b.time||"00:00"}`,E=`${I.date||"1970-01-01"}T${I.time||"00:00"}`;return P<E?-1:P>E?1:0});let _="";C.forEach(b=>{b.date!==_&&(x+=`
--- ${b.date?new Date(b.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,_=b.date);const I=b.time||"--:--",P=b.statusOnLine?` [${b.statusOnLine}]`:"";x+=`${I}${P} - ${b.desc||b.title}
`}),U(x),w(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 z-20 bg-white dark:bg-[#0e0e11] border-b border-zinc-100 dark:border-zinc-800 relative shadow-sm",children:e.jsx(Za,{incident:t,onUpdate:F,onBack:m,onDelete:()=>i(t.id),onEdit:()=>v(!0),onGenerateReport:G,onExport:D,canEdit:g})}),e.jsx("div",{ref:f,className:"flex-1 overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar bg-zinc-50/50 dark:bg-[#09090b] relative min-h-0",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsxs("div",{className:"w-32 h-32 bg-zinc-100 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-zinc-200 dark:border-zinc-800 animate-spin-slow",style:{animationDuration:"20s"}}),e.jsx(qr,{size:48,className:"text-zinc-300 dark:text-zinc-600 opacity-80",strokeWidth:1})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-1",children:"No Timeline Events"}),e.jsx("p",{className:"text-xs text-zinc-400 max-w-xs text-center mb-8",children:"This case has no operational records yet. Start by adding your first update."}),g&&e.jsxs("button",{onClick:()=>{y(null),h(!0)},className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl text-xs font-bold uppercase tracking-wider shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all",children:[e.jsx(he,{size:16}),"Initialize Log"]})]}):e.jsxs("div",{className:"flex flex-col pb-36 relative max-w-4xl mx-auto min-h-full",children:[A.map((x,C)=>{const _=C===0||x.date!==A[C-1].date;let b="-";try{b=x.date?new Date(x.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{b="-"}return e.jsx(rs,{event:x,index:C,isLastItem:C===A.length-1,showDateHeader:_,dateLabel:b,onMove:O,onEdit:I=>{y(I),h(!0)},onDelete:I=>o(t.id,I),canEdit:g},x.id)}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"absolute bottom-8 right-8 flex flex-col gap-4 z-40 items-end",children:g&&A.length>0&&!r&&e.jsx("button",{onClick:()=>{y(null),h(!0)},className:"w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl shadow-xl shadow-indigo-600/30 hover:scale-105 hover:rotate-90 transition-all duration-300 z-30 flex items-center justify-center active:scale-90",title:"Add Update",children:e.jsx(he,{size:28,strokeWidth:3})})}),e.jsx(ss,{isOpen:S,onClose:()=>h(!1),initialData:p,onDelete:x=>o(t.id,x),onSubmit:x=>{const C=typeof l=="object"?l?.name:l,_={...x};p?(_.updatedBy=C,c(t.id,p.id,_)):(_.createdBy=C,s(t.id,_)),h(!1)}}),e.jsx(as,{isOpen:M,onClose:()=>w(!1),text:z,incident:t}),e.jsx(is,{isOpen:k,onClose:()=>v(!1),incident:t,onUpdate:F,onDelete:()=>i(t.id),onExport:D})]})}const qa=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},Ja=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-blue-500 bg-blue-50/50 dark:bg-blue-500/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},Ke=a.memo(({label:t,value:r,icon:n,colorClass:s})=>{const o=n;return e.jsxs("div",{className:"flex-1 p-4 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:T("p-1.5 rounded-lg shrink-0",s),children:e.jsx(o,{size:12})}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})}),Ve=a.memo(({title:t,icon:r,children:n,accentColor:s="text-zinc-400"})=>{const o=r;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 flex items-center gap-2 tracking-[0.3em] px-1",children:[e.jsx(o,{size:12,className:s})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-[2rem] shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:n})]})]})});function Xa({log:t,onAddToIncident:r,onClose:n}){if(!t)return null;const s=t.createdAt?Rt(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-zinc-950/40 backdrop-blur-md animate-in fade-in transition-all duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-[#fafafa] dark:bg-[#050505] rounded-[3rem] shadow-2xl border border-zinc-200/50 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 slide-in-from-bottom-8 duration-500",children:[e.jsxs("div",{className:"relative shrink-0 p-8 border-b border-zinc-100 dark:border-zinc-900 bg-white dark:bg-[#09090b]",children:[e.jsx("button",{onClick:n,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-zinc-50 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all active:scale-90",children:e.jsx(ne,{size:20})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-lg",children:e.jsx(we,{size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 uppercase tracking-[0.3em]",children:"Operational Log"}),e.jsx("h2",{className:"text-3xl font-black text-zinc-900 dark:text-white tracking-tighter leading-none",children:t.ticketNumber})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(et,{size:12})," ",s]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ge,{size:12})," ",t.type]}),e.jsx("div",{className:T("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-widest",qa(t.status)),children:t.status})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(Ke,{label:"Severity",value:t.severity||"Low",icon:Ae,colorClass:Ja(t.severity)}),e.jsx(Ke,{label:"Hierarchy",value:t.category||"N/A",icon:Ye,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(Ke,{label:"Sub-Class",value:t.subCategory||"N/A",icon:Xr,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(Ve,{title:"Record Description",icon:Jr,accentColor:"text-blue-500",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ve,{title:"Action Deployed",icon:le,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200 italic",children:t.action||"No defensive actions recorded."})}),e.jsx(Ve,{title:"Resolution Status",icon:ge,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-white dark:bg-zinc-900/50 rounded-[2.5rem] border border-zinc-100 dark:border-zinc-900 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-lg font-black shadow-lg shadow-black/10 transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(Sr,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-[0.3em]",children:"Lead Engineer"}),e.jsxs("p",{className:"text-base font-black text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-zinc-300 group-hover:text-blue-500 transition-colors",children:[e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Profile Archive"}),e.jsx(Qr,{size:14})]})]})]}),e.jsxs("div",{className:"p-8 bg-white dark:bg-[#09090b] border-t border-zinc-100 dark:border-zinc-900 flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-16 bg-zinc-950 dark:bg-white text-white dark:text-black rounded-[1.5rem] text-[12px] font-black uppercase tracking-[0.3em] flex items-center justify-center gap-3 shadow-2xl transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Mt,{size:18,className:"fill-current group-hover:animate-pulse"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[10px] font-bold text-zinc-400 uppercase tracking-widest opacity-60",children:"System will reconcile this log into a global incident archive."})]})]})})}const Qa=a.memo(({label:t,value:r,variant:n})=>{const s={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${s[n]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:r}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});Qa.displayName="StatBox";const eo=a.memo(({item:t,type:r})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${r==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticket]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.subject})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${r==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:r==="new"?"New":"Update"})]}));eo.displayName="PreviewRow";function $o(){const{currentUser:t}=zt(),r=Ir(t,[mt.LEAD,mt.ENGINEER]),{toast:n}=Mr(),[s,o]=a.useState("incidents"),{incidents:c,filteredIncidents:d,selectedId:i,setSelectedId:m,loading:g,error:l,stats:u,searchTerm:f,setSearchTerm:S,filterStatus:h,setFilterStatus:k,filterType:v,setFilterType:p,clearFilters:y,hasActiveFilters:M}=Tn(),{sortedEvents:w,loading:z}=An(i),{logs:U,loading:A,stats:O}=Er(),[F,D]=a.useState(null),[G,x]=a.useState({isOpen:!1}),[C,_]=a.useState(!1),[b,I]=a.useState(!1),P=c.find(R=>R.id===i),E=a.useCallback((R,B="success")=>{n({description:R,variant:B==="error"?"destructive":"default"})},[n]),N=async()=>{I(!0);try{const R=typeof t=="object"?t:{name:"Admin"},B=await J.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:R,impact:"",root_cause:"",action:""});o("incidents"),m(B),E("Case created successfully")}catch(R){console.error(R),E("Failed to create incident","error")}finally{I(!1)}},W=async R=>{if(R){I(!0);try{const B=typeof t=="object"?t:{name:"System"},te={subject:R.shortDesc||R.details||`Ticket #${R.ticketNumber}`,ticket:R.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(R.type)?R.type:"Incident",status:"Open",priority:R.severity||"Medium",createdBy:B,impact:"",root_cause:R.details||"",action:R.action||""},Ne=await J.createIncident(te,R.ticketNumber);E(`Ticket #${R.ticketNumber} promoted to Case`),o("incidents"),m(Ne)}catch(B){console.error(B),E("Failed to promote ticket","error")}finally{I(!1)}}},$=R=>{x({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await J.deleteIncident(R),i===R&&m(null),x({isOpen:!1}),E("Case deleted")}catch(B){console.error(B),E("Failed to delete","error")}}})},j=async R=>{if(!R||R.length===0){E("No data to export","error");return}E("Preparing export...","info");try{const B="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",te=R.map(async ee=>{const Ue=`"${ft(ee.createdAt)}","${pe(ee.project)}","${pe(ee.ticket)}","${pe(ee.type)}","${ee.status}","${pe(ee.subject)}","${ee.createdBy?.name||ee.createdBy||""}"`;try{const Ge=await J.getEvents(ee.id);return Ge.length>0?Ge.map(Ce=>{const vr=ft(Ce.date),wr=pe(Ce.desc||Ce.title);return`${Ue},"${vr}","${Ce.time||"-"}","${wr}"`}).join(`
`)+`
,,,,,,,,,`:`${Ue},"-","-","-"
,,,,,,,,,`}catch{return`${Ue},"Error fetching events","-","-"
,,,,,,,,,`}}),Ne=await Promise.all(te),fr=[B,...Ne].join(`
`);Ln(fr,`CaseExport_${new Date().toISOString().split("T")[0]}`),E("Export completed")}catch(B){console.error(B),E("Failed to export data","error")}},Z=async(R,B)=>{try{await J.updateIncident(R,B),E("Incident updated")}catch{E("Update failed","error")}},Y=async(R,B)=>{try{await J.createEvent(R,B),E("Timeline updated")}catch{E("Failed to add event","error")}},ce=async(R,B,te)=>{try{await J.updateEvent(R,B,te),E("Event updated")}catch{E("Failed to update event","error")}},Q=async(R,B)=>J.reorderEvents(R,B),K=async(R,B)=>{x({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await J.deleteEvent(R,B),E("Event removed")}catch{E("Failed to remove event","error")}finally{x({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx(kt,{isOpen:G.isOpen,onClose:()=>x({isOpen:!1}),...G}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${i||F?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(Hn,{filteredIncidents:d,stats:u,loading:g,error:l,logs:U,logsLoading:A,logStats:O,selectedId:i,selectedLogId:F?.ticketNumber,onSelect:R=>{o("incidents"),m(R)},onSelectLog:D,onAddIncident:N,onDeleteIncident:$,onExportCSV:j,viewMode:s,onViewModeChange:R=>{o(R),R==="incidents"&&D(null),R==="logs"&&m(null)},searchTerm:f,setSearchTerm:S,filterStatus:h,setFilterStatus:k,filterType:v,setFilterType:p,clearFilters:y,hasActiveFilters:M,canEdit:r})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${i||F?"flex w-full":"hidden lg:flex"}
      `,children:s==="incidents"&&i?e.jsx(Ya,{incident:P?{...P,events:w}:null,isLoading:z,onBack:()=>m(null),onUpdateIncident:Z,onAddEvent:Y,onUpdateEvent:ce,onDeleteEvent:K,onDeleteIncident:$,onReorderEvent:Q,saving:b,canEdit:r}):s==="logs"&&F?e.jsx(Xa,{log:F,onAddToIncident:W,onClose:()=>D(null),canEdit:r}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-zinc-100 dark:bg-zinc-900 rounded-3xl flex items-center justify-center mb-6 shadow-inner",children:e.jsx(yn,{size:48,strokeWidth:1,className:"text-zinc-400 dark:text-zinc-500 opacity-50"})}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-2 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{$o as default};
