import{a as Y,r as u,j as e,X as J,L as G}from"./index-DK6B-WCw.js";import{b as O,d as I,k as Q,i as V}from"./firebaseConfig-BlIlsXYa.js";import{C as W}from"./cloud-download-Dc17wpCt.js";import{C as q}from"./circle-alert--QTtUIUu.js";import{C as L}from"./search-Bb0GrWoW.js";import{A as Z}from"./arrow-right-DkPDAcYM.js";import{D as H}from"./database-F_kCxUSr.js";import{R as ee}from"./refresh-cw-B6gQuUtT.js";const B="https://script.google.com/macros/s/AKfycbx5ngxY4YuUCQsyGjjudXuuTX5bWU-yZIT-osINDoKQJpO3Jjgs8Yp6hV0GoGUdL0ni/exec";function de({isOpen:r,onClose:i,onSyncComplete:j}){const{currentUser:k}=Y(),[y,P]=u.useState("daily"),[D,_]=u.useState(new Date().toISOString().split("T")[0]),[A,F]=u.useState(new Date().toISOString().slice(0,7)),[m,p]=u.useState("input"),[a,M]=u.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[E,w]=u.useState(null),T=()=>{p("input"),M({newItems:[],updatedItems:[],uptodateItems:[]}),w(null)},K=async()=>{p("analyzing"),w(null);const t=y==="daily"?D:A;try{const l=await fetch(`${B}?date=${t}`,{method:"GET",mode:"cors"});if(!l.ok)throw new Error(`API Error: ${l.statusText}`);const v=await l.json(),b=Array.isArray(v)?v:v.data||[];if(b.length===0)throw new Error("No matches found in Google Calendar for this period.");const d=new Map;b.forEach(s=>{const n=s.match||s.title||"",g=s.time||s.startTime||"",o=s.startDate||"",R=n.toLowerCase().replace(/\s/g,""),S=`${o}|${g}|${R}`;if(d.has(S)){const c=d.get(S),x=s.channel||"";c.isMerged=!0,x&&!c.channel.includes(x)&&(c.channel=c.channel?`${c.channel}, ${x}`:x)}else{let c=n,x="";if(n.includes(" vs ")){const f=n.split(" vs ");c=f[0].trim(),x=f[1]?.trim()||""}else if(n.includes(" - ")){const f=n.split(" - ");c=f[0].trim(),x=f[1]?.trim()||""}d.set(S,{id:s.id?.toString(),time:g,league:s.league||s.calendar||"",match:n,teamA:c,teamB:x,channel:s.channel||"",startDate:o,isMerged:!1})}});const N=Array.from(d.values()).filter(s=>s.id),z=[],h=[],$=[];await Promise.all(N.map(async s=>{const n=O(I,"schedules",s.id),g=await Q(n);if(!g.exists())z.push(s);else{const o=g.data();o.startTime!==s.time||o.title!==s.match||o.channel!==s.channel||o.startDate!==s.startDate?h.push({...s,_prev:o}):$.push(s)}})),M({newItems:z,updatedItems:h,uptodateItems:$}),p("review")}catch(l){console.error(l),w(l.message),p("input")}},X=async()=>{p("saving");try{const t=V(I),l=[...a.newItems,...a.updatedItems],b=(typeof k=="object"?k?.name:k)||"System Sync";l.forEach(d=>{const N=O(I,"schedules",d.id),{_prev:z,...h}=d;t.set(N,{...h,title:h.match,startTime:h.time,updatedAt:new Date().toISOString(),updatedBy:b,...d._prev?{}:{hasStartStat:!1,hasEndStat:!1,createdAt:new Date().toISOString(),createdBy:b}},{merge:!0})}),await t.commit(),j&&j(),p("success"),setTimeout(()=>{i(),T()},2e3)}catch(t){w("Database Error: "+t.message),p("review")}};return r?e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#121212] w-full max-w-2xl rounded-[2rem] border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 bg-zinc-900 text-white sticky top-0 z-10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:e.jsx(W,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-black uppercase tracking-tight",children:"Sync Manager"}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:"Google Sheets Integration"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6",children:[m==="input"&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-left-4",children:[e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 p-1 rounded-xl",children:["daily","monthly"].map(t=>e.jsxs("button",{onClick:()=>P(t),className:`flex-1 py-2 rounded-lg text-xs font-black uppercase transition-all ${y===t?"bg-white dark:bg-black shadow text-blue-600":"text-zinc-400"}`,children:[t," Mode"]},t))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 uppercase",children:"Target Period"}),y==="daily"?e.jsx("input",{type:"date",value:D,onChange:t=>_(t.target.value),className:"w-full p-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl font-mono font-bold outline-none focus:ring-2 focus:ring-blue-500/20"}):e.jsx("input",{type:"month",value:A,onChange:t=>F(t.target.value),className:"w-full p-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl font-mono font-bold outline-none focus:ring-2 focus:ring-blue-500/20"})]}),E&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-500/10 text-red-600 dark:text-red-400 text-xs font-bold rounded-xl flex items-center gap-3 border border-red-100 dark:border-red-500/20",children:[e.jsx(q,{size:16})," ",E]})]}),m==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center space-y-4 animate-in zoom-in-95",children:[e.jsxs("div",{className:"relative",children:[e.jsx(G,{size:40,className:"animate-spin text-blue-500"}),e.jsx("div",{className:"absolute inset-0 blur-xl bg-blue-500/20 animate-pulse"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-black uppercase",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Comparing Sheet vs Database"})]})]}),m==="review"&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(C,{label:"New Entities",value:a.newItems.length,color:"bg-emerald-500/5 text-emerald-600 dark:text-emerald-400 border border-emerald-500/10"}),e.jsx(C,{label:"Modifications",value:a.updatedItems.length,color:"bg-amber-500/5 text-amber-600 dark:text-amber-400 border border-amber-500/10"}),e.jsx(C,{label:"Verified",value:a.uptodateItems.length,color:"bg-zinc-100 dark:bg-zinc-900 text-zinc-400 border border-zinc-200 dark:border-zinc-800"})]}),a.newItems.length>0||a.updatedItems.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[8px] font-black uppercase tracking-widest text-zinc-400",children:"Structural Comparison"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[a.newItems.length+a.updatedItems.length," changes pending"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#0c0c0c] border border-zinc-100 dark:border-zinc-900 rounded-2xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar divide-y divide-zinc-50 dark:divide-zinc-900/50",children:[a.newItems.map(t=>e.jsx(U,{item:t,type:"new"},t.id)),a.updatedItems.map(t=>e.jsx(U,{item:t,type:"update"},t.id))]})})]}):e.jsxs("div",{className:"py-12 text-center border-2 border-dashed border-zinc-100 dark:border-zinc-900 rounded-2xl bg-zinc-50/30 dark:bg-white/[0.01]",children:[e.jsx(L,{size:32,className:"mx-auto mb-3 text-emerald-500/30"}),e.jsx("h3",{className:"text-xs font-black uppercase text-zinc-900 dark:text-white",children:"All Synchronized"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-zinc-400 mt-1",children:"Local database matches remote source"})]})]}),m==="success"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500 blur-2xl opacity-20 animate-pulse"}),e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg relative",children:e.jsx(L,{size:32,strokeWidth:2.5})})]}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-900 dark:text-white",children:"Sync Finalized"}),e.jsx("p",{className:"text-xs font-bold text-zinc-400 mt-2 uppercase tracking-widest",children:"Operational records updated successfully"})]})]}),e.jsxs("div",{className:"shrink-0 p-6 border-t border-zinc-100 dark:border-zinc-900 flex flex-col sm:flex-row justify-end gap-3 bg-white dark:bg-[#0c0c0c]",children:[m==="input"&&e.jsxs("button",{onClick:K,className:"w-full sm:w-auto px-8 py-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl font-black uppercase text-[9px] tracking-widest shadow-xl shadow-black/20 dark:shadow-white/10 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-2 group",children:["Analyze ",e.jsx(Z,{size:12,className:"group-hover:translate-x-1 transition-transform"})]}),m==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:T,className:"px-6 py-3 rounded-xl font-black uppercase text-[9px] tracking-widest text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all",children:"Back"}),e.jsxs("button",{onClick:X,disabled:a.newItems.length===0&&a.updatedItems.length===0,className:"px-8 py-3 bg-blue-600 text-white rounded-xl font-black uppercase text-[9px] tracking-widest shadow-lg shadow-blue-500/20 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:transform-none flex items-center justify-center gap-2",children:[e.jsx(H,{size:12})," Commit"]})]}),m==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-8 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-400",children:[e.jsx(G,{size:12,className:"animate-spin"})," Recording..."]})]})]})}):null}const C=({label:r,value:i,color:j})=>e.jsxs("div",{className:`px-4 py-3 rounded-xl flex flex-col items-center justify-center transition-all hover:scale-105 ${j}`,children:[e.jsx("span",{className:"text-2xl font-black tracking-tighter mb-0.5",children:i}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-60 text-center",children:r})]}),U=({item:r,type:i})=>e.jsxs("div",{className:"px-4 py-3 bg-white dark:bg-transparent flex items-center justify-between group hover:bg-zinc-50/50 dark:hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:`w-1 h-6 rounded-full ${i==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"truncate",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-black text-zinc-800 dark:text-zinc-100 tracking-tight",children:r.match}),r.isMerged&&e.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-blue-500/10 text-blue-500 text-[7px] font-black uppercase tracking-tighter border border-blue-500/20",children:[e.jsx(ee,{size:8})," Duplicate Merged"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("span",{className:"text-[8px] font-bold text-zinc-400 uppercase tracking-widest",children:r.league||"Event"}),e.jsx("span",{className:"text-[8px] font-mono font-bold text-zinc-300",children:"•"}),e.jsx("span",{className:"text-[8px] font-mono font-bold text-zinc-400",children:r.time}),r.channel&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-[8px] font-mono font-bold text-zinc-300",children:"•"}),e.jsx("span",{className:"text-[8px] font-bold text-blue-500 uppercase truncate max-w-[150px]",children:r.channel})]})]})]})]}),e.jsx("div",{className:`px-2 py-1 rounded-lg text-[8px] font-black uppercase tracking-widest border ${i==="new"?"bg-emerald-500/10 text-emerald-600 border-emerald-500/20":"bg-amber-500/10 text-amber-600 border-amber-500/20"}`,children:i==="new"?"New":"Update"})]});export{de as default};
