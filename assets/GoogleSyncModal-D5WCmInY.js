import{c as G,r as h,j as e,X as F,L as D}from"./index-NnLxa0C5.js";import{b as E,d as k,m as P,k as U}from"./firebaseConfig-B-I4EWGW.js";import{C as V}from"./cloud-download-By_Bomjz.js";import{C as Z}from"./circle-alert-DBAkMCP8.js";import{C as M}from"./search-CBJj41SK.js";import{A as H}from"./arrow-right-Dv9Hf0E0.js";const J=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],q=G("database",J),R="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec";function te({isOpen:c,onClose:r,onSyncComplete:u}){const[g,L]=h.useState("daily"),[w,T]=h.useState(new Date().toISOString().split("T")[0]),[y,B]=h.useState(new Date().toISOString().slice(0,7)),[i,l]=h.useState("input"),[s,z]=h.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[N,f]=h.useState(null),S=()=>{l("input"),z({newItems:[],updatedItems:[],uptodateItems:[]}),f(null)},O=async()=>{l("analyzing"),f(null);const a=g==="daily"?w:y;try{const o=await fetch(`${R}?date=${a}`);if(!o.ok)throw new Error("Failed to fetch from Google Script");const d=await o.json(),x=Array.isArray(d)?d:d.data||[];if(x.length===0)throw new Error("No data found in Sheet.");if(x[0]?.error)throw new Error(x[0].error);const I=x.map(t=>{const p=t.match||t.title||t.Match||"";let b=p,n="";if(p.includes(" vs ")){const j=p.split(" vs ");b=j[0].trim(),n=j[1]?.trim()||""}return{id:t.id?.toString(),time:t.time||t.startTime||"",league:t.league||t.calendar||"",match:p,teamA:b,teamB:n,channel:t.channel||t.Channel||"",startDate:t.startDate||(g==="daily"?w:"")}}).filter(t=>t.id),m=[],C=[],A=[];await Promise.all(I.map(async t=>{const p=E(k,"schedules",t.id),b=await P(p);if(!b.exists())m.push(t);else{const n=b.data();n.startTime!==t.time||n.title!==t.match||n.channel!==t.channel||n.startDate!==t.startDate?C.push({...t,_prev:n}):A.push(t)}})),z({newItems:m,updatedItems:C,uptodateItems:A}),l("review")}catch(o){console.error(o),f(o.message),l("input")}},$=async()=>{l("saving");try{const a=U(k);[...s.newItems,...s.updatedItems].forEach(d=>{const x=E(k,"schedules",d.id),{_prev:I,...m}=d;a.set(x,{...m,title:m.match,startTime:m.time,updatedAt:new Date().toISOString(),...d._prev?{}:{hasStartStat:!1,hasEndStat:!1}},{merge:!0})}),await a.commit(),u&&u(),setTimeout(()=>{r(),S()},1500),l("success")}catch(a){f("Database Error: "+a.message),l("review")}};return c?e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#121212] w-full max-w-2xl rounded-[2rem] border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 bg-zinc-900 text-white sticky top-0 z-10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:e.jsx(V,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-black uppercase tracking-tight",children:"Sync Manager"}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:"Google Sheets Integration"})]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-full",children:e.jsx(F,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6",children:[i==="input"&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-left-4",children:[e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 p-1 rounded-xl",children:["daily","monthly"].map(a=>e.jsxs("button",{onClick:()=>L(a),className:`flex-1 py-2 rounded-lg text-xs font-black uppercase ${g===a?"bg-white dark:bg-black shadow text-blue-600":"text-zinc-400"}`,children:[a," Mode"]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 uppercase",children:"Target Period"}),g==="daily"?e.jsx("input",{type:"date",value:w,onChange:a=>T(a.target.value),className:"w-full p-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl font-mono font-bold"}):e.jsx("input",{type:"month",value:y,onChange:a=>B(a.target.value),className:"w-full p-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl font-mono font-bold"})]}),N&&e.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-xs font-bold rounded-lg flex items-center gap-2",children:[e.jsx(Z,{size:14})," ",N]})]}),i==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center space-y-4 animate-in zoom-in-95",children:[e.jsx(D,{size:40,className:"animate-spin text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-black uppercase",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Comparing Sheet vs Database"})]})]}),i==="review"&&e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(v,{label:"New Entities",value:s.newItems.length,color:"bg-emerald-500/5 text-emerald-600 dark:text-emerald-400 border border-emerald-500/10"}),e.jsx(v,{label:"Modifications",value:s.updatedItems.length,color:"bg-amber-500/5 text-amber-600 dark:text-amber-400 border border-amber-500/10"}),e.jsx(v,{label:"Verified",value:s.uptodateItems.length,color:"bg-zinc-100 dark:bg-zinc-900 text-zinc-400 border border-zinc-200 dark:border-zinc-800"})]}),s.newItems.length>0||s.updatedItems.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[8px] font-black uppercase tracking-widest text-zinc-400",children:"Structural Comparison"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[s.newItems.length+s.updatedItems.length," changes pending"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#0c0c0c] border border-zinc-100 dark:border-zinc-900 rounded-2xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[300px] overflow-y-auto custom-scrollbar divide-y divide-zinc-50 dark:divide-zinc-900/50",children:[s.newItems.map(a=>e.jsx(_,{item:a,type:"new"},a.id)),s.updatedItems.map(a=>e.jsx(_,{item:a,type:"update"},a.id))]})})]}):e.jsxs("div",{className:"py-8 text-center border-2 border-dashed border-zinc-100 dark:border-zinc-900 rounded-2xl bg-zinc-50/30 dark:bg-white/[0.01]",children:[e.jsx(M,{size:32,className:"mx-auto mb-3 text-emerald-500/30"}),e.jsx("h3",{className:"text-xs font-black uppercase text-zinc-900 dark:text-white",children:"All Synchronized"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-zinc-400 mt-1",children:"Local database matches remote source"})]})]}),i==="success"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500 blur-2xl opacity-20 animate-pulse"}),e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg relative",children:e.jsx(M,{size:32,strokeWidth:2.5})})]}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-900 dark:text-white",children:"Sync Finalized"}),e.jsx("p",{className:"text-xs font-bold text-zinc-400 mt-2 uppercase tracking-widest",children:"Operational records updated successfully"})]})]}),e.jsxs("div",{className:"shrink-0 p-6 border-t border-zinc-100 dark:border-zinc-900 flex flex-col sm:flex-row justify-end gap-3 bg-white dark:bg-[#0c0c0c]",children:[i==="input"&&e.jsxs("button",{onClick:O,className:"w-full sm:w-auto px-8 py-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl font-black uppercase text-[9px] tracking-widest shadow-xl shadow-black/20 dark:shadow-white/10 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-2 group",children:["Analyze ",e.jsx(H,{size:12,className:"group-hover:translate-x-1 transition-transform"})]}),i==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S,className:"px-6 py-3 rounded-xl font-black uppercase text-[9px] tracking-widest text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all",children:"Back"}),e.jsxs("button",{onClick:$,disabled:s.newItems.length===0&&s.updatedItems.length===0,className:"px-8 py-3 bg-blue-600 text-white rounded-xl font-black uppercase text-[9px] tracking-widest shadow-lg shadow-blue-500/20 hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:transform-none flex items-center justify-center gap-2",children:[e.jsx(q,{size:12})," Commit"]})]}),i==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-8 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-400",children:[e.jsx(D,{size:12,className:"animate-spin"})," Recording..."]})]})]})}):null}const v=({label:c,value:r,color:u})=>e.jsxs("div",{className:`px-4 py-3 rounded-xl flex flex-col items-center justify-center transition-all hover:scale-105 ${u}`,children:[e.jsx("span",{className:"text-2xl font-black tracking-tighter mb-0.5",children:r}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-60 text-center",children:c})]}),_=({item:c,type:r})=>e.jsxs("div",{className:"px-4 py-3 bg-white dark:bg-transparent flex items-center justify-between group hover:bg-zinc-50/50 dark:hover:bg-white/[0.02] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:`w-1 h-6 rounded-full ${r==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"text-xs font-black text-zinc-800 dark:text-zinc-100 tracking-tight",children:c.match}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("span",{className:"text-[8px] font-bold text-zinc-400 uppercase tracking-widest",children:c.league||"Event"}),e.jsx("span",{className:"text-[8px] font-mono font-bold text-zinc-300",children:"â€¢"}),e.jsx("span",{className:"text-[8px] font-mono font-bold text-zinc-400",children:c.time})]})]})]}),e.jsx("div",{className:`px-2 py-1 rounded-lg text-[8px] font-black uppercase tracking-widest border ${r==="new"?"bg-emerald-500/10 text-emerald-600 border-emerald-500/20":"bg-amber-500/10 text-amber-600 border-amber-500/20"}`,children:r==="new"?"New":"Update"})]});export{te as default};
