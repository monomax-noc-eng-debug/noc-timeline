import{c as te,a as H,r as b,b as re,j as e,F as K,X as q,e as ae,C as Q,S as _,M as G,L as Z,T as se,d as ne}from"./index-NnLxa0C5.js";import{b as U,d as T,u as V,e as ie,f as ce,h as de,i as le,c as W,q as oe,l as xe,o as Y,j as be}from"./firebaseConfig-B-I4EWGW.js";import{P as me,a as pe,p as X,b as ue,C as he,S as ge}from"./popover-BTh3yhaj.js";import{C as ee,P as fe,T as ke}from"./trash-2-CSAiA0vi.js";import{S as ze,a as je,P as we}from"./save-DeiPSA3q.js";import{f as ye}from"./format-B2edJEpO.js";import{C as J,S as ve}from"./search-CBJj41SK.js";import{U as Ne}from"./users-DwtRTdTx.js";import{C as Se}from"./circle-alert-DBAkMCP8.js";import{C as De}from"./cloud-download-By_Bomjz.js";import{F as Ce}from"./addYears-DS8uA00Y.js";const Ae=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]],$e=te("layout-panel-top",Ae),E="shift_handovers",O={subscribeHandovers:(t,s=50)=>{const c=oe(W(T,E),Y("date","desc"),Y("createdAt","desc"),xe(s));return be(c,m=>{const k=m.docs.map(o=>({id:o.id,...o.data(),onDuty:o.data().onDuty||[],acknowledgedBy:o.data().acknowledgedBy||[]}));t(k)},m=>{console.error("Firestore subscription error:",m),t([])})},createHandover:async t=>{try{const s={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:t.acknowledgedBy||[],onDuty:t.onDuty||[]};return await le(W(T,E),s)}catch(s){throw console.error("Create handover error:",s),new Error("Failed to create handover log")}},updateHandover:async(t,s)=>{try{const c={...s,updatedAt:new Date().toISOString()};await V(U(T,E,t),c)}catch(c){throw console.error("Update handover error:",c),new Error("Failed to update handover log")}},deleteHandover:async t=>{try{await de(U(T,E,t))}catch(s){throw console.error("Delete handover error:",s),new Error("Failed to delete handover log")}},toggleAcknowledge:async(t,s,c)=>{try{const m=U(T,E,t);await V(m,{acknowledgedBy:c?ie(s):ce(s),updatedAt:new Date().toISOString()})}catch(m){throw console.error("Toggle acknowledge error:",m),new Error("Failed to update acknowledgment")}}},Fe=()=>{const t=H(i=>i.currentUser),s=H(i=>i.nocMembers),[c,m]=b.useState([]),[k,o]=b.useState(!0),[u,z]=b.useState(!1),[a,l]=b.useState(""),[h,p]=b.useState("All"),[N,S]=b.useState("All"),[j,n]=b.useState(""),{toast:f}=re(),r=b.useCallback((i,d="success")=>{f({description:i,variant:d})},[f]);b.useEffect(()=>{if(!t){m([]),o(!1);return}o(!0);const i=O.subscribeHandovers(d=>{m(d),o(!1)});return()=>i()},[t]);const g=b.useMemo(()=>c.filter(i=>{const d=j.toLowerCase(),w=i.note?.toLowerCase().includes(d)||!1,y=(i.onDuty||[]).some(R=>typeof R=="string"&&R.toLowerCase().includes(d)),v=i.status?.toLowerCase().includes(d)||!1,M=!d||w||y||v,A=!a||i.date===a,x=h==="All"||i.shift===h,D=N==="All"||i.status===N;return M&&A&&x&&D}),[c,j,a,h,N]),C=b.useCallback(i=>{const d=s.length,w=(i.acknowledgedBy||[]).length,y=d>0?Math.round(w/d*100):0,v=w>=d;return{total:d,acked:w,percentage:y,isComplete:v}},[s]),$=b.useMemo(()=>{const i=g.length,d=g.filter(y=>y.status!=="Normal").length,w=g.filter(y=>{const{isComplete:v}=C(y);return v}).length;return{total:i,withIssues:d,fullyAcked:w}},[g,C]),P=async(i,d,w)=>{z(!0);try{return d?(await O.updateHandover(w,i),r("Log updated successfully")):(await O.createHandover(i),r("Log created successfully")),!0}catch(y){return r(y.message||"Save failed","error"),!1}finally{z(!1)}},F=async i=>{try{await O.deleteHandover(i),r("Log deleted")}catch(d){r(d.message||"Delete failed","error")}},B=async(i,d)=>{if(!t){r("Please login first!","error");return}const w=(i.acknowledgedBy||[]).includes(d);try{await O.toggleAcknowledge(i.id,d,w),r(w?"Acknowledgment removed":"Acknowledged âœ“")}catch(y){r(y.message||"Failed to update","error")}},L=()=>{const d=["Date,Time,Shift,Status,Team,Acknowledged,Note",...g.map(v=>{const M=new Date(v.date).toLocaleDateString("en-GB"),A=(v.note||"").replace(/"/g,'""'),x=(v.onDuty||[]).join("; "),D=(v.acknowledgedBy||[]).join("; ");return`"${M}","${v.time}","${v.shift}","${v.status}","${x}","${D}","${A}"`})].join(`
`),w=new Blob(["\uFEFF"+d],{type:"text/csv;charset=utf-8;"}),y=document.createElement("a");y.href=URL.createObjectURL(w),y.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,y.click(),r("CSV exported")},I=()=>{l(""),p("All"),S("All"),n("")};return{filteredHistory:g,loading:k,saving:u,stats:$,filterDate:a,setFilterDate:l,filterShift:h,setFilterShift:p,filterStatus:N,setFilterStatus:S,searchText:j,setSearchText:n,clearFilters:I,clearFilters:I,showToast:r,handleSave:P,handleDelete:F,handleAcknowledge:B,handleExportCSV:L,getAckStats:C}},Le=(t,s,c,m,k)=>{const o=b.useCallback(()=>{const n=new Date,f=n.getHours(),r=f>=20||f<8,g=n.toTimeString().slice(0,5);return{date:n.toISOString().split("T")[0],time:g,shift:r?"Night":"Morning",onDuty:c?[c]:[],status:"Normal",note:"",acknowledgedBy:[]}},[c]),[u,z]=b.useState(o()),[a,l]=b.useState({});b.useEffect(()=>{t&&(z(s?{...s,onDuty:s.onDuty||[],acknowledgedBy:s.acknowledgedBy||[]}:o()),l({}))},[t,s,o]);const h=n=>{z(f=>f.onDuty.includes(n)?{...f,onDuty:f.onDuty.filter(g=>g!==n)}:{...f,onDuty:[...f.onDuty,n]})},p=(n,f)=>{z(r=>({...r,[n]:f})),a[n]&&l(r=>({...r,[n]:null}))},N=()=>{const n={};return u.date||(n.date="Date is required"),u.time||(n.time="Time is required"),(!u.onDuty||u.onDuty.length===0)&&(n.onDuty="At least one staff member required"),l(n),Object.keys(n).length===0},S=n=>{n?.preventDefault(),N()&&k(u)},j=s?m:m.filter(n=>n.name===c);return{formData:u,errors:a,setField:p,toggleMember:h,handleSubmit:S,displayMembers:j}};function Me({isOpen:t,onClose:s,onSubmit:c,initialData:m,isEditing:k,currentUser:o,saving:u=!1}){const{nocMembers:z}=H(),{formData:a,errors:l,setField:h,toggleMember:p,handleSubmit:N,displayMembers:S}=Le(t,m,o,z,c);if(b.useEffect(()=>{const r=g=>{g.key==="Escape"&&t&&s()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,s]),!t)return null;const j="block text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2",n="w-full bg-zinc-50 dark:bg-zinc-950 border-2 border-zinc-100 dark:border-zinc-800 rounded-xl px-4 py-3 text-sm font-bold text-zinc-900 dark:text-white focus:border-black dark:focus:border-white outline-none transition-all",f="text-[9px] font-bold text-red-500 mt-1";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-zinc-900/60 dark:bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:s,children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-[#18181b] rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-300",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 bg-gradient-to-r from-white to-zinc-50 dark:from-[#18181b] dark:to-zinc-900 flex justify-between items-center sticky top-0 z-10 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-black uppercase tracking-tighter text-zinc-900 dark:text-white flex items-center gap-2",children:[k?e.jsx(K,{size:20,className:"text-zinc-400"}):e.jsx(ee,{size:20,className:"text-zinc-400"}),k?"Edit Log":"New Shift Log"]}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest mt-1",children:k?"Update handover details":"Record shift handover"})]}),e.jsx("button",{onClick:s,disabled:u,className:"p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 hover:text-black dark:hover:text-white rounded-full transition-colors disabled:opacity-50",children:e.jsx(q,{size:20})})]}),e.jsxs("div",{className:"p-8 overflow-y-auto space-y-6 bg-white dark:bg-[#18181b] [&::-webkit-scrollbar]:hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Date"}),e.jsxs(me,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs("button",{type:"button",className:ae(n,"px-4 text-left flex items-center justify-between",!a.date&&"text-zinc-400",l.date?"border-red-400":""),children:[a.date?ye(X(a.date),"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(Q,{size:14,className:"text-zinc-400"})]})}),e.jsx(ue,{className:"w-auto p-0 bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800",align:"start",children:e.jsx(he,{mode:"single",selected:a.date?X(a.date):void 0,onSelect:r=>{if(r){const g=r.getFullYear(),C=String(r.getMonth()+1).padStart(2,"0"),$=String(r.getDate()).padStart(2,"0");h("date",`${g}-${C}-${$}`)}},initialFocus:!0,classNames:{selected:"bg-black! text-white! dark:bg-white! dark:text-black!"}})})]}),l.date&&e.jsx("p",{className:f,children:l.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Time"}),e.jsx("input",{type:"time",value:a.time,onChange:r=>h("time",r.target.value),className:`${n} px-2 text-center ${l.time?"border-red-400":""}`}),l.time&&e.jsx("p",{className:f,children:l.time})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Shift Type"}),e.jsx("div",{className:"flex flex-col gap-2",children:["Morning","Night"].map(r=>e.jsxs("button",{type:"button",onClick:()=>h("shift",r),className:`flex items-center justify-center gap-2 py-3 rounded-xl text-[10px] font-black uppercase transition-all border-2
                      ${a.shift===r?"bg-black text-white border-black dark:bg-white dark:text-black dark:border-white shadow-md":"bg-zinc-50 text-zinc-400 border-zinc-100 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-500 hover:border-zinc-300 dark:hover:border-zinc-600"}`,children:[r==="Morning"?e.jsx(_,{size:14}):e.jsx(G,{size:14}),r]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"On Duty"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(r=>{const g=a.onDuty.includes(r.name);return e.jsx("button",{type:"button",onClick:()=>p(r.name),className:`flex flex-col items-center justify-center p-2 w-full rounded-xl border-2 transition-all
                        ${g?"bg-zinc-50 dark:bg-zinc-800 border-black dark:border-white opacity-100":"bg-white dark:bg-transparent border-zinc-100 opacity-60 hover:opacity-100"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[9px] font-black ${g?"bg-black text-white dark:bg-white dark:text-black":"bg-zinc-200 text-zinc-500"}`,children:r.name.charAt(0)}),e.jsx("span",{className:`text-[10px] font-bold uppercase truncate ${g?"text-black dark:text-white":"text-zinc-400"}`,children:r.name.split(" ")[0]})]})},r.id)})}),l.onDuty&&e.jsx("p",{className:f,children:l.onDuty})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Shift Status"}),e.jsx("div",{className:"flex gap-3 p-1.5 bg-zinc-50 dark:bg-zinc-950 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:["Normal","Issues"].map(r=>e.jsx("button",{type:"button",onClick:()=>h("status",r),className:`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl text-[10px] font-black uppercase transition-all ${a.status===r?"bg-emerald-500 text-white":"text-zinc-400"}`,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:j,children:"Handover Remarks"}),e.jsx("textarea",{rows:4,value:a.note,onChange:r=>h("note",r.target.value),className:n})]})]}),e.jsxs("div",{className:"p-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-[#18181b]/50 flex gap-3 shrink-0",children:[e.jsx("button",{type:"button",onClick:s,disabled:u,className:"flex-1 py-3.5 rounded-xl border-2 border-zinc-200 dark:border-zinc-700 text-zinc-500 font-black uppercase text-[10px] hover:bg-zinc-100 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:N,disabled:u,className:"flex-[2] py-3.5 bg-black dark:bg-white text-white dark:text-black rounded-xl font-black uppercase text-[10px] shadow-lg flex items-center justify-center gap-2",children:[u?e.jsx(Z,{size:16,className:"animate-spin"}):e.jsx(ze,{size:16})," Save Log"]})]})]})})}function Te({log:t,isOpen:s,onClose:c,nocMembers:m}){if(!s||!t)return null;const k=m.length,o=(t.acknowledgedBy||[]).length,u=k>0?Math.round(o/k*100):0,z=o>=k;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-zinc-900/60 dark:bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:c,children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-[#18181b] rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-300",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 bg-gradient-to-r from-zinc-50 to-white dark:from-zinc-900 dark:to-[#18181b]",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[t.shift==="Morning"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-600 dark:text-orange-400 px-2.5 py-1 rounded-full",children:[e.jsx(_,{size:12})," Morning Shift"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 text-indigo-600 dark:text-indigo-400 px-2.5 py-1 rounded-full",children:[e.jsx(G,{size:12})," Night Shift"]}),t.status==="Normal"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 px-2.5 py-1 rounded-full",children:[e.jsx(J,{size:12})," Normal"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2.5 py-1 rounded-full animate-pulse",children:[e.jsx(se,{size:12})," Issues"]})]}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-tighter text-zinc-900 dark:text-white",children:"Shift Log Details"})]}),e.jsx("button",{onClick:c,className:"p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 hover:text-black dark:hover:text-white rounded-full transition-colors hover:bg-zinc-200 dark:hover:bg-zinc-700",children:e.jsx(q,{size:20})})]})}),e.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-2xl border-2 ${z?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500 flex items-center gap-1",children:[e.jsx(ge,{size:12})," Acknowledgment Status"]}),e.jsxs("span",{className:`text-sm font-black ${z?"text-emerald-600":"text-amber-600"}`,children:[u,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-zinc-200 dark:bg-zinc-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-700 rounded-full ${z?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${u}%`}})}),e.jsxs("div",{className:"mt-2 text-[10px] font-bold text-zinc-500",children:[o," of ",k," team members acknowledged"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 p-4 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx(Q,{size:10,className:"inline mr-1"}),"Date"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:new Date(t.date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 p-4 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx(ee,{size:10,className:"inline mr-1"}),"Time Logged"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:t.time})]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3 flex items-center gap-1",children:[e.jsx(Ne,{size:12})," On Duty"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.onDuty&&t.onDuty.length>0?t.onDuty.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2 pl-1 pr-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-full shadow-sm",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-zinc-800 to-zinc-900 dark:from-white dark:to-zinc-100 text-white dark:text-black flex items-center justify-center text-[10px] font-black",children:a.charAt(0)}),e.jsx("span",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:a})]},l)):e.jsx("span",{className:"text-xs text-zinc-400 italic",children:"No staff assigned"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3",children:"Remarks / Note"}),e.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-900/30 p-5 rounded-2xl border border-zinc-100 dark:border-zinc-800 text-sm font-medium text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap min-h-[80px]",children:t.note||e.jsx("span",{className:"text-zinc-400 italic",children:"No additional remarks."})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3",children:"Acknowledged By"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((a,l)=>{const h=(t.acknowledgedBy||[]).includes(a.name);return e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border transition-all ${h?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800":"bg-zinc-50 dark:bg-zinc-800 text-zinc-400 border-zinc-200 dark:border-zinc-700 opacity-60"}`,children:[h?e.jsx(J,{size:12}):e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current"}),a.name]},a.id||l)})})]})]}),e.jsx("div",{className:"px-8 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50",children:e.jsx("button",{onClick:c,className:"w-full py-3 rounded-xl border-2 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 font-black uppercase text-[10px] tracking-widest hover:bg-white dark:hover:bg-zinc-800 transition-colors",children:"Close"})})]})})}function Ee({log:t,currentUser:s,nocMembers:c,onView:m,onEdit:k,onDelete:o,onAck:u,getAckStats:z}){const a=z?z(t):{total:c.length,acked:(t.acknowledgedBy||[]).length,percentage:0,isComplete:!1};!a.percentage&&c.length>0&&(a.percentage=Math.round(a.acked/a.total*100),a.isComplete=a.acked>=a.total);const l=t.shift==="Morning",h=l?"from-orange-500/10 to-amber-500/10 dark:from-orange-500/20 dark:to-amber-500/20 border-l-orange-500":"from-indigo-500/10 to-violet-500/10 dark:from-indigo-500/20 dark:to-violet-500/20 border-l-indigo-500";return e.jsxs("div",{onClick:m,className:`group relative bg-white dark:bg-[#0a0a0a] rounded-2xl border border-zinc-200 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden border-l-4 ${h}`,children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${l?"from-orange-500":"from-indigo-500"} opacity-[0.03] rounded-bl-full pointer-events-none`}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-zinc-100 dark:bg-zinc-800",children:e.jsx("div",{className:`h-full transition-all duration-500 ${a.isComplete?"bg-emerald-500":a.percentage>50?"bg-blue-500":a.percentage>0?"bg-amber-500":"bg-zinc-300 dark:bg-zinc-700"}`,style:{width:`${a.percentage}%`}})}),e.jsxs("div",{className:"flex flex-col md:flex-row p-5 gap-6 relative",children:[e.jsxs("div",{className:"flex md:flex-col items-center md:items-start gap-3 md:w-32 shrink-0 border-b md:border-b-0 md:border-r border-zinc-100 dark:border-zinc-800 pb-4 md:pb-0 md:pr-4",children:[e.jsx("div",{className:`p-2.5 rounded-xl shrink-0 ${l?"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400":"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400"}`,children:l?e.jsx(_,{size:18}):e.jsx(G,{size:18})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-black uppercase text-zinc-900 dark:text-white tracking-wide",children:new Date(t.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}),e.jsx("span",{className:"block text-[10px] font-bold text-zinc-400 font-mono mt-0.5",children:t.time}),e.jsxs("div",{className:`mt-2 text-[9px] font-bold uppercase tracking-wider ${a.isComplete?"text-emerald-500":"text-zinc-400"}`,children:[a.acked,"/",a.total," Ack"]})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[e.jsxs("div",{className:"mb-3",children:[t.status!=="Normal"&&e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 text-[9px] font-black text-red-600 dark:text-red-400 uppercase tracking-wide mb-2",children:[e.jsx(Se,{size:10})," Issue Reported"]}),e.jsx("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 line-clamp-2 leading-relaxed",children:t.note||e.jsx("span",{className:"text-zinc-400 italic",children:"No remarks recorded."})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[e.jsx("div",{className:"flex -space-x-1.5",children:t.onDuty&&t.onDuty.length>0?t.onDuty.map((p,N)=>e.jsx("div",{title:p,className:"w-5 h-5 rounded-full bg-zinc-100 dark:bg-zinc-800 border border-white dark:border-black flex items-center justify-center text-[8px] font-black text-zinc-500 uppercase",children:p.charAt(0)},N)):e.jsx("span",{className:"text-[10px] text-zinc-300",children:"-"})}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-wider pl-1",children:"On Duty"})]})]}),e.jsxs("div",{className:"flex flex-row md:flex-col items-center justify-between md:justify-center gap-4 pl-0 md:pl-4 border-t md:border-t-0 md:border-l border-zinc-100 dark:border-zinc-800 pt-4 md:pt-0",children:[e.jsx("div",{className:"flex md:grid md:grid-cols-2 gap-1.5",children:c.map((p,N)=>{const S=(t.acknowledgedBy||[]).includes(p.name),j=s===p.name;return e.jsx("div",{onClick:n=>{n.stopPropagation(),j&&u(t,p.name)},className:`
                    w-7 h-7 rounded-full border flex items-center justify-center text-[9px] font-black transition-all duration-200
                    ${j?"cursor-pointer hover:scale-110 shadow-sm":"cursor-default"}
                    ${S?"bg-zinc-900 text-white dark:bg-white dark:text-black border-transparent":"bg-zinc-50 dark:bg-zinc-900 text-zinc-400 border-zinc-200 dark:border-zinc-800"}
                    ${j&&!S?"ring-2 ring-blue-500/50 animate-pulse":""}
                  `,title:`${p.name} ${S?"(Acknowledged)":"(Pending)"}`,children:S?e.jsx(je,{size:10,strokeWidth:4}):p.name.charAt(0)},p.id||N)})}),e.jsxs("div",{className:"flex gap-1 md:opacity-0 md:group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),k(t)},className:"p-1.5 text-zinc-400 hover:text-blue-500 transition-colors bg-zinc-50 dark:bg-zinc-900 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20",title:"Edit",children:e.jsx(fe,{size:12})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),o(t.id)},className:"p-1.5 text-zinc-400 hover:text-red-500 transition-colors bg-zinc-50 dark:bg-zinc-900 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20",title:"Delete",children:e.jsx(ke,{size:12})})]})]})]})]})}function We(){const{currentUser:t,nocMembers:s}=H(),{filteredHistory:c,loading:m,saving:k,stats:o,searchText:u,setSearchText:z,filterShift:a,setFilterShift:l,filterStatus:h,setFilterStatus:p,clearFilters:N,handleSave:S,handleDelete:j,handleAcknowledge:n,handleExportCSV:f,getAckStats:r}=Fe(),[g,C]=b.useState(!1),[$,P]=b.useState(!1),[F,B]=b.useState(null),[L,I]=b.useState(!1),[i,d]=b.useState({isOpen:!1}),[w,y]=b.useState(!1),v=(x=null)=>{I(!!x),B(x),C(!0)},M=async x=>{let D={...x};L||(D.timestamp=new Date().toISOString(),t&&(D.onDuty?.includes(t)||(D.onDuty=[...D.onDuty||[],t]),D.acknowledgedBy=[t])),await S(D,L,F?.id)&&C(!1)},A=u||a!=="All"||h!=="All";return e.jsxs("div",{className:"flex flex-col h-full bg-[#fafafa] dark:bg-black transition-colors duration-300 overflow-hidden",children:[e.jsx("header",{className:"shrink-0 px-4 py-3 md:px-6 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 shadow-sm",children:e.jsxs("div",{className:"max-w-[1400px] mx-auto flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20",children:e.jsx(K,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Handover"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),e.jsxs("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-wider",children:[o.fullyAcked," Acked"]})]}),o.withIssues>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"}),e.jsxs("span",{className:"text-[9px] font-bold text-red-500 uppercase tracking-wider",children:[o.withIssues," Issues"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:f,className:"p-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",title:"Export CSV",children:e.jsx(De,{size:20})}),e.jsx("div",{className:"w-px h-6 bg-zinc-200 dark:bg-zinc-800 mx-1"}),e.jsxs("button",{onClick:()=>v(),className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-xl text-[10px] font-black uppercase hover:opacity-90 active:scale-95 transition-all shadow-md",children:[e.jsx(we,{size:14}),"New Log"]})]})]})}),e.jsxs("div",{className:"shrink-0 px-4 md:px-6 py-3 bg-white/50 dark:bg-[#050505]/50 border-b border-zinc-200 dark:border-zinc-800 backdrop-blur-md",children:[e.jsxs("div",{className:"max-w-[1400px] mx-auto flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:14}),e.jsx("input",{type:"text",placeholder:"SEARCH LOGS OR DUTY STAFF...",value:u,onChange:x=>z(x.target.value),className:"w-full h-9 pl-9 pr-4 bg-zinc-100 dark:bg-zinc-900 border-none rounded-lg text-[10px] font-bold uppercase tracking-wider outline-none focus:ring-2 focus:ring-blue-500/20 transition-all placeholder:text-zinc-400"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>y(!w),className:`h-9 px-4 rounded-lg text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-all border ${A?"bg-blue-50 border-blue-200 text-blue-600 dark:bg-blue-900/20 dark:border-blue-800":"bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 text-zinc-500"}`,children:[e.jsx(Ce,{size:14}),"Filters",A&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})]}),A&&e.jsx("button",{onClick:N,className:"h-9 w-9 flex items-center justify-center rounded-lg bg-red-50 dark:bg-red-900/20 text-red-500 border border-red-100 dark:border-red-900/30 hover:bg-red-100 transition-colors",children:e.jsx(q,{size:14})})]})]}),w&&e.jsxs("div",{className:"max-w-[1400px] mx-auto mt-3 p-3 bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 flex flex-wrap gap-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest",children:"Shift"}),e.jsx("div",{className:"flex gap-1",children:["All","Morning","Night"].map(x=>e.jsx("button",{onClick:()=>l(x),className:`px-3 py-1 rounded-md text-[9px] font-bold uppercase transition-all ${a===x?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500"}`,children:x},x))})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest",children:"Status"}),e.jsx("div",{className:"flex gap-1",children:["All","Normal","Issues"].map(x=>e.jsx("button",{onClick:()=>p(x),className:`px-3 py-1 rounded-md text-[9px] font-bold uppercase transition-all ${h===x?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500"}`,children:x},x))})]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 md:px-8 py-8",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(Z,{size:32,className:"text-blue-500 animate-spin mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-[0.2em]",children:"Synchronizing Logs..."})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-[2rem] bg-white/50 dark:bg-white/[0.02]",children:[e.jsx($e,{size:48,className:"text-zinc-200 dark:text-zinc-800 mb-4",strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-widest",children:"No handover logs found"})]}):e.jsx("div",{className:"grid gap-4 pb-20",children:c.map(x=>e.jsx(Ee,{log:x,currentUser:t,nocMembers:s,getAckStats:r,onView:()=>{B(x),P(!0)},onEdit:v,onDelete:D=>d({isOpen:!0,title:"Delete Log?",message:"Are you sure? This action is permanent.",isDanger:!0,onConfirm:()=>{j(D),d({isOpen:!1})}}),onAck:n},x.id))})})}),e.jsx(Me,{isOpen:g,onClose:()=>C(!1),onSubmit:M,initialData:F,isEditing:L,currentUser:t,saving:k}),e.jsx(Te,{log:F,isOpen:$,onClose:()=>P(!1),nocMembers:s}),e.jsx(ne,{isOpen:i.isOpen,onClose:()=>d({isOpen:!1}),...i})]})}export{We as default};
