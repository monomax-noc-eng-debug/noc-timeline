import{a0 as v,f as d,h as s,ad as m,_ as u,q as y,w as R,ac as f,V as i,W as w,$ as h,g as l,a8 as A,o as I}from"./index-Q34mk0jU.js";const o="incidents",O=(e,t)=>{if(!s)return console.error("Firebase not configured! Check your .env file"),t&&t(new Error("Firebase not configured")),e([]),()=>{};try{const n=y(d(s,o),l("createdAt","desc"));return I(n,r=>{const a=r.docs.map(c=>({id:c.id,...c.data()}));e(a)},r=>{console.error("Subscription error:",r.message),t&&t(r),e([])})}catch(n){return t&&t(n),e([]),()=>{}}},D=async e=>{try{const t=i(s,o,e),n=await A(t);return n.exists()?{id:n.id,...n.data()}:null}catch(t){u(t)}},b=async()=>{try{const e=y(d(s,o),l("createdAt","desc"));return(await f(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){u(e)}},q=async e=>{try{return(await v(d(s,o),{...e,status:e.status||"Open",priority:e.priority||"Medium",timeline:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),serverTimestamp:m()})).id}catch(t){u(t)}},T=async(e,t)=>{try{const n=i(s,o,e);await w(n,{...t,updatedAt:new Date().toISOString()})}catch(n){u(n)}},F=async e=>{try{const t=i(s,o,e);await h(t)}catch(t){u(t)}},C=(e,t)=>{if(!e)return()=>{};const n=d(s,o,e,"events"),r=y(n);return I(r,a=>{const c=a.docs.map(p=>({id:p.id,...p.data()}));t(c)},a=>console.error("Error subscribing to events sub-collection:",a))},S=async(e,t)=>{try{const n=d(s,o,e,"events"),r={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},a=await v(n,r),c=i(s,o,e);return await w(c,{updatedAt:m()}),{id:a.id,...r}}catch(n){u(n)}},M=async(e,t,n)=>{try{const r=t.id||n.id;if(!r)throw new Error("Event ID missing for update");const a=i(s,o,e,"events",r),c={...n,updatedAt:new Date().toISOString()};return await w(a,c),{id:r,...c}}catch(r){u(r)}},x=async(e,t)=>{try{const n=t.id;if(!n)throw new Error("Event ID missing for delete");const r=i(s,o,e,"events",n);await h(r)}catch(n){u(n)}},B=async e=>{try{const t=d(s,o,e,"events");return(await f(t)).docs.map(r=>({id:r.id,...r.data()}))}catch(t){return console.error("Error fetching events:",t),[]}},L=S,N=async(e,t,n)=>{const r=i(s,o,e,"events",t);await w(r,{...n,updatedAt:new Date().toISOString()})},_=async(e,t)=>{const n=i(s,o,e,"events",t);await h(n)},P=async(e,t)=>{throw new Error("reorderEvents is not yet implemented for sub-collections")},V=async e=>{try{let t=0,n=0;for(const r of e){const a=y(d(s,o),R("ticket","==",r.ticket)),c=await f(a),p={...r,updatedAt:new Date().toISOString()};if(c.empty)await v(d(s,o),{...p,createdAt:r.createdAt||new Date().toISOString(),status:r.status||"Open",priority:r.priority||"Medium",timeline:[]}),t++;else{const g=c.docs[0].id,E=i(s,o,g);await w(E,p),n++}}return{created:t,updated:n}}catch(t){throw console.error("Import Error:",t),t}},$={subscribeIncidents:O,subscribeEvents:C,getIncidentById:D,getIncidents:b,createIncident:q,updateIncident:T,deleteIncident:F,addTimelineEvent:S,updateTimelineEvent:M,deleteTimelineEvent:x,getEvents:B,createEvent:L,updateEvent:N,deleteEvent:_,reorderEvents:P,importIncidentsFromSheet:V};export{$ as i,O as s};
