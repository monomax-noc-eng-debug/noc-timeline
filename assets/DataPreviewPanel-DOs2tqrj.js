import{e as F,r as x,a as Z,j as t,F as Q,s as K,L as Y,X as ee}from"./index-Q34mk0jU.js";import{k as te,g as ae,j as re,l as se}from"./formatters-CkvMZQNo.js";import{F as L}from"./useMatches-p1m4fDdn.js";import{C as S}from"./check-BzVhAMyo.js";import{C as ie}from"./chevron-down-DTgGqtqR.js";import{C as ne}from"./chevron-right-MWDulPs6.js";import{C as ce}from"./index-DFPlaL-s.js";import{C as de}from"./cloud-download-CcDfvnHD.js";import{C as oe}from"./copy-BEi8nQi4.js";import{Z as le}from"./zap-dCety7eh.js";import{L as xe}from"./layers-CUr3yPnR.js";import{L as he}from"./layout-grid-kHBgeddS.js";import{f as I,i as be}from"./format-_IVVRDDj.js";import"./addYears-PKoCkgVc.js";import"./rotate-ccw-BGOjk6ld.js";import"./useBaseQuery-DdGex9By.js";const pe=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ge=F("external-link",pe);const ke=[["path",{d:"M5 12h14",key:"1ays0h"}]],me=F("minus",ke),ue="https://script.google.com/macros/s/AKfycbzbW8G0iM3zGwl7QNaL1mX6oJtqWv3yjRNfXR_gPHSjzY5wm-WjHl3xpVu9oU71si6hhQ/exec",ze={exportCombinedMatches:async(l,h,m,p)=>{const D={action:"export_combined_matches",date:l,headers:h,startRows:m,endRows:p};try{const d=await fetch(ue,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(D)});if(!d.ok)throw new Error(`Server returned ${d.status} ${d.statusText}`);return!0}catch(d){return console.error("âŒ Export Error:",d),!1}}},z=l=>{try{if(l==null)return"0";const h=te(l);return ae(h)||"0"}catch{return"0"}},C=l=>{try{const h=l?.val??l??0,m=l?.unit||"GB";return se(h,m)?.toLocaleString("en-US",{maximumFractionDigits:4})||"0"}catch{return"0"}},$=l=>{try{return re(l,2)||"0.00 %"}catch{return"0.00 %"}},A=["No.","League","Match","Time","ECS Sport","ECS Ent","API Huawei","WWW & API Peak","CDN","Channel","Req Peak","Req Total","BW Peak","BW Total","Viewers","Score","Start","End"];function Re({data:l,isOpen:h,onClose:m}){const[p,D]=x.useState([]),[d,f]=x.useState(new Set),[k,P]=x.useState("end_stat"),{toast:w}=Z(),[E,H]=x.useState("table"),[y,_]=x.useState(!1),[u,M]=x.useState({});x.useEffect(()=>{h&&Array.isArray(l)&&(D(JSON.parse(JSON.stringify(l))),f(new Set),M({}))},[h,l]);const c=x.useMemo(()=>{if(!p||p.length===0)return[];const e=new Map,r=a=>a.cdn||a.endStats?.cdn||a.startStats?.cdn,i=a=>a.cdnDetails||a.endStats?.cdnDetails||a.startStats?.cdnDetails;return p.forEach(a=>{const n=a.teamA&&a.teamB?`${a.teamA} vs ${a.teamB}`:a.title||a.match||"",o=n?n.toLowerCase().replace(/\s/g,""):"",s=a.startTime||a.time||"",b=a.startDate||"",j=a.id||`${b}|${s}|${o}`;if(e.has(j)){const g=e.get(j);e.set(j,{...g,...a})}else e.set(j,{...a,cdn:r(a),cdnDetails:i(a)})}),Array.from(e.values()).map((a,n)=>({...a,originalNo:n+1}))},[p]),N=x.useMemo(()=>{const e={};return c.forEach(r=>{const i=r.startDate||"unknown";e[i]||(e[i]=[]),e[i].push(r.id)}),e},[c]);x.useEffect(()=>{if(c.length>0&&Object.keys(u).length===0){const e=Object.keys(N),r={};e.forEach(i=>{r[i]=!0}),M(r)}},[N,c.length,u]);const v=(e,r="end_stat")=>{const i=r==="start_stat"?e.startStats||{}:e.endStats||{},a={...e,...i},n=!!(r==="start_stat"?e.startStats:e.endStats),o=e.teamA&&e.teamB&&!e.title?`${e.teamA} vs ${e.teamB}`:e.title||e.match||"-",s={no:e.originalNo,league:e.league||e.calendar||"-",title:o,time:e.startTime||e.time||"-",ecsSport:$(a.ecsSport),ecsEnt:$(a.ecsEntitlement),api:$(a.apiHuawei),reqPeak:z(a.requestPeak),viewers:z(a.muxViewerUniq),score:a.muxScore||"0",start:a.rangeStart||"-",end:a.rangeEnd||"-"},b=[];return(e.cdn==="Multi CDN"||Array.isArray(e.cdnDetails)&&e.cdnDetails.length>0)&&Array.isArray(e.cdnDetails)?e.cdnDetails.forEach((g,B)=>{b.push({id:`${e.id}-cdn-${B}`,matchId:e.id,isMainRow:B===0,hasStats:n,cells:[s.no,s.league,s.title,s.time,s.ecsSport,s.ecsEnt,s.api,s.reqPeak,g.provider||"Unknown",g.key||"-",z(g.reqPeakMin),z(g.reqTotal),C(g.bwPeakGbps),C(g.bandwidth),s.viewers,s.score,s.start,s.end],raw:{league:e.league||e.calendar||"",title:o,time:e.startTime||e.time||""}})}):b.push({id:e.id,matchId:e.id,isMainRow:!0,hasStats:n,cells:[s.no,s.league,s.title,s.time,s.ecsSport,s.ecsEnt,s.api,s.reqPeak,e.cdn||a.cdn||"-",e.liveChannel||e.channel||"-",z(a.reqPeakMin),z(a.reqTotal),C(a.bwPeakGbps),C(a.bandwidth),s.viewers,s.score,s.start,s.end],raw:{league:e.league||e.calendar||"",title:o,time:e.startTime||e.time||""}}),b},U=x.useMemo(()=>{const e=[...c].sort((a,n)=>{const o=a.startDate||"",s=n.startDate||"";return o!==s?o.localeCompare(s):(a.startTime||"").localeCompare(n.startTime||"")}),r=[];let i=null;return e.forEach(a=>{if(a.startDate&&a.startDate!==i&&(r.push({isHeader:!0,date:a.startDate,id:`header-${a.startDate}`}),i=a.startDate),a.startDate&&u[a.startDate]){const n=v(a,k);r.push(...n)}}),r},[c,k,u]),R=e=>{const r=new Set(d);r.has(e)?r.delete(e):r.add(e),f(r)},G=()=>{d.size===c?.length?f(new Set):f(new Set(c.map(e=>e.id)))},O=(e,r)=>{e.stopPropagation();const i=N[r]||[],a=i.every(o=>d.has(o)),n=new Set(d);a?i.forEach(o=>n.delete(o)):i.forEach(o=>n.add(o)),f(n)},V=e=>{M(r=>({...r,[e]:!r[e]}))},X=()=>c.filter(r=>d.has(r.id)).flatMap(r=>v(r,k)),q=x.useMemo(()=>c.filter(e=>d.has(e.id)),[c,d]),J=()=>{window.open("https://docs.google.com/spreadsheets/d/1XHTWZXetw9lwpFhbW2f2gfanlyrvU81J8f8ZpfjgZmk/edit?gid=0","_blank")},W=(e=!1)=>{let r=[];if(e?r=c.flatMap(a=>v(a,k)):r=X(),r.length===0){w({title:"Copy Failed",description:"No data to copy",variant:"destructive"});return}const i=r.map(a=>a.cells.join("	")).join(`
`);navigator.clipboard.writeText(i).then(()=>{w({title:"Success",description:`Copied ${r.length} rows.`,variant:"success"})})},T=async(e="all")=>{if(d.size===0){w({title:"No Selection",description:"Please select at least one match to export.",variant:"destructive"});return}const r=c.filter(i=>d.has(i.id));_(!0);try{const i=I(new Date,"dd-MM-yyyy");let a=[],n=[];(e==="all"||e==="start")&&(a=r.flatMap(s=>v(s,"start_stat").map(b=>b.cells))),(e==="all"||e==="end")&&(n=r.flatMap(s=>v(s,"end_stat").map(b=>b.cells))),await ze.exportCombinedMatches(i,A,a,n),w({title:"Export Success!",description:`Sent ${e==="all"?"All":e==="start"?"Start":"End"} stats for ${r.length} matches.`,variant:"default",className:"bg-emerald-500 text-white border-none"})}catch(i){console.error(i),w({title:"Export Error",description:"Check console for details.",variant:"destructive"})}finally{_(!1)}};return h?t.jsx(Q,{isOpen:!0,onClose:m,showCloseButton:!1,size:"3xl",bodyClassName:"overflow-y-auto custom-scrollbar p-0 sm:p-4 bg-zinc-50/10 dark:bg-black/20",className:"max-h-[98vh] sm:max-h-[90vh]",header:t.jsxs("div",{className:"shrink-0 w-full flex flex-col gap-3 bg-white/50 dark:bg-black/50 backdrop-blur-xl z-20",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-9 h-9 rounded-xl bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-md",children:t.jsx(L,{size:18})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-base font-black text-zinc-900 dark:text-white tracking-tight uppercase leading-none",children:"Data Preview"}),t.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-zinc-400 mt-1.5 uppercase tracking-widest",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(le,{size:10,className:"text-amber-500"})," ",p?.length||0," Raw"]}),t.jsx("div",{className:"w-0.5 h-0.5 rounded-full bg-zinc-300 dark:bg-zinc-700"}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(xe,{size:10,className:"text-blue-500"})," ",c.length," Unique"]})]})]})]}),t.jsx("button",{onClick:m,className:"w-9 h-9 flex items-center justify-center rounded-full bg-zinc-100 dark:bg-zinc-800 text-zinc-400 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-950/30 transition-all active:scale-95",children:t.jsx(ee,{size:20})})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3 overflow-x-auto no-scrollbar",children:[t.jsxs("div",{className:"flex items-center bg-zinc-100/50 dark:bg-zinc-900/50 p-1 rounded-xl border border-zinc-200/50 dark:border-zinc-800/50",children:[t.jsx("button",{onClick:()=>P("start_stat"),className:`h-8 px-4 rounded-lg text-[9px] font-black uppercase tracking-wider transition-all ${k==="start_stat"?"bg-white dark:bg-zinc-800 text-black dark:text-white shadow-sm border border-zinc-200/50 dark:border-zinc-700/50":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"Start Stats"}),t.jsx("button",{onClick:()=>P("end_stat"),className:`h-8 px-4 rounded-lg text-[9px] font-black uppercase tracking-wider transition-all ${k==="end_stat"?"bg-white dark:bg-zinc-800 text-black dark:text-white shadow-sm border border-zinc-200/50 dark:border-zinc-700/50":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"End Stats"})]}),t.jsxs("button",{onClick:()=>H(E==="table"?"compact":"table"),className:"h-9 px-4 flex items-center gap-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all hover:bg-zinc-200 dark:hover:bg-zinc-700 active:scale-95 whitespace-nowrap",children:[t.jsx(he,{size:16}),t.jsx("span",{className:"hidden sm:inline",children:E==="table"?"Cards":"Table"})]})]})]}),footer:t.jsxs("div",{className:"w-full flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsx("div",{className:"flex items-center justify-between md:justify-start gap-4",children:t.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-zinc-50 dark:bg-zinc-900 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[t.jsx("span",{className:`w-2 h-2 rounded-full ${q.length>0?"bg-emerald-500":"bg-zinc-300 dark:bg-zinc-700"}`}),t.jsxs("span",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-widest",children:[q.length," Rows Selected"]})]})}),t.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto no-scrollbar pb-1 md:pb-0",children:[t.jsxs("div",{className:"flex items-center p-1 bg-zinc-50 dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800",children:[t.jsx("button",{onClick:()=>T("start"),disabled:y||c.length===0,className:"h-9 px-4 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-white dark:hover:bg-zinc-800 rounded-xl transition-all disabled:opacity-50 whitespace-nowrap",children:"Start"}),t.jsx("div",{className:"w-px h-1/2 bg-zinc-200 dark:border-zinc-700 mx-1"}),t.jsx("button",{onClick:()=>T("end"),disabled:y||c.length===0,className:"h-9 px-4 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-white dark:hover:bg-zinc-800 rounded-xl transition-all disabled:opacity-50 whitespace-nowrap",children:"End"}),t.jsx("div",{className:"w-px h-1/2 bg-zinc-200 dark:border-zinc-700 mx-1"}),t.jsxs("button",{onClick:()=>T("all"),disabled:y||c.length===0,className:"h-9 px-4 flex items-center gap-2 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl text-[9px] font-black uppercase tracking-widest transition-all shadow-md active:scale-95 disabled:opacity-70 whitespace-nowrap",children:[y?t.jsx(Y,{size:12,className:"animate-spin"}):t.jsx(de,{size:12})," Export All"]})]}),t.jsxs("button",{onClick:J,className:"h-11 px-5 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-zinc-500 dark:text-zinc-400 hover:text-emerald-600 dark:hover:text-emerald-400 text-[10px] font-black uppercase tracking-widest transition-all whitespace-nowrap active:scale-95 flex items-center gap-2",children:[t.jsx(ge,{size:16})," Open Sheet"]}),t.jsx("button",{onClick:()=>W(!0),disabled:c.length===0,className:"h-11 px-5 rounded-2xl border border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900 text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white text-[10px] font-black uppercase tracking-widest transition-all whitespace-nowrap active:scale-95 disabled:opacity-50",children:"Copy All"}),t.jsxs("button",{onClick:()=>W(!1),disabled:d.size===0,className:"h-11 px-6 rounded-2xl bg-zinc-900 dark:bg-white text-white dark:text-black hover:bg-black dark:hover:bg-zinc-100 text-[10px] font-black uppercase tracking-widest shadow-lg flex items-center gap-3 transition-all active:scale-95 disabled:opacity-40 disabled:pointer-events-none whitespace-nowrap",children:[t.jsx(oe,{size:16})," Copy ",k==="start_stat"?"Start":"End"]})]})]}),children:c.length===0?t.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center animate-in fade-in zoom-in-95",children:[t.jsx("div",{className:"w-20 h-20 rounded-3xl bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-zinc-300 mb-4",children:t.jsx(L,{size:40})}),t.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:"No Data Available"}),t.jsx("p",{className:"text-xs text-zinc-500 mt-2 max-w-[250px] leading-relaxed",children:"There are no matches to display."})]}):E==="table"?t.jsx("div",{className:"min-w-full inline-block align-middle",children:t.jsx("div",{className:"bg-white dark:bg-[#0a0a0a] shadow-sm sm:rounded-2xl overflow-hidden border-b sm:border border-zinc-100 dark:border-zinc-800",children:t.jsxs("table",{className:"min-w-full border-separate border-spacing-0",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-zinc-50/50 dark:bg-zinc-900/50",children:[t.jsx("th",{className:"sticky left-0 z-30 p-2 sm:p-3 bg-zinc-50/80 dark:bg-zinc-900/80 backdrop-blur-sm text-left border-b border-zinc-100 dark:border-zinc-800 w-10",children:t.jsx("button",{onClick:G,className:`w-5 h-5 rounded-md flex items-center justify-center transition-all border ${d.size===c?.length&&c.length>0?"bg-zinc-900 dark:bg-white border-zinc-900 dark:border-white text-white dark:text-black":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-transparent hover:border-zinc-400"}`,children:t.jsx(S,{size:12,strokeWidth:4})})}),A.map((e,r)=>t.jsx("th",{className:"px-2 py-2 sm:px-3 sm:py-3 text-left text-[9px] font-black uppercase tracking-widest text-zinc-400 whitespace-nowrap select-none border-b border-zinc-100 dark:border-zinc-800",children:e},r))]})}),t.jsx("tbody",{className:"divide-y divide-zinc-5 dark:divide-zinc-900/50",children:U.map(e=>{if(e.isHeader){const i=u[e.date],a=N[e.date]||[],n=a.every(s=>d.has(s)),o=a.some(s=>d.has(s));return t.jsxs("tr",{className:"bg-zinc-100/90 dark:bg-zinc-800/90 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors cursor-pointer",onClick:()=>V(e.date),children:[t.jsx("td",{className:"sticky left-0 z-20 px-2 sm:px-3 py-2 bg-zinc-100/90 dark:bg-zinc-800/90 border-y border-zinc-200 dark:border-zinc-700",children:t.jsx("div",{className:"flex items-center justify-center gap-2",children:t.jsxs("button",{onClick:s=>O(s,e.date),className:`w-5 h-5 rounded-md flex items-center justify-center transition-all border ${n?"bg-zinc-900 dark:bg-white border-zinc-900 dark:border-white text-white dark:text-black":o?"bg-zinc-300 dark:bg-zinc-600 border-zinc-300 dark:border-zinc-600 text-white":"bg-white dark:bg-zinc-800 border-zinc-300 dark:border-zinc-600 hover:border-zinc-400"}`,children:[n&&t.jsx(S,{size:12,strokeWidth:4}),!n&&o&&t.jsx(me,{size:12,strokeWidth:4})]})})}),t.jsx("td",{colSpan:A.length,className:"px-2 py-2 text-[10px] font-black text-zinc-600 dark:text-zinc-300 uppercase tracking-widest border-y border-zinc-200 dark:border-zinc-700",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-5 h-5 flex items-center justify-center rounded bg-zinc-200 dark:bg-zinc-700 text-zinc-500",children:i?t.jsx(ie,{size:14}):t.jsx(ne,{size:14})}),t.jsx(K,{size:12}),be(new Date(e.date))?I(new Date(e.date),"EEEE, d MMMM yyyy"):e.date,t.jsxs("span",{className:"ml-2 px-1.5 py-0.5 rounded bg-white dark:bg-black border border-zinc-200 dark:border-zinc-700 text-[9px] text-zinc-400",children:[a.length," Matches"]})]})})]},e.id)}const r=d.has(e.matchId);return t.jsxs("tr",{onClick:()=>R(e.matchId),className:`group cursor-pointer transition-colors ${r?"bg-zinc-50 dark:bg-zinc-900/50":"hover:bg-zinc-50/50 dark:hover:bg-zinc-900/30 bg-white dark:bg-[#0a0a0a]"}`,children:[t.jsx("td",{className:`sticky left-0 z-20 p-2 sm:p-3 transition-colors ${r?"bg-zinc-50 dark:bg-zinc-900/50":"bg-white dark:bg-[#0a0a0a] group-hover:bg-zinc-50/50 dark:group-hover:bg-zinc-900/30"}`,children:t.jsx("div",{className:`w-5 h-5 rounded-md flex items-center justify-center transition-all border ${r?"bg-zinc-900 dark:bg-white border-zinc-900 dark:border-white text-white dark:text-black":"bg-transparent border-zinc-200 dark:border-zinc-800 text-transparent group-hover:border-zinc-400"}`,children:t.jsx(S,{size:12,strokeWidth:4})})}),e.cells.map((i,a)=>t.jsx("td",{className:`px-2 py-2 sm:px-3 sm:py-2.5 text-[11px] font-bold whitespace-nowrap font-mono ${r?"text-zinc-900 dark:text-white":"text-zinc-500 dark:text-zinc-400"}`,children:i},a))]},e.id)})})]})})}):t.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:c.map(e=>{if(e.startDate&&!u[e.startDate])return null;const r=d.has(e.id);return t.jsxs("div",{onClick:()=>R(e.id),className:`relative p-4 rounded-2xl border transition-all duration-300 cursor-pointer shadow-sm ${r?"border-zinc-900 dark:border-white bg-zinc-50 dark:bg-zinc-900":"border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#0c0c0e] hover:shadow-md hover:border-zinc-200 dark:hover:border-zinc-700"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:"px-2 py-0.5 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-[8px] font-black uppercase text-zinc-400 tracking-widest border border-zinc-200/50 dark:border-zinc-700/50",children:e.league||e.calendar}),r&&t.jsx("div",{className:"w-5 h-5 rounded-full bg-zinc-900 dark:bg-white flex items-center justify-center text-white dark:text-black shadow-lg",children:t.jsx(S,{size:12,strokeWidth:3})})]}),t.jsx("h4",{className:`text-xs font-black leading-tight mb-3 line-clamp-2 uppercase tracking-tighter ${r?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300"}`,children:e.teamA&&e.teamB?`${e.teamA} vs ${e.teamB}`:e.title||e.match||"-"}),t.jsx("div",{className:"flex items-center gap-2 pt-3 border-t border-zinc-100 dark:border-zinc-900",children:t.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-zinc-400 font-black uppercase",children:[t.jsx(ce,{size:10}),e.startTime||e.time||"-"]})})]},e.id)})})}):null}export{Re as default};
