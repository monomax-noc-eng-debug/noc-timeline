const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TicketSyncModal-DtTlncHZ.js","assets/index-DeB0UNQi.js","assets/index-B_3iS1_v.css","assets/cloud-download-ChoXo7XV.js","assets/formatters-BaVPdGTo.js","assets/format-DGoV6LV2.js","assets/setYear-D3UzLEUF.js","assets/chevron-down-C0MtzhZK.js","assets/rotate-ccw-BIVUIMXV.js","assets/arrow-right-BKpbOeSf.js","assets/database-C_SdLRok.js","assets/parse-B07Sz6Sq.js"])))=>i.map(i=>d[i]);
import{e as _,af as Be,ag as ct,ah as lt,A as ne,r as a,P as We,C as G,ad as ot,j as e,f as N,T as W,X as Q,U as ue,L as ee,a as Ee,b as pe,G as Ae,u as dt,ab as xt,K as Me,H as te,_ as mt,ai as Qe,R as ut,F as Pe,J as bt,Z as Ke,aj as ht,ak as gt,al as pt}from"./index-DeB0UNQi.js";import{Q as ft,u as jt,P as be,H as kt,L as zt}from"./useBaseQuery-DBXqlS8z.js";import{i as V}from"./incidentService-BcKDOBZL.js";import{V as vt,S as he,c as fe,b as Nt,a as yt,d as Xe,g as ge,I as Ze,C as wt,B as Ct,u as Dt,e as St,D as Tt,F as Lt}from"./FilterBar-CKf4JoHi.js";import{C as It,T as je}from"./tag-BOCUZuXy.js";import{a as Z,C as se,h as Et,D as At,T as Mt,f as Pt,b as Re,c as Fe,S as Rt}from"./formatters-BaVPdGTo.js";import{T as J,P as Oe}from"./trash-2-I2HcWu5d.js";import{f as X,i as Ft}from"./format-DGoV6LV2.js";import{P as ke,H as re}from"./panels-top-left-6AlLWY-y.js";import{A as K}from"./activity-BTsV5vZ7.js";import{S as $e}from"./save-C3fkMG-Q.js";import{G as Ot}from"./globe-Cuqv8OAl.js";import{C as Ce}from"./cloud-download-ChoXo7XV.js";import{L as Je}from"./layers-CqHJUMeP.js";import{C as $t}from"./chevron-down-C0MtzhZK.js";import{S as ce}from"./shield-check-C0I4SZic.js";import{p as _e}from"./setYear-D3UzLEUF.js";import{C as Ut}from"./copy-Fz2oJR8g.js";import{c as Bt}from"./configService-LpWpRo6h.js";import"./rotate-ccw-BIVUIMXV.js";const _t=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],qt=_("chevron-up",_t);const Vt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}],["path",{d:"M8 12h8",key:"1wcyev"}]],Ht=_("circle-arrow-right",Vt);const Gt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Wt=_("circle-x",Gt);const Qt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Kt=_("file",Qt);const Xt=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],Zt=_("fingerprint-pattern",Xt);const Jt=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],De=_("flag",Jt);const Yt=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],qe=_("folder-kanban",Yt);const es=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],ts=_("image-plus",es);const ss=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Ye=_("inbox",ss);const rs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],as=_("info",rs);const is=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ns=_("layout-dashboard",is);const cs=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],ls=_("link",cs);const os=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Se=_("message-square",os);const ds=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],xs=_("workflow",ds);const ms=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],us=_("wrench",ms);var bs=class extends ft{constructor(t,r){super(t,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:Be()})}getOptimisticResult(t){return t.behavior=Be(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,r){const{state:s}=t,n=super.createResult(t,r),{isFetching:c,isRefetching:l,isError:o,isRefetchError:i}=n,b=s.fetchMeta?.fetchMore?.direction,m=o&&b==="forward",j=c&&b==="forward",z=o&&b==="backward",h=c&&b==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:lt(r,s.data),hasPreviousPage:ct(r,s.data),isFetchNextPageError:m,isFetchingNextPage:j,isFetchPreviousPageError:z,isFetchingPreviousPage:h,isRefetchError:i&&!m&&!z,isRefetching:l&&!j&&!h}}};function hs(t,r){return jt(t,bs)}const gs=()=>{const{data:t,fetchNextPage:r,hasNextPage:s,isFetchingNextPage:n,isLoading:c,isError:l,error:o}=hs({queryKey:["ticketLogs"],queryFn:async({pageParam:m=null})=>await ne.fetchMoreLogs(m),initialPageParam:null,getNextPageParam:m=>m.lastDoc||void 0,staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),i=t?.pages.flatMap(m=>m.data)||[],b={total:i.length,succeed:i.filter(m=>m.status?.toLowerCase()==="succeed").length,pending:i.filter(m=>m.status?.toLowerCase()==="pending").length,incidents:i.filter(m=>m.status?.toLowerCase()==="open"||m.type==="Incident").length,requests:i.filter(m=>m.type==="Request").length};return{logs:i,loading:c,loadingMore:n,hasMore:s,loadMore:r,stats:b,isError:l,error:o?.message||null}},ps=()=>{const[t,r]=a.useState([]),[s,n]=a.useState(null),[c,l]=a.useState(!0),[o,i]=a.useState(null),[b,m]=a.useState(""),[j,z]=a.useState("All"),[h,u]=a.useState("All");a.useEffect(()=>{l(!0),i(null);const T=V.subscribeIncidents(d=>{const f=(d||[]).map(w=>({...w,_searchString:`${w.subject||""} ${w.project||""} ${w.ticket||""} ${w.createdBy&&typeof w.createdBy=="object"?w.createdBy.name:w.createdBy||""} ${w.status||""} ${w.type||""}`.toLowerCase()}));r(f),l(!1),i(null)},d=>{console.error("useIncidents error:",d),i(d.message||"Failed to connect to database"),l(!1)});return()=>{typeof T=="function"&&T()}},[]);const y=a.useMemo(()=>{const T=b.toLowerCase().trim();return t.filter(f=>{const w=!T||(f._searchString||"").includes(T),R=j==="All"||f.status===j,D=h==="All"||f.type===h;return w&&R&&D}).sort((f,w)=>{const R=f.createdAt?new Date(f.createdAt).getTime():0;return(w.createdAt?new Date(w.createdAt).getTime():0)-R})},[t,b,j,h]),P=a.useMemo(()=>{const T={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((d,f)=>{d.total++;const w=f.status?.replace(/\s+/g,"").replace(/^\w/,R=>R.toLowerCase());return d[w]!==void 0?d[w]++:f.status==="In Progress"&&d.inProgress++,d},T)},[t]),k=a.useCallback(()=>{m(""),z("All"),u("All")},[]);return{incidents:t,filteredIncidents:y,selectedId:s,setSelectedId:n,loading:c,error:o,searchTerm:b,setSearchTerm:m,filterStatus:j,setFilterStatus:z,filterType:h,setFilterType:u,clearFilters:k,hasActiveFilters:!!b||j!=="All"||h!=="All",stats:P}},fs=(t="table")=>{const[r,s]=a.useState(t),[n,c]=a.useState(""),[l,o]=a.useState("All"),[i,b]=a.useState("All"),{logs:m,loading:j,loadMore:z,hasMore:h,loadingMore:u,stats:y,refetch:P}=gs(),{incidents:k,loading:A,error:T}=ps(),d=a.useMemo(()=>{const D=n.toLowerCase().trim();return k.filter(S=>{const C=`${S.subject||""} ${S.project||""} ${S.ticket||""} ${S.createdBy?.name||S.createdBy||""} ${S.status||""}`.toLowerCase(),U=!D||C.includes(D),$=l==="All"||S.status===l,g=i==="All"||S.type===i;return U&&$&&g}).sort((S,C)=>{const U=S.createdAt?new Date(S.createdAt).getTime():0;return(C.createdAt?new Date(C.createdAt).getTime():0)-U})},[k,n,l,i]),f=a.useMemo(()=>{const D=n.toLowerCase().trim();return m.filter(S=>{const C=!D||S.ticketNumber?.toLowerCase().includes(D)||S.shortDesc?.toLowerCase().includes(D)||S.details?.toLowerCase().includes(D),U=l==="All"||S.status===l,$=i==="All"||S.type===i;return C&&U&&$}).sort((S,C)=>S.isFlagged&&!C.isFlagged?-1:!S.isFlagged&&C.isFlagged?1:new Date(C.createdAt||0)-new Date(S.createdAt||0))},[m,n,l,i]),w=a.useCallback(()=>{c(""),o("All"),b("All")},[]);return{viewMode:r,setViewMode:s,searchTerm:n,setSearchTerm:c,filterStatus:l,setFilterStatus:o,filterType:i,setFilterType:b,clearFilters:w,hasActiveFilters:!!n||l!=="All"||i!=="All",logs:m,filteredLogs:f,logsLoading:j,loadMoreLogs:z,hasMoreLogs:h,loadingMoreLogs:u,logStats:y,refetchLogs:P,incidents:k,filteredIncidents:d,incidentsLoading:A,incidentsError:T}},et=a.memo(({label:t,value:r,icon:s,colorClass:n,borderColorClass:c})=>{const l=s;return e.jsx("div",{className:N("relative bg-white dark:bg-zinc-900 border-l-[3px] rounded-r-lg p-4","shadow-sm hover:shadow-md transition-shadow",c),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide mb-1",children:t}),e.jsx("h4",{className:"text-2xl font-bold text-zinc-900 dark:text-white leading-none",children:typeof r=="number"?r.toLocaleString():r})]}),e.jsx("div",{className:N("w-10 h-10 rounded-lg flex items-center justify-center bg-zinc-50 dark:bg-zinc-800"),children:e.jsx(l,{size:20,className:n,strokeWidth:2})})]})})});et.displayName="StatCard";function js({stats:t={}}){const r=[{label:"Total Tickets",value:t?.total||0,icon:We,colorClass:"text-[#0078D4]",borderColorClass:"border-[#0078D4]"},{label:"Resolved",value:t?.succeed||0,icon:It,colorClass:"text-emerald-500",borderColorClass:"border-emerald-500"},{label:"Pending",value:t?.pending||0,icon:Z,colorClass:"text-amber-500",borderColorClass:"border-amber-500"},{label:"Incidents",value:t?.incidents||0,icon:G,colorClass:"text-red-500",borderColorClass:"border-red-500"},{label:"Requests",value:t?.requests||0,icon:ot,colorClass:"text-violet-500",borderColorClass:"border-violet-500"}];return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-3",children:r.map((s,n)=>e.jsx(et,{label:s.label,value:s.value,icon:s.icon,colorClass:s.colorClass,borderColorClass:s.borderColorClass},n))})}const ks=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-500";case"pending":return"bg-amber-500";case"in progress":return"bg-[#0078D4]";case"resolved":case"succeed":case"completed":return"bg-emerald-500";default:return"bg-zinc-400"}},zs=t=>{switch(t?.toLowerCase()){case"open":return{text:"text-red-600",bg:"bg-red-50"};case"pending":return{text:"text-amber-600",bg:"bg-amber-50"};case"in progress":return{text:"text-[#0078D4]",bg:"bg-blue-50"};case"resolved":case"succeed":case"completed":return{text:"text-emerald-600",bg:"bg-emerald-50"};default:return{text:"text-zinc-500",bg:"bg-zinc-50"}}},tt=a.memo(({log:t,onClick:r,isActive:s,onFlag:n,onDelete:c})=>{const l=ks(t.status),o=zs(t.status);return e.jsxs("div",{onClick:()=>r(t),className:N("group relative flex cursor-pointer transition-all border-b border-zinc-100 dark:border-zinc-800/50 hover:bg-zinc-50 dark:hover:bg-zinc-800/50",s?"bg-[#cce3f5] dark:bg-[#0078D4]/20":t.isFlagged?"bg-amber-50/40 dark:bg-amber-900/10":"bg-white dark:bg-zinc-900"),children:[e.jsx("div",{className:N("w-1 shrink-0",s?"bg-[#0078D4]":l)}),e.jsxs("div",{className:"flex-1 p-3 min-w-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.isFlagged&&e.jsx("div",{className:"shrink-0 flex items-center justify-center w-5 h-5 bg-amber-100 dark:bg-amber-900/50 rounded text-amber-600 dark:text-amber-500",title:"Pinned Ticket",children:e.jsx(De,{size:12,fill:"currentColor"})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:N("w-5 h-5 rounded-full flex items-center justify-center font-bold text-[10px]",o.bg,o.text),children:t.responsibility?t.responsibility.charAt(0).toUpperCase():"?"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:N("font-semibold truncate",s?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300"),children:t.responsibility||"Unassigned"}),t.assign&&e.jsxs("span",{className:"text-[9px] text-zinc-400 leading-none",children:["To: ",t.assign]})]})]}),(t.severity==="Critical"||t.severity==="High")&&e.jsx("span",{className:N("px-1.5 py-0.5 rounded text-[9px] font-black uppercase tracking-wider ml-1",t.severity==="Critical"?"bg-red-100 text-red-600 dark:bg-red-900/50 dark:text-red-400 animate-pulse":"bg-orange-100 text-orange-600 dark:bg-orange-900/50 dark:text-orange-400"),children:t.severity})]}),e.jsx("span",{className:N("text-[10px] shrink-0",s?"text-zinc-700 dark:text-zinc-300":"text-zinc-400 group-hover:hidden"),children:t.createdAt?X(new Date(t.createdAt),"MMM dd"):""}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-2 shrink-0 animate-in fade-in duration-200",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),n&&n(t)},className:N("transition-colors",t.isFlagged?"text-amber-500 hover:text-amber-600":"text-zinc-400 hover:text-amber-500"),title:t.isFlagged?"Remove Pin":"Pin to Top",children:e.jsx(De,{size:14,fill:t.isFlagged?"currentColor":"none"})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),c&&c(t.ticketNumber)},className:"text-zinc-400 hover:text-red-500 transition-colors",title:"Delete",children:e.jsx(J,{size:14})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:N("text-sm font-semibold truncate",s?"text-[#0078D4]":"text-zinc-900 dark:text-white",t.isFlagged?"italic":""),children:t.shortDesc||t.details||"(No Subject)"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs truncate",children:[e.jsxs("span",{className:"shrink-0 font-mono text-[10px] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 px-1.5 py-0.5 rounded",children:["#",t.ticketNumber]}),e.jsx("span",{className:N("truncate",s?"text-zinc-600 dark:text-zinc-400":"text-zinc-500"),children:t.details?.substring(0,60)||"No details preview..."}),!s&&e.jsx("span",{className:N("ml-auto shrink-0 px-1.5 py-0.5 rounded-[3px] text-[10px] font-medium uppercase tracking-wider",o.bg,o.text),children:t.status})]})]})]})});tt.displayName="TicketListItem";const st=a.memo(({logs:t,onLogClick:r,isLoading:s,activeLogId:n,onFlag:c,onDelete:l})=>s?e.jsx("div",{className:"p-4 space-y-3",children:[1,2,3,4,5].map(o=>e.jsx("div",{className:"h-20 bg-zinc-100 dark:bg-zinc-800/50 rounded-lg animate-pulse"},o))}):!t||t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-zinc-400",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(se,{size:32})}),e.jsx("p",{className:"font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-sm",children:"No tickets found."})]}):e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800 border-t border-zinc-200 dark:border-zinc-800",children:t.map(o=>e.jsx(tt,{log:o,onClick:r,isActive:n===o.ticketNumber,onFlag:c,onDelete:l},o.id||o.ticketNumber))}));st.displayName="TicketTable";const vs=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Ve=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},rt=a.memo(({date:t})=>{const r=t?new Date(t):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-md bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-bold text-zinc-500 dark:text-zinc-500 uppercase leading-none",children:X(r,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-bold text-zinc-900 dark:text-white leading-none mt-0.5",children:X(r,"dd")}),e.jsx("span",{className:"text-[7px] font-medium text-zinc-400 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:X(r,"yy")})]})});rt.displayName="DateBox";const Te=a.memo(({log:t,onClick:r,onEdit:s,canEdit:n})=>e.jsx("div",{onClick:r,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 shadow-sm hover:border-[#0078D4]/50 transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(rt,{date:t.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-[#deecf9] dark:bg-blue-900/20 text-[#0078D4] dark:text-[#4ba0e8] text-[10px] sm:text-xs font-semibold rounded-md border border-blue-100 dark:border-blue-800/50",children:["#",t.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-semibold px-2 py-0.5 rounded-md border ${vs(t.status)}`,children:t.status})]}),n&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:c=>{c.stopPropagation(),s(t)},className:"p-1.5 text-zinc-400 hover:text-[#0078D4] hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors",children:e.jsx(he,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:t.shortDesc||t.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-bold text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.assign?t.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{size:12,className:Ve(t.severity)}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${Ve(t.severity)}`,children:t.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-500 border border-zinc-200 dark:border-zinc-800 dark:text-zinc-400 font-medium bg-zinc-50 dark:bg-zinc-900 px-2 py-0.5 rounded",children:t.type})]})]})]})}));Te.displayName="MobileTicketCard";function Ns({logs:t,onLogClick:r,onEdit:s,canEdit:n}){const c=a.useCallback(l=>e.jsx(Te,{log:l,onClick:()=>r(l),onEdit:s,canEdit:n},l.id),[r,s,n]);return t.length<=15?e.jsx("div",{className:"md:hidden space-y-4",children:t.map(l=>e.jsx(Te,{log:l,onClick:()=>r(l),onEdit:s,canEdit:n},l.ticketNumber))}):e.jsx("div",{className:"md:hidden",children:e.jsx(vt,{items:t,itemHeight:140,renderItem:c,containerHeight:"calc(100vh - 280px)",className:"space-y-4"})})}const xe=a.memo(({label:t,required:r,icon:s,error:n,...c})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[s&&e.jsx(s,{size:10,className:"text-[#0078D4]"}),t," ",r&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...c,className:N("w-full h-9 px-3 bg-zinc-50 dark:bg-zinc-800 border rounded-lg text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400","focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none disabled:opacity-50 disabled:bg-zinc-100 dark:disabled:bg-zinc-900",n?"border-red-400 dark:border-red-500":"border-zinc-200 dark:border-zinc-700")}),n&&e.jsx("p",{className:"text-[10px] text-red-500 font-medium",children:n})]}));xe.displayName="FormInput";const H=a.memo(({label:t,value:r,onChange:s,options:n,required:c,icon:l,error:o})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[l&&e.jsx(l,{size:10,className:"text-[#0078D4]"}),t," ",c&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r,onChange:i=>s(i.target.value),className:N("w-full h-9 px-3 bg-zinc-50 dark:bg-zinc-800 border rounded-lg text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none",o?"border-red-400 dark:border-red-500":"border-zinc-200 dark:border-zinc-700"),children:[e.jsx("option",{value:"",children:"Select..."}),n.map(i=>e.jsx("option",{value:i,children:i},i))]}),o&&e.jsx("p",{className:"text-[10px] text-red-500 font-medium",children:o})]}));H.displayName="FormSelect";const me=a.memo(({label:t,icon:r,...s})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[r&&e.jsx(r,{size:10,className:"text-[#0078D4]"}),t]}),e.jsx("textarea",{...s,className:N("w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400","focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none")})]}));me.displayName="FormTextarea";const ve={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",responsibility:"",assign:"",remark:""},Le=a.memo(({onClose:t,onSubmit:r,initialData:s=null,isSubmitting:n=!1})=>{const{ticketOptions:c}=fe();Nt();const[l,o]=a.useState(ve),[i,b]=a.useState({}),m=s!==null;a.useEffect(()=>{o(s?{...ve,...s}:ve),b({})},[s]);const j=a.useCallback((u,y)=>{let P=y;u==="ticketNumber"&&(P=y.toUpperCase()),o(k=>({...k,[u]:P})),i[u]&&b(k=>({...k,[u]:null}))},[i]),z=a.useCallback(()=>{const u={},y=/^[A-Z]{3}\d{9}$/;return l.ticketNumber?.trim()?y.test(l.ticketNumber)||(u.ticketNumber="Format must be 3 letters + 9 numbers (e.g. SVR123456789)"):u.ticketNumber="Ticket Number is required",l.type?.trim()||(u.type="Type is required"),l.status?.trim()||(u.status="Status is required"),l.shortDesc?.trim()||(u.shortDesc="Subject is required"),b(u),Object.keys(u).length===0},[l]),h=a.useCallback(u=>{u.preventDefault(),z()&&r&&r(l)},[l,r,z]);return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Q,{size:18,className:"text-zinc-500"})}),e.jsxs("div",{children:[e.jsx("span",{className:N("px-2 py-0.5 text-[10px] font-semibold rounded",m?"bg-amber-500 text-white":"bg-[#0078D4] text-white"),children:m?"EDIT":"NEW"}),e.jsx("h2",{className:"text-base font-semibold text-zinc-900 dark:text-white mt-1",children:m?`Edit Ticket #${s?.ticketNumber}`:"Create New Ticket"})]})]})})}),e.jsxs("form",{id:"ticket-form-panel",onSubmit:h,className:"flex-1 overflow-y-auto custom-scrollbar p-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(xe,{label:"Ticket No.",icon:je,required:!0,disabled:m,value:l.ticketNumber,onChange:u=>j("ticketNumber",u.target.value),error:i.ticketNumber,placeholder:"e.g. SVR090924001",maxLength:12}),e.jsx(H,{label:"Type",icon:ke,required:!0,value:l.type,onChange:u=>j("type",u),options:c.types||["Incident","Request","Problem"],error:i.type})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(H,{label:"Status",required:!0,value:l.status,onChange:u=>j("status",u),options:c.statuses||["Open","Pending","In Progress","Succeed"],error:i.status}),e.jsx(H,{label:"Severity",value:l.severity,onChange:u=>j("severity",u),options:c.severities||["Critical","High","Medium","Low"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(H,{label:"Category",value:l.category,onChange:u=>j("category",u),options:c.categories||[]}),e.jsx(H,{label:"Sub Category",value:l.subCategory,onChange:u=>j("subCategory",u),options:c.subCategories||[]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800"}),e.jsx(xe,{label:"Subject / Short Description",icon:as,required:!0,value:l.shortDesc,onChange:u=>j("shortDesc",u.target.value),error:i.shortDesc,placeholder:"Brief description of the issue"}),e.jsx(me,{label:"Ticket Details",rows:3,value:l.details,onChange:u=>j("details",u.target.value),placeholder:"Describe the incident or request in detail..."}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(H,{label:"Responsibility",icon:ue,value:l.responsibility,onChange:u=>j("responsibility",u),options:c.responsibilities||[]}),e.jsx(H,{label:"Assignee",icon:ue,value:l.assign,onChange:u=>j("assign",u),options:c.assignees||[],required:!1})]}),e.jsx(me,{label:"Action Taken / Mitigation",icon:K,rows:2,value:l.action,onChange:u=>j("action",u.target.value)}),e.jsx(xe,{label:"Resolution Result",value:l.resolvedDetail,onChange:u=>j("resolvedDetail",u.target.value)}),e.jsx(me,{label:"Remarks",rows:2,value:l.remark,onChange:u=>j("remark",u.target.value)})]}),e.jsx("div",{className:"shrink-0 p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 h-10 px-4 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 rounded-lg text-sm font-medium hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",form:"ticket-form-panel",disabled:n,className:N("flex-[2] flex items-center justify-center gap-2 h-10 px-4 rounded-lg text-sm font-medium text-white transition-all",m?"bg-amber-500 hover:bg-amber-600":"bg-[#0078D4] hover:bg-[#106EBE]","disabled:opacity-50"),children:n?e.jsx(ee,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx($e,{size:16}),m?"Save Changes":"Create Ticket"]})})]})})]})});Le.displayName="TicketFormPanel";const oe=({label:t,value:r,icon:s,className:n})=>e.jsxs("div",{className:N("space-y-1",n),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-zinc-500 uppercase tracking-wide",children:[s&&e.jsx(s,{size:12,className:"text-[#0078D4]"}),t]}),e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 break-words",children:r||"-"})]}),Ie=a.memo(({ticket:t,onClose:r,onEdit:s,onDelete:n,onSendToIncident:c,canEdit:l})=>t?e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-6 py-3 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"p-2 -ml-2 text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all lg:hidden",children:e.jsx(Q,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-500",children:[e.jsxs("span",{className:"font-mono bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded text-xs",children:["#",t.ticketNumber]}),e.jsx("span",{children:"/"}),e.jsx("span",{children:t.type})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[l&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>s(t),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors",children:[e.jsx(he,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),e.jsx("button",{onClick:()=>n(t.ticketNumber),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors",title:"Delete Ticket",children:e.jsx(J,{size:16})})]}),e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-700 mx-2"}),e.jsxs("button",{onClick:()=>c(t),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-[#0078D4] hover:bg-[#0078D4]/10 rounded-md transition-colors",title:"Convert to Incident",children:[e.jsx(Ht,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"To Incident"})]}),e.jsx("button",{onClick:r,className:"p-2 ml-1 text-zinc-400 hover:text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-all hidden lg:block",children:e.jsx(Q,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-zinc-900",children:e.jsxs("div",{className:"p-6 max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-zinc-900 dark:text-white leading-tight",children:t.shortDesc}),e.jsxs("div",{className:"flex items-center gap-3 pb-6 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#0078D4]/10 text-[#0078D4] flex items-center justify-center font-bold text-lg",children:t.assign?t.assign.charAt(0).toUpperCase():e.jsx(ue,{size:20})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white text-sm",children:t.assign||"Unassigned"}),e.jsx("span",{className:"text-zinc-400 text-xs",children:"â€¢"}),e.jsx("span",{className:"text-zinc-500 text-xs",children:t.createdAt?X(new Date(t.createdAt),"EEE, MMM d, yyyy h:mm a"):"-"})]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Responsibility: ",t.responsibility||"-"]})]})]})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 rounded-lg p-4 grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsx(oe,{label:"Status",value:t.status,icon:K}),e.jsx(oe,{label:"Severity",value:t.severity,icon:W,className:t.severity==="Critical"?"text-red-600":""}),e.jsx(oe,{label:"Category",value:t.category,icon:ke}),e.jsx(oe,{label:"Sub-Category",value:t.subCategory,icon:je})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-[#0078D4] rounded-full"}),"Description"]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap",children:t.details||"No description provided."})]}),(t.action||t.resolvedDetail||t.remark)&&e.jsxs("div",{className:"space-y-6 pt-6 border-t border-zinc-100 dark:border-zinc-800",children:[t.action&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Action Taken"}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 bg-amber-50 dark:bg-amber-900/10 p-3 rounded-md border border-amber-100 dark:border-amber-900/20",children:t.action})]}),t.resolvedDetail&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-emerald-600 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(se,{size:12})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:t.resolvedDetail})]}),t.remark&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Remarks"}),e.jsxs("p",{className:"text-sm text-zinc-500 italic",children:['"',t.remark,'"']})]})]})]})})]}):null);Ie.displayName="TicketDetailPanel";const ys=a.lazy(()=>mt(()=>import("./TicketSyncModal-DtTlncHZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])));function ws({logs:t=[],loading:r=!1,loadMore:s,hasMore:n,loadingMore:c,stats:l,onRefresh:o,clearFilters:i}){const{toast:b}=Ee(),{currentUser:m}=pe(),j=Ae(m,[te.LEAD,te.ENGINEER]),z=dt(),h=xt(),u=a.useRef(null),[y,P]=a.useState(null),[k,A]=a.useState("view"),[T,d]=a.useState(!1),[f,w]=a.useState(null),[R,D]=a.useState(!1),S=a.useCallback(L=>{P(L),A("view")},[]),C=a.useCallback(()=>{P(null),A("create")},[]),U=a.useCallback(L=>{P(L),A("edit")},[]),$=a.useCallback(()=>{P(null),A("view")},[]),g=a.useCallback(async L=>{d(!0);try{k==="edit"&&y?(await ne.updateLog(y.ticketNumber,L),b({className:"bg-emerald-500 text-white border-none",title:"Update Successful",description:`Ticket #${y.ticketNumber} has been updated.`})):(await ne.createLog(L),b({className:"bg-[#0078D4] text-white border-none",title:"Ticket Created",description:"New operational log has been recorded."})),h.invalidateQueries(["ticketLogs"]),$()}catch(p){console.error("Submit Error:",p),b({variant:"destructive",title:"Submission Failed",description:p.message||"Could not save the ticket."})}finally{d(!1)}},[k,y,h,b,$]),v=a.useCallback(L=>{w(L)},[]),F=a.useCallback(async()=>{if(f)try{await ne.deleteLog(f),b({title:"Ticket Deleted",description:`Ticket #${f} removed.`}),h.invalidateQueries(["ticketLogs"]),$()}catch(L){b({variant:"destructive",title:"Delete Failed",description:L.message})}finally{w(null)}},[f,h,b,$]),x=a.useCallback(async(L,p)=>{if(p&&p.stopPropagation(),!m){b({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const M=typeof m=="object"&&m!==null?{name:m.name,id:m.id,role:m.role}:{name:m};await V.createIncident({subject:L.shortDesc||L.details||"New Incident from Log",ticket:L.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(L.type)?L.type:"Incident",status:"Open",createdBy:M,impact:"",root_cause:L.details||"",action:L.action||""}),b({title:"Successfully Added",description:`Ticket #${L.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>z("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(M){console.error(M),b({variant:"destructive",title:"Error",description:"Failed to add to timeline."})}},[m,z,b]),I=a.useCallback(async L=>{try{const p=!L.isFlagged;await ne.updateLog(L.ticketNumber,{isFlagged:p}),h.invalidateQueries(["ticketLogs"]),b({title:p?"Flagged":"Unflagged",description:`Ticket #${L.ticketNumber} ${p?"pinned to top":"unpinned"}.`})}catch{b({variant:"destructive",title:"Error",description:"Failed to update flag status."})}},[h,b]),E=y!==null||k==="create";return e.jsxs("div",{className:"flex-1 flex overflow-hidden h-full",children:[e.jsx("div",{className:"hidden","data-trigger-create":!0,onClick:C}),e.jsx("div",{className:"hidden","data-trigger-sync":!0,onClick:()=>D(!0)}),e.jsx(a.Suspense,{fallback:null,children:R&&e.jsx(ys,{isOpen:R,onClose:()=>D(!1),currentLogs:t,onSyncComplete:L=>{b({title:"Sync Completed",description:`Updated ${L} records.`}),h.invalidateQueries({queryKey:["ticketLogs"]}),D(!1)}})}),e.jsx("div",{className:N("flex-1 flex flex-col overflow-hidden transition-all",E?"hidden lg:flex lg:w-[55%] xl:w-[60%]":"w-full"),children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden p-4 sm:p-6 space-y-4",children:[e.jsx("div",{className:"shrink-0",children:!r&&e.jsx(js,{stats:l})}),e.jsx("div",{ref:u,className:"flex-1 min-h-0 bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 flex flex-col overflow-hidden",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ot,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:i,className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex-1 overflow-y-auto flex flex-col p-1 custom-scrollbar",children:[e.jsx(st,{logs:t,onLogClick:S,activeLogId:y?.ticketNumber,onFlag:I,onDelete:v}),e.jsx(Ns,{logs:t,onLogClick:S,onEdit:U,canEdit:j}),e.jsx("div",{className:"shrink-0 py-4 flex justify-center",children:e.jsxs("button",{onClick:()=>s(),disabled:!n||c,className:N("px-4 py-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 rounded-full text-xs font-bold uppercase disabled:opacity-50 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors flex items-center gap-2",!n&&"hidden"),children:[c?e.jsx(ee,{size:14,className:"animate-spin"}):e.jsx(Ce,{size:14}),c?"Loading more tickets...":"Load More"]})})]})})})]})}),e.jsx("div",{className:N("hidden lg:block shrink-0 overflow-hidden transition-all",E?"w-[45%] xl:w-[40%]":"w-0"),children:k==="view"?e.jsx(Ie,{ticket:y,mode:k,onClose:$,onEdit:U,onDelete:v,onSendToIncident:x,canEdit:j}):e.jsx(Le,{onClose:$,onSubmit:g,initialData:y,isSubmitting:T})}),E&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsx("div",{className:"w-full max-h-[90vh] bg-white dark:bg-zinc-900 rounded-t-2xl overflow-hidden animate-in slide-in-from-bottom duration-300",children:k==="view"?e.jsx(Ie,{ticket:y,mode:k,onClose:$,onEdit:U,onDelete:v,onSendToIncident:x,canEdit:j}):e.jsx(Le,{onClose:$,onSubmit:g,initialData:y,isSubmitting:T})})}),e.jsx(Me,{isOpen:!!f,onClose:()=>w(null),onConfirm:F,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${f}?`,isDanger:!0})]})}const Cs=t=>{const[r,s]=a.useState([]),[n,c]=a.useState(!1);a.useEffect(()=>{if(!t){setTimeout(()=>{s([])},0);return}const o=V.subscribeEvents(t,i=>{const b=(i||[]).map(m=>({...m,_sortTime:new Date(`${m.date||"1970-01-01"}T${m.time||"00:00"}`).getTime()}));s(b),c(!1)});return()=>o&&o()},[t]);const l=a.useMemo(()=>[...r].sort((o,i)=>i._sortTime-o._sortTime),[r]);return{events:r,sortedEvents:l,loading:n}},ie=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),He=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},Ds=(t,r)=>{const s=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(s),c=document.createElement("a");c.href=n;const l=r.endsWith(".csv")?r:`${r}.csv`;c.download=l,document.body.appendChild(c),c.click(),setTimeout(()=>{document.body.removeChild(c),window.URL.revokeObjectURL(n)},0)},Ss=t=>{switch(t){case"Open":return{border:"border-l-rose-500",dot:"bg-rose-500",text:"text-rose-600 dark:text-rose-400",bg:"bg-rose-500/10"};case"In Progress":return{border:"border-l-[#0078D4]",dot:"bg-[#0078D4]",text:"text-[#0078D4] dark:text-blue-400",bg:"bg-[#0078D4]/10"};case"Monitoring":case"Pending":return{border:"border-l-amber-500",dot:"bg-amber-500",text:"text-amber-600 dark:text-amber-400",bg:"bg-amber-500/10"};case"Succeed":case"Resolved":return{border:"border-l-emerald-500",dot:"bg-emerald-500",text:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-500/10"};case"Closed":return{border:"border-l-zinc-500",dot:"bg-zinc-500",text:"text-zinc-500 dark:text-zinc-400",bg:"bg-zinc-500/10"};default:return{border:"border-l-zinc-400",dot:"bg-zinc-400",text:"text-zinc-500 dark:text-zinc-400",bg:"bg-zinc-500/10"}}},Ts=a.memo(({incident:t,isSelected:r,onClick:s,onDelete:n})=>{const c=Ss(t.status);let l="--",o="";try{if(t.createdAt){const i=new Date(t.createdAt);l=i.getDate(),o=i.toLocaleString("default",{month:"short"}).toUpperCase()}}catch{}return e.jsxs("div",{onClick:s,className:N("group relative flex items-stretch gap-4 p-4 mb-2 cursor-pointer transition-all duration-200 overflow-hidden","rounded-xl border","bg-zinc-100 dark:bg-zinc-900/80","border-zinc-200/50 dark:border-zinc-800","hover:bg-zinc-200/50 dark:hover:bg-zinc-800/80","border-l-4",c.border,r&&"ring-2 ring-[#0078D4] ring-offset-2 ring-offset-white dark:ring-offset-black"),children:[e.jsxs("div",{className:"shrink-0 flex flex-col items-center justify-center w-12 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-zinc-800 dark:text-zinc-100 leading-none tracking-tight",children:l}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:o})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-zinc-500 dark:text-zinc-400 flex items-center gap-1",children:[e.jsx(re,{size:12}),t.ticket||"-"]}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold uppercase bg-zinc-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-300 dark:border-zinc-700",children:t.project||"CORE"})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-800 dark:text-zinc-100 line-clamp-2 leading-snug",children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:N("inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide border",c.bg,c.text,t.status==="Open"?"border-rose-500/30":t.status==="In Progress"?"border-[#0078D4]/30":t.status==="Pending"||t.status==="Monitoring"?"border-amber-500/30":t.status==="Resolved"||t.status==="Succeed"?"border-emerald-500/30":"border-zinc-500/30"),children:[e.jsx("span",{className:N("w-1.5 h-1.5 rounded-full",c.dot)}),t.status]}),t.type&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium text-zinc-500 dark:text-zinc-400 bg-zinc-200/50 dark:bg-zinc-800/50 border border-zinc-300/50 dark:border-zinc-700/50",children:t.type})]})]}),e.jsx("div",{className:N("shrink-0 flex items-center justify-center transition-opacity",r?"opacity-100":"opacity-0 group-hover:opacity-100"),children:e.jsx("button",{onClick:i=>{i.stopPropagation(),n(t.id)},className:"p-1.5 rounded-lg text-zinc-400 hover:text-rose-600 hover:bg-rose-500/10 transition-colors",title:"Delete Case",children:e.jsx(J,{size:16,strokeWidth:2})})})]})}),Ls=Qe("relative rounded-lg transition-all duration-150 overflow-hidden",{variants:{variant:{default:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",interactive:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 hover:shadow-lg hover:border-zinc-300 dark:hover:border-zinc-700 active:scale-[0.99] cursor-pointer",flat:"bg-white dark:bg-zinc-900",ghost:"bg-transparent hover:bg-zinc-50 dark:hover:bg-zinc-900"},status:{none:"",live:"border-red-500 shadow-lg shadow-red-500/20",soon:"border-orange-400 shadow-lg shadow-orange-500/10",finished:"border-emerald-500/30 dark:border-emerald-500/20",upcoming:"border-zinc-200 dark:border-zinc-800",normal:"border-emerald-500/30 dark:border-emerald-500/20",issues:"border-red-500/30 dark:border-red-500/20",open:"border-rose-500/30 dark:border-rose-500/20",pending:"border-amber-500/30 dark:border-amber-500/20",resolved:"border-emerald-500/30 dark:border-emerald-500/20"},selected:{true:"bg-white dark:bg-zinc-800/80 border-[#0078D4]/50 shadow-md scale-[1.01] z-10",false:""},size:{sm:"p-3",md:"p-4",lg:"p-5 sm:p-6"}},defaultVariants:{variant:"default",status:"none",selected:!1,size:"md"}}),Is=Qe("absolute left-0 top-0 bottom-0 w-1.5 transition-colors",{variants:{accent:{none:"bg-transparent",live:"bg-red-500 animate-pulse",soon:"bg-orange-500",finished:"bg-emerald-500",upcoming:"bg-zinc-300 dark:bg-zinc-700",normal:"bg-emerald-500",issues:"bg-red-500",blue:"bg-[#0078D4]",indigo:"bg-[#0078D4]",open:"bg-rose-500",pending:"bg-amber-500",resolved:"bg-emerald-500",closed:"bg-zinc-400"}},defaultVariants:{accent:"none"}}),at=a.memo(({children:t,className:r,onClick:s,variant:n="default",status:c="none",accent:l="none",selected:o=!1,size:i="md",showAccent:b=!1,...m})=>{const j=b&&l==="none"?c:l;return e.jsxs("div",{className:N(Ls({variant:n,status:c,selected:o,size:i}),j!=="none"&&"pl-4",r),onClick:s,role:s?"button":void 0,tabIndex:s?0:void 0,onKeyDown:s?z=>{(z.key==="Enter"||z.key===" ")&&(z.preventDefault(),s(z))}:void 0,...m,children:[j!=="none"&&e.jsx("div",{className:N(Is({accent:j}))}),t]})});at.displayName="Card";const Es=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},As=t=>{switch(t?.toLowerCase()){case"open":return"open";case"pending":return"pending";case"succeed":return"resolved";default:return"none"}},Ge=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Ms=a.memo(({log:t,isSelected:r,onClick:s})=>{const n=t.createdAt?new Date(t.createdAt):null,c=n?n.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs(at,{variant:"interactive",selected:r,accent:r?"primary":As(t.status),showAccent:!0,size:"md",onClick:s,className:N("group mb-3",!r&&"hover:-translate-y-1"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:N("px-2.5 py-1 rounded-lg text-[9px] font-mediumst border",Es(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:c})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:N("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(W,{size:10,className:N("shrink-0",Ge(t.severity))}),e.jsx("span",{className:N("text-[9px] font-mediumst",Ge(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(Et,{size:18,className:"text-zinc-300"})})]})}),Ps=({filteredIncidents:t,selectedId:r,onSelect:s,onAddIncident:n,onDeleteIncident:c,onExportCSV:l,onSync:o,stats:i,logs:b,selectedLogId:m,onSelectLog:j,logsLoading:z,viewMode:h,onViewModeChange:u,searchTerm:y,setSearchTerm:P,filterStatus:k,setFilterStatus:A,filterType:T,setFilterType:d,clearFilters:f,hasActiveFilters:w,loading:R,error:D,canEdit:S})=>{fe();const[C,U]=a.useState(20),$=a.useRef(null),g=h==="logs",v=g?b:t,F=g?z:R;return a.useEffect(()=>{U(20)},[v?.length,h,k,T]),a.useEffect(()=>{const x=new IntersectionObserver(I=>{I[0].isIntersecting&&v?.length>C&&U(E=>E+20)},{threshold:.1});return $.current&&x.observe($.current),()=>x.disconnect()},[v,C]),e.jsx("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:D&&!g?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(G,{className:"text-red-600",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:D})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(ut,{size:12}),"Retry"]})]}):F&&C===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(ee,{className:"animate-spin text-[#0078D4]",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):v?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[g?e.jsx(Ye,{size:40,strokeWidth:1}):e.jsx(Je,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),w&&e.jsx("button",{onClick:f,className:"mt-2 text-xs text-[#0078D4] font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[v.slice(0,C).map(x=>g?e.jsx(Ms,{log:x,isSelected:m===(x.ticketNumber||x.id),onClick:()=>j(x)},x.ticketNumber||x.id):e.jsx(Ts,{incident:x,isSelected:r===x.id,onClick:()=>s(x.id),onDelete:c},x.id)),e.jsx("div",{ref:$,className:"h-4 w-full"})]})})})},Rs=a.memo(Ps),Fs=t=>{const r=t.type?.toLowerCase()||"",s=(t.desc||t.details||"").toLowerCase(),n=(t.title||"").toLowerCase();let c="default";r==="create"||n.includes("create")||s.includes("created")?c="create":r==="update"||n.includes("update")||s.includes("updated")||s.includes("edit")?c="update":r==="status_change"||s.includes("resolved")||s.includes("succeed")||s.includes("completed")||s.includes("closed")?c="resolved":r==="alert"||s.includes("alert")||s.includes("error")||s.includes("failed")||s.includes("critical")?c="alert":r==="image"||s.includes("evidence")||s.includes("photo")||s.includes("upload")?c="evidence":(s.includes("pending")||s.includes("wait"))&&(c="pending");const l={create:{icon:Oe,color:"bg-[#0078D4]",text:"text-[#0078D4]",border:"border-[#0078D4]",lightBg:"bg-[#0078D4]/10",label:"Created"},update:{icon:be,color:"bg-amber-500",text:"text-amber-600",border:"border-amber-500",lightBg:"bg-amber-500/10",label:"Update"},resolved:{icon:se,color:"bg-emerald-600",text:"text-emerald-700",border:"border-emerald-600",lightBg:"bg-emerald-600/10",label:"Resolved"},alert:{icon:G,color:"bg-rose-600",text:"text-rose-700",border:"border-rose-600",lightBg:"bg-rose-600/10",label:"Alert"},evidence:{icon:Xe,color:"bg-indigo-500",text:"text-indigo-600",border:"border-indigo-500",lightBg:"bg-indigo-500/10",label:"Evidence"},pending:{icon:Z,color:"bg-orange-500",text:"text-orange-600",border:"border-orange-500",lightBg:"bg-orange-500/10",label:"Pending"},default:{icon:Se,color:"bg-zinc-400",text:"text-zinc-500",border:"border-zinc-400",lightBg:"bg-zinc-400/10",label:"Note"}},o=l[c]||l.default;if(t.iconType){const i={message:Se,alert:G,check:se,clock:Z,update:be};i[t.iconType]&&(o.icon=i[t.iconType])}return{...o,label:t.statusOnLine||o.label}},Os=({src:t,index:r,onClick:s,className:n})=>{const[c,l]=a.useState(!1),[o,i]=a.useState(null);return a.useEffect(()=>{l(!1)},[t]),a.useEffect(()=>{if(!t){i(null);return}let b=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(b=URL.createObjectURL(t),i(b)):typeof t=="string"&&i(ge(t)),()=>{b&&URL.revokeObjectURL(b)}},[t]),c||!o?e.jsx("div",{className:N(n,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(Ze,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>s(t),className:N("relative group/img overflow-hidden cursor-zoom-in",n),children:[e.jsx("img",{src:o,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>l(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(Xe,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function $s({event:t,index:r,isLastItem:s,onEdit:n,onDelete:c,onMove:l,showDateHeader:o,dateLabel:i}){const[b,m]=a.useState(null),{icon:j,color:z,text:h,border:u,lightBg:y,label:P}=Fs(t),k=t.time||"00:00";let A=(t.imageUrls||[]).filter(T=>T);return!A.length&&t.image&&(A=[t.image]),e.jsxs("div",{className:"relative group flex gap-6 pb-2 pl-2",children:[o&&e.jsxs("div",{className:"absolute -top-3 left-0 right-0 flex items-center gap-4 z-10 mb-6",children:[e.jsx("div",{className:"w-4 flex justify-center"}),e.jsx("div",{className:"bg-zinc-100 dark:bg-zinc-800/80 px-3 py-1 rounded-full border border-zinc-200 dark:border-zinc-700 text-xs font-bold text-zinc-600 dark:text-zinc-400 shadow-sm backdrop-blur-sm",children:i})]}),e.jsxs("div",{className:"relative flex flex-col items-center shrink-0 w-8 pt-2",children:[e.jsx("div",{className:N("absolute top-0 bottom-0 w-[2px] z-0","bg-zinc-200 dark:bg-zinc-800",r===0&&!o?"top-4":"-top-6",s&&"bottom-auto h-full")}),e.jsx("div",{className:N("relative w-4 h-4 rounded-[4px] z-20 flex items-center justify-center shadow-sm transition-all duration-300",z),children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full opacity-90"})})]}),e.jsxs("div",{className:N("flex-1 min-w-0 pb-8 relative",o&&"mt-8"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-bold font-mono text-zinc-500 dark:text-zinc-400 tabular-nums bg-zinc-100 dark:bg-zinc-800 px-1.5 rounded",children:k}),e.jsx("span",{className:N("text-[10px] font-bold uppercase tracking-wide",h),children:P})]}),e.jsxs("div",{className:N("relative bg-white dark:bg-zinc-900 border rounded-lg p-4 shadow-sm transition-all duration-200 group/card","border-l-4",u.replace("border-","border-l-"),"border-y-zinc-200 border-r-zinc-200 dark:border-y-zinc-800 dark:border-r-zinc-800","hover:shadow-md hover:bg-zinc-50/50 dark:hover:bg-zinc-800/50"),children:[e.jsxs("div",{className:"flex justify-between items-start gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:N("p-1.5 rounded-full shrink-0",y),children:e.jsx(j,{size:14,className:h})}),e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 leading-tight",children:t.title||"Update"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 opacity-0 group-hover/card:opacity-100 transition-opacity",children:[l&&e.jsxs("div",{className:"flex flex-col mr-1",children:[e.jsx("button",{onClick:()=>l(r,"up"),className:"p-0.5 hover:text-[#0078D4]",children:e.jsx(qt,{size:12})}),e.jsx("button",{onClick:()=>l(r,"down"),className:"p-0.5 hover:text-[#0078D4]",children:e.jsx($t,{size:12})})]}),e.jsx("button",{onClick:()=>n(t),className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-[#0078D4]",title:"Edit",children:e.jsx(be,{size:14})}),e.jsx("button",{onClick:()=>c(t.id),className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-rose-600",title:"Delete",children:e.jsx(J,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap pl-9 break-words",children:t.desc||t.details}),A.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 pl-9",children:A.map((T,d)=>e.jsx(Os,{index:d,src:T,onClick:m,className:"w-16 h-16 rounded border border-zinc-200 dark:border-zinc-700 shadow-sm hover:ring-2 ring-offset-1 ring-[#0078D4]"},d))}),(t.updatedBy||t.createdBy)&&e.jsxs("div",{className:"mt-3 pl-9 flex items-center gap-1.5 opacity-60 hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-[#0078D4] text-white flex items-center justify-center text-[8px] font-bold",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})]})]}),e.jsx(yt,{isOpen:!!b,onClose:()=>m(null),imageUrl:b,allImages:A})]})}const Us=a.memo($s),Ne=a.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),Bs=a.memo(({error:t,className:r,...s})=>e.jsx("input",{...s,className:N("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-[#0078D4]/50 focus:ring-4 focus:ring-[#0078D4]/5",t?"border-rose-500":"",r)})),de=a.memo(({children:t,title:r,icon:s,badge:n})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[s&&e.jsx(s,{size:14,className:"text-zinc-400 group-hover/row:text-[#0078D4] transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase ",children:r})]}),n&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:n})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function _s({isOpen:t,onClose:r,initialData:s,incidentId:n,onSave:c}){const l=a.useRef(null),[o,i]=a.useState({date:null,time:"",desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"}),[b,m]=a.useState({}),[j,z]=a.useState(!1),[h,u]=a.useState(""),[y,P]=a.useState(!1),[k,A]=a.useState(0),[T,d]=a.useState(null),[f,w]=a.useState({}),R=a.useRef(null),[D,S]=a.useState({isOpen:!1,type:null,index:null});a.useEffect(()=>{if(s){let x=s.imageUrls||[];!x.length&&s.image&&(x=[s.image]),i({date:s.date&&Ft(_e(s.date))?_e(s.date):null,time:s.time||"",desc:s.desc||s.title||"",imageUrls:x,iconType:s.iconType||"message",statusOnLineColor:s.statusOnLineColor||"white"})}else i({date:new Date,time:X(new Date,"HH:mm"),desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"});m({}),u(""),w({})},[s,t]);const C=x=>{const I=x||h.trim();I&&!o.imageUrls.includes(I)&&(i(E=>({...E,imageUrls:[...E.imageUrls,I]})),u(""))},U=x=>{const I=o.imageUrls[x];i(E=>({...E,imageUrls:E.imageUrls.filter((L,p)=>p!==x)})),I?.includes("drive.google.com")&&St(I).catch(console.error)},$=async x=>{const I=x.target.files?.[0];if(I){x.target.value=null,P(!0),A(0),d(null),R.current=new AbortController;try{const E=await Dt(I);console.log("Upload Result:",E);const L=E?.webViewLink||E?.url||E?.link;L?C(L):(console.error("Upload successful but no URL found in response:",E),d("Upload succeeded but returned no URL"))}catch(E){E.name!=="AbortError"&&d(E.message||"Upload failed")}finally{P(!1),A(100)}}},g=()=>{R.current?.abort(),P(!1),A(0)},v=async x=>{x.preventDefault();const I={};if(o.desc?.trim()||(I.desc=!0),Object.keys(I).length){m(I);return}z(!0);try{await c({...o,date:o.date?Pt(o.date):null,id:s?.id}),r()}catch(E){console.error("Failed to save event:",E)}finally{z(!1)}},F=async()=>{if(D.type==="image")U(D.index);else if(D.type==="item"){z(!0);try{await c({...s,_delete:!0}),r()}finally{z(!1)}}S({isOpen:!1,type:null,index:null})};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{isOpen:t,onClose:r,isLoading:j,size:"md",showCloseButton:!1,headerClassName:"p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#0078D4] text-white flex items-center justify-center shadow-lg",children:e.jsx(ce,{size:20,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:s?"Edit Operation":"New Deployment"})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(Q,{size:18})})]}),footerClassName:"p-6 pt-2 flex items-center gap-3 border-t-0",footer:e.jsxs(e.Fragment,{children:[s&&e.jsx("button",{type:"button",onClick:()=>S({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-lg bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(J,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:j||y,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[j?e.jsx(ee,{size:18,className:"animate-spin"}):e.jsx($e,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Commit Record"})]})]}),bodyClassName:"p-6 space-y-8",children:e.jsxs("form",{id:"event-form",onSubmit:v,className:"space-y-8",children:[e.jsx(de,{title:"Temporal Matrix",icon:Z,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ne,{label:"Deployment Date"}),e.jsx(At,{date:o.date,setDate:x=>i({...o,date:x}),placeholder:"Select date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ne,{label:"Sync Time"}),e.jsx(Mt,{value:o.time,onChange:x=>i({...o,time:x.target.value})})]})]})}),e.jsx(de,{title:"Visual Personalization",icon:Zt,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-lg border border-zinc-100 dark:border-white/5",children:[e.jsx(Ne,{label:"Marker Status",icon:re}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(x=>e.jsx("button",{type:"button",onClick:()=>i({...o,statusOnLineColor:x}),className:N("w-5 h-5 rounded-full border-2 transition-all",x==="white"?"bg-white border-zinc-200":x==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",o.statusOnLineColor===x?"ring-4 ring-[#0078D4]/20 scale-110 shadow-lg border-[#0078D4]":"opacity-30 border-transparent")},x))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg",children:[{id:"message",icon:Se},{id:"alert",icon:G},{id:"check",icon:se},{id:"clock",icon:Z},{id:"update",icon:be},{id:"activity",icon:K}].map(x=>e.jsx("button",{type:"button",onClick:()=>i({...o,iconType:x.id}),className:N("h-9 flex items-center justify-center rounded-lg transition-all",o.iconType===x.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(x.icon,{size:14,strokeWidth:2.5})},x.id))})]})}),e.jsx(de,{title:"Operational Narrative",icon:ke,children:e.jsx("textarea",{className:N("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",b.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:o.desc,onChange:x=>i({...o,desc:x.target.value})})}),e.jsx(de,{title:"Intelligence Evidence",icon:ts,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(Bs,{placeholder:"Asset URL...",value:h,onChange:x=>u(x.target.value)}),e.jsx(ls,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>C(),disabled:!h,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(Oe,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>l.current.click(),disabled:y,className:"h-10 w-10 flex items-center justify-center bg-[#0078D4] text-white rounded-lg transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:l,className:"hidden",accept:"image/*",onChange:$}),y?e.jsx(ee,{size:16,className:"animate-spin"}):e.jsx(wt,{size:16})]})]}),(y||T)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-lg p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:y?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:12,className:"animate-spin text-[#0078D4]"}),e.jsx("span",{className:"text-[9px] font-medium text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-[#0078D4] tabular-nums",children:[Math.round(k),"%"]}),e.jsx("button",{type:"button",onClick:g,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(Ct,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300 ease-out",style:{width:`${k}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(G,{size:12}),e.jsx("span",{className:"text-[9px] font-medium",children:T})]})}),o.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:o.imageUrls.map((x,I)=>e.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[f[I]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(Ze,{size:16})}):e.jsx("img",{src:ge(x),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>w(E=>({...E,[I]:!0}))}),e.jsx("button",{type:"button",onClick:E=>{E.stopPropagation(),S({isOpen:!0,type:"image",index:I})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(J,{size:16})})]},I))})]})})]})}),e.jsx(Me,{isOpen:D.isOpen,onClose:()=>S({isOpen:!1,type:null,index:null}),title:D.type==="image"?"Remove Asset?":"Delete Record?",message:D.type==="image"?"This asset will be permanently removed.":"This record will be permanently deleted.",confirmLabel:D.type==="image"?"Remove":"Delete",isDanger:!0,onConfirm:F})]})}function qs({isOpen:t,onClose:r,text:s,incident:n}){const[c,l]=a.useState(!1),[o,i]=a.useState("preview"),{toast:b}=Ee(),m=a.useMemo(()=>{const z=k=>{if(!k)return"-";try{return new Date(k).toLocaleDateString("th-TH",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return k}};if(n)return{header:{id:n.ticket||"INC-PENDING",date:z(n.createdAt||new Date),status:n.status||"Open",severity:n.sev||"Normal"},meta:{Subject:n.subject||"-",Project:n.project||"-","Reported By":n.createdBy?.name||"-","Assigned To":n.assign||"-"},content:{"Incident Description":n.impact||"-","Root Cause":n.root_cause||"-","Action Taken":n.action||"-"},timeline:(n.events||[]).map(k=>({date:k.date?new Date(k.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:k.time,desc:k.desc||k.title,images:k.imageUrls||(k.image?[k.image]:[])}))};if(!s)return null;const h={header:{id:"LOG-ENTRY",date:new Date().toLocaleDateString("th-TH"),status:"-",severity:"-"},meta:{},content:{},timeline:[]},u=s.split(`
`);let y=!1,P="";return u.forEach(k=>{const A=k.trim();if(!A)return;const T=k.indexOf(":");if(!y&&T!==-1&&T<25){const d=k.substring(0,T).trim(),f=k.substring(T+1).trim();["Ticket","ID"].includes(d)?h.header.id=f:["Status"].includes(d)?h.header.status=f:["Subject","Project","Reported By"].includes(d)?h.meta[d]=f:["Impact","Description"].includes(d)?h.content["Incident Description"]=f:["Root Cause"].includes(d)?h.content["Root Cause"]=f:["Action","Action Taken"].includes(d)?h.content["Action Taken"]=f:h.meta[d]=f}else if(y=!0,A.length<20&&/\d/.test(A)&&!A.includes("-"))P=A;else{const f=A.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*à¸™\.)?\s*(.*)/);f?h.timeline.push({date:P,time:f[1],desc:f[2]||""}):h.timeline.push({date:P,time:null,desc:A})}}),h},[s,n]),j=async()=>{try{await navigator.clipboard.writeText(s),l(!0),b({title:"Copied",description:"Ready to paste."}),setTimeout(()=>l(!1),2e3)}catch{b({variant:"destructive",title:"Error",description:"Copy failed."})}};return t?e.jsx(Pe,{isOpen:t,onClose:r,size:"2xl",showCloseButton:!1,headerClassName:"flex justify-between items-center px-4 py-3 sm:px-6 sm:py-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md sticky top-0 z-50",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,className:"p-2 -ml-2 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-white mr-2",children:e.jsx(Fe,{size:24})}),e.jsx("div",{className:"p-2 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-sm hidden sm:block",children:e.jsx(We,{size:20,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg text-zinc-900 dark:text-white tracking-tight",children:"Incident Report"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-zinc-500 font-mono",children:["#",m?.header.id]}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsxs("div",{className:"flex bg-zinc-200 dark:bg-zinc-800 rounded p-[2px]",children:[e.jsx("button",{onClick:()=>i("preview"),className:`text-[10px] font-bold px-1.5 py-0.5 rounded-sm transition-all ${o==="preview"?"bg-white dark:bg-zinc-600 shadow-sm text-black dark:text-white":"text-zinc-500 hover:text-zinc-700 dark:text-zinc-400"}`,children:"Visual"}),e.jsx("button",{onClick:()=>i("raw"),className:`text-[10px] font-bold px-1.5 py-0.5 rounded-sm transition-all ${o==="raw"?"bg-white dark:bg-zinc-600 shadow-sm text-black dark:text-white":"text-zinc-500 hover:text-zinc-700 dark:text-zinc-400"}`,children:"Raw"})]})]})]})]}),e.jsx("button",{onClick:r,className:"hidden sm:block p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(Q,{size:20})})]}),bodyClassName:"p-0 overflow-y-auto custom-scrollbar bg-zinc-50 dark:bg-[#09090b]",footerClassName:"p-4 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-50 sticky bottom-0",footer:e.jsxs("button",{onClick:j,className:`w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-2 rounded-lg text-sm font-bold transition-all shadow-sm ${c?"bg-emerald-500 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:opacity-90"}`,children:[c?e.jsx(bt,{size:16}):e.jsx(Ut,{size:16}),c?"Copied":"Copy Text"]}),children:o==="raw"?e.jsx("div",{className:"p-4 sm:p-6 min-h-[50vh]",children:e.jsx("textarea",{readOnly:!0,value:s,className:"w-full h-full min-h-[60vh] font-mono text-xs sm:text-sm leading-relaxed outline-none resize-none text-zinc-600 dark:text-zinc-300 bg-transparent"})}):e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 max-w-3xl mx-auto",children:[e.jsx("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-zinc-900 dark:text-white mb-1",children:m?.meta.Subject||m?.header?.id}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-zinc-500 dark:text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Re,{size:12})," ",m?.header.date]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:m?.meta.Project||"Monomax"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-md text-xs font-bold border ${m?.header.status==="Resolved"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 border-emerald-200 dark:border-emerald-800":"bg-amber-50 dark:bg-amber-900/20 text-amber-600 border-amber-200 dark:border-amber-800"}`,children:m?.header.status}),e.jsx("span",{className:"px-2.5 py-1 rounded-md text-xs font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 border border-zinc-200 dark:border-zinc-700",children:m?.header.severity})]})]})}),e.jsx("div",{className:"space-y-4",children:m?.content&&Object.entries(m.content).map(([z,h])=>{let u=K;return z.includes("Incident")&&(u=W),z.includes("Root")&&(u=xs),z.includes("Action")&&(u=us),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4 shadow-sm",children:[e.jsxs("h4",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest flex items-center gap-2 mb-3",children:[e.jsx(u,{size:14})," ",z]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap",children:h==="-"?e.jsx("span",{className:"text-zinc-400 italic",children:"No details provided."}):h})]},z)})}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200 dark:border-zinc-800 p-4 sm:p-6 shadow-sm",children:[e.jsxs("h4",{className:"text-xs font-bold text-zinc-400 uppercase tracking-widest flex items-center gap-2 mb-6",children:[e.jsx(K,{size:14})," Sequence of Events"]}),e.jsxs("div",{className:"relative space-y-8 pl-2",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),m?.timeline.map((z,h)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[2px] w-3 h-3 rounded-full border-2 border-white dark:border-zinc-900 bg-zinc-300 dark:bg-zinc-600 z-10"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-4 sm:items-baseline mb-1",children:[e.jsx("span",{className:"text-xs font-black text-zinc-900 dark:text-white shrink-0 w-16",children:z.time||"--:--"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wider sm:hidden",children:z.date})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-400 leading-relaxed",children:z.desc}),z.images&&z.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mt-3",children:z.images.map((u,y)=>e.jsx("div",{className:"aspect-video bg-zinc-100 dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-700 overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",children:e.jsx("img",{src:ge(u),className:"w-full h-full object-cover",alt:"evidence",loading:"lazy",onClick:()=>window.open(ge(u),"_blank")})},y))})]},h)),m?.timeline.length===0&&e.jsx("div",{className:"text-center py-4 text-zinc-400 text-xs italic",children:"No timeline data available."})]})]})]})}):null}function Vs(){const[t,r]=a.useState([]),[s,n]=a.useState(!0),[c,l]=a.useState(null);return a.useEffect(()=>{const o=b=>{console.error("[useProjects] Subscription error:",b),l(b.message||"Failed to load projects")},i=Bt.subscribeProjects(b=>{r(b),n(!1)},o);return()=>i()},[]),{projects:t,loading:s,error:c}}function Hs({isOpen:t,onClose:r,incident:s,onUpdate:n,onDelete:c}){const{ticketOptions:l}=fe(),{projects:o}=Vs(),[i,b]=a.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});a.useEffect(()=>{s&&setTimeout(()=>{b({subject:s.subject||"",project:s.project||"",type:s.type||"Incident",ticket:s.ticket||"",status:s.status||"Open",priority:s.priority||"Medium",impact:s.impact||"",root_cause:s.root_cause||"",action:s.action||""})},0)},[s,t]);const m=i.subject?.includes("|")&&i.subject?.includes("-"),j=d=>{let f={subject:d};if(d.includes("|")&&d.includes("-")){const w=d.split("|").map(R=>R.trim());if(w.length>=2){const R=w[0].split("-").map(D=>D.trim());if(R.length>=2){f.ticket=R[0],f.project=R[1];const D=l?.types||["Incident","Request","Maintenance"];f.type=D.find(S=>S.toLowerCase()===w[1].toLowerCase())||w[1],w.length>=3&&(f.subject=w.slice(2).join(" | "))}}}b(w=>({...w,...f}))},[z,h]=a.useState({});if(!t)return null;const u=d=>{d.preventDefault();const f={};if(i.ticket?.trim()||(f.ticket="Ticket Identity is required"),Object.keys(f).length>0){h(f);return}n(i),r()},y=d=>{const f={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:G},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:Z},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:se},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:Wt}};return f[d]||f.Open},P=d=>{const f={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-[#0078D4]",bg:"bg-[#0078D4]/10"}};return f[d]||f.Medium},k="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",A="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] outline-none transition-all",T="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-xs font-medium focus:ring-4 focus:ring-[#0078D4]/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx(Pe,{isOpen:t,onClose:r,size:"lg",showCloseButton:!1,headerClassName:"px-6 py-5 bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(ce,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(Q,{size:18})})]}),footerClassName:"p-6 pt-2 border-t border-zinc-100 dark:border-white/5 flex items-center justify-between",footer:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:c,className:"h-11 px-5 rounded-lg bg-rose-500/10 text-rose-500 font-semibold text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(J,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"h-11 px-6 rounded-lg text-[9px] font-medium text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",form:"incident-form",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[9px] font-medium shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx($e,{size:14})," Commit Changes"]})]})]}),bodyClassName:"p-6",children:e.jsxs("form",{id:"incident-form",onSubmit:u,className:"space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-lg bg-[#0078D4]/5 border border-[#0078D4]/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:N(k,"text-[#0078D4]"),children:[e.jsx(ke,{size:10})," Protocol Signature (Subject)"]}),m&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Ke,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-lg p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4]/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:i.subject,onChange:d=>j(d.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(K,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:N(T,y(i.status).color),value:i.status,onChange:d=>b({...i,status:d.target.value}),children:(l.statuses||["Open","Pending","Succeed","Closed"]).map(d=>e.jsx("option",{value:d,className:"bg-white dark:bg-zinc-950",children:d},d))}),e.jsx(Z,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(De,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:N(T,P(i.priority).color),value:i.priority,onChange:d=>b({...i,priority:d.target.value}),children:(l.severities||["Critical","High","Medium","Low"]).map(d=>e.jsx("option",{value:d,className:"bg-white dark:bg-zinc-950",children:d},d))}),e.jsx(W,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(re,{size:10,className:"text-[#0078D4]"})," Ticket Identity",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",className:N(A,z.ticket&&"border-red-400 focus:border-red-500 focus:ring-red-500/10"),value:i.ticket,onChange:d=>{b({...i,ticket:d.target.value}),z.ticket&&h({...z,ticket:null})},placeholder:"e.g. SVR123456"}),z.ticket&&e.jsx("p",{className:"text-[10px] text-red-500 font-bold mt-1 ml-1",children:z.ticket})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(qe,{size:10,className:"text-[#0078D4]"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:T,value:i.project,onChange:d=>b({...i,project:d.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(o&&o.length>0?o:["MONOMAX","MONO29","3BB GIGATV"]).map(d=>e.jsx("option",{value:d,className:"bg-white dark:bg-zinc-950",children:d},d))]}),e.jsx(qe,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(G,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[80px] resize-none transition-all",value:i.impact,onChange:d=>b({...i,impact:d.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(ht,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:i.root_cause,onChange:d=>b({...i,root_cause:d.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(ce,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:i.action,onChange:d=>b({...i,action:d.target.value}),placeholder:""})]})]})]})]})})}function Gs({incident:t,isLoading:r,onUpdateIncident:s,onAddEvent:n,onDeleteEvent:c,onUpdateEvent:l,onReorderEvent:o,onDeleteIncident:i,onBack:b,canEdit:m}){const{currentUser:j}=pe(),z=a.useRef(null),h=a.useRef(null),[u,y]=a.useState(!1),[P,k]=a.useState(!1),[A,T]=a.useState(null),[d,f]=a.useState(!1),[w,R]=a.useState(""),D=a.useMemo(()=>t?.events?[...t.events].sort((g,v)=>{if(typeof g.order=="number"&&typeof v.order=="number"&&g.order!==v.order)return g.order-v.order;const F=`${g.date||"1970-01-01"}T${g.time||"00:00"}`,x=`${v.date||"1970-01-01"}T${v.time||"00:00"}`;return F<x?1:F>x?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(K,{size:24,className:"text-[#0078D4]"})}),e.jsx("p",{className:"font-semibold text-zinc-600 dark:text-zinc-400 text-sm",children:"Select an incident to view details"})]})]});const S=(g,v)=>{const F=[...D],x=v==="up"?g-1:g+1;if(x<0||x>=F.length)return;[F[g],F[x]]=[F[x],F[g]];const I=F.map((E,L)=>({...E,order:L}));o&&o(t.id,I)},C=g=>{const v=typeof j=="object"?j?.name:j;s(t.id,{...g,updatedBy:v})},U=async()=>{if(t)try{const g=O=>{if(O==null)return"";const B=String(O);return B.includes(",")||B.includes(`
`)||B.includes('"')?`"${B.replace(/"/g,'""')}"`:B},v=[...t.events||[]].sort((O,B)=>{const Y=`${O.date||"1970-01-01"}T${O.time||"00:00"}`,q=`${B.date||"1970-01-01"}T${B.time||"00:00"}`;return Y<q?-1:Y>q?1:0}),F=[`Incident,${g(t.subject)}`,`Project,${g(t.project)}`,`Ticket ID,${g(t.ticket)}`,`Current Status,${g(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],x=["Date","Time","Status","Description","Images"].join(","),I=v.map(O=>{const B=O.date?new Date(O.date).toLocaleDateString("en-GB"):"-",Y=O.time||"-",q=g(O.statusOnLine||""),Ue=g(O.desc||O.title||""),ae=g((O.imageUrls||[]).join(" ; "));return[B,Y,q,Ue,ae].join(",")}),E="\uFEFF"+[...F,x,...I].join(`
`),L=new Blob([E],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(L),M=document.createElement("a");M.href=p,M.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(p)}catch(g){console.error("Export failed:",g),alert("Failed to export CSV. Please check console.")}},$=()=>{if(!t)return;let g=`[INCIDENT REPORT]
`;g+=`Project : ${t.project||"-"}
`,g+=`Ticket  : ${t.ticket||"-"}
`,g+=`Subject : ${t.subject||"-"}
`,g+=`Status  : ${t.status||"-"}

`,g+=`[DETAILS]
`,g+=`Impact     : ${t.impact||"-"}
`,g+=`Root Cause : ${t.root_cause||"-"}
`,g+=`Action     : ${t.action||"-"}

`,g+=`[TIMELINE]
`;const v=[...t.events||[]].sort((x,I)=>{const E=`${x.date||"1970-01-01"}T${x.time||"00:00"}`,L=`${I.date||"1970-01-01"}T${I.time||"00:00"}`;return E<L?-1:E>L?1:0});let F="";v.forEach(x=>{x.date!==F&&(g+=`
--- ${x.date?new Date(x.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,F=x.date);const I=x.time||"--:--",E=x.statusOnLine?` [${x.statusOnLine}]`:"";g+=`${I}${E} - ${x.desc||x.title}
`}),R(g),f(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-zinc-50 dark:bg-[#0e0e11] border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:"p-1 -ml-1 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-white mr-2",title:"Back to List",children:e.jsx(Fe,{size:24})}),e.jsx("span",{className:"bg-[#0078D4] text-white px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider",children:t.status}),e.jsxs("span",{className:"text-zinc-400 text-xs font-medium uppercase flex items-center gap-1",children:[e.jsx(re,{size:12}),t.ticket||"NO-TICKET"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:$,className:"p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-md transition-colors",title:"Generate Text Report",children:e.jsx(Kt,{size:16})}),e.jsx("button",{onClick:U,className:"p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-md transition-colors",title:"Export CSV",children:e.jsx(Tt,{size:16})}),m&&e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-md text-xs font-bold transition-colors ml-1",children:[e.jsx(he,{size:14}),"Edit Case"]})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-zinc-900 dark:text-white leading-tight",children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-zinc-500 dark:text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Re,{size:12}),"Created: ",t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"-"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(je,{size:12}),t.project||"CORE"]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative bg-white dark:bg-[#0e0e11]",children:[e.jsx("div",{ref:h,className:"h-full overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):D.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-300 dark:text-zinc-700 mt-10",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-100 dark:border-zinc-800 flex items-center justify-center mb-3",children:e.jsx(kt,{size:28,className:"text-zinc-400 dark:text-zinc-600"})}),e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wide",children:"No Timeline Events"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1",children:"Add an update to start tracking this case."})]}):e.jsxs("div",{className:"flex flex-col pb-20 relative max-w-4xl mx-auto min-h-full",children:[D.map((g,v)=>{const F=v===0||g.date!==D[v-1].date;let x="-";try{x=g.date?new Date(g.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{x="-"}return e.jsx(Us,{event:g,index:v,isLastItem:v===D.length-1,showDateHeader:F,dateLabel:x,onMove:S,onEdit:I=>{T(I),y(!0)},onDelete:I=>c(t.id,I),canEdit:m},g.id)}),e.jsx("div",{ref:z})]})}),e.jsx("div",{className:"absolute bottom-6 right-6 z-30",children:m&&!r&&t?.id&&e.jsx("button",{onClick:()=>{T(null),y(!0)},className:"w-11 h-11 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-full shadow-lg shadow-[#0078D4]/20 hover:shadow-xl transition-all duration-300 flex items-center justify-center active:scale-95",title:"Add Timeline Update",children:e.jsx(he,{size:20})})})]}),e.jsx(_s,{isOpen:u,onClose:()=>y(!1),initialData:A,onDelete:g=>t?.id&&c(t.id,g),incidentId:t?.id,onSave:g=>{if(!t?.id){console.error("Cannot save event: Incident ID is missing"),y(!1);return}const v=typeof j=="object"?j?.name:j,F={...g};A?(F.updatedBy=v,l(t.id,A.id,F)):(F.createdBy=v,n(t.id,F)),y(!1)}}),e.jsx(qs,{isOpen:d,onClose:()=>f(!1),text:w,incident:t}),e.jsx(Hs,{isOpen:P,onClose:()=>k(!1),incident:t,onUpdate:C,onDelete:()=>i(t.id),onExport:U})]})}const Ws=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},Qs=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-[#0078D4] bg-[#0078D4]/10 dark:bg-[#0078D4]/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},ye=a.memo(({label:t,value:r,icon:s,colorClass:n})=>{const c=s;return e.jsxs("div",{className:"flex-1 p-4 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:N("p-1.5 rounded-lg shrink-0",n),children:e.jsx(c,{size:12})}),e.jsx("span",{className:"text-[9px] font-semibold text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})}),we=a.memo(({title:t,icon:r,children:s,accentColor:n="text-zinc-400"})=>{const c=r;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-semibold text-zinc-400 flex items-center gap-2 px-1",children:[e.jsx(c,{size:12,className:n})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-lg shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:s})]})]})});function Ks({log:t,onAddToIncident:r,onClose:s,canEdit:n}){if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(re,{size:24,className:"text-[#0078D4]"})}),e.jsx("p",{className:"font-semibold text-zinc-600 dark:text-zinc-400 text-sm",children:"Select a log to view details"})]})]});const c=t.createdAt?X(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-zinc-50 dark:bg-[#0e0e11] border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"lg:hidden w-9 h-9 flex items-center justify-center rounded-lg bg-zinc-100 dark:bg-zinc-900 text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(Fe,{size:20})}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-md",children:e.jsx(re,{size:20,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-[#0078D4] uppercase tracking-wider",children:"Operational Log"}),e.jsx("h2",{className:"text-xl font-black text-zinc-900 dark:text-white tracking-tight leading-none",children:t.ticketNumber})]})]}),e.jsx("button",{onClick:s,className:"hidden lg:flex w-9 h-9 items-center justify-center rounded-lg bg-zinc-100 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(Q,{size:18})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(Re,{size:12})," ",c]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ce,{size:12})," ",t.type]}),e.jsx("div",{className:N("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-wider",Ws(t.status)),children:t.status})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(ye,{label:"Severity",value:t.severity||"Low",icon:W,colorClass:Qs(t.severity)}),e.jsx(ye,{label:"Hierarchy",value:t.category||"N/A",icon:Je,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(ye,{label:"Sub-Class",value:t.subCategory||"N/A",icon:je,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(we,{title:"Record Description",icon:zt,accentColor:"text-[#0078D4]",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(we,{title:"Action Deployed",icon:K,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-200",children:t.action||"No defensive actions recorded."})}),e.jsx(we,{title:"Resolution Status",icon:ce,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsx("div",{className:"flex items-center justify-between p-5 bg-white dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-base font-black shadow-md transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(ue,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400",children:"Lead Engineer"}),e.jsxs("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]})})]}),n&&e.jsxs("div",{className:"shrink-0 p-6 bg-white dark:bg-[#0a0a0a] border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-12 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-lg text-xs font-bold flex items-center justify-center gap-2 shadow-lg shadow-[#0078D4]/20 transition-all active:scale-[0.98]",children:[e.jsx(Ke,{size:16,className:"fill-current"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[9px] font-medium text-zinc-400 mt-3",children:"This will create a new case from this log entry."})]})]})}function Xs({incidents:t=[],loading:r=!1,error:s=null,stats:n,logs:c=[],logsLoading:l=!1,logStats:o={}}){const{currentUser:i}=pe(),b=Ae(i,[te.LEAD,te.ENGINEER]),{toast:m}=Ee(),[j,z]=a.useState("incidents"),[h,u]=a.useState(null),[y,P]=a.useState(null),{sortedEvents:k,loading:A}=Cs(h),[T,d]=a.useState({isOpen:!1}),[f,w]=a.useState(!1),[R,D]=a.useState(null),S=R&&R.id===h&&!t.find(p=>p.id===h)?R:t.find(p=>p.id===h);a.useEffect(()=>{R&&t.find(p=>p.id===R.id)&&D(null)},[t,R]);const C=a.useCallback((p,M="success")=>{m({description:p,variant:M==="error"?"destructive":"default"})},[m]),U=async()=>{w(!0);try{const M={subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:typeof i=="object"?i:{name:"Admin"},impact:"",root_cause:"",action:""},O=await V.createIncident(M);D({...M,id:O,events:[],createdAt:new Date().toISOString()}),z("incidents"),u(O),C("Case created successfully")}catch(p){console.error(p),C("Failed to create incident","error")}finally{w(!1)}},$=async p=>{if(p){w(!0);try{const M=typeof i=="object"?i:{name:"System"},O={subject:p.shortDesc||p.details||`Ticket #${p.ticketNumber}`,ticket:p.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(p.type)?p.type:"Incident",status:"Open",priority:p.severity||"Medium",createdBy:M,impact:"",root_cause:p.details||"",action:p.action||""},B=await V.createIncident(O,p.ticketNumber);C(`Ticket #${p.ticketNumber} promoted to Case`),z("incidents"),u(B)}catch(M){console.error(M),C("Failed to promote ticket","error")}finally{w(!1)}}},g=p=>{d({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await V.deleteIncident(p),h===p&&u(null),d({isOpen:!1}),C("Case deleted")}catch(M){console.error(M),C("Failed to delete","error")}}})},v=async p=>{if(!p||p.length===0){C("No data to export","error");return}C("Preparing export...","info");try{const M="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",O=p.map(async q=>{const ae=`"${He(q.createdAt)}","${ie(q.project)}","${ie(q.ticket)}","${ie(q.type)}","${q.status}","${ie(q.subject)}","${q.createdBy?.name||q.createdBy||""}"`;try{const ze=await V.getEvents(q.id);return ze.length>0?ze.map(le=>{const it=He(le.date),nt=ie(le.desc||le.title);return`${ae},"${it}","${le.time||"-"}","${nt}"`}).join(`
`)+`
,,,,,,,,,`:`${ae},"-","-","-"
,,,,,,,,,`}catch{return`${ae},"Error fetching events","-","-"
,,,,,,,,,`}}),B=await Promise.all(O),Y=[M,...B].join(`
`);Ds(Y,`CaseExport_${new Date().toISOString().split("T")[0]}`),C("Export completed")}catch(M){console.error(M),C("Failed to export data","error")}},F=async(p,M)=>{try{await V.updateIncident(p,M),C("Incident updated")}catch{C("Update failed","error")}},x=async(p,M)=>{try{console.log("TimelinePage: Adding event",p,M),await V.createEvent(p,M),C("Timeline updated")}catch(O){console.error("TimelinePage: Failed to add event",O),C("Failed to add event","error")}},I=async(p,M,O)=>{try{await V.updateEvent(p,M,O),C("Event updated")}catch{C("Failed to update event","error")}},E=async(p,M)=>V.reorderEvents(p,M),L=async(p,M)=>{d({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await V.deleteEvent(p,M),C("Event removed")}catch{C("Failed to remove event","error")}finally{d({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx("div",{className:"hidden","data-trigger-create":!0,onClick:U}),e.jsx("div",{className:"hidden","data-trigger-export":!0,onClick:()=>v(t)}),e.jsx(Me,{isOpen:T.isOpen,onClose:()=>d({isOpen:!1}),...T}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${h||y?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(Rs,{filteredIncidents:t,stats:n,loading:r,error:s,logs:c,logsLoading:l,logStats:o,selectedId:h,selectedLogId:y?.ticketNumber,onSelect:p=>{z("incidents"),u(p)},onSelectLog:P,onAddIncident:U,onDeleteIncident:g,onExportCSV:v,viewMode:j,onViewModeChange:p=>{z(p),p==="incidents"&&P(null),p==="logs"&&u(null)},searchTerm:"",setSearchTerm:()=>{},filterStatus:"All",setFilterStatus:()=>{},filterType:"All",setFilterType:()=>{},clearFilters:()=>{},hasActiveFilters:!1,canEdit:b})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${h||y?"flex w-full":"hidden lg:flex"}
      `,children:j==="incidents"&&h?e.jsx(Gs,{incident:S?{...S,events:k}:null,isLoading:A,onBack:()=>u(null),onUpdateIncident:F,onAddEvent:x,onUpdateEvent:I,onDeleteEvent:L,onDeleteIncident:g,onReorderEvent:E,saving:f,canEdit:b}):j==="logs"&&y?e.jsx(Ks,{log:y,onAddToIncident:$,onClose:()=>P(null),canEdit:b}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-20 h-20 bg-zinc-100 dark:bg-zinc-900 rounded-lg flex items-center justify-center mb-4 shadow-sm",children:e.jsx(ns,{size:40,strokeWidth:1.5,className:"text-zinc-400 dark:text-zinc-500"})}),e.jsx("h3",{className:"text-lg font-bold uppercase tracking-wide text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-1 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}function fr({defaultView:t="table"}){const{currentUser:r}=pe(),s=Ae(r,[te.LEAD,te.ENGINEER]);gt();const{ticketOptions:n}=fe(),{viewMode:c,setViewMode:l,searchTerm:o,setSearchTerm:i,filterStatus:b,setFilterStatus:m,filterType:j,setFilterType:z,clearFilters:h,hasActiveFilters:u,filteredLogs:y,logsLoading:P,loadMoreLogs:k,hasMoreLogs:A,loadingMoreLogs:T,logStats:d,filteredIncidents:f,incidentsLoading:w,incidentsError:R}=fs(t);a.useEffect(()=>{l(t)},[t,l]);const D=v=>{l(v)},[S,C]=a.useState(!1),[U,$]=a.useState(0),g=()=>{const v=document.querySelector("[data-trigger-create]");v&&v.click()};return e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx("div",{className:"shrink-0 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center px-4 pt-4 gap-4",children:[e.jsxs("button",{onClick:()=>D("table"),className:N("pb-3 text-sm font-bold border-b-2 transition-all flex items-center gap-2",c==="table"?"border-[#0078D4] text-[#0078D4]":"border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-200"),children:[e.jsx(pt,{size:16})," Ticket Log"]}),e.jsxs("button",{onClick:()=>D("timeline"),className:N("pb-3 text-sm font-bold border-b-2 transition-all flex items-center gap-2",c==="timeline"?"border-[#0078D4] text-[#0078D4]":"border-transparent text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-200"),children:[e.jsx(W,{size:16})," Timeline"]})]}),e.jsx(Lt,{title:c==="table"?"Ticket Log":"Incident Timeline",icon:c==="table"?Ye:W,searchTerm:o,onSearch:i,isFilterActive:u,onFilterClick:()=>C(!0),actions:[{label:"New",icon:Oe,onClick:g,variant:"primary",disabled:!s,hideTextOnMobile:!0},...c==="timeline"?[{label:"Export",icon:Ce,onClick:()=>{const v=document.querySelector("[data-trigger-export]");v&&v.click()},variant:"ghost",hideTextOnMobile:!0}]:[],...c==="table"?[{label:"Sync",icon:Ce,onClick:()=>{const v=document.querySelector("[data-trigger-sync]");v&&v.click()},variant:"secondary",disabled:!s||P,hideTextOnMobile:!0}]:[]]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:c==="table"?e.jsx(ws,{logs:y,loading:P,loadMore:k,hasMore:A,loadingMore:T,stats:d}):e.jsx(Xs,{incidents:f,loading:w,error:R})}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:()=>C(!1)}),e.jsxs("div",{className:"relative w-full sm:w-[400px] bg-white dark:bg-zinc-900 rounded-t-xl sm:rounded-xl p-5 shadow-2xl animate-in slide-in-from-bottom sm:zoom-in-95 duration-300 pointer-events-auto m-0 sm:m-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white flex items-center gap-2",children:[e.jsx(Rt,{size:18,className:"text-[#0078D4]"})," Filters"]}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-full text-zinc-600 hover:text-zinc-900 transition-colors",children:e.jsx(Q,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...n.statuses].map(v=>e.jsx("button",{onClick:()=>m(v),className:N("px-3 py-2 rounded-lg text-xs font-bold transition-all border flex items-center gap-1.5",b===v?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:v},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...n.types].map(v=>e.jsx("button",{onClick:()=>z(v),className:N("px-3 py-2 rounded-lg text-xs font-bold transition-all border",j===v?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:v},v))})]})]}),e.jsxs("div",{className:"mt-8 flex gap-3",children:[e.jsx("button",{onClick:()=>{h(),C(!1)},className:"flex-1 py-2.5 text-zinc-600 font-bold bg-zinc-100 dark:bg-zinc-800 rounded-lg hover:bg-zinc-200 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>C(!1),className:"flex-[2] py-2.5 bg-[#0078D4] text-white font-bold rounded-lg shadow-lg shadow-[#0078D4]/20 hover:bg-[#106EBE] transition-colors text-sm",children:"Apply Filters"})]})]})]})]})}export{fr as default};
