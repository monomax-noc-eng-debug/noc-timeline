import{c as P,r as x,a as X,R as q,j as e,X as Z,b as fe,F as V,C as de,L as ne,d as xe,A as G,T as ee,e as ke}from"./index-Cu1hj24i.js";import{i as R,u as te,U as ve}from"./useTicketOptions-CXOxnMow.js";import{T as K}from"./trash-2-BELcC8hK.js";import{H as ue}from"./hash-Be0gCF0f.js";import{C as B}from"./circle-alert-COENiKgS.js";import{C as H,S as ie}from"./search-CzE8fqzl.js";import{C as A}from"./clock-C3VHd1-G.js";import{R as je}from"./refresh-cw-CZHKUVRt.js";import{C as ze,a as re,b as we}from"./chevron-right-Dsr-MPTf.js";import{C as ye,a as Ne,S as Ce}from"./settings-bRGG89hn.js";import{C as Se,P as Ee}from"./pencil-pPlvHbo3.js";import"./firebaseConfig--jbwBVp3.js";import{I as $e}from"./info-D45V6E1M.js";import{S as me}from"./save-eic3Sy5Q.js";import{T as Me,A as Ie}from"./tag-C8KqynrB.js";import{Z as De}from"./zap-DqWJJD1m.js";import{A as Te}from"./arrow-right-b-83yzMy.js";import{P as Ue}from"./plus-Bqwbh0YV.js";import"./configService-Cf9dW1Z_.js";const Le=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],se=P("circle-play",Le);const Pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Y=P("circle-x",Pe);const _e=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],Oe=P("cloud-upload",_e);const Re=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],ae=P("download",Re);const Ae=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],Fe=P("file-plus-corner",Ae);const Be=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],He=P("folder-kanban",Be);const qe=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],Ve=P("image-plus",qe);const We=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],be=P("image",We);const Ze=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Ge=P("layout-dashboard",Ze);const Xe=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],oe=P("link",Xe);const Ke=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ce=P("maximize-2",Ke);const Ye=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],le=P("minimize-2",Ye);const Je=[["path",{d:"M5 12h14",key:"1ays0h"}]],Q=P("minus",Je);const Qe=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],et=P("move",Qe);const tt=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],rt=P("workflow",tt);const st=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],at=P("wrench",st);const nt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],it=P("zoom-in",nt),ot=()=>{const[t,s]=x.useState([]),[i,l]=x.useState(null),[j,a]=x.useState(!0),[d,h]=x.useState(""),[f,k]=x.useState("All"),[b,r]=x.useState("All"),o=X(p=>p.currentUser);x.useEffect(()=>{if(!o){s([]),a(!1);return}a(!0);const p=R.subscribeIncidents(z=>{s(z),a(!1)});return()=>p()},[o]);const w=x.useMemo(()=>t.filter(p=>{const z=d.toLowerCase(),I=!z||(p.subject||"").toLowerCase().includes(z)||(p.project||"").toLowerCase().includes(z)||(p.ticket||"").toLowerCase().includes(z)||(p.createdBy||"").toLowerCase().includes(z),D=f==="All"||p.status===f,U=b==="All"||p.type===b;return I&&D&&U}).sort((p,z)=>z._sortTime-p._sortTime),[t,d,f,b]),m=x.useMemo(()=>{const p=t.length,z=t.filter(v=>v.status==="Open").length,I=t.filter(v=>v.status==="In Progress").length,D=t.filter(v=>v.status==="Pending").length,U=t.filter(v=>v.status==="Monitoring").length,E=t.filter(v=>v.status==="Succeed").length,u=t.filter(v=>v.status==="Resolved").length,C=t.filter(v=>v.status==="Closed").length;return{total:p,open:z,inProgress:I,pending:D,monitoring:U,succeed:E,resolved:u,closed:C}},[t]),c=x.useMemo(()=>[{status:"Open",count:m.open,color:"#ef4444"},{status:"In Progress",count:m.inProgress,color:"#3b82f6"},{status:"Pending",count:m.pending,color:"#f59e0b"},{status:"Monitoring",count:m.monitoring,color:"#f97316"},{status:"Succeed",count:m.succeed,color:"#10b981"},{status:"Resolved",count:m.resolved,color:"#059669"},{status:"Closed",count:m.closed,color:"#6b7280"}].filter(p=>p.count>0),[m]),N=x.useCallback(()=>{h(""),k("All"),r("All")},[]);return{incidents:t,filteredIncidents:w,selectedId:i,setSelectedId:l,loading:j,searchTerm:d,setSearchTerm:h,filterStatus:f,setFilterStatus:k,filterType:b,setFilterType:r,clearFilters:N,hasActiveFilters:d||f!=="All"||b!=="All",stats:m,statusDistribution:c}},ct=t=>{const[s,i]=x.useState([]),[l,j]=x.useState(!1),[a,d]=x.useState(null),h=X(b=>b.currentUser);x.useEffect(()=>{if(!h||!t){i([]),j(!1);return}j(!0);const b=R.subscribeEvents(t,r=>{const o=r.map(w=>({...w,_sortTime:new Date(`${w.date||"1970-01-01"}T${w.time||"00:00"}`).getTime()}));i(o),j(!1)});return()=>b()},[t,h]);const f=x.useMemo(()=>[...s].sort((b,r)=>b._sortTime!==r._sortTime?r._sortTime-b._sortTime:(r.order||0)-(b.order||0)),[s]),k=x.useMemo(()=>({total:s.length,withImages:s.filter(b=>b.imageUrls&&b.imageUrls.length>0).length,dateRange:f.length>0?{start:f[f.length-1]?.date,end:f[0]?.date}:null}),[s,f]);return{events:s,sortedEvents:f,loading:l,error:a,stats:k}},lt=t=>{switch(t){case"Open":return{color:"bg-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",icon:B,gradient:"from-red-500 to-rose-600"};case"In Progress":return{color:"bg-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",icon:se,gradient:"from-blue-500 to-indigo-600"};case"Monitoring":return{color:"bg-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",icon:A,gradient:"from-orange-500 to-amber-600"};case"Pending":return{color:"bg-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",textColor:"text-amber-600 dark:text-amber-400",icon:A,gradient:"from-amber-500 to-yellow-600"};case"Succeed":return{color:"bg-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",textColor:"text-emerald-600 dark:text-emerald-400",icon:H,gradient:"from-emerald-500 to-teal-600"};case"Resolved":return{color:"bg-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",textColor:"text-emerald-600 dark:text-emerald-400",icon:H,gradient:"from-emerald-500 to-teal-600"};case"Closed":return{color:"bg-zinc-400",bgColor:"bg-zinc-100 dark:bg-zinc-800",textColor:"text-zinc-500 dark:text-zinc-400",icon:Y,gradient:"from-zinc-400 to-zinc-500"};default:return{color:"bg-zinc-400",bgColor:"bg-zinc-100 dark:bg-zinc-800",textColor:"text-zinc-600 dark:text-zinc-400",icon:B,gradient:"from-zinc-400 to-zinc-500"}}},dt=t=>{switch(t){case"Critical":return{label:"CRIT",color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"};case"High":return{label:"HIGH",color:"text-orange-500 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"};case"Medium":return{label:"MED",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"};case"Low":return{label:"LOW",color:"text-blue-500 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"};default:return{label:"MED",color:"text-zinc-500",bg:"bg-zinc-50 dark:bg-zinc-900"}}},xt=q.memo(({incident:t,isSelected:s,onClick:i,onDelete:l})=>{const{color:j,bgColor:a,textColor:d,icon:h,gradient:f}=lt(t.status),k=dt(t.priority||"Medium"),b=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:i,className:`
        group relative p-3.5 rounded-xl border transition-all duration-300 cursor-pointer overflow-hidden
        ${s?"bg-white dark:bg-[#0a0a0a] border-zinc-900 dark:border-zinc-500 shadow-xl scale-[1.01] z-10":"bg-white dark:bg-[#111] border-transparent hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-0.5"}
      `,children:[s&&e.jsx("div",{className:`absolute top-0 bottom-0 left-0 w-1 bg-gradient-to-b ${f}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${j} ${t.status==="Open"?"animate-pulse shadow-[0_0_8px_currentColor]":""}`}),e.jsx("span",{className:"text-[8px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-wider",children:t.project||"SYSTEM"})]}),e.jsx("span",{className:`text-[8px] font-black uppercase px-2 py-0.5 rounded-lg border border-transparent ${t.type==="Incident"?"bg-red-50 text-red-600 dark:bg-red-900/10 dark:text-red-400 dark:border-red-900/20":t.type==="Request"?"bg-blue-50 text-blue-600 dark:bg-blue-900/10 dark:text-blue-400 dark:border-blue-900/20":"bg-amber-50 text-amber-600 dark:bg-amber-900/10 dark:text-amber-400 dark:border-amber-900/20"}`,children:t.type||"Incident"}),e.jsx("span",{className:`text-[8px] font-black uppercase px-1.5 py-0.5 rounded-lg border border-transparent ${k.bg} ${k.color}`,children:k.label})]}),!s&&e.jsx("button",{onClick:r=>{r.stopPropagation(),l(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Delete incident",children:e.jsx(K,{size:12})})]}),e.jsx("h3",{className:`font-black text-xs leading-snug mb-3 line-clamp-2 min-h-[2rem] transition-colors ${s?"text-black dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-black dark:group-hover:text-white"}`,children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex justify-between items-center pt-2.5 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-zinc-400",children:[e.jsx(ue,{size:10}),e.jsx("span",{className:"text-[9px] font-mono font-bold uppercase truncate max-w-[80px]",children:t.ticket||"N/A"})]}),e.jsx("span",{className:"text-[9px] text-zinc-300 font-bold tracking-tighter uppercase",children:b})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-0.5 rounded-lg ${a}`,children:[e.jsx(h,{size:10,className:d}),e.jsx("span",{className:`text-[8px] font-black uppercase tracking-tight ${d}`,children:t.status})]})]})]})});function ut(t,s){const[i,l]=x.useState(t);return x.useEffect(()=>{const j=setTimeout(()=>l(t),s);return()=>clearTimeout(j)},[t,s]),i}function mt({filteredIncidents:t,selectedId:s,onSelect:i,onAddIncident:l,onDeleteIncident:j,onExportCSV:a,stats:d,searchTerm:h,setSearchTerm:f,filterStatus:k,setFilterStatus:b,filterType:r,setFilterType:o,clearFilters:w,hasActiveFilters:m,loading:c}){const{ticketOptions:N}=te(),[S,p]=x.useState(h),z=ut(S,300);x.useEffect(()=>{f(z)},[z,f]),x.useEffect(()=>{p(h)},[h]);const I=u=>{b(u===k?"All":u)},[D,U]=x.useState(20),E=x.useRef(null);return x.useEffect(()=>{U(20)},[t,k,r,z]),x.useEffect(()=>{const u=new IntersectionObserver(C=>{C[0].isIntersecting&&t&&U(v=>Math.min(v+20,t.length))},{threshold:.1});return E.current&&u.observe(E.current),()=>u.disconnect()},[t]),e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black border-r border-zinc-200 dark:border-zinc-800 relative",children:[e.jsx("div",{className:"shrink-0 pt-4 pb-3 px-4 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-10 shadow-sm transition-all",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-9 h-9 bg-zinc-900 dark:bg-zinc-100 rounded-xl flex items-center justify-center shadow-lg transition-transform hover:scale-105 active:scale-95",children:e.jsx(Ge,{size:18,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Ticket Timeline"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-1",children:"Active Ticket Logs"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>a(t),className:"w-8 h-8 flex items-center justify-center rounded-lg border border-zinc-200 dark:border-zinc-800 text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all active:scale-95",title:"Export Database",children:e.jsx(ae,{size:15})}),e.jsx("button",{onClick:l,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 shadow-md hover:opacity-90 active:scale-95 transition-all",title:"New Case",children:e.jsx(Fe,{size:16})})]})]}),d&&e.jsx("div",{className:"flex items-center gap-1.5 overflow-x-auto no-scrollbar pb-0.5",children:[{status:"Open",count:d.open,color:"bg-red-500",icon:B},{status:"In Progress",count:d.inProgress,color:"bg-blue-500",icon:se},{status:"Pending",count:d.pending,color:"bg-amber-500",icon:A},{status:"Monitoring",count:d.monitoring,color:"bg-orange-500",icon:A},{status:"Succeed",count:d.succeed,color:"bg-emerald-500",icon:H},{status:"Resolved",count:d.resolved,color:"bg-emerald-600",icon:H},{status:"Closed",count:d.closed,color:"bg-zinc-400",icon:Y}].filter(u=>u.count>0).map(u=>e.jsxs("button",{onClick:()=>I(u.status),className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-[8px] font-black uppercase tracking-tighter transition-all border ${k===u.status?"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 border-zinc-900 dark:border-zinc-100 shadow-sm":"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-400 border-zinc-100 dark:border-zinc-800 hover:border-zinc-200"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${u.color} ${k===u.status?"animate-pulse":""}`}),e.jsx("span",{children:u.status.split(" ")[0]}),e.jsx("span",{className:"opacity-50 ml-0.5",children:u.count})]},u.status))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ie,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Search cases...",value:S,onChange:u=>p(u.target.value),className:"w-full h-9 pl-9 pr-7 rounded-lg text-[11px] font-medium border border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 text-zinc-900 dark:text-white outline-none focus:ring-1 focus:ring-zinc-200 dark:focus:ring-zinc-700 transition-all placeholder-zinc-400"}),S&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-300 hover:text-red-500",children:e.jsx(Z,{size:12})})]}),e.jsxs("div",{className:"flex bg-zinc-100/50 dark:bg-zinc-900 p-0.5 rounded-lg border border-zinc-200/50 dark:border-zinc-800",children:[e.jsxs("select",{value:r,onChange:u=>o(u.target.value),className:"h-8 pl-2 pr-1 bg-transparent border-none text-[9px] font-black uppercase text-zinc-500 dark:text-zinc-400 outline-none cursor-pointer appearance-none",children:[e.jsx("option",{value:"All",children:"Type: All"}),(N.types||["Incident","Request","Maintenance"]).map(u=>e.jsx("option",{value:u,children:u},u))]}),m&&e.jsx("button",{onClick:w,className:"w-8 h-8 flex items-center justify-center text-red-400 hover:text-red-500 transition-colors",title:"Clear filters",children:e.jsx(je,{size:12})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar bg-zinc-50 dark:bg-[#050505]",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 space-y-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-300 border-t-black dark:border-zinc-700 dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400",children:"Loading..."})]}):t?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 space-y-3",children:[e.jsx(ie,{size:32,className:"text-zinc-300 dark:text-zinc-700"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400",children:m?"No matching cases":"No incidents yet"}),m&&e.jsx("button",{onClick:w,className:"text-[10px] font-bold text-blue-500 hover:underline",children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[t.slice(0,D).map(u=>e.jsx(xt,{incident:u,isSelected:s===u.id,onClick:()=>i(u.id),onDelete:j},u.id)),e.jsx("div",{ref:E,className:"h-4 w-full"}),t.length>D&&e.jsx("div",{className:"py-2 text-center text-[10px] text-zinc-400 animate-pulse",children:"Loading more..."})]})})]})}const W=t=>{if(!t)return"";try{const s=new URL(t);if(t.includes("drive.google.com")||t.includes("docs.google.com")){let i=s.searchParams.get("id");if(!i){const l=t.match(/\/d\/(.+?)(?:\/|\?|&|$)/);l&&l[1]&&(i=l[1])}if(i)return`https://lh3.googleusercontent.com/d/${i}`}return t.includes("dropbox.com")?(s.searchParams.set("raw","1"),s.searchParams.delete("dl"),s.toString()):t}catch{if(t.includes("drive.google.com")||t.includes("docs.google.com")){const i=t.match(/\/d\/(.+?)(?:\/|\?|&|$)/);if(i&&i[1])return`https://lh3.googleusercontent.com/d/${i[1]}`}return t}};function ge({isOpen:t,onClose:s,imageUrl:i,allImages:l=[],initialIndex:j=0}){const[a,d]=x.useState(j),[h,f]=x.useState(1),[k,b]=x.useState({x:0,y:0}),[r,o]=x.useState(!1),[w,m]=x.useState({x:0,y:0}),c=l.length>0?l:[i],N=c[a]||i,S=q.useRef(null),[p,z]=x.useState(!1);x.useEffect(()=>{const g=()=>z(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",g),()=>document.removeEventListener("fullscreenchange",g)},[]),x.useEffect(()=>{const g=M=>{if(t)switch(M.key){case"ArrowRight":U();break;case"ArrowLeft":E();break;case"Escape":document.fullscreenElement?document.exitFullscreen():s();break;case"f":case"F":I();break;case"0":D();break}};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[t,a,c.length,h]),x.useEffect(()=>{const g=S.current;if(!g)return;const M=L=>{if(!t)return;L.preventDefault();const n=-L.deltaY>0?1.1:.9,y=Math.min(Math.max(h*n,.5),10);f(y),y<=1&&b({x:0,y:0})};return g.addEventListener("wheel",M,{passive:!1}),()=>g.removeEventListener("wheel",M)},[t,h]);const I=g=>{g?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():S.current?.requestFullscreen().catch(M=>{console.error("Fullscreen failed:",M)})},D=()=>{f(1),b({x:0,y:0})};if(x.useEffect(()=>(t?(d(j||(i&&l.indexOf(i)>=0?l.indexOf(i):0)),D(),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,j,i,l]),!t)return null;const U=g=>{g?.stopPropagation(),d(M=>(M+1)%c.length),D()},E=g=>{g?.stopPropagation(),d(M=>(M-1+c.length)%c.length),D()},u=g=>{h<=1||(g.preventDefault(),o(!0),m({x:g.clientX-k.x,y:g.clientY-k.y}))},C=g=>{!r||h<=1||(g.preventDefault(),b({x:g.clientX-w.x,y:g.clientY-w.y}))},v=()=>{o(!1)},T=g=>{g?.stopPropagation(),h===1?f(2.5):D()};return fe.createPortal(e.jsxs("div",{ref:S,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${r?"cursor-grabbing":""}`,onClick:s,onMouseMove:C,onMouseUp:v,onMouseLeave:v,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:I,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:p?e.jsx(le,{size:24,className:"text-white"}):e.jsx(ce,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",a+1," of ",c.length," • Click to ",p?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:T,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${h>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:h>1?"Reset Zoom":"Quick Zoom",children:h>1?e.jsx(le,{size:22}):e.jsx(ce,{size:22})}),e.jsx("a",{href:W(N),download:!0,target:"_blank",rel:"noreferrer",onClick:g=>g.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(ae,{size:22})}),e.jsx("button",{onClick:s,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(Z,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:s,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${k.x}px, ${k.y}px) scale(${h})`,cursor:h>1?r?"grabbing":"grab":"zoom-in"},onClick:g=>{g.stopPropagation(),h===1?f(2.5):D()},onMouseDown:u,children:[e.jsx("img",{src:W(N),alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},onError:g=>{g.target.src="https://placehold.co/1200x800?text=Failed+to+load+image"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:h===1&&e.jsx(et,{size:64,className:"text-white/10"})})]})}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:E,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(ze,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:U,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(re,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[c.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:c.map((g,M)=>e.jsx("button",{onClick:L=>{L.stopPropagation(),d(M),setIsZoomed(!1)},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${a===M?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},M))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",N.split("/").pop().substring(0,60)]})})]})]}),document.body)}function bt({event:t,index:s,isLastItem:i,showDateHeader:l,dateLabel:j,onMove:a,onEdit:d,onDelete:h}){const[f,k]=q.useState({isOpen:!1,url:null,index:0});let b=(t.imageUrls||[]).filter(m=>m&&typeof m=="string");!b.length&&t.image&&typeof t.image=="string"&&(b=[t.image]),!b.length&&t.imageUrl&&typeof t.imageUrl=="string"&&(b=[t.imageUrl]);const r=t.desc&&t.desc.trim().length>0,o=b.length>0,w=m=>{m.target.closest("button")||m.target.closest(".image-container")||d(t)};return e.jsxs("div",{className:"relative flex items-start gap-3 md:gap-4 mb-4 z-10 group/item animate-in fade-in slide-in-from-left-2 duration-300",children:[e.jsxs("div",{className:"flex-none flex flex-col items-center w-14 pt-[4px]",children:[e.jsx("div",{className:`
          w-2.5 h-2.5 rounded-full bg-white dark:bg-zinc-900 border-[2.5px] border-black dark:border-white shadow-sm z-20 transition-all
          ${s===0?"ring-2 ring-black/10 dark:ring-white/10":""}
          group-hover/item:scale-125
        `}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"font-mono text-[9px] font-black text-gray-400 dark:text-zinc-500 bg-gray-50/50 dark:bg-zinc-900 px-1 py-0.5 rounded uppercase",children:t.time})}),o&&e.jsx("div",{className:"mt-1 text-zinc-300",children:e.jsx(be,{size:9})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[l&&e.jsx("div",{className:"mb-2 -mt-1",children:e.jsx("span",{className:"inline-block text-[8px] font-black text-white dark:text-black uppercase tracking-wider bg-zinc-900 dark:bg-zinc-100 px-2 py-0.5 rounded shadow-sm",children:j})}),e.jsxs("div",{onClick:w,className:"bg-white dark:bg-[#0a0a0a] p-2.5 md:p-3 rounded-xl border border-gray-100 dark:border-zinc-800 shadow-sm flex gap-2 relative hover:border-zinc-300 dark:hover:border-zinc-600 transition-all group-hover/item:shadow-md cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 justify-center border-r pr-1.5 border-gray-100 dark:border-zinc-900 opacity-100 lg:opacity-0 lg:group-hover/item:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),a(s,"up")},disabled:s===0,className:"p-0.5 text-gray-300 hover:text-black dark:hover:text-white disabled:opacity-10 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded transition-colors",children:e.jsx(ye,{size:12})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),a(s,"down")},disabled:i,className:"p-0.5 text-gray-300 hover:text-black dark:hover:text-white disabled:opacity-10 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded transition-colors",children:e.jsx(Se,{size:12})})]}),e.jsxs("div",{className:"flex-1 min-w-0 relative pr-10 md:pr-12",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-0.5 opacity-100 lg:opacity-0 lg:group-hover/item:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),d(t)},className:"p-1 text-gray-300 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/10 rounded transition-colors",title:"Edit",children:e.jsx(Ee,{size:10})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),h(t.id)},className:"p-1 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 rounded transition-colors",title:"Delete",children:e.jsx(K,{size:10})})]}),e.jsx("div",{className:"text-[11px] font-medium text-gray-700 dark:text-zinc-400 leading-normal whitespace-pre-wrap pt-0.5",children:r?t.desc:e.jsx("span",{className:"text-gray-300 dark:text-zinc-800 italic",children:"..."})}),o&&e.jsx("div",{className:`image-container grid gap-1.5 mt-2.5 ${b.length===1?"grid-cols-1 max-w-[150px]":b.length===2?"grid-cols-2 max-w-[300px]":"grid-cols-2 sm:grid-cols-3"}`,children:b.map((m,c)=>e.jsxs("div",{className:"relative group/image rounded-lg overflow-hidden border border-gray-100 dark:border-zinc-900 bg-gray-50 aspect-video",children:[e.jsx("img",{src:W(m),className:"w-full h-full object-cover transition-transform duration-500 group-hover/image:scale-110",alt:`Evidence ${c+1}`,loading:"lazy",onError:N=>{console.warn("Image load failed:",m),N.target.src="https://placehold.co/400?text=Image+Load+Failed"}}),e.jsx("div",{onClick:N=>{N.stopPropagation(),k({isOpen:!0,url:m,index:c})},className:"absolute inset-0 bg-black/0 hover:bg-black/30 transition-all flex items-center justify-center opacity-0 hover:opacity-100 cursor-zoom-in",children:e.jsx(it,{size:14,className:"text-white"})})]},c))})]})]})]}),e.jsx(ge,{isOpen:f.isOpen,onClose:()=>k(m=>({...m,isOpen:!1})),imageUrl:f.url,allImages:b,initialIndex:f.index})]})}function gt({isOpen:t,onClose:s,title:i,message:l,type:j="error"}){if(!t)return null;const a={error:{icon:Y,color:"text-red-600",bg:"bg-red-50 dark:bg-red-950/20",btn:"bg-red-600 hover:bg-red-700 shadow-red-500/20",accent:"border-red-100 dark:border-red-900/30"},warning:{icon:B,color:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-950/20",btn:"bg-amber-600 hover:bg-amber-700 shadow-amber-500/20",accent:"border-amber-100 dark:border-amber-900/30"},success:{icon:H,color:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-950/20",btn:"bg-emerald-600 hover:bg-emerald-700 shadow-emerald-500/20",accent:"border-emerald-100 dark:border-emerald-900/30"},info:{icon:$e,color:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-950/20",btn:"bg-blue-600 hover:bg-blue-700 shadow-blue-500/20",accent:"border-blue-100 dark:border-blue-900/30"}},d=a[j]||a.error,h=d.icon;return e.jsx("div",{className:"fixed inset-0 z-[400] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-[#0a0a0a] w-full max-w-[340px] rounded-[24px] shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:`pt-8 pb-4 flex flex-col items-center justify-center gap-4 ${d.bg}`,children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${d.bg} border-2 ${d.accent} animate-bounce-subtle`,children:e.jsx(h,{size:32,className:d.color})}),e.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-zinc-900 dark:text-zinc-100",children:i||"System Notification"})]}),e.jsx("div",{className:"px-8 py-6",children:e.jsx("p",{className:"text-[11px] text-zinc-500 dark:text-zinc-400 leading-relaxed font-bold text-center uppercase tracking-tight",children:l})}),e.jsx("div",{className:"px-6 pb-6 pt-2",children:e.jsxs("button",{onClick:s,className:`w-full h-11 ${d.btn} text-white rounded-xl text-[10px] font-black uppercase tracking-[0.2em] shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2`,children:["Dismiss ",e.jsx(re,{size:14})]})})]})})}const pt=async t=>{const s="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec";try{return await(await fetch(s,{method:"POST",body:JSON.stringify(t)})).json()}catch(i){return{result:"error",error:i.message}}},ht=async t=>{try{return new Promise((s,i)=>{const l=new FileReader;l.readAsDataURL(t),l.onload=async()=>{const j=l.result.split(",")[1],a=await pt({base64:j,fileName:t.name,mimeType:t.type});s(a)},l.onerror=j=>i(j)})}catch(s){return{result:"error",error:s.message}}};function ft({isOpen:t,onClose:s,onSubmit:i,initialData:l,saving:j=!1}){const[a,d]=x.useState({date:"",time:"",desc:"",imageUrls:[]}),[h,f]=x.useState(""),[k,b]=x.useState("link"),[r,o]=x.useState(!1),[w,m]=x.useState(0),[c,N]=x.useState({}),[S,p]=x.useState({isOpen:!1,index:null}),[z,I]=x.useState(null),[D,U]=x.useState({isOpen:!1,message:""}),E=x.useRef(null);x.useEffect(()=>{const n=y=>{y.key==="Escape"&&!j&&s()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[s,j]),x.useEffect(()=>{if(t){if(l){let n=l.imageUrls||[];!n.length&&l.image&&(n=[l.image]),d({...l,imageUrls:n})}else{const n=new Date;d({date:n.toISOString().split("T")[0],time:`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`,desc:"",imageUrls:[]})}f(""),N({})}},[t,l]);const u=n=>{const y=n||h;y&&!a.imageUrls.includes(y)&&(d($=>({...$,imageUrls:[...$.imageUrls,y]})),f(""))},C=async n=>{const y=n.target.files[0];if(!y)return;o(!0),m(0);const $=setInterval(()=>{m(_=>_>=95?(clearInterval($),95):_+Math.random()*10)},200);try{const _=await ht(y);_.result==="success"?(m(100),setTimeout(()=>u(_.url),200)):U({isOpen:!0,message:_.error||"Upload failed. Please check your connection."})}catch(_){U({isOpen:!0,message:_.message||"An unexpected error occurred during upload."})}finally{clearInterval($),setTimeout(()=>{o(!1),m(0)},500),n.target.value=""}},v=n=>{p({isOpen:!0,index:n})},T=()=>{S.index!==null&&d(n=>({...n,imageUrls:n.imageUrls.filter((y,$)=>$!==S.index)})),p({isOpen:!1,index:null})},g=()=>{const n={};return a.date||(n.date="Required"),a.time||(n.time="Required"),a.desc?.trim()||(n.desc="Description is required"),N(n),Object.keys(n).length===0},M=n=>{if(n.preventDefault(),!g())return;let y=[...a.imageUrls];h&&!y.includes(h)&&y.push(h);const $=a.title||a.desc.trim().split(`
`)[0].substring(0,50)+(a.desc.length>50?"...":"")||"Log Update";i({...a,title:$,imageUrls:y,image:null})};if(!t)return null;const L="w-full bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-xl p-3.5 text-sm font-medium text-zinc-900 dark:text-zinc-100 outline-none transition-all duration-200 focus:bg-white dark:focus:bg-zinc-800 focus:border-black dark:focus:border-zinc-500 focus:ring-4 focus:ring-zinc-100 dark:focus:ring-zinc-800/50 placeholder:text-zinc-400",O="text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-2 flex items-center gap-1.5 ml-1";return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-zinc-900/40 dark:bg-black/80 backdrop-blur-md transition-opacity duration-300",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#121212] rounded-[2rem] shadow-2xl ring-1 ring-zinc-900/5 dark:ring-white/10 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 slide-in-from-bottom-4 duration-300 ease-out",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-white/80 dark:bg-[#121212]/80 backdrop-blur-xl z-10 sticky top-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white tracking-tight flex items-center gap-2",children:[l?e.jsx(V,{className:"text-blue-500",size:20}):e.jsx(A,{className:"text-violet-500",size:20}),l?"Edit Event":"New Event"]}),e.jsx("p",{className:"text-xs text-zinc-500 font-medium mt-0.5 ml-7",children:"Update incident timeline details"})]}),e.jsx("button",{onClick:s,disabled:j,className:"p-2.5 -mr-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all duration-200 hover:rotate-90 active:scale-90",children:e.jsx(Z,{size:22})})]}),e.jsxs("form",{onSubmit:M,className:"flex-1 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:O,children:[e.jsx(de,{size:12})," Date"]}),e.jsx("input",{type:"date",className:`${L} ${c.date?"border-red-500":""}`,value:a.date,onChange:n=>d({...a,date:n.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:O,children:[e.jsx(A,{size:12})," Time"]}),e.jsx("input",{type:"time",className:`${L} ${c.time?"border-red-500":""}`,value:a.time,onChange:n=>d({...a,time:n.target.value})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:O,children:[e.jsx(V,{size:12})," Description"]}),e.jsx("textarea",{rows:3,placeholder:"",className:`${L} resize-none min-h-[100px] ${c.desc?"border-red-500":""}`,value:a.desc,onChange:n=>d({...a,desc:n.target.value})})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("label",{className:O.replace("mb-2","mb-0"),children:[e.jsx(Ve,{size:12})," Attachments"]}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[a.imageUrls.length," Files"]})]}),e.jsxs("div",{className:"bg-zinc-100/50 dark:bg-zinc-900/50 p-1.5 rounded-2xl border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex p-1 gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>b("link"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-[10px] font-black uppercase tracking-tighter transition-all ${k==="link"?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black shadow-sm":"text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-800"}`,children:[e.jsx(oe,{size:12,strokeWidth:3})," Link URL"]}),e.jsxs("button",{type:"button",onClick:()=>b("upload"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-[10px] font-black uppercase tracking-tighter transition-all ${k==="upload"?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black shadow-sm":"text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-800"}`,children:[e.jsx(Oe,{size:12,strokeWidth:3})," Upload"]})]}),e.jsx("div",{className:"mt-1 p-1",children:k==="link"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Paste image URL here...",className:"w-full h-11 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl px-4 text-xs outline-none focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700",value:h,onChange:n=>f(n.target.value)}),e.jsx(oe,{size:14,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400"})]}),e.jsx("button",{type:"button",onClick:()=>u(),disabled:!h,className:"w-11 h-11 shrink-0 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl flex items-center justify-center transition-all active:scale-90 disabled:opacity-20",children:e.jsx(re,{size:20,strokeWidth:3})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-zinc-200 dark:border-zinc-700 rounded-xl bg-white dark:bg-zinc-800/50 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-all cursor-pointer relative overflow-hidden",onClick:()=>!r&&E.current.click(),children:[e.jsx("input",{type:"file",ref:E,className:"hidden",accept:"image/*",onChange:C}),r?e.jsxs("div",{className:"w-full px-8 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500",children:[e.jsx(ne,{size:12,className:"animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider",children:"Syncing to Drive..."})]}),e.jsxs("span",{className:"text-[10px] font-black text-blue-500",children:[Math.round(w),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden border border-zinc-200/50 dark:border-zinc-700/50",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300 ease-out relative",style:{width:`${w}%`},children:e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})})})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(be,{size:24,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"Click to select file"})]})]})})]}),a.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 px-1",children:a.imageUrls.map((n,y)=>e.jsxs("div",{className:"group relative aspect-square rounded-xl overflow-hidden bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700",children:[e.jsx("img",{src:W(n),alt:"attachment",className:"w-full h-full object-cover cursor-pointer hover:scale-110 transition-transform duration-500",onClick:()=>I(n),onError:$=>{$.target.src="https://placehold.co/400?text=Image+Not+Found"}}),e.jsx("button",{type:"button",onClick:$=>{$.stopPropagation(),v(y)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500",children:e.jsx(K,{size:12})})]},y))})]})]}),e.jsx("div",{className:"p-6 pt-4 bg-white dark:bg-[#121212] sticky bottom-0 border-t border-zinc-100 dark:border-zinc-800",children:e.jsxs("button",{type:"submit",disabled:j,className:"w-full h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl hover:shadow-zinc-500/20 active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-3",children:[j?e.jsx(ne,{size:18,className:"animate-spin"}):e.jsx(me,{size:18}),"Save Timeline Event"]})})]}),e.jsx(xe,{isOpen:S.isOpen,onClose:()=>p({isOpen:!1,index:null}),title:"Delete Image?",message:"Are you sure you want to remove this image from the gallery?",onConfirm:T,isDanger:!0}),e.jsx(ge,{isOpen:!!z,onClose:()=>I(null),imageUrl:z,allImages:a.imageUrls,initialIndex:a.imageUrls.indexOf(z)}),e.jsx(gt,{isOpen:D.isOpen,onClose:()=>U({isOpen:!1,message:""}),title:"Upload Error",message:D.message,type:"error"})]})]})}function kt({isOpen:t,onClose:s,text:i,incident:l}){const[j,a]=q.useState(!1),[d,h]=q.useState("preview"),f=x.useMemo(()=>{if(l)return{meta:{Project:l.project||"-",Subject:l.subject||"-",Status:l.status||"-",Ticket:l.ticket||"-"},details:{Impact:l.impact||"-","Root Cause":l.root_cause||"-","Action Taken":l.action||"-"},timeline:(l.events||[]).map(c=>({date:c.date?new Date(c.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:c.time,desc:c.desc||c.title,originalDate:c.date,imageUrls:c.imageUrls||(c.image?[c.image]:[])}))};if(!i)return null;const r={meta:{},details:{},timeline:[]},o=i.split(`
`);let w=!1,m="";return o.forEach(c=>{const N=c.trim();if(!N)return;const S=c.indexOf(":");if(!w&&S!==-1&&S<20){const p=c.substring(0,S).trim(),z=c.substring(S+1).trim();["Project","Subject","Status","Ticket"].includes(p)?r.meta[p]=z:(["Impact","Root Cause","Action Taken"].includes(p),r.details[p]=z)}else if(w=!0,N.length<20&&/\d/.test(N)&&!N.includes("-"))m=N;else{const z=N.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);z?r.timeline.push({date:m,time:z[1],desc:z[2]||""}):r.timeline.push({date:m,time:null,desc:N})}}),r},[i,l]),k=async()=>{try{await navigator.clipboard.writeText(i),a(!0),setTimeout(()=>{a(!1),s()},1e3)}catch(r){console.error("Failed to copy:",r);const o=document.createElement("textarea");o.value=i,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),a(!0),setTimeout(()=>{a(!1),s()},1e3)}},b=()=>{const r=new Blob([i],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(r),w=document.createElement("a");w.href=o,w.download=`Incident_Report_${f?.meta.Ticket||"Draft"}.txt`,w.click(),URL.revokeObjectURL(o)};return q.useEffect(()=>{const r=o=>{o.key==="Escape"&&t&&s()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,s]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-all",onClick:s,children:e.jsxs("div",{className:"bg-white dark:bg-[#09090b] w-full max-w-3xl h-[85vh] rounded-3xl border border-zinc-200 dark:border-zinc-800 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 relative",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(V,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>h("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>h("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(Z,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",children:d==="raw"?e.jsx("textarea",{readOnly:!0,value:i,className:"w-full h-full p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f?.meta&&Object.entries(f.meta).map(([r,o])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:r}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:o})]},r))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(G,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:f?.details&&Object.entries(f.details).map(([r,o])=>{let w=G;return r.includes("Impact")&&(w=ee),r.includes("Root")&&(w=rt),r.includes("Action")&&(w=at),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:r})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:o==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):o})]},r)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(A,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),f?.timeline.map((r,o)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(o===0||r.date!==f.timeline[o-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(de,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:r.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[r.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:r.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:r.desc}),r.imageUrls&&r.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:r.imageUrls.map((w,m)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:W(w),alt:`Evidence ${m+1}`,className:"w-full h-full object-cover",onError:c=>{c.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},m))})]})]},o)),f?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}),e.jsxs("div",{className:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",children:[e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest bg-zinc-100 dark:bg-zinc-900 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-800 transition-colors",children:[e.jsx(ae,{size:16})," Download"]}),e.jsx("button",{onClick:k,disabled:j,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${j?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(we,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:16})," Copy to Clipboard"]})})]})]})}):null}function vt({isOpen:t,onClose:s,incident:i,onUpdate:l}){const{ticketOptions:j}=te(),[a,d]=x.useState({project:"",type:"Incident",ticket:"",impact:"",root_cause:"",action:""});if(x.useEffect(()=>{i&&d({project:i.project||"",type:i.type||"Incident",ticket:i.ticket||"",impact:i.impact||"",root_cause:i.root_cause||"",action:i.action||""})},[i,t]),!t)return null;const h=o=>{o.preventDefault(),l(a),s()},f=()=>i.createdBy?typeof i.createdBy=="object"?i.createdBy.name:i.createdBy:"Unknown",k="block text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-1.5 flex items-center gap-2",b="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-3 py-2 text-xs font-bold text-zinc-900 dark:text-zinc-100 focus:ring-1 focus:ring-black dark:focus:ring-white outline-none transition-all",r="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-3 py-2 text-xs font-medium text-zinc-700 dark:text-zinc-300 focus:ring-1 focus:ring-black dark:focus:ring-white outline-none transition-all resize-none min-h-[80px]";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-[#0a0a0a] w-full max-w-2xl rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden scale-in-center animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between bg-zinc-50/50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-black dark:bg-white flex items-center justify-center",children:e.jsx(G,{size:18,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-zinc-900 dark:text-white",children:"Incident Information"}),e.jsx("p",{className:"text-[10px] text-zinc-400 font-bold uppercase tracking-tight",children:"Modify incident metadata and details"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(Z,{size:18,className:"text-zinc-400"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(He,{size:12})," Project"]}),e.jsx("input",{type:"text",className:b,value:a.project,onChange:o=>d({...a,project:o.target.value}),placeholder:"Project Name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(Me,{size:12})," Type"]}),e.jsx("select",{className:b,value:a.type,onChange:o=>d({...a,type:o.target.value}),children:(j.types||["Incident","Request","Maintenance"]).map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(ue,{size:12})," Ticket ID"]}),e.jsx("input",{type:"text",className:b,value:a.ticket,onChange:o=>d({...a,ticket:o.target.value}),placeholder:"NO-TICKET"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(ve,{size:12})," Reporter"]}),e.jsx("input",{type:"text",className:`${b} opacity-50 cursor-not-allowed`,value:f(),readOnly:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(B,{size:12})," Impact"]}),e.jsx("textarea",{className:r,value:a.impact,onChange:o=>d({...a,impact:o.target.value}),placeholder:"Describe the impact of this incident..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(V,{size:12})," Root Cause"]}),e.jsx("textarea",{className:r,value:a.root_cause,onChange:o=>d({...a,root_cause:o.target.value}),placeholder:"What was the root cause?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:k,children:[e.jsx(G,{size:12})," Action Taken"]}),e.jsx("textarea",{className:r,value:a.action,onChange:o=>d({...a,action:o.target.value}),placeholder:"What actions were taken to resolve this?"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all",children:"Discard"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-8 py-2.5 bg-black dark:bg-white text-white dark:text-black rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(me,{size:14}),"Save Changes"]})]})]})]})})}function jt({incident:t={},onUpdate:s=()=>{},onBack:i=()=>{},onDelete:l=()=>{},onEdit:j=()=>{},onGenerateReport:a=()=>{}}){const{ticketOptions:d}=te(),h=t.subject?.includes("|")&&t.subject?.includes("-"),f=c=>({Open:{bg:"bg-red-500/10",text:"text-red-600",border:"border-red-500/20",icon:B},Pending:{bg:"bg-amber-500/10",text:"text-amber-600",border:"border-amber-500/20",icon:A},"In Progress":{bg:"bg-blue-500/10",text:"text-blue-600",border:"border-blue-500/20",icon:se},Succeed:{bg:"bg-emerald-500/10",text:"text-emerald-600",border:"border-emerald-500/20",icon:H},Resolved:{bg:"bg-emerald-500/10",text:"text-emerald-600",border:"border-emerald-500/20",icon:H},Closed:{bg:"bg-zinc-500/10",text:"text-zinc-500",border:"border-zinc-500/20",icon:Y}})[c]||{bg:"bg-zinc-500/10",text:"text-zinc-500",border:"border-zinc-500/20",icon:B},k=c=>({Critical:{color:"text-red-600",icon:ee,bg:"bg-red-500/10"},High:{color:"text-orange-600",icon:ee,bg:"bg-orange-500/10"},Medium:{color:"text-yellow-600",icon:Q,bg:"bg-yellow-500/10"},Low:{color:"text-blue-600",icon:Q,bg:"bg-blue-500/10"}})[c]||{color:"text-zinc-500",icon:Q,bg:"bg-zinc-500/10"},b=f(t.status||"Open"),r=b.icon,o=k(t.priority||"Medium"),w=o.icon,m=c=>{const N=c.target.value;let S={subject:N};if(N.includes("|")&&N.includes("-")){const p=N.split("|").map(z=>z.trim());if(p.length>=2){const z=p[0].split("-").map(I=>I.trim());if(z.length>=2){S.ticket=z[0],S.project=z[1];const I=p[1],D=d.types||["Incident","Request","Maintenance"];S.type=D.find(U=>U.toLowerCase()===I.toLowerCase())||I,p.length>=3&&(S.subject=p.slice(2).join(" | "))}}}s(S)};return e.jsx("div",{className:"relative px-4 py-2 border-b border-zinc-100 dark:border-zinc-800 z-20 shrink-0 bg-white dark:bg-[#080808] transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-900 text-zinc-400 hover:text-black dark:text-zinc-500 dark:hover:text-white transition-all",children:e.jsx(Ie,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-zinc-100 dark:bg-zinc-800 mx-1"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded border ${b.border} ${b.bg}`,children:[e.jsx(r,{size:10,className:b.text}),e.jsx("select",{value:t.status||"Open",onChange:c=>s({status:c.target.value}),className:`bg-transparent font-black uppercase text-[8px] tracking-wider cursor-pointer outline-none border-none p-0 focus:ring-0 ${b.text}`,children:(d.statuses||["Open","Pending","Succeed","Closed"]).map(c=>e.jsx("option",{value:c,className:"bg-white dark:bg-zinc-900 text-zinc-800 dark:text-zinc-200",children:c},c))})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded border border-transparent ${o.bg}`,children:[e.jsx(w,{size:10,className:o.color}),e.jsx("select",{value:t.priority||"Medium",onChange:c=>s({priority:c.target.value}),className:`bg-transparent font-black uppercase text-[8px] tracking-wider cursor-pointer outline-none border-none p-0 focus:ring-0 ${o.color}`,children:(d.severities||["Critical","High","Medium","Low"]).map(c=>e.jsx("option",{value:c,className:"bg-white dark:bg-zinc-900 text-zinc-800 dark:text-zinc-200",children:c},c))})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 ml-2",children:[e.jsxs("span",{className:"text-[10px] font-mono font-black text-blue-500 tracking-tighter opacity-70",children:["#",t.ticket||"NO-ID"]}),e.jsx("div",{className:"h-1 w-1 rounded-full bg-zinc-200 dark:bg-zinc-800"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest truncate max-w-[100px]",children:t.project||"GENERAL"})]})]}),e.jsxs("div",{className:"flex-1 max-w-2xl relative group px-2",children:[e.jsx("input",{type:"text",className:"w-full text-sm md:text-base font-black text-zinc-900 dark:text-white placeholder-zinc-300 dark:placeholder-zinc-700 border-none bg-transparent p-0 focus:ring-0 leading-tight transition-all",value:t.subject||"",onChange:m,placeholder:"Auto Parsing..."}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none",children:e.jsx(De,{size:12,className:`transition-all duration-500 ${h?"text-emerald-500 fill-current animate-pulse":"text-zinc-200 dark:text-zinc-800"}`})})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-blue-500 transition-all",title:"Report",children:e.jsx(V,{size:14})}),e.jsx("button",{onClick:j,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-orange-500 transition-all",title:"Settings",children:e.jsx(Ce,{size:14})}),e.jsx("button",{onClick:l,className:"p-1.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 text-zinc-400 hover:text-red-500 transition-all",title:"Delete",children:e.jsx(K,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-zinc-100 dark:bg-zinc-800 mx-1 hidden sm:block"}),e.jsxs("div",{className:"flex flex-col items-end shrink-0 hidden sm:flex ml-1",children:[e.jsx("span",{className:"text-[7px] font-black text-zinc-300 dark:text-zinc-600 uppercase tracking-widest",children:"Date"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 dark:text-zinc-500 tracking-tighter mt-0.5",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"N/A"})]})]})]})})}function zt({incident:t,isLoading:s,onUpdateIncident:i,onAddEvent:l,onDeleteEvent:j,onUpdateEvent:a,onReorderEvent:d,onDeleteIncident:h,onBack:f}){const{currentUser:k}=X(),[b,r]=x.useState(!1),[o,w]=x.useState(!1),[m,c]=x.useState(null),[N,S]=x.useState(!1),[p,z]=x.useState(""),I=x.useMemo(()=>t?.events?[...t.events].sort((u,C)=>{if(typeof u.order=="number"&&typeof C.order=="number"&&u.order!==C.order)return u.order-C.order;const v=`${u.date||"1970-01-01"}T${u.time||"00:00"}`,T=`${C.date||"1970-01-01"}T${C.time||"00:00"}`;return v<T?1:v>T?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#050505] transition-colors",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-800 dark:to-zinc-900 flex items-center justify-center mb-6 shadow-inner",children:e.jsx(Te,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-black text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs",children:"Select an incident to view details"})]});const D=(u,C)=>{const v=[...I],T=C==="up"?u-1:u+1;if(T<0||T>=v.length)return;[v[u],v[T]]=[v[T],v[u]];const g=v.map((M,L)=>({...M,order:L}));d&&d(t.id,g)},U=u=>{const C=typeof k=="object"?k?.name:k;i(t.id,{...u,updatedBy:C})},E=()=>{const C=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}).replace(/ /g,"-").toLowerCase(),v={};I.forEach(g=>{const L=(g.date?new Date(g.date):new Date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"});v[L]||(v[L]=[]),v[L].push(g)});let T=`Project: ${t.project||"-"}
Subject: ${t.type||"Incident"} | ${t.subject||"-"} | ${C}
Status: ${t.status||"-"}
Ticket: ${t.ticket||"-"}
Impact: ${t.impact||"-"}
Root Cause: ${t.root_cause||"-"}
Action Taken: ${t.action||"-"}

`;Object.keys(v).forEach(g=>{T+=`${g}
`,v[g].forEach(M=>{T+=`${M.time} - ${M.desc||M.title}`;const L=M.imageUrls||(M.image?[M.image]:[]);L.length>0&&L.forEach(O=>T+=`
📎 ${O}`),T+=`
`}),T+=`
`}),z(T),S(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#080808] relative transition-colors duration-300 overflow-hidden",children:[e.jsx(jt,{incident:t,onUpdate:U,onBack:f,onDelete:()=>h(t.id),onEdit:()=>w(!0),onGenerateReport:E}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar bg-zinc-50/50 dark:bg-black relative min-h-0",children:s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 border-t-black dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] animate-pulse",children:"Loading Timeline..."})]}):I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsx(A,{size:48,className:"mb-4 opacity-50"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:"No timeline events recorded"}),e.jsx("button",{onClick:()=>{c(null),r(!0)},className:"mt-6 px-6 py-3 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl text-xs font-black uppercase shadow-sm hover:shadow-md hover:border-black dark:hover:border-white transition-all",children:"Start Logging"})]}):e.jsxs("div",{className:"flex flex-col pb-24 relative max-w-3xl mx-auto",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-[27px] w-[2px] bg-zinc-200 dark:bg-zinc-800 z-0"}),I.map((u,C)=>{const v=C===0||u.date!==I[C-1].date;let T="-";try{T=u.date?new Date(u.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{}return e.jsx(bt,{event:u,index:C,isLastItem:C===I.length-1,showDateHeader:v,dateLabel:T,onMove:D,onEdit:g=>{c(g),r(!0)},onDelete:g=>j(t.id,g)},u.id)})]})}),e.jsx("button",{onClick:()=>{c(null),r(!0)},className:"absolute bottom-8 right-8 bg-black dark:bg-white text-white dark:text-black w-14 h-14 rounded-full shadow-2xl hover:shadow-blue-500/20 hover:scale-105 transition-all z-30 flex items-center justify-center active:scale-95 group",children:e.jsx(Ue,{size:28,className:"group-hover:rotate-90 transition-transform duration-300"})}),e.jsx(ft,{isOpen:b,onClose:()=>r(!1),initialData:m,onSubmit:u=>{const C=typeof k=="object"?k?.name:k,v={...u};m?(v.updatedBy=C,a(t.id,m.id,v)):(v.createdBy=C,l(t.id,v)),r(!1)}}),e.jsx(kt,{isOpen:N,onClose:()=>S(!1),text:p,incident:t}),e.jsx(vt,{isOpen:o,onClose:()=>w(!1),incident:t,onUpdate:U})]})}function Bt(){const{currentUser:t}=X(),{incidents:s,filteredIncidents:i,selectedId:l,setSelectedId:j,loading:a,stats:d,searchTerm:h,setSearchTerm:f,filterStatus:k,setFilterStatus:b,filterType:r,setFilterType:o,clearFilters:w,hasActiveFilters:m}=ot(),{sortedEvents:c,loading:N}=ct(l),[S,p]=x.useState({isOpen:!1}),{toast:z}=ke(),[I,D]=x.useState(!1),U=s.find(n=>n.id===l),E=x.useCallback((n,y="success")=>{z({description:n,variant:y})},[z]),u=async()=>{if(!t){E("Please login first!","error");return}D(!0);try{const n=await R.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:t,impact:"",root_cause:"",action:""});j(n.id),E("Case created")}catch(n){console.error("Error creating incident:",n),E(n.message||"Failed to create incident","error")}finally{D(!1)}},C=n=>{p({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await R.deleteIncident(n),l===n&&j(null),p({isOpen:!1}),E("Case deleted")}catch(y){console.error("Error deleting incident:",y),E(y.message||"Failed to delete","error")}}})},v=async(n,y)=>{try{await R.updateIncident(n,y)}catch($){console.error("Error updating incident:",$),E($.message||"Failed to update","error")}},T=async(n,y)=>{try{await R.createEvent(n,y),E("Event added")}catch($){console.error("Error adding event:",$),E($.message||"Failed to add event","error")}},g=async(n,y,$)=>{try{await R.updateEvent(n,y,$),E("Event updated")}catch(_){console.error("Error updating event:",_),E(_.message||"Failed to update event","error")}},M=async(n,y)=>{p({isOpen:!0,title:"Delete Event?",message:"This timeline event will be permanently removed.",isDanger:!0,onConfirm:async()=>{try{await R.deleteEvent(n,y),p({isOpen:!1}),E("Event deleted")}catch($){console.error("Error deleting event:",$),E($.message||"Failed to delete event","error")}}})},L=async(n,y)=>{try{await R.reorderEvents(n,y)}catch($){console.error("Error reordering events:",$),E($.message||"Failed to reorder","error")}},O=n=>{if(!n||n.length===0){E("No data to export","error");return}const $=["Date,Project,Ticket,Type,Status,Subject,CreatedBy",...n.map(F=>{const pe=F.createdAt?new Date(F.createdAt).toLocaleDateString("en-GB"):"-",he=(F.subject||"").replace(/"/g,'""');return`"${pe}","${F.project||""}","${F.ticket||""}","${F.type||""}","${F.status}","${he}","${F.createdBy||""}"`})].join(`
`),_=new Blob(["\uFEFF"+$],{type:"text/csv;charset=utf-8;"}),J=document.createElement("a");J.href=URL.createObjectURL(_),J.download=`TicketTimeline_Export_${new Date().toISOString().split("T")[0]}.csv`,J.click(),E("CSV exported")};return e.jsxs("div",{className:"w-full h-full flex overflow-hidden bg-zinc-50 dark:bg-black",children:[e.jsx(xe,{isOpen:S.isOpen,onClose:()=>p({isOpen:!1}),...S}),e.jsx("div",{className:`
        h-full border-r border-zinc-200 dark:border-zinc-800 overflow-hidden bg-white dark:bg-[#050505] flex-shrink-0 transition-all duration-300
        ${l?"hidden lg:block lg:w-[350px]":"w-full lg:w-[350px]"}
      `,children:e.jsx(mt,{incidents:s,filteredIncidents:i,selectedId:l,onSelect:j,onAddIncident:u,onDeleteIncident:C,onExportCSV:O,stats:d,searchTerm:h,setSearchTerm:f,filterStatus:k,setFilterStatus:b,filterType:r,setFilterType:o,clearFilters:w,hasActiveFilters:m,loading:a})}),e.jsx("div",{className:`
        h-full flex-1 min-w-0 overflow-hidden bg-white dark:bg-[#09090b] relative
        ${l?"block":"hidden lg:block"}
      `,children:e.jsx(zt,{incident:U?{...U,events:c}:null,isLoading:N,onBack:()=>j(null),onUpdateIncident:v,onAddEvent:T,onUpdateEvent:g,onDeleteEvent:M,onDeleteIncident:C,onReorderEvent:L,saving:I})})]})}export{Bt as default};
