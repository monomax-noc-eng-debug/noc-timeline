import{c as R,r as c,R as Z,j as e,T as Y,X as te,b as Fe,F as J,C as ce,L as ue,d as ve,A as Q,a as ze,e as Be}from"./index-DK6B-WCw.js";import{i as B,U as we,u as oe,S as He,a as qe}from"./useTicketOptions-CDfYJuZt.js";import{T as se}from"./trash-2-Bo3QcrYj.js";import{H as ye}from"./hash-Cm205t8I.js";import{C as V}from"./circle-alert--QTtUIUu.js";import{C as G,S as be}from"./search-Bb0GrWoW.js";import{C as q}from"./clock-nIUUpKTM.js";import{L as Ve}from"./layers-qnb4Fv5D.js";import{D as le}from"./download-DdnyqUg2.js";import{R as Ge,L as We}from"./refresh-cw-B6gQuUtT.js";import{C as Ze,a as de,b as Xe}from"./chevron-right-k380nygg.js";import{C as Ke,a as Ye,S as Je}from"./settings-Bkv8fnLY.js";import{C as Qe,P as et}from"./pencil-D_jbUahZ.js";import"./firebaseConfig-BlIlsXYa.js";import{I as tt}from"./info-DoX0unKy.js";import{S as Ne}from"./save-BEoUYHgs.js";import{T as rt,A as st}from"./tag-DCXI9xhI.js";import{Z as Ce}from"./zap-BGSuEEfu.js";import{A as at}from"./arrow-right-DkPDAcYM.js";import{P as nt}from"./plus-CgBOjWeQ.js";import{f as it}from"./format-Xuj1Wk4j.js";import"./useBaseQuery-BujZq4kw.js";import"./configService-CZgy8SXU.js";import"./protectedTokens-BgWIJsKD.js";const ct=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],re=R("circle-play",ct);const ot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ae=R("circle-x",ot);const lt=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],dt=R("cloud-upload",lt);const xt=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],mt=R("file-plus-corner",xt);const ut=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],bt=R("folder-kanban",ut);const pt=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],gt=R("image-plus",pt);const ht=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Se=R("image",ht);const ft=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],pe=R("inbox",ft);const kt=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],ge=R("link",kt);const jt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],he=R("maximize-2",jt);const vt=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],fe=R("minimize-2",vt);const zt=[["path",{d:"M5 12h14",key:"1ays0h"}]],ie=R("minus",zt);const wt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],yt=R("move",wt);const Nt=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Ct=R("workflow",Nt);const St=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Et=R("wrench",St);const $t=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Dt=R("zoom-in",$t),It=()=>{const[t,s]=c.useState([]),[n,o]=c.useState(null),[j,a]=c.useState(!0),[i,f]=c.useState(""),[v,h]=c.useState("All"),[r,p]=c.useState("All");c.useEffect(()=>{a(!0);const b=B.subscribeIncidents(w=>{s(w),a(!1)});return()=>b()},[]);const m=c.useMemo(()=>t.filter(b=>{const w=i.toLowerCase(),A=!w||(b.subject||"").toLowerCase().includes(w)||(b.project||"").toLowerCase().includes(w)||(b.ticket||"").toLowerCase().includes(w)||(b.createdBy||"").toLowerCase().includes(w),$=v==="All"||b.status===v,M=r==="All"||b.type===r;return A&&$&&M}).sort((b,w)=>w._sortTime-b._sortTime),[t,i,v,r]),E=c.useMemo(()=>{const b=t.length,w=t.filter(g=>g.status==="Open").length,A=t.filter(g=>g.status==="In Progress").length,$=t.filter(g=>g.status==="Pending").length,M=t.filter(g=>g.status==="Monitoring").length,P=t.filter(g=>g.status==="Succeed").length,O=t.filter(g=>g.status==="Resolved").length,y=t.filter(g=>g.status==="Closed").length;return{total:b,open:w,inProgress:A,pending:$,monitoring:M,succeed:P,resolved:O,closed:y}},[t]),l=c.useMemo(()=>[{status:"Open",count:E.open,color:"#ef4444"},{status:"In Progress",count:E.inProgress,color:"#3b82f6"},{status:"Pending",count:E.pending,color:"#f59e0b"},{status:"Monitoring",count:E.monitoring,color:"#f97316"},{status:"Succeed",count:E.succeed,color:"#10b981"},{status:"Resolved",count:E.resolved,color:"#059669"},{status:"Closed",count:E.closed,color:"#6b7280"}].filter(b=>b.count>0),[E]),N=c.useCallback(()=>{f(""),h("All"),p("All")},[]);return{incidents:t,filteredIncidents:m,selectedId:n,setSelectedId:o,loading:j,searchTerm:i,setSearchTerm:f,filterStatus:v,setFilterStatus:h,filterType:r,setFilterType:p,clearFilters:N,hasActiveFilters:i||v!=="All"||r!=="All",stats:E,statusDistribution:l}},Mt=t=>{const[s,n]=c.useState([]),[o,j]=c.useState(!1),[a,i]=c.useState(null);c.useEffect(()=>{if(!t){n([]),j(!1);return}j(!0);const h=B.subscribeEvents(t,r=>{const p=r.map(m=>({...m,_sortTime:new Date(`${m.date||"1970-01-01"}T${m.time||"00:00"}`).getTime()}));n(p),j(!1)});return()=>h()},[t]);const f=c.useMemo(()=>[...s].sort((h,r)=>h._sortTime!==r._sortTime?r._sortTime-h._sortTime:(r.order||0)-(h.order||0)),[s]),v=c.useMemo(()=>({total:s.length,withImages:s.filter(h=>h.imageUrls&&h.imageUrls.length>0).length,dateRange:f.length>0?{start:f[f.length-1]?.date,end:f[0]?.date}:null}),[s,f]);return{events:s,sortedEvents:f,loading:o,error:a,stats:v}},Tt=t=>{switch(t){case"Open":return{color:"bg-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",textColor:"text-red-600 dark:text-red-400",icon:V,gradient:"from-red-500 to-rose-600"};case"In Progress":return{color:"bg-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",textColor:"text-blue-600 dark:text-blue-400",icon:re,gradient:"from-blue-500 to-indigo-600"};case"Monitoring":return{color:"bg-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",textColor:"text-orange-600 dark:text-orange-400",icon:q,gradient:"from-orange-500 to-amber-600"};case"Pending":return{color:"bg-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",textColor:"text-amber-600 dark:text-amber-400",icon:q,gradient:"from-amber-500 to-yellow-600"};case"Succeed":return{color:"bg-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",textColor:"text-emerald-600 dark:text-emerald-400",icon:G,gradient:"from-emerald-500 to-teal-600"};case"Resolved":return{color:"bg-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",textColor:"text-emerald-600 dark:text-emerald-400",icon:G,gradient:"from-emerald-500 to-teal-600"};case"Closed":return{color:"bg-zinc-400",bgColor:"bg-zinc-100 dark:bg-zinc-800",textColor:"text-zinc-500 dark:text-zinc-400",icon:ae,gradient:"from-zinc-400 to-zinc-500"};default:return{color:"bg-zinc-400",bgColor:"bg-zinc-100 dark:bg-zinc-800",textColor:"text-zinc-600 dark:text-zinc-400",icon:V,gradient:"from-zinc-400 to-zinc-500"}}},Lt=t=>{switch(t){case"Critical":return{label:"CRIT",color:"text-red-600 dark:text-red-400",bg:"bg-red-50 dark:bg-red-900/20"};case"High":return{label:"HIGH",color:"text-orange-500 dark:text-orange-400",bg:"bg-orange-50 dark:bg-orange-900/20"};case"Medium":return{label:"MED",color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"};case"Low":return{label:"LOW",color:"text-blue-500 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"};default:return{label:"MED",color:"text-zinc-500",bg:"bg-zinc-50 dark:bg-zinc-900"}}},Pt=Z.memo(({incident:t,isSelected:s,onClick:n,onDelete:o})=>{const{color:j,bgColor:a,textColor:i,icon:f,gradient:v}=Tt(t.status),h=Lt(t.priority||"Medium"),r=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:`
        group relative p-3.5 rounded-xl border transition-all duration-300 cursor-pointer overflow-hidden
        ${s?"bg-white dark:bg-[#0a0a0a] border-zinc-900 dark:border-zinc-500 shadow-xl scale-[1.01] z-10":"bg-white dark:bg-[#111] border-transparent hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-0.5"}
      `,children:[s&&e.jsx("div",{className:`absolute top-0 bottom-0 left-0 w-1 bg-gradient-to-b ${v}`}),e.jsxs("div",{className:"flex justify-between items-start mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${j} ${t.status==="Open"?"animate-pulse shadow-[0_0_8px_currentColor]":""}`}),e.jsx("span",{className:"text-[8px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-wider",children:t.project||"SYSTEM"})]}),e.jsx("span",{className:`text-[8px] font-black uppercase px-2 py-0.5 rounded-lg border border-transparent ${t.type==="Incident"?"bg-red-50 text-red-600 dark:bg-red-900/10 dark:text-red-400 dark:border-red-900/20":t.type==="Request"?"bg-blue-50 text-blue-600 dark:bg-blue-900/10 dark:text-blue-400 dark:border-blue-900/20":"bg-amber-50 text-amber-600 dark:bg-amber-900/10 dark:text-amber-400 dark:border-amber-900/20"}`,children:t.type||"Incident"}),e.jsx("span",{className:`text-[8px] font-black uppercase px-1.5 py-0.5 rounded-lg border border-transparent ${h.bg} ${h.color}`,children:h.label})]}),!s&&e.jsx("button",{onClick:p=>{p.stopPropagation(),o(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Delete incident",children:e.jsx(se,{size:12})})]}),e.jsx("h3",{className:`font-black text-xs leading-snug mb-3 line-clamp-2 min-h-[2rem] transition-colors ${s?"text-black dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-black dark:group-hover:text-white"}`,children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex justify-between items-center pt-2.5 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-zinc-400",children:[e.jsx(ye,{size:10}),e.jsx("span",{className:"text-[9px] font-mono font-bold uppercase truncate max-w-[80px]",children:t.ticket||"N/A"})]}),e.jsx("span",{className:"text-[9px] text-zinc-300 font-bold tracking-tighter uppercase",children:r})]}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-0.5 rounded-lg ${a}`,children:[e.jsx(f,{size:10,className:i}),e.jsx("span",{className:`text-[8px] font-black uppercase tracking-tight ${i}`,children:t.status})]})]})]})}),Ut=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 text-zinc-500 dark:bg-zinc-900/50 border-zinc-200 dark:border-zinc-800"}},ke=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},At=({log:t,isSelected:s,onClick:n})=>{const o=t.createdAt?new Date(t.createdAt):null,j=o?o.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:`
        group relative p-3.5 rounded-xl border transition-all duration-300 cursor-pointer overflow-hidden
        ${s?"bg-white dark:bg-[#0a0a0a] border-zinc-900 dark:border-zinc-500 shadow-xl scale-[1.01] z-10":"bg-white dark:bg-[#111] border-transparent hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-0.5"}
      `,children:[s&&e.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-1 bg-zinc-900 dark:bg-zinc-100"}),e.jsxs("div",{className:"flex justify-between items-start mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded text-[9px] font-mono font-bold",children:["#",t.ticketNumber]}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[8px] font-black uppercase border ${Ut(t.status)}`,children:t.status})]}),e.jsx("span",{className:"text-[9px] text-zinc-300 font-bold uppercase",children:j})]}),e.jsx("h3",{className:`font-medium text-xs leading-snug mb-3 line-clamp-2 min-h-[2rem] ${s?"text-black dark:text-white":"text-zinc-600 dark:text-zinc-300"}`,children:t.shortDesc||t.details||"No Description"}),e.jsxs("div",{className:"flex justify-between items-center pt-2.5 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-400",children:[e.jsx(we,{size:10}),e.jsx("span",{className:"text-[9px] font-medium truncate max-w-[80px]",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{size:10,className:ke(t.severity)}),e.jsx("span",{className:`text-[8px] font-black uppercase ${ke(t.severity)}`,children:t.severity||"Low"})]})]})]})};function _t(t,s){const[n,o]=c.useState(t);return c.useEffect(()=>{const j=setTimeout(()=>o(t),s);return()=>clearTimeout(j)},[t,s]),n}function Ot({filteredIncidents:t,selectedId:s,onSelect:n,onAddIncident:o,onDeleteIncident:j,onExportCSV:a,stats:i,logs:f,selectedLogId:v,onSelectLog:h,logsLoading:r,logStats:p,viewMode:m,onViewModeChange:E,searchTerm:l,setSearchTerm:N,filterStatus:I,setFilterStatus:b,filterType:w,setFilterType:A,clearFilters:$,hasActiveFilters:M,loading:P}){const{ticketOptions:O}=oe(),[y,g]=c.useState(l),C=_t(y,300);c.useEffect(()=>{N(C)},[C,N]),c.useEffect(()=>{g(l)},[l]);const T=x=>{b(x===I?"All":x)},[d,S]=c.useState(20),z=c.useRef(null),U=m==="logs",u=U?f:t,D=U?r:P;return c.useEffect(()=>{S(20)},[u,I,w,C,m]),c.useEffect(()=>{const x=new IntersectionObserver(F=>{F[0].isIntersecting&&u&&S(X=>Math.min(X+20,u.length))},{threshold:.1});return z.current&&x.observe(z.current),()=>x.disconnect()},[u]),e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black border-r border-zinc-200 dark:border-zinc-800 relative",children:[e.jsx("div",{className:"shrink-0 pt-4 pb-3 px-4 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-10 shadow-sm transition-all",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center shadow-lg transition-all ${U?"bg-blue-600 text-white":"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900"}`,children:U?e.jsx(pe,{size:18}):e.jsx(Ve,{size:18})}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 rounded-lg p-0.5 border border-zinc-200 dark:border-zinc-700",children:[e.jsx("button",{onClick:()=>E("incidents"),className:`px-3 py-1 text-[10px] font-black uppercase tracking-wide rounded-md transition-all ${U?"text-zinc-400 hover:text-zinc-600":"bg-white dark:bg-black shadow-sm text-zinc-900 dark:text-white"}`,children:"Cases"}),e.jsx("button",{onClick:()=>E("logs"),className:`px-3 py-1 text-[10px] font-black uppercase tracking-wide rounded-md transition-all ${U?"bg-white dark:bg-black shadow-sm text-blue-600 dark:text-blue-400":"text-zinc-400 hover:text-zinc-600"}`,children:"Inbox"})]})]}),e.jsx("div",{className:"flex items-center gap-1.5",children:!U&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(t),className:"w-8 h-8 flex items-center justify-center rounded-lg border border-zinc-200 dark:border-zinc-800 text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all active:scale-95",title:"Export Database",children:e.jsx(le,{size:15})}),e.jsx("button",{onClick:o,className:"w-8 h-8 flex items-center justify-center rounded-lg bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 shadow-md hover:opacity-90 active:scale-95 transition-all",title:"New Case",children:e.jsx(mt,{size:16})})]})})]}),e.jsx("div",{className:"flex items-center gap-1.5 overflow-x-auto no-scrollbar pb-0.5",children:U?p&&[{status:"All",count:p.total,color:"bg-zinc-400",icon:pe},{status:"Incidents",count:p.incidents,color:"bg-red-500",icon:V},{status:"Requests",count:p.requests,color:"bg-blue-500",icon:re}].map(x=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1.5 rounded-lg text-[8px] font-black uppercase bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${x.color}`}),e.jsx("span",{children:x.status}),e.jsx("span",{className:"opacity-50 ml-0.5",children:x.count})]},x.status)):i&&[{status:"Open",count:i.open,color:"bg-red-500",icon:V},{status:"In Progress",count:i.inProgress,color:"bg-blue-500",icon:re},{status:"Pending",count:i.pending,color:"bg-amber-500",icon:q},{status:"Monitoring",count:i.monitoring,color:"bg-orange-500",icon:q},{status:"Succeed",count:i.succeed,color:"bg-emerald-500",icon:G},{status:"Resolved",count:i.resolved,color:"bg-emerald-600",icon:G},{status:"Closed",count:i.closed,color:"bg-zinc-400",icon:ae}].filter(x=>x.count>0).map(x=>e.jsxs("button",{onClick:()=>T(x.status),className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-[8px] font-black uppercase tracking-tighter transition-all border ${I===x.status?"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 border-zinc-900 dark:border-zinc-100 shadow-sm":"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-400 border-zinc-100 dark:border-zinc-800 hover:border-zinc-200"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${x.color} ${I===x.status?"animate-pulse":""}`}),e.jsx("span",{children:x.status.split(" ")[0]}),e.jsx("span",{className:"opacity-50 ml-0.5",children:x.count})]},x.status))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:U?"Search ticket logs...":"Search cases...",value:y,onChange:x=>g(x.target.value),className:"w-full h-9 pl-9 pr-7 rounded-lg text-[11px] font-medium border border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 text-zinc-900 dark:text-white outline-none focus:ring-1 focus:ring-zinc-200 dark:focus:ring-zinc-700 transition-all placeholder-zinc-400"}),y&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-300 hover:text-red-500",children:e.jsx(te,{size:12})})]}),e.jsxs("div",{className:"flex bg-zinc-100/50 dark:bg-zinc-900 p-0.5 rounded-lg border border-zinc-200/50 dark:border-zinc-800",children:[e.jsxs("select",{value:w,onChange:x=>A(x.target.value),className:"h-8 pl-2 pr-1 bg-transparent border-none text-[9px] font-black uppercase text-zinc-500 dark:text-zinc-400 outline-none cursor-pointer appearance-none",children:[e.jsx("option",{value:"All",children:"Type: All"}),(O.types||["Incident","Request","Maintenance"]).map(x=>e.jsx("option",{value:x,children:x},x))]}),M&&e.jsx("button",{onClick:$,className:"w-8 h-8 flex items-center justify-center text-red-400 hover:text-red-500 transition-colors",title:"Clear filters",children:e.jsx(Ge,{size:12})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar bg-zinc-50 dark:bg-[#050505]",children:D?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 space-y-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-300 border-t-black dark:border-zinc-700 dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400",children:"Loading..."})]}):u?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-50 space-y-3",children:[e.jsx(be,{size:32,className:"text-zinc-300 dark:text-zinc-700"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400",children:M?"No matching items":U?"No records in Inbox":"No incidents yet"}),M&&e.jsx("button",{onClick:$,className:"text-[10px] font-bold text-blue-500 hover:underline",children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[u.slice(0,d).map(x=>U?e.jsx(At,{log:x,isSelected:v===(x.id||x.ticketNumber),onClick:()=>h(x)},x.id||x.ticketNumber):e.jsx(Pt,{incident:x,isSelected:s===x.id,onClick:()=>n(x.id),onDelete:j},x.id)),e.jsx("div",{ref:z,className:"h-4 w-full"}),u.length>d&&e.jsx("div",{className:"py-2 text-center text-[10px] text-zinc-400 animate-pulse",children:"Loading more..."})]})})]})}const ee=t=>{if(!t)return"";try{const s=new URL(t);if(t.includes("drive.google.com")||t.includes("docs.google.com")){let n=s.searchParams.get("id");if(!n){const o=t.match(/\/d\/(.+?)(?:\/|\?|&|$)/);o&&o[1]&&(n=o[1])}if(n)return`https://lh3.googleusercontent.com/d/${n}`}return t.includes("dropbox.com")?(s.searchParams.set("raw","1"),s.searchParams.delete("dl"),s.toString()):t}catch{if(t.includes("drive.google.com")||t.includes("docs.google.com")){const n=t.match(/\/d\/(.+?)(?:\/|\?|&|$)/);if(n&&n[1])return`https://lh3.googleusercontent.com/d/${n[1]}`}return t}};function Ee({isOpen:t,onClose:s,imageUrl:n,allImages:o=[],initialIndex:j=0}){const[a,i]=c.useState(j),[f,v]=c.useState(1),[h,r]=c.useState({x:0,y:0}),[p,m]=c.useState(!1),[E,l]=c.useState({x:0,y:0}),N=o.length>0?o:[n],I=N[a]||n,b=Z.useRef(null),[w,A]=c.useState(!1);c.useEffect(()=>{const d=()=>A(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",d),()=>document.removeEventListener("fullscreenchange",d)},[]),c.useEffect(()=>{const d=S=>{if(t)switch(S.key){case"ArrowRight":P();break;case"ArrowLeft":O();break;case"Escape":document.fullscreenElement?document.exitFullscreen():s();break;case"f":case"F":$();break;case"0":M();break}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[t,a,N.length,f]),c.useEffect(()=>{const d=b.current;if(!d)return;const S=z=>{if(!t)return;z.preventDefault();const u=-z.deltaY>0?1.1:.9,D=Math.min(Math.max(f*u,.5),10);v(D),D<=1&&r({x:0,y:0})};return d.addEventListener("wheel",S,{passive:!1}),()=>d.removeEventListener("wheel",S)},[t,f]);const $=d=>{d?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():b.current?.requestFullscreen().catch(S=>{console.error("Fullscreen failed:",S)})},M=()=>{v(1),r({x:0,y:0})};if(c.useEffect(()=>(t?(i(j||(n&&o.indexOf(n)>=0?o.indexOf(n):0)),M(),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,j,n,o]),!t)return null;const P=d=>{d?.stopPropagation(),i(S=>(S+1)%N.length),M()},O=d=>{d?.stopPropagation(),i(S=>(S-1+N.length)%N.length),M()},y=d=>{f<=1||(d.preventDefault(),m(!0),l({x:d.clientX-h.x,y:d.clientY-h.y}))},g=d=>{!p||f<=1||(d.preventDefault(),r({x:d.clientX-E.x,y:d.clientY-E.y}))},C=()=>{m(!1)},T=d=>{d?.stopPropagation(),f===1?v(2.5):M()};return Fe.createPortal(e.jsxs("div",{ref:b,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${p?"cursor-grabbing":""}`,onClick:s,onMouseMove:g,onMouseUp:C,onMouseLeave:C,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:$,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:w?e.jsx(fe,{size:24,className:"text-white"}):e.jsx(he,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",a+1," of ",N.length," • Click to ",w?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:T,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${f>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:f>1?"Reset Zoom":"Quick Zoom",children:f>1?e.jsx(fe,{size:22}):e.jsx(he,{size:22})}),e.jsx("a",{href:ee(I),download:!0,target:"_blank",rel:"noreferrer",onClick:d=>d.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(le,{size:22})}),e.jsx("button",{onClick:s,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(te,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:s,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${h.x}px, ${h.y}px) scale(${f})`,cursor:f>1?p?"grabbing":"grab":"zoom-in"},onClick:d=>{d.stopPropagation(),f===1?v(2.5):M()},onMouseDown:y,children:[e.jsx("img",{src:ee(I),alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},onError:d=>{d.target.src="https://placehold.co/1200x800?text=Failed+to+load+image"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:f===1&&e.jsx(yt,{size:64,className:"text-white/10"})})]})}),N.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:O,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(Ze,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:P,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(de,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[N.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:N.map((d,S)=>e.jsx("button",{onClick:z=>{z.stopPropagation(),i(S),setIsZoomed(!1)},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${a===S?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},S))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",I.split("/").pop().substring(0,60)]})})]})]}),document.body)}function Rt({event:t,index:s,isLastItem:n,showDateHeader:o,dateLabel:j,onMove:a,onEdit:i,onDelete:f}){const[v,h]=Z.useState({isOpen:!1,url:null,index:0});let r=(t.imageUrls||[]).filter(l=>l&&typeof l=="string");!r.length&&t.image&&typeof t.image=="string"&&(r=[t.image]),!r.length&&t.imageUrl&&typeof t.imageUrl=="string"&&(r=[t.imageUrl]);const p=t.desc&&t.desc.trim().length>0,m=r.length>0,E=l=>{l.target.closest("button")||l.target.closest(".image-container")||i(t)};return e.jsxs("div",{className:"relative flex items-start gap-3 md:gap-4 mb-4 z-10 group/item animate-in fade-in slide-in-from-left-2 duration-300",children:[e.jsxs("div",{className:"flex-none flex flex-col items-center w-14 pt-[4px]",children:[e.jsx("div",{className:`
          w-2.5 h-2.5 rounded-full bg-white dark:bg-zinc-900 border-[2.5px] border-black dark:border-white shadow-sm z-20 transition-all
          ${s===0?"ring-2 ring-black/10 dark:ring-white/10":""}
          group-hover/item:scale-125
        `}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"font-mono text-[9px] font-black text-gray-400 dark:text-zinc-500 bg-gray-50/50 dark:bg-zinc-900 px-1 py-0.5 rounded uppercase",children:t.time})}),m&&e.jsx("div",{className:"mt-1 text-zinc-300",children:e.jsx(Se,{size:9})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[o&&e.jsx("div",{className:"mb-2 -mt-1",children:e.jsx("span",{className:"inline-block text-[8px] font-black text-white dark:text-black uppercase tracking-wider bg-zinc-900 dark:bg-zinc-100 px-2 py-0.5 rounded shadow-sm",children:j})}),e.jsxs("div",{onClick:E,className:"bg-white dark:bg-[#0a0a0a] p-2.5 md:p-3 rounded-xl border border-gray-100 dark:border-zinc-800 shadow-sm flex gap-2 relative hover:border-zinc-300 dark:hover:border-zinc-600 transition-all group-hover/item:shadow-md cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col gap-0.5 justify-center border-r pr-1.5 border-gray-100 dark:border-zinc-900 opacity-100 lg:opacity-0 lg:group-hover/item:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),a(s,"up")},disabled:s===0,className:"p-0.5 text-gray-300 hover:text-black dark:hover:text-white disabled:opacity-10 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded transition-colors",children:e.jsx(Ke,{size:12})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),a(s,"down")},disabled:n,className:"p-0.5 text-gray-300 hover:text-black dark:hover:text-white disabled:opacity-10 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded transition-colors",children:e.jsx(Qe,{size:12})})]}),e.jsxs("div",{className:"flex-1 min-w-0 relative pr-10 md:pr-12",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-0.5 opacity-100 lg:opacity-0 lg:group-hover/item:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),i(t)},className:"p-1 text-gray-300 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/10 rounded transition-colors",title:"Edit",children:e.jsx(et,{size:10})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),f(t.id)},className:"p-1 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 rounded transition-colors",title:"Delete",children:e.jsx(se,{size:10})})]}),e.jsx("div",{className:"text-[11px] font-medium text-gray-700 dark:text-zinc-400 leading-normal whitespace-pre-wrap pt-0.5",children:p?t.desc:e.jsx("span",{className:"text-gray-300 dark:text-zinc-800 italic",children:"..."})}),m&&e.jsx("div",{className:`image-container grid gap-1.5 mt-2.5 ${r.length===1?"grid-cols-1 max-w-[150px]":r.length===2?"grid-cols-2 max-w-[300px]":"grid-cols-2 sm:grid-cols-3"}`,children:r.map((l,N)=>e.jsxs("div",{className:"relative group/image rounded-lg overflow-hidden border border-gray-100 dark:border-zinc-900 bg-gray-50 aspect-video",children:[e.jsx("img",{src:ee(l),className:"w-full h-full object-cover transition-transform duration-500 group-hover/image:scale-110",alt:`Evidence ${N+1}`,loading:"lazy",onError:I=>{console.warn("Image load failed:",l),I.target.src="https://placehold.co/400?text=Image+Load+Failed"}}),e.jsx("div",{onClick:I=>{I.stopPropagation(),h({isOpen:!0,url:l,index:N})},className:"absolute inset-0 bg-black/0 hover:bg-black/30 transition-all flex items-center justify-center opacity-0 hover:opacity-100 cursor-zoom-in",children:e.jsx(Dt,{size:14,className:"text-white"})})]},N))})]})]})]}),e.jsx(Ee,{isOpen:v.isOpen,onClose:()=>h(l=>({...l,isOpen:!1})),imageUrl:v.url,allImages:r,initialIndex:v.index})]})}function Ft({isOpen:t,onClose:s,title:n,message:o,type:j="error"}){if(!t)return null;const a={error:{icon:ae,color:"text-red-600",bg:"bg-red-50 dark:bg-red-950/20",btn:"bg-red-600 hover:bg-red-700 shadow-red-500/20",accent:"border-red-100 dark:border-red-900/30"},warning:{icon:V,color:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-950/20",btn:"bg-amber-600 hover:bg-amber-700 shadow-amber-500/20",accent:"border-amber-100 dark:border-amber-900/30"},success:{icon:G,color:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-950/20",btn:"bg-emerald-600 hover:bg-emerald-700 shadow-emerald-500/20",accent:"border-emerald-100 dark:border-emerald-900/30"},info:{icon:tt,color:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-950/20",btn:"bg-blue-600 hover:bg-blue-700 shadow-blue-500/20",accent:"border-blue-100 dark:border-blue-900/30"}},i=a[j]||a.error,f=i.icon;return e.jsx("div",{className:"fixed inset-0 z-[400] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-[#0a0a0a] w-full max-w-[340px] rounded-[24px] shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:`pt-8 pb-4 flex flex-col items-center justify-center gap-4 ${i.bg}`,children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center ${i.bg} border-2 ${i.accent} animate-bounce-subtle`,children:e.jsx(f,{size:32,className:i.color})}),e.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-zinc-900 dark:text-zinc-100",children:n||"System Notification"})]}),e.jsx("div",{className:"px-8 py-6",children:e.jsx("p",{className:"text-[11px] text-zinc-500 dark:text-zinc-400 leading-relaxed font-bold text-center uppercase tracking-tight",children:o})}),e.jsx("div",{className:"px-6 pb-6 pt-2",children:e.jsxs("button",{onClick:s,className:`w-full h-11 ${i.btn} text-white rounded-xl text-[10px] font-black uppercase tracking-[0.2em] shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2`,children:["Dismiss ",e.jsx(de,{size:14})]})})]})})}const Bt=async t=>{const s="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec";try{return await(await fetch(s,{method:"POST",body:JSON.stringify(t)})).json()}catch(n){return{result:"error",error:n.message}}},Ht=async t=>{try{return new Promise((s,n)=>{const o=new FileReader;o.readAsDataURL(t),o.onload=async()=>{const j=o.result.split(",")[1],a=await Bt({base64:j,fileName:t.name,mimeType:t.type});s(a)},o.onerror=j=>n(j)})}catch(s){return{result:"error",error:s.message}}};function qt({isOpen:t,onClose:s,onSubmit:n,initialData:o,saving:j=!1}){const[a,i]=c.useState({date:"",time:"",desc:"",imageUrls:[]}),[f,v]=c.useState(""),[h,r]=c.useState("link"),[p,m]=c.useState(!1),[E,l]=c.useState(0),[N,I]=c.useState({}),[b,w]=c.useState({isOpen:!1,index:null}),[A,$]=c.useState(null),[M,P]=c.useState({isOpen:!1,message:""}),O=c.useRef(null);c.useEffect(()=>{const u=D=>{D.key==="Escape"&&!j&&s()};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[s,j]),c.useEffect(()=>{if(t){if(o){let u=o.imageUrls||[];!u.length&&o.image&&(u=[o.image]),i({...o,imageUrls:u})}else{const u=new Date;i({date:u.toISOString().split("T")[0],time:`${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`,desc:"",imageUrls:[]})}v(""),I({})}},[t,o]);const y=u=>{const D=u||f;D&&!a.imageUrls.includes(D)&&(i(x=>({...x,imageUrls:[...x.imageUrls,D]})),v(""))},g=async u=>{const D=u.target.files[0];if(!D)return;m(!0),l(0);const x=setInterval(()=>{l(F=>F>=95?(clearInterval(x),95):F+Math.random()*10)},200);try{const F=await Ht(D);F.result==="success"?(l(100),setTimeout(()=>y(F.url),200)):P({isOpen:!0,message:F.error||"Upload failed. Please check your connection."})}catch(F){P({isOpen:!0,message:F.message||"An unexpected error occurred during upload."})}finally{clearInterval(x),setTimeout(()=>{m(!1),l(0)},500),u.target.value=""}},C=u=>{w({isOpen:!0,index:u})},T=()=>{b.index!==null&&i(u=>({...u,imageUrls:u.imageUrls.filter((D,x)=>x!==b.index)})),w({isOpen:!1,index:null})},d=()=>{const u={};return a.date||(u.date="Required"),a.time||(u.time="Required"),a.desc?.trim()||(u.desc="Description is required"),I(u),Object.keys(u).length===0},S=u=>{if(u.preventDefault(),!d())return;let D=[...a.imageUrls];f&&!D.includes(f)&&D.push(f);const x=a.title||a.desc.trim().split(`
`)[0].substring(0,50)+(a.desc.length>50?"...":"")||"Log Update";n({...a,title:x,imageUrls:D,image:null})};if(!t)return null;const z="w-full bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-xl p-3.5 text-sm font-medium text-zinc-900 dark:text-zinc-100 outline-none transition-all duration-200 focus:bg-white dark:focus:bg-zinc-800 focus:border-black dark:focus:border-zinc-500 focus:ring-4 focus:ring-zinc-100 dark:focus:ring-zinc-800/50 placeholder:text-zinc-400",U="text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-2 flex items-center gap-1.5 ml-1";return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-zinc-900/40 dark:bg-black/80 backdrop-blur-md transition-opacity duration-300",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#121212] rounded-[2rem] shadow-2xl ring-1 ring-zinc-900/5 dark:ring-white/10 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 slide-in-from-bottom-4 duration-300 ease-out",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-white/80 dark:bg-[#121212]/80 backdrop-blur-xl z-10 sticky top-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white tracking-tight flex items-center gap-2",children:[o?e.jsx(J,{className:"text-blue-500",size:20}):e.jsx(q,{className:"text-violet-500",size:20}),o?"Edit Event":"New Event"]}),e.jsx("p",{className:"text-xs text-zinc-500 font-medium mt-0.5 ml-7",children:"Update incident timeline details"})]}),e.jsx("button",{onClick:s,disabled:j,className:"p-2.5 -mr-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all duration-200 hover:rotate-90 active:scale-90",children:e.jsx(te,{size:22})})]}),e.jsxs("form",{onSubmit:S,className:"flex-1 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:U,children:[e.jsx(ce,{size:12})," Date"]}),e.jsx("input",{type:"date",className:`${z} ${N.date?"border-red-500":""}`,value:a.date,onChange:u=>i({...a,date:u.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:U,children:[e.jsx(q,{size:12})," Time"]}),e.jsx("input",{type:"time",className:`${z} ${N.time?"border-red-500":""}`,value:a.time,onChange:u=>i({...a,time:u.target.value})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:U,children:[e.jsx(J,{size:12})," Description"]}),e.jsx("textarea",{rows:3,placeholder:"",className:`${z} resize-none min-h-[100px] ${N.desc?"border-red-500":""}`,value:a.desc,onChange:u=>i({...a,desc:u.target.value})})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("label",{className:U.replace("mb-2","mb-0"),children:[e.jsx(gt,{size:12})," Attachments"]}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[a.imageUrls.length," Files"]})]}),e.jsxs("div",{className:"bg-zinc-100/50 dark:bg-zinc-900/50 p-1.5 rounded-2xl border border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex p-1 gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>r("link"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-[10px] font-black uppercase tracking-tighter transition-all ${h==="link"?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black shadow-sm":"text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-800"}`,children:[e.jsx(ge,{size:12,strokeWidth:3})," Link URL"]}),e.jsxs("button",{type:"button",onClick:()=>r("upload"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-[10px] font-black uppercase tracking-tighter transition-all ${h==="upload"?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-black shadow-sm":"text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-800"}`,children:[e.jsx(dt,{size:12,strokeWidth:3})," Upload"]})]}),e.jsx("div",{className:"mt-1 p-1",children:h==="link"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",placeholder:"Paste image URL here...",className:"w-full h-11 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl px-4 text-xs outline-none focus:ring-2 focus:ring-zinc-200 dark:focus:ring-zinc-700",value:f,onChange:u=>v(u.target.value)}),e.jsx(ge,{size:14,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400"})]}),e.jsx("button",{type:"button",onClick:()=>y(),disabled:!f,className:"w-11 h-11 shrink-0 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl flex items-center justify-center transition-all active:scale-90 disabled:opacity-20",children:e.jsx(de,{size:20,strokeWidth:3})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-24 border-2 border-dashed border-zinc-200 dark:border-zinc-700 rounded-xl bg-white dark:bg-zinc-800/50 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-all cursor-pointer relative overflow-hidden",onClick:()=>!p&&O.current.click(),children:[e.jsx("input",{type:"file",ref:O,className:"hidden",accept:"image/*",onChange:g}),p?e.jsxs("div",{className:"w-full px-8 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-500",children:[e.jsx(ue,{size:12,className:"animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider",children:"Syncing to Drive..."})]}),e.jsxs("span",{className:"text-[10px] font-black text-blue-500",children:[Math.round(E),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-100 dark:bg-zinc-800 rounded-full overflow-hidden border border-zinc-200/50 dark:border-zinc-700/50",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300 ease-out relative",style:{width:`${E}%`},children:e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})})})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Se,{size:24,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"Click to select file"})]})]})})]}),a.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 px-1",children:a.imageUrls.map((u,D)=>e.jsxs("div",{className:"group relative aspect-square rounded-xl overflow-hidden bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700",children:[e.jsx("img",{src:ee(u),alt:"attachment",className:"w-full h-full object-cover cursor-pointer hover:scale-110 transition-transform duration-500",onClick:()=>$(u),onError:x=>{x.target.src="https://placehold.co/400?text=Image+Not+Found"}}),e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),C(D)},className:"absolute top-1 right-1 p-1 bg-black/50 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500",children:e.jsx(se,{size:12})})]},D))})]})]}),e.jsx("div",{className:"p-6 pt-4 bg-white dark:bg-[#121212] sticky bottom-0 border-t border-zinc-100 dark:border-zinc-800",children:e.jsxs("button",{type:"submit",disabled:j,className:"w-full h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl hover:shadow-zinc-500/20 active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-3",children:[j?e.jsx(ue,{size:18,className:"animate-spin"}):e.jsx(Ne,{size:18}),"Save Timeline Event"]})})]}),e.jsx(ve,{isOpen:b.isOpen,onClose:()=>w({isOpen:!1,index:null}),title:"Delete Image?",message:"Are you sure you want to remove this image from the gallery?",onConfirm:T,isDanger:!0}),e.jsx(Ee,{isOpen:!!A,onClose:()=>$(null),imageUrl:A,allImages:a.imageUrls,initialIndex:a.imageUrls.indexOf(A)}),e.jsx(Ft,{isOpen:M.isOpen,onClose:()=>P({isOpen:!1,message:""}),title:"Upload Error",message:M.message,type:"error"})]})]})}function Vt({isOpen:t,onClose:s,text:n,incident:o}){const[j,a]=Z.useState(!1),[i,f]=Z.useState("preview"),v=c.useMemo(()=>{if(o)return{meta:{Project:o.project||"-",Subject:o.subject||"-",Status:o.status||"-",Ticket:o.ticket||"-"},details:{Impact:o.impact||"-","Root Cause":o.root_cause||"-","Action Taken":o.action||"-"},timeline:(o.events||[]).map(l=>({date:l.date?new Date(l.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:l.time,desc:l.desc||l.title,originalDate:l.date,imageUrls:l.imageUrls||(l.image?[l.image]:[])}))};if(!n)return null;const r={meta:{},details:{},timeline:[]},p=n.split(`
`);let m=!1,E="";return p.forEach(l=>{const N=l.trim();if(!N)return;const I=l.indexOf(":");if(!m&&I!==-1&&I<20){const b=l.substring(0,I).trim(),w=l.substring(I+1).trim();["Project","Subject","Status","Ticket"].includes(b)?r.meta[b]=w:(["Impact","Root Cause","Action Taken"].includes(b),r.details[b]=w)}else if(m=!0,N.length<20&&/\d/.test(N)&&!N.includes("-"))E=N;else{const w=N.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);w?r.timeline.push({date:E,time:w[1],desc:w[2]||""}):r.timeline.push({date:E,time:null,desc:N})}}),r},[n,o]),h=async()=>{try{await navigator.clipboard.writeText(n),a(!0),setTimeout(()=>{a(!1),s()},1e3)}catch(r){console.error("Failed to copy:",r);const p=document.createElement("textarea");p.value=n,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),a(!0),setTimeout(()=>{a(!1),s()},1e3)}};return Z.useEffect(()=>{const r=p=>{p.key==="Escape"&&t&&s()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,s]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-all",onClick:s,children:e.jsxs("div",{className:"bg-white dark:bg-[#09090b] w-full max-w-3xl h-[85vh] rounded-3xl border border-zinc-200 dark:border-zinc-800 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 relative",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(J,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>f("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${i==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>f("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${i==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(te,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",children:i==="raw"?e.jsx("textarea",{readOnly:!0,value:n,className:"w-full h-full p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v?.meta&&Object.entries(v.meta).map(([r,p])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:r}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:p})]},r))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(Q,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:v?.details&&Object.entries(v.details).map(([r,p])=>{let m=Q;return r.includes("Impact")&&(m=Y),r.includes("Root")&&(m=Ct),r.includes("Action")&&(m=Et),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:r})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:p==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):p})]},r)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(q,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),v?.timeline.map((r,p)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(p===0||r.date!==v.timeline[p-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(ce,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:r.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[r.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:r.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:r.desc}),r.imageUrls&&r.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:r.imageUrls.map((m,E)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ee(m),alt:`Evidence ${E+1}`,className:"w-full h-full object-cover",onError:l=>{l.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},E))})]})]},p)),v?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}),e.jsx("div",{className:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",children:e.jsx("button",{onClick:h,disabled:j,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${j?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:16})," Copy to Clipboard"]})})})]})}):null}function Gt({isOpen:t,onClose:s,incident:n,onUpdate:o}){const{ticketOptions:j}=oe(),[a,i]=c.useState({project:"",type:"Incident",ticket:"",impact:"",root_cause:"",action:""});if(c.useEffect(()=>{n&&i({project:n.project||"",type:n.type||"Incident",ticket:n.ticket||"",impact:n.impact||"",root_cause:n.root_cause||"",action:n.action||""})},[n,t]),!t)return null;const f=m=>{m.preventDefault(),o(a),s()},v=()=>n.createdBy?typeof n.createdBy=="object"?n.createdBy.name:n.createdBy:"Unknown",h="block text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-1.5 flex items-center gap-2",r="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-3 py-2 text-xs font-bold text-zinc-900 dark:text-zinc-100 focus:ring-1 focus:ring-black dark:focus:ring-white outline-none transition-all",p="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-3 py-2 text-xs font-medium text-zinc-700 dark:text-zinc-300 focus:ring-1 focus:ring-black dark:focus:ring-white outline-none transition-all resize-none min-h-[80px]";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-[#0a0a0a] w-full max-w-2xl rounded-2xl shadow-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden scale-in-center animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between bg-zinc-50/50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-black dark:bg-white flex items-center justify-center",children:e.jsx(Q,{size:18,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-zinc-900 dark:text-white",children:"Incident Information"}),e.jsx("p",{className:"text-[10px] text-zinc-400 font-bold uppercase tracking-tight",children:"Modify incident metadata and details"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(te,{size:18,className:"text-zinc-400"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(bt,{size:12})," Project"]}),e.jsx("input",{type:"text",className:r,value:a.project,onChange:m=>i({...a,project:m.target.value}),placeholder:"Project Name"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(rt,{size:12})," Type"]}),e.jsx("select",{className:r,value:a.type,onChange:m=>i({...a,type:m.target.value}),children:(j.types||["Incident","Request","Maintenance"]).map(m=>e.jsx("option",{value:m,children:m},m))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(ye,{size:12})," Ticket ID"]}),e.jsx("input",{type:"text",className:r,value:a.ticket,onChange:m=>i({...a,ticket:m.target.value}),placeholder:"NO-TICKET"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(we,{size:12})," Reporter"]}),e.jsx("input",{type:"text",className:`${r} opacity-50 cursor-not-allowed`,value:v(),readOnly:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(V,{size:12})," Impact"]}),e.jsx("textarea",{className:p,value:a.impact,onChange:m=>i({...a,impact:m.target.value}),placeholder:"Describe the impact of this incident..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(J,{size:12})," Root Cause"]}),e.jsx("textarea",{className:p,value:a.root_cause,onChange:m=>i({...a,root_cause:m.target.value}),placeholder:"What was the root cause?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(Q,{size:12})," Action Taken"]}),e.jsx("textarea",{className:p,value:a.action,onChange:m=>i({...a,action:m.target.value}),placeholder:"What actions were taken to resolve this?"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-6 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all",children:"Discard"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 px-8 py-2.5 bg-black dark:bg-white text-white dark:text-black rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(Ne,{size:14}),"Save Changes"]})]})]})]})})}function Wt({incident:t={},onUpdate:s=()=>{},onBack:n=()=>{},onDelete:o=()=>{},onEdit:j=()=>{},onGenerateReport:a=()=>{},onExport:i=()=>{},onImport:f=()=>{}}){const{ticketOptions:v}=oe(),h=t.subject?.includes("|")&&t.subject?.includes("-"),r=b=>({Open:{bg:"bg-red-500/10",text:"text-red-600",border:"border-red-500/20",icon:V},Pending:{bg:"bg-amber-500/10",text:"text-amber-600",border:"border-amber-500/20",icon:q},"In Progress":{bg:"bg-blue-500/10",text:"text-blue-600",border:"border-blue-500/20",icon:re},Succeed:{bg:"bg-emerald-500/10",text:"text-emerald-600",border:"border-emerald-500/20",icon:G},Resolved:{bg:"bg-emerald-500/10",text:"text-emerald-600",border:"border-emerald-500/20",icon:G},Closed:{bg:"bg-zinc-500/10",text:"text-zinc-500",border:"border-zinc-500/20",icon:ae}})[b]||{bg:"bg-zinc-500/10",text:"text-zinc-500",border:"border-zinc-500/20",icon:V},p=b=>({Critical:{color:"text-red-600",icon:Y,bg:"bg-red-500/10"},High:{color:"text-orange-600",icon:Y,bg:"bg-orange-500/10"},Medium:{color:"text-yellow-600",icon:ie,bg:"bg-yellow-500/10"},Low:{color:"text-blue-600",icon:ie,bg:"bg-blue-500/10"}})[b]||{color:"text-zinc-500",icon:ie,bg:"bg-zinc-500/10"},m=r(t.status||"Open"),E=m.icon,l=p(t.priority||"Medium"),N=l.icon,I=b=>{const w=b.target.value;let A={subject:w};if(w.includes("|")&&w.includes("-")){const $=w.split("|").map(M=>M.trim());if($.length>=2){const M=$[0].split("-").map(P=>P.trim());if(M.length>=2){A.ticket=M[0],A.project=M[1];const P=$[1],O=v.types||["Incident","Request","Maintenance"];A.type=O.find(y=>y.toLowerCase()===P.toLowerCase())||P,$.length>=3&&(A.subject=$.slice(2).join(" | "))}}}s(A)};return e.jsx("div",{className:"relative px-4 py-2 border-b border-zinc-100 dark:border-zinc-800 z-20 shrink-0 bg-white dark:bg-[#080808] transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-900 text-zinc-400 hover:text-black dark:text-zinc-500 dark:hover:text-white transition-all",children:e.jsx(st,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-zinc-100 dark:bg-zinc-800 mx-1"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded border ${m.border} ${m.bg}`,children:[e.jsx(E,{size:10,className:m.text}),e.jsx("select",{value:t.status||"Open",onChange:b=>s({status:b.target.value}),className:`bg-transparent font-black uppercase text-[8px] tracking-wider cursor-pointer outline-none border-none p-0 focus:ring-0 ${m.text}`,children:(v.statuses||["Open","Pending","Succeed","Closed"]).map(b=>e.jsx("option",{value:b,className:"bg-white dark:bg-zinc-900 text-zinc-800 dark:text-zinc-200",children:b},b))})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-0.5 rounded border border-transparent ${l.bg}`,children:[e.jsx(N,{size:10,className:l.color}),e.jsx("select",{value:t.priority||"Medium",onChange:b=>s({priority:b.target.value}),className:`bg-transparent font-black uppercase text-[8px] tracking-wider cursor-pointer outline-none border-none p-0 focus:ring-0 ${l.color}`,children:(v.severities||["Critical","High","Medium","Low"]).map(b=>e.jsx("option",{value:b,className:"bg-white dark:bg-zinc-900 text-zinc-800 dark:text-zinc-200",children:b},b))})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 ml-2",children:[e.jsxs("span",{className:"text-[10px] font-mono font-black text-blue-500 tracking-tighter opacity-70",children:["#",t.ticket||"NO-ID"]}),e.jsx("div",{className:"h-1 w-1 rounded-full bg-zinc-200 dark:bg-zinc-800"}),e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest truncate max-w-[100px]",children:t.project||"GENERAL"})]})]}),e.jsxs("div",{className:"flex-1 max-w-2xl relative group px-2",children:[e.jsx("input",{type:"text",className:"w-full text-sm md:text-base font-black text-zinc-900 dark:text-white placeholder-zinc-300 dark:placeholder-zinc-700 border-none bg-transparent p-0 focus:ring-0 leading-tight transition-all",value:t.subject||"",onChange:I,placeholder:"Auto Parsing..."}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none",children:e.jsx(Ce,{size:12,className:`transition-all duration-500 ${h?"text-emerald-500 fill-current animate-pulse":"text-zinc-200 dark:text-zinc-800"}`})})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-emerald-500 transition-all",title:"Export CSV",children:e.jsx(le,{size:14})}),e.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-blue-500 transition-all",title:"Report",children:e.jsx(J,{size:14})}),e.jsx("button",{onClick:j,className:"p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-orange-500 transition-all",title:"Settings",children:e.jsx(Je,{size:14})}),e.jsx("button",{onClick:o,className:"p-1.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 text-zinc-400 hover:text-red-500 transition-all",title:"Delete",children:e.jsx(se,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-zinc-100 dark:bg-zinc-800 mx-1 hidden sm:block"}),e.jsxs("div",{className:"flex flex-col items-end shrink-0 hidden sm:flex ml-1",children:[e.jsx("span",{className:"text-[7px] font-black text-zinc-300 dark:text-zinc-600 uppercase tracking-widest",children:"Date"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 dark:text-zinc-500 tracking-tighter mt-0.5",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"N/A"})]})]})]})})}function Zt({incident:t,isLoading:s,onUpdateIncident:n,onAddEvent:o,onDeleteEvent:j,onUpdateEvent:a,onReorderEvent:i,onDeleteIncident:f,onBack:v}){const{currentUser:h}=ze(),[r,p]=c.useState(!1),[m,E]=c.useState(!1),[l,N]=c.useState(null),[I,b]=c.useState(!1),[w,A]=c.useState(""),$=c.useMemo(()=>t?.events?[...t.events].sort((y,g)=>{if(typeof y.order=="number"&&typeof g.order=="number"&&y.order!==g.order)return y.order-g.order;const C=`${y.date||"1970-01-01"}T${y.time||"00:00"}`,T=`${g.date||"1970-01-01"}T${g.time||"00:00"}`;return C<T?1:C>T?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#050505] transition-colors",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-zinc-100 to-zinc-200 dark:from-zinc-800 dark:to-zinc-900 flex items-center justify-center mb-6 shadow-inner",children:e.jsx(at,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-black text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs",children:"Select an incident to view details"})]});const M=(y,g)=>{const C=[...$],T=g==="up"?y-1:y+1;if(T<0||T>=C.length)return;[C[y],C[T]]=[C[T],C[y]];const d=C.map((S,z)=>({...S,order:z}));i&&i(t.id,d)},P=y=>{const g=typeof h=="object"?h?.name:h;n(t.id,{...y,updatedBy:g})},O=()=>{const g=new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}).replace(/ /g,"-").toLowerCase(),C={};$.forEach(d=>{const z=(d.date?new Date(d.date):new Date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"});C[z]||(C[z]=[]),C[z].push(d)});let T=`Project: ${t.project||"-"}
Subject: ${t.type||"Incident"} | ${t.subject||"-"} | ${g}
Status: ${t.status||"-"}
Ticket: ${t.ticket||"-"}
Impact: ${t.impact||"-"}
Root Cause: ${t.root_cause||"-"}
Action Taken: ${t.action||"-"}

`;Object.keys(C).forEach(d=>{T+=`${d}
`,C[d].forEach(S=>{T+=`${S.time} - ${S.desc||S.title}`;const z=S.imageUrls||(S.image?[S.image]:[]);z.length>0&&z.forEach(U=>T+=`
📎 ${U}`),T+=`
`}),T+=`
`}),A(T),b(!0)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#080808] relative transition-colors duration-300 overflow-hidden",children:[e.jsx(Wt,{incident:t,onUpdate:P,onBack:v,onDelete:()=>f(t.id),onEdit:()=>E(!0),onGenerateReport:O,onExport:()=>{const y="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription";let g=[];const C=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"-",T=(t.subject||"").replace(/"/g,'""'),d=typeof t.createdBy=="object"?t.createdBy.name:t.createdBy||"",S=`"${C}","${t.project||""}","${t.ticket||""}","${t.type||""}","${t.status}","${T}","${d}"`;$&&$.length>0?$.forEach(D=>{const x=D.date?new Date(D.date).toLocaleDateString("en-GB"):"-",F=D.time||"-",X=(D.desc||D.title||"").replace(/"/g,'""').replace(/\n/g," ");g.push(`${S},"${x}","${F}","${X}"`)}):g.push(`${S},"-","-","-"`);const z=[y,...g].join(`
`),U=new Blob(["\uFEFF"+z],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");u.href=URL.createObjectURL(U),u.download=`Incident_${t.ticket||"NO-ID"}_Export.csv`,u.click()}}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar bg-zinc-50/50 dark:bg-black relative min-h-0",children:s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 border-t-black dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] animate-pulse",children:"Loading Timeline..."})]}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsx(q,{size:48,className:"mb-4 opacity-50"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:"No timeline events recorded"}),e.jsx("button",{onClick:()=>{N(null),p(!0)},className:"mt-6 px-6 py-3 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl text-xs font-black uppercase shadow-sm hover:shadow-md hover:border-black dark:hover:border-white transition-all",children:"Start Logging"})]}):e.jsxs("div",{className:"flex flex-col pb-24 relative max-w-3xl mx-auto",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-[27px] w-[2px] bg-zinc-200 dark:bg-zinc-800 z-0"}),$.map((y,g)=>{const C=g===0||y.date!==$[g-1].date;let T="-";try{T=y.date?new Date(y.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{}return e.jsx(Rt,{event:y,index:g,isLastItem:g===$.length-1,showDateHeader:C,dateLabel:T,onMove:M,onEdit:d=>{N(d),p(!0)},onDelete:d=>j(t.id,d)},y.id)})]})}),e.jsx("button",{onClick:()=>{N(null),p(!0)},className:"absolute bottom-8 right-8 bg-black dark:bg-white text-white dark:text-black w-14 h-14 rounded-full shadow-2xl hover:shadow-blue-500/20 hover:scale-105 transition-all z-30 flex items-center justify-center active:scale-95 group",children:e.jsx(nt,{size:28,className:"group-hover:rotate-90 transition-transform duration-300"})}),e.jsx(qt,{isOpen:r,onClose:()=>p(!1),initialData:l,onSubmit:y=>{const g=typeof h=="object"?h?.name:h,C={...y};l?(C.updatedBy=g,a(t.id,l.id,C)):(C.createdBy=g,o(t.id,C)),p(!1)}}),e.jsx(Vt,{isOpen:I,onClose:()=>b(!1),text:w,incident:t}),e.jsx(Gt,{isOpen:m,onClose:()=>E(!1),incident:t,onUpdate:P})]})}const Xt=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},je=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}};function Kt({log:t,onAddToIncident:s,onClose:n}){if(!t)return null;const o=t.createdAt?it(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsx("div",{className:"h-full bg-zinc-50/50 dark:bg-[#09090b] flex flex-col items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-zinc-900 rounded-2xl shadow-xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-full",children:[e.jsx("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900 flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"px-2.5 py-1 bg-blue-500 text-white text-[10px] font-bold rounded shadow-blue-500/20 shadow-lg",children:"TICKET LOG"}),e.jsxs("span",{className:"text-2xl font-black text-zinc-900 dark:text-white",children:["#",t.ticketNumber]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-zinc-400 font-medium",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:12})," ",o]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-zinc-300"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(He,{size:12})," ",t.type]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-zinc-300"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[9px] font-bold border ${Xt(t.status)} uppercase`,children:t.status})]})]})}),e.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-100 dark:border-zinc-800 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-wider",children:"Severity"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:14,className:je(t.severity)}),e.jsx("span",{className:`text-sm font-bold ${je(t.severity)}`,children:t.severity||"Low"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-100 dark:border-zinc-800 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-wider",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:t.category||"-"})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-950/50 border border-zinc-100 dark:border-zinc-800 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-wider",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:t.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 mb-3 tracking-widest flex items-center gap-2",children:[e.jsx(We,{size:12})," Description"]}),e.jsx("div",{className:"p-5 bg-zinc-50 dark:bg-black rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap",children:t.details||t.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 mb-3 tracking-widest flex items-center gap-2",children:[e.jsx(Q,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300 bg-white dark:bg-zinc-900/50 p-3 rounded-lg border border-zinc-100 dark:border-zinc-800",children:t.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 mb-3 tracking-widest flex items-center gap-2",children:[e.jsx(G,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300 bg-white dark:bg-zinc-900/50 p-3 rounded-lg border border-zinc-100 dark:border-zinc-800",children:t.resolvedDetail||"Pending"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-xs font-bold text-zinc-500",children:t.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-black uppercase text-zinc-400",children:"Assigned To"}),e.jsx("div",{className:"text-sm font-bold text-zinc-800 dark:text-white",children:t.assign||"Unassigned"})]})]})]}),e.jsxs("div",{className:"p-6 bg-zinc-50/80 dark:bg-zinc-900 border-t border-zinc-200 dark:border-zinc-800",children:[e.jsxs("button",{onClick:()=>s(t),className:"w-full py-4 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-xl text-sm font-black uppercase tracking-wide hover:opacity-90 active:scale-[0.99] transition-all shadow-xl flex items-center justify-center gap-2",children:[e.jsx(Ce,{size:16,className:"fill-current"}),"Create Incident Case"]}),e.jsx("p",{className:"text-center mt-3 text-[10px] text-zinc-400",children:"This will create a new incident case in the timeline and link this ticket."})]})]})})}function vr(){const{currentUser:t}=ze(),[s,n]=c.useState("incidents"),{incidents:o,filteredIncidents:j,selectedId:a,setSelectedId:i,loading:f,stats:v,searchTerm:h,setSearchTerm:r,filterStatus:p,setFilterStatus:m,filterType:E,setFilterType:l,clearFilters:N,hasActiveFilters:I}=It(),{sortedEvents:b,loading:w}=Mt(a),{logs:A,loading:$,stats:M}=qe(),[P,O]=c.useState(null),[y,g]=c.useState({isOpen:!1}),{toast:C}=Be(),[T,d]=c.useState(!1),S=o.find(k=>k.id===a),z=c.useCallback((k,L="success")=>{C({description:k,variant:L})},[C]),U=async()=>{d(!0);try{const k=typeof t=="object"?t:{name:"Admin"},L=await B.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:k,impact:"",root_cause:"",action:""});n("incidents"),i(L.id),z("Case created")}catch(k){console.error("Error creating incident:",k),z(k.message||"Failed to create incident","error")}finally{d(!1)}},u=async k=>{if(k){d(!0);try{const L=typeof t=="object"?t:{name:"System"},_={subject:k.shortDesc||k.details||`Ticket #${k.ticketNumber}`,ticket:k.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(k.type)?k.type:"Incident",status:"Open",priority:k.severity||"Medium",createdBy:L,impact:"",root_cause:k.details||"",action:k.action||""},W=await B.createIncident(_,k.ticketNumber);z(`Ticket #${k.ticketNumber} promoted to Case`),n("incidents"),i(W.id)}catch(L){console.error("Error promoting log:",L),z("Failed to promote ticket","error")}finally{d(!1)}}},D=k=>{g({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await B.deleteIncident(k),a===k&&i(null),g({isOpen:!1}),z("Case deleted")}catch(L){console.error("Error deleting incident:",L),z(L.message||"Failed to delete","error")}}})},x=async(k,L)=>{try{await B.updateIncident(k,L)}catch(_){console.error("Error updating incident:",_),z(_.message||"Failed to update","error")}},F=async(k,L)=>{try{await B.createEvent(k,L),z("Event added")}catch(_){console.error("Error adding event:",_),z(_.message||"Failed to add event","error")}},X=async(k,L,_)=>{try{await B.updateEvent(k,L,_),z("Event updated")}catch(W){console.error("Error updating event:",W),z(W.message||"Failed to update event","error")}},$e=async(k,L)=>{g({isOpen:!0,title:"Delete Event?",message:"This timeline event will be permanently removed.",isDanger:!0,onConfirm:async()=>{try{await B.deleteEvent(k,L),g({isOpen:!1}),z("Event deleted")}catch(_){console.error("Error deleting event:",_),z(_.message||"Failed to delete event","error")}}})},De=async(k,L)=>{try{await B.reorderEvents(k,L)}catch(_){console.error("Error reordering events:",_),z(_.message||"Failed to reorder","error")}},Ie=async k=>{if(!k||k.length===0){z("No data to export","error");return}z("Preparing export...","info");try{const L="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription";let _=[];for(const H of k){const Te=H.createdAt?new Date(H.createdAt).toLocaleDateString("en-GB"):"-",Le=(H.subject||"").replace(/"/g,'""').replace(/\n/g," "),Pe=(H.project||"").replace(/"/g,'""').replace(/\n/g," "),Ue=(H.ticket||"").replace(/"/g,'""').replace(/\n/g," "),Ae=(H.type||"").replace(/"/g,'""').replace(/\n/g," "),xe=`"${Te}","${Pe}","${Ue}","${Ae}","${H.status}","${Le}","${H.createdBy?.name||H.createdBy||""}"`,me=await B.getEvents(H.id);me.length>0?me.forEach(K=>{const _e=K.date?new Date(K.date).toLocaleDateString("en-GB"):"-",Oe=K.time||"-",Re=(K.desc||K.title||"").replace(/"/g,'""').replace(/\n/g," ");_.push(`${xe},"${_e}","${Oe}","${Re}"`)}):_.push(`${xe},"-","-","-"`),_.push(",,,,,,,,,")}const W=[L,..._].join(`
`),Me=new Blob(["\uFEFF"+W],{type:"text/csv;charset=utf-8;"}),ne=document.createElement("a");ne.href=URL.createObjectURL(Me),ne.download=`TicketTimeline_Full_Export_${new Date().toISOString().split("T")[0]}.csv`,ne.click(),z("Export completed")}catch(L){console.error("Export failed:",L),z("Failed to export data","error")}};return e.jsxs("div",{className:"w-full h-full flex overflow-hidden bg-zinc-50 dark:bg-black",children:[e.jsx(ve,{isOpen:y.isOpen,onClose:()=>g({isOpen:!1}),...y}),e.jsx("div",{className:`
        h-full border-r border-zinc-200 dark:border-zinc-800 overflow-hidden bg-white dark:bg-[#050505] flex-shrink-0 transition-all duration-300
        ${a||P?"hidden lg:block lg:w-[350px]":"w-full lg:w-[350px]"}
      `,children:e.jsx(Ot,{filteredIncidents:j,selectedId:a,onSelect:k=>{n("incidents"),i(k)},onAddIncident:U,onDeleteIncident:D,onExportCSV:Ie,stats:v,logs:A,selectedLogId:P?.ticketNumber,onSelectLog:O,logsLoading:$,logStats:M,viewMode:s,onViewModeChange:k=>{n(k),k==="incidents"&&O(null),k==="logs"&&i(null)},searchTerm:h,setSearchTerm:r,filterStatus:p,setFilterStatus:m,filterType:E,setFilterType:l,clearFilters:N,hasActiveFilters:I,loading:f})}),e.jsx("div",{className:`
        h-full flex-1 min-w-0 overflow-hidden bg-white dark:bg-[#09090b] relative
        ${a||P||s==="incidents"?"block":"hidden lg:block"}
      `,children:s==="incidents"?e.jsx(Zt,{incident:S?{...S,events:b}:null,isLoading:w,onBack:()=>i(null),onUpdateIncident:x,onAddEvent:F,onUpdateEvent:X,onDeleteEvent:$e,onDeleteIncident:D,onReorderEvent:De,saving:T}):e.jsx(Kt,{log:P,onAddToIncident:u,onClose:()=>O(null)})})]})}export{vr as default};
