import{j as d,d as n,a as o,i as m,g as p,e as y,u as h,p as c,E,r as A,t as D,v as S,G as f,x as C,y as w,k as g,z as U,A as I,B as v}from"./firebaseConfig-Cp-1Ewx5.js";const i="users",P={register:async({email:r,password:t,name:e,role:a="Viewer"})=>{try{const u=(await I(c,r,t)).user;await v(u,{displayName:e});const l={uid:u.uid,email:u.email,name:e,role:a,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0};return await g(n(o,i,u.uid),l),l}catch(s){throw new Error(s.message)}},login:async(r,t)=>{try{const a=(await U(c,r,t)).user,s=await d(n(o,i,a.uid));if(!s.exists())throw new Error("User profile not found");const u=s.data();if(!u.isActive)throw await w(c),new Error("Account is disabled. Contact administrator.");return u}catch(e){throw new Error(e.message)}},logout:async()=>{try{await w(c)}catch(r){throw new Error(r.message)}},loginWithGoogle:async()=>{try{const r=new f,e=(await C(c,r)).user,a=await d(n(o,i,e.uid));let s;if(a.exists()){if(s=a.data(),!s.isActive)throw await w(c),new Error("Account is disabled. Contact administrator.")}else s={uid:e.uid,email:e.email,name:e.displayName||e.email.split("@")[0],role:"Viewer",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isActive:!0,photoURL:e.photoURL||null},await g(n(o,i,e.uid),s);return s}catch(r){throw r.code==="auth/popup-closed-by-user"?new Error("Sign-in cancelled"):new Error(r.message)}},getCurrentUser:async()=>new Promise(r=>{const t=S(c,async e=>{if(t(),e){const a=await d(n(o,i,e.uid));r(a.exists()?a.data():null)}else r(null)})}),changePassword:async(r,t)=>{try{const e=c.currentUser;if(!e||!e.email)throw new Error("No user is currently signed in");const a=E.credential(e.email,r);await A(e,a),await D(e,t)}catch(e){throw e.code==="auth/wrong-password"?new Error("Current password is incorrect"):new Error(e.message)}},updateUser:async(r,t)=>{try{const e=n(o,i,r);await h(e,{...t,updatedAt:new Date().toISOString()})}catch(e){throw new Error(e.message)}},deleteUser:async r=>{try{const t=n(o,i,r);await h(t,{isActive:!1,updatedAt:new Date().toISOString()})}catch(t){throw new Error(t.message)}},permanentDeleteUser:async r=>{try{await y(n(o,i,r))}catch(t){throw new Error(t.message)}},getAllUsers:async()=>{try{return(await m(p(o,i))).docs.map(t=>({id:t.id,...t.data()}))}catch(r){throw new Error(r.message)}},getUserById:async r=>{try{const t=await d(n(o,i,r));return t.exists()?{id:t.id,...t.data()}:null}catch(t){throw new Error(t.message)}}};export{P as a};
