const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driveUpload-BPcOS6Dp.js","assets/index-BFEWtwhJ.js","assets/index-CVhFeo2U.css","assets/sliders-horizontal-iwKFpgUC.js","assets/chevron-right-DVovX0bV.js"])))=>i.map(i=>d[i]);
import{d as je,_ as ke,n as ve,g as Y,f as B,t as G,q as ce,i as Z,o as J,x as oe,l as Ne,m as de,aj as ye,ak as ze,h as we,v as De,b as ee,a as Se,r as l,j as e,X as ie,y as v,L as le,C as me,al as Ce,ai as _,am as te,an as se,z as he,N as ue,P as K,J as Ae,F as Ie,O as Ee}from"./index-BFEWtwhJ.js";import{u as Me,V as Fe}from"./VirtualizedList-BvEmNleU.js";import{f as $}from"./format-DU8rxv2E.js";import{u as Pe,S as He,F as Le}from"./FilterBar-B7acpHUP.js";import{D as be,f as pe}from"./formatters-DpnTxRTe.js";import{T as Te}from"./TimeInput-BnbwFigf.js";import{I as Oe,g as Be,B as Re,C as _e,a as $e,u as Ue,b as qe,D as Ve}from"./driveUpload-BPcOS6Dp.js";import{P as fe,T as We}from"./trash-2-DeAKwTRc.js";import{C as re}from"./configService-D_rl3Y87.js";import{C as L}from"./sliders-horizontal-iwKFpgUC.js";import{A as Ge}from"./activity-CgZXiaul.js";import{S as Je}from"./save-CToUh0ov.js";import{p as Q}from"./setYear-BV4xPqlg.js";import{F as Xe}from"./funnel-Bj5Lkajq.js";import"./search-Caa-NJMl.js";import"./addYears-C7ezsmVv.js";import"./chevron-right-DVovX0bV.js";import"./chevron-down-qX9YY_vo.js";import"./rotate-ccw-DgI1qe1m.js";const Ke=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],Qe=je("expand",Ke),R="shift_handovers",H={subscribeHandovers:(t,i=50)=>{const a=ce(Z(B,R),J("date","desc"),J("createdAt","desc"),oe(i));return De(a,c=>{const g=c.docs.map(u=>({id:u.id,...u.data(),onDuty:u.data().onDuty||[],acknowledgedBy:u.data().acknowledgedBy||[]}));t(g)},c=>{console.error("Firestore subscription error:",c),t([])})},createHandover:async t=>{try{const i={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:t.acknowledgedBy||[],onDuty:t.onDuty||[]};return await we(Z(B,R),i)}catch(i){G(i)}},updateHandover:async(t,i)=>{try{const a={...i,updatedAt:new Date().toISOString()};await de(Y(B,R,t),a)}catch(a){G(a)}},toggleAcknowledge:async(t,i,a)=>{try{const c=Y(B,R,t);await de(c,{acknowledgedBy:a?ye(i):ze(i),updatedAt:new Date().toISOString()})}catch(c){G(c)}},createShift:t=>H.createHandover(t),getShifts:async(t=50)=>{try{const i=ce(Z(B,R),J("date","desc"),J("createdAt","desc"),oe(t));return(await Ne(i)).docs.map(c=>({id:c.id,...c.data()}))}catch(i){G(i)}},updateShift:(t,i)=>H.updateHandover(t,i),deleteShift:(t,i=[])=>H.deleteHandover(t,i),deleteHandover:async(t,i=[])=>{try{i&&i.length>0&&Promise.all(i.map(a=>ke(async()=>{const{deleteFileFromDrive:c}=await import("./driveUpload-BPcOS6Dp.js").then(g=>g.c);return{deleteFileFromDrive:c}},__vite__mapDeps([0,1,2,3,4])).then(({deleteFileFromDrive:c})=>c(a.id||a.url||a)))).catch(a=>console.error("Error cleaning up images:",a)),await ve(Y(B,R,t))}catch(a){G(a)}}},Ye=()=>{const t=ee(r=>r.currentUser),i=ee(r=>r.nocMembers),{toast:a}=Se(),[c,g]=l.useState([]),[u,f]=l.useState(!0),[S,d]=l.useState(!1),[N,z]=l.useState(""),[j,C]=l.useState("All"),[A,s]=l.useState("All"),[m,h]=l.useState(""),o=l.useCallback((r,n="success")=>{a({description:r,variant:n==="error"?"destructive":"default"})},[a]);l.useEffect(()=>{if(!t){g([]),f(!1);return}const r=H.subscribeHandovers(n=>{g(n||[]),f(!1)});return()=>r&&r()},[t]);const w=l.useMemo(()=>{if(!c.length)return[];const r=m.toLowerCase().trim();return c.filter(n=>{const x=(n.note||"").toLowerCase().includes(r),b=(n.onDuty||[]).some(W=>(W||"").toLowerCase().includes(r)),k=(n.status||"").toLowerCase().includes(r),T=!r||x||b||k,q=!N||n.date===N,V=j==="All"||n.shift===j,O=A==="All"||n.status===A;return T&&q&&V&&O})},[c,m,N,j,A]),D=l.useCallback(r=>{const n=Array.isArray(i)?i.length:0,x=(r.acknowledgedBy||[]).length,b=n>0?Math.round(x/n*100):0,k=n>0&&x>=n;return{total:n,acked:x,percentage:b,isComplete:k}},[i]),M=l.useMemo(()=>{const r=w.length,n=w.filter(b=>b.status!=="Normal").length,x=w.filter(b=>D(b).isComplete).length;return{total:r,withIssues:n,fullyAcked:x}},[w,D]),I=l.useCallback(async(r,n,x)=>{d(!0);try{return n?(await H.updateHandover(x,r),o("Log updated successfully")):(await H.createHandover(r),o("Log created successfully")),!0}catch(b){return console.error(b),o(b.message||"Save failed","error"),!1}finally{d(!1)}},[o]),F=l.useCallback(async r=>{try{await H.deleteHandover(r),o("Log deleted")}catch(n){console.error(n),o(n.message||"Delete failed","error")}},[o]),U=l.useCallback(async(r,n)=>{if(!t){o("Please login first!","error");return}const x=(r.acknowledgedBy||[]).includes(n);try{await H.toggleAcknowledge(r.id,n,x),o(x?"Acknowledgment removed":"Acknowledged ✓")}catch(b){console.error(b),o(b.message||"Failed to update","error")}},[t,o]),P=l.useCallback(()=>{if(w.length===0){o("No data to export","error");return}try{const n=["Date,Time,Shift,Status,Team,Acknowledged,Note",...w.map(k=>{const T=new Date(k.date).toLocaleDateString("en-GB"),q=(k.note||"").replace(/"/g,'""'),V=(k.onDuty||[]).join("; "),O=(k.acknowledgedBy||[]).join("; ");return`"${T}","${k.time}","${k.shift}","${k.status}","${V}","${O}","${q}"`})].join(`
`),x=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a");b.href=URL.createObjectURL(x),b.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,b.click(),o("CSV exported successfully")}catch(r){console.error(r),o("Export failed","error")}},[w,o]),E=l.useCallback(()=>{z(""),C("All"),s("All"),h("")},[]);return{filteredHistory:w,loading:u,saving:S,stats:M,filterDate:N,setFilterDate:z,filterShift:j,setFilterShift:C,filterStatus:A,setFilterStatus:s,searchText:m,setSearchText:h,clearFilters:E,handleSave:I,handleDelete:F,handleAcknowledge:U,handleExportCSV:P,getAckStats:D}},Ze=(t,i,a,c,g)=>{const[u,f]=l.useState({date:"",time:"",shift:"Morning",onDuty:[],status:"Normal",note:""}),[S,d]=l.useState({});l.useEffect(()=>{{if(i)f({...i,onDuty:i.onDuty||[]});else{const s=new Date,m=typeof a=="object"?a?.name:a;f({date:$(s,"yyyy-MM-dd"),time:$(s,"HH:mm"),shift:s.getHours()>=8&&s.getHours()<20?"Morning":"Night",onDuty:m?[m]:[],status:"Normal",note:""})}d({})}},[t,i,a]);const N=(s,m)=>{f(h=>({...h,[s]:m})),S[s]&&d(h=>({...h,[s]:null}))},z=s=>{f(m=>{const h=m.onDuty||[];return h.includes(s)?{...m,onDuty:h.filter(o=>o!==s)}:{...m,onDuty:[...h,s]}})},j=()=>{const s={};return u.date||(s.date="Date is required"),u.time||(s.time="Start time is required"),(!u.onDuty||u.onDuty.length===0)&&(s.onDuty="Select at least one member"),d(s),Object.keys(s).length===0},C=()=>{j()&&g(u)},A=l.useMemo(()=>{const s=new Set(c.map(o=>o.name)),m=[...c],h=typeof a=="object"?a?.name:a;return!i&&h&&!s.has(h)&&(m.push({id:"current-user",name:h,role:"Current",isActive:!0}),s.add(h)),i?.onDuty&&i.onDuty.forEach(o=>{s.has(o)||(m.push({id:o,name:o,role:"History",isActive:!1}),s.add(o))}),m},[c,i,a]);return{formData:u,errors:S,setField:N,toggleMember:z,handleSubmit:C,displayMembers:A}};function et({value:t=[],onChange:i,maxImages:a=10}){const[c,g]=l.useState(!1),[u,f]=l.useState(0),[S,d]=l.useState(""),[N,z]=l.useState({}),[j,C]=l.useState(!1),[A,s]=l.useState(0),m=l.useRef(null),h=l.useRef(null),o=l.useRef(!1),w=(t||[]).map((r,n)=>typeof r=="string"?{url:r,name:`Image ${n+1}`,id:`img-${n}`}:r),D=w.map(r=>r.url);l.useEffect(()=>{(!t||t.length===0)&&(z({}),d(""),f(0))},[t]),l.useEffect(()=>()=>{h.current&&clearInterval(h.current)},[]);const M=r=>{r&&(r.stopPropagation(),r.preventDefault()),o.current=!0,h.current&&(clearInterval(h.current),h.current=null),g(!1),f(0),d("Upload canceled"),m.current&&(m.current.value="")},I=async r=>{const n=r.target.files[0];if(n){if(!n.type.startsWith("image/")){d("Please select an image file only.");return}if(w.length>=a){d(`Maximum ${a} images allowed.`);return}d(""),g(!0),f(10),o.current=!1;try{h.current=setInterval(()=>{o.current||f(b=>b>=90?b:b+10)},300);const x=await Ue(n);if(h.current&&(clearInterval(h.current),h.current=null),o.current)return;if(x&&x.result==="success"&&x.url){f(100);const b={url:x.url,name:n.name,id:x.id||`img-${Date.now()}`};i([...w,b]),d("")}else throw new Error(x?.error||"Upload failed")}catch(x){if(h.current&&(clearInterval(h.current),h.current=null),o.current)return;console.error("Upload error:",x),d(x.message||"Drive upload failed. Check permissions.")}finally{o.current||g(!1),m.current&&(m.current.value="")}}},F=(r,n)=>{n?.stopPropagation();const x=w.filter((b,k)=>k!==r);i(x),z(b=>{const k={...b};return delete k[r],k})},U=r=>{z(n=>({...n,[r]:!0}))},P=(r,n)=>{n?.stopPropagation(),s(r),C(!0)},E=w.length<a;return e.jsxs("div",{className:"space-y-3",children:[w.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:w.map((r,n)=>e.jsxs("div",{className:"relative group rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 aspect-video bg-zinc-100 dark:bg-zinc-900 cursor-pointer hover:ring-2 hover:ring-[#0078D4]/50 transition-all",onClick:x=>P(n,x),children:[N[n]?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-400 gap-1",children:[e.jsx(Oe,{size:24}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500",children:"Preview N/A"})]}):e.jsx("img",{src:Be(r.url),alt:r.name||"Preview",className:"w-full h-full object-cover",referrerPolicy:"no-referrer",onError:()=>U(n)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx(Qe,{size:20,className:"text-white"})}),e.jsx("button",{type:"button",onClick:x=>F(n,x),className:"absolute top-1.5 right-1.5 p-1.5 bg-red-500 text-white rounded-md shadow-sm hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-all active:scale-95",title:"Remove Image",children:e.jsx(ie,{size:12,strokeWidth:2.5})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent pt-4 pb-1.5 px-2",children:e.jsx("span",{className:"text-[10px] font-bold text-white/90 truncate block",children:r.name||"Image"})})]},r.id||n))}),E&&e.jsxs("div",{onClick:()=>!c&&m.current?.click(),className:v("relative border border-dashed rounded-lg h-24 flex items-center justify-center transition-all group bg-zinc-50 dark:bg-zinc-900/50",c?"border-zinc-200 cursor-default":"border-zinc-300 dark:border-zinc-700 hover:border-[#0078D4] hover:bg-blue-50/50 dark:hover:bg-blue-900/10 cursor-pointer"),children:[c?e.jsxs("div",{className:"w-full px-6 flex flex-col gap-3 relative z-10",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#0078D4]",children:[e.jsx(le,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold",children:"Syncing to Drive..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-semibold text-[#0078D4] tabular-nums",children:[u,"%"]}),e.jsx("button",{type:"button",onClick:M,className:"p-1.5 rounded-md bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/40 border border-transparent hover:border-red-200 dark:hover:border-red-800 transition-all shrink-0",title:"Cancel Upload",children:e.jsx(Re,{size:12,strokeWidth:2.5})})]})]}),e.jsx("div",{className:"h-1 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300",style:{width:`${u}%`}})})]}):e.jsx("div",{className:"flex flex-col items-center gap-2 text-zinc-500 group-hover:text-[#0078D4] transition-colors",children:w.length>0?e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:24,strokeWidth:1.5}),e.jsxs("span",{className:"text-xs font-semibold",children:["Add More (",w.length,"/",a,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:24,strokeWidth:1.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Click to Upload Images (Gallery)"})]})}),e.jsx("input",{type:"file",ref:m,onChange:I,className:"hidden",accept:"image/*"})]}),S&&e.jsxs("div",{className:"flex items-center gap-2 text-rose-600 bg-rose-50 dark:bg-rose-950/20 px-3 py-2 rounded-md animate-in slide-in-from-top-1",children:[e.jsx(me,{size:14}),e.jsx("span",{className:"text-xs font-semibold",children:S})]}),e.jsx($e,{isOpen:j,onClose:()=>C(!1),imageUrl:D[A],allImages:D,initialIndex:A})]})}const y={sectionTitle:"flex items-center gap-2 text-xs font-bold text-[#0078D4] uppercase tracking-wider mb-4",label:"block text-[11px] font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",inputContainer:"relative transition-all group",input:"w-full h-10 bg-white dark:bg-zinc-900 border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 text-sm font-medium text-zinc-900 dark:text-white focus:ring-1 focus:ring-[#0078D4] focus:border-[#0078D4] outline-none transition-all placeholder:text-zinc-400",error:"text-[10px] font-semibold text-red-600 mt-1 flex items-center gap-1",btnOption:"flex-1 flex items-center justify-center gap-2 rounded-md text-[10px] font-bold uppercase transition-all",btnActive:"bg-white dark:bg-zinc-800 text-[#0078D4] shadow-sm border border-zinc-200 dark:border-zinc-700",btnInactive:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-200",memberCard:"relative flex flex-col items-center justify-center p-3 rounded-lg border transition-all duration-200 group"},ae=l.memo(({onSubmit:t,initialData:i,isEditing:a,currentUser:c,saving:g=!1,onCancel:u})=>{const{team:f}=Me(),{ticketOptions:S}=Pe(),{formData:d,errors:N,setField:z,toggleMember:j,handleSubmit:C}=Ze(!0,i,c,f,t),A=s=>{z("images",s)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#121214] overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center bg-zinc-50/80 dark:bg-zinc-900/80 backdrop-blur-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold uppercase tracking-tight text-zinc-900 dark:text-white flex items-center gap-2",children:[a?e.jsx(Ce,{size:20,className:"text-[#0078D4]"}):e.jsx(re,{size:20,className:"text-[#0078D4]"}),a?"Edit Shift Log":"New Handover"]}),e.jsx("p",{className:"text-xs font-medium text-zinc-500 mt-0.5",children:"Record details for the next shift team."})]}),a&&e.jsxs("div",{className:"px-3 py-1 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 text-[10px] font-bold uppercase tracking-wider border border-orange-100 dark:border-orange-900/30 flex items-center gap-1.5",children:[e.jsx(me,{size:12})," Editing Mode"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(re,{size:14})," Shift Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:[e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:v(y.label,"truncate"),children:"Date"}),e.jsx(be,{date:d.date?Q(d.date):void 0,setDate:s=>s&&z("date",pe(s)),placeholder:"Pick a date",className:v(y.input,N.date&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),N.date&&e.jsxs("p",{className:y.error,children:[e.jsx(_,{size:10})," ",N.date]})]}),e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:v(y.label,"truncate"),children:"Start Time"}),e.jsx(Te,{value:d.time,onChange:s=>z("time",s.target.value),className:v(y.input,"text-center tracking-widest",N.time&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),N.time&&e.jsxs("p",{className:y.error,children:[e.jsx(_,{size:10})," ",N.time]})]}),e.jsxs("div",{className:v(y.inputContainer,"sm:col-span-2 lg:col-span-1"),children:[e.jsx("label",{className:v(y.label,"truncate"),children:"Period"}),e.jsx("div",{className:"flex rounded-lg bg-zinc-100 dark:bg-zinc-800/50 p-1 border border-zinc-200 dark:border-zinc-700 h-10 overflow-hidden",children:["Morning","Night"].map(s=>e.jsxs("button",{type:"button",onClick:()=>z("shift",s),className:v(y.btnOption,"min-w-0 overflow-hidden",d.shift===s?y.btnActive:y.btnInactive),children:[s==="Morning"?e.jsx(te,{size:14,className:"shrink-0"}):e.jsx(se,{size:14,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:s})]},s))})]})]})]}),e.jsx("hr",{className:"border-zinc-200 dark:border-zinc-800"}),e.jsxs("section",{children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(he,{size:14})," Responsibility"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:S.responsibilities?.map(s=>{const m=d.onDuty.includes(s);return e.jsxs("button",{type:"button",onClick:()=>j(s),className:v(y.memberCard,m?"bg-blue-50 dark:bg-blue-900/20 border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-[#0078D4] hover:shadow-sm"),children:[m&&e.jsx("div",{className:"absolute top-2 right-2 text-[#0078D4]",children:e.jsx(L,{size:14,fill:"currentColor",className:"text-white dark:text-blue-900"})}),e.jsx("div",{className:v("w-8 h-8 mb-2 rounded-full flex items-center justify-center text-xs font-bold transition-colors",m?"bg-[#0078D4] text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 group-hover:bg-zinc-200 dark:group-hover:bg-zinc-700"),children:s.charAt(0)}),e.jsx("span",{className:v("text-[10px] font-bold uppercase truncate w-full text-center",m?"text-[#0078D4]":"text-zinc-600"),children:s})]},s)})}),N.onDuty&&e.jsxs("p",{className:y.error,children:[e.jsx(_,{size:10})," ",N.onDuty]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(Ge,{size:14})," Log Details"]}),e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:["Normal","Issues"].map(s=>e.jsxs("button",{type:"button",onClick:()=>z("status",s),className:v("px-3 py-1 rounded-md text-[10px] font-bold uppercase transition-all flex items-center gap-1.5",d.status===s?s==="Normal"?"bg-white dark:bg-zinc-800 text-emerald-600 shadow-sm":"bg-white dark:bg-zinc-800 text-red-500 shadow-sm":"text-zinc-400"),children:[d.status===s&&(s==="Normal"?e.jsx(L,{size:10}):e.jsx(_,{size:10})),s]},s))})]}),e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:y.label,children:"Handover Remarks / Incidents"}),e.jsx("textarea",{rows:6,value:d.note,onChange:s=>z("note",s.target.value),className:v(y.input,"h-auto py-3 resize-none leading-relaxed"),placeholder:"Enter handover details here..."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:y.label,children:"Attached Images"}),e.jsx(et,{value:d.images||[],onChange:A,maxImages:10})]})]}),e.jsx("div",{className:"h-10"})]}),e.jsxs("div",{className:"shrink-0 p-5 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 flex gap-3",children:[a&&e.jsx("button",{type:"button",onClick:u,disabled:g,className:"flex-1 py-2.5 rounded-lg border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 font-bold text-xs uppercase hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors disabled:opacity-50",children:"Cancel Edit"}),e.jsxs("button",{onClick:C,disabled:g,className:"flex-[2] py-2.5 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-lg font-bold text-xs uppercase shadow-sm flex items-center justify-center gap-2 hover:opacity-90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[g?e.jsx(le,{size:16,className:"animate-spin"}):e.jsx(Je,{size:16}),a?"Update Handover":"Submit Handover"]})]})]})});ae.displayName="ShiftHandoverForm";const X=({label:t,value:i,icon:a,className:c})=>e.jsxs("div",{className:v("space-y-1",c),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-zinc-500 uppercase tracking-wide",children:[a&&e.jsx(a,{size:12,className:"text-[#0078D4]"}),t]}),e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 break-words",children:i||"-"})]}),ne=l.memo(({log:t,onClose:i,onEdit:a,onDelete:c,onAcknowledge:g,currentUser:u})=>{if(!t)return null;const f=t.status==="Issues",S=u&&(t.acknowledgedBy||[]).includes(u.name),d=ue(u,[K.LEAD,K.ENGINEER])||u&&u.name===t.createdBy;let N=t.date,z="";try{const j=Q(t.date);N=$(j,"MMMM d, yyyy"),z=$(j,"EEEE")}catch{}return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900 overflow-hidden relative",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:i,className:"lg:hidden p-2 -ml-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full",children:e.jsx(ie,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:v("flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-bold border uppercase tracking-wider",t.shift==="Morning"?"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-800":"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800"),children:[t.shift==="Morning"?e.jsx(te,{size:12,strokeWidth:2.5}):e.jsx(se,{size:12,strokeWidth:2.5}),t.shift]}),e.jsx("span",{className:"text-zinc-300",children:"•"}),e.jsx("span",{className:"text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:N})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(t),className:"p-2 text-zinc-500 hover:text-[#0078D4] hover:bg-[#0078D4]/5 rounded-lg transition-colors",title:"Edit",children:e.jsx(He,{size:18})}),e.jsx("button",{onClick:()=>c(t),className:"p-2 text-zinc-500 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(We,{size:18})})]}),e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-700 mx-2"}),e.jsxs("button",{onClick:()=>g&&g(t,u?.name),className:v("flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold uppercase tracking-wide rounded-md transition-all shadow-sm border",S?"bg-emerald-50 text-emerald-600 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800":"bg-zinc-900 text-white border-zinc-900 hover:bg-zinc-800 dark:bg-white dark:text-black dark:border-white"),children:[e.jsx(L,{size:14,className:S?"fill-emerald-600 text-white":""}),S?"Acknowledged":"Acknowledge"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:f?e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-[10px] font-bold uppercase text-rose-600 bg-rose-50 dark:bg-rose-500/10 px-2 py-0.5 rounded border border-rose-100 dark:border-rose-500/20",children:[e.jsx(_,{size:10})," Issues Reported"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-[10px] font-bold uppercase text-emerald-600 bg-emerald-50 dark:bg-emerald-500/10 px-2 py-0.5 rounded border border-emerald-100 dark:border-emerald-500/20",children:[e.jsx(L,{size:10})," Normal"]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0 w-10 h-10 rounded-full bg-zinc-100 dark:bg-zinc-800 border-2 border-white dark:border-zinc-900 shadow-sm flex items-center justify-center overflow-hidden",children:e.jsx("span",{className:"text-sm font-black text-zinc-500",children:t.createdBy?t.createdBy.charAt(0).toUpperCase():"?"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold text-zinc-900 dark:text-white leading-tight",children:["Handover by ",t.createdBy]}),e.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-0.5 flex items-center gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{size:12})," ",t.time]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-mono",children:z})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8 bg-zinc-50/50 dark:bg-[#0c0c0e]",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pb-6 border-b border-zinc-200 dark:border-zinc-800/50",children:[e.jsx(X,{label:"Shift Type",value:t.shift,icon:t.shift==="Morning"?te:se}),e.jsx(X,{label:"Duty Count",value:`${(t.onDuty||[]).length} Person(s)`,icon:he}),e.jsx(X,{label:"Ack Count",value:`${(t.acknowledgedBy||[]).length} / ${(t.onDuty||[]).length||"-"}`,icon:L}),e.jsx(X,{label:"Status",value:t.status,icon:f?_:L,className:f?"text-rose-600":"text-emerald-600"})]}),(t.onDuty||[]).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider flex items-center gap-2",children:"Personnel On Duty"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.onDuty||[]).map((j,C)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0078D4]/10 text-[#0078D4] flex items-center justify-center text-[10px] font-bold",children:j.charAt(0)}),e.jsx("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:j})]},C))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider",children:"Handover Note"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none bg-white dark:bg-zinc-800/40 p-5 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed text-zinc-700 dark:text-zinc-300",children:t.note||e.jsx("span",{className:"italic text-zinc-400",children:"No content provided."})})})]}),(t.images||[]).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider",children:"Attachments"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:(t.images||[]).map((j,C)=>e.jsxs("div",{className:"group relative aspect-video bg-zinc-100 dark:bg-zinc-800 rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-700",children:[e.jsx("img",{src:j,alt:"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("a",{href:j,target:"_blank",className:"absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/30 transition-colors",children:e.jsx(qe,{className:"text-white opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all"})})]},C))})]}),(t.acknowledgedBy||[]).length>0&&e.jsxs("div",{className:"pt-6 border-t border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1 rounded bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600",children:e.jsx(L,{size:12})}),e.jsx("span",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Acknowledged by"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.acknowledgedBy||[]).map((j,C)=>e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded bg-emerald-50 dark:bg-emerald-900/10 text-emerald-700 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-900/20",children:j},C))})]})]})]})});ne.displayName="ShiftDetailPanel";const xe=({label:t,isActive:i,onClick:a})=>e.jsx("button",{onClick:a,className:v("px-3 py-1.5 rounded-md text-xs font-bold uppercase tracking-wide transition-all border",i?"bg-[#dde7ee] text-[#0078D4] border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 text-zinc-600 border-zinc-200 dark:border-zinc-700 hover:border-[#0078D4] dark:hover:border-[#0078D4]"),children:t}),ge=Ae.memo(({data:t,onClick:i,isSelected:a,currentUser:c})=>{const g=t.status==="Issues",u=c&&(t.acknowledgedBy||[]).includes(c.name);let f="--",S="";try{if(t.date){const d=Q(t.date);f=$(d,"dd"),S=$(d,"MMM")}}catch{}return e.jsx("div",{onClick:i,className:v("group cursor-pointer px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 transition-all",a?"bg-[#0078D4]/5 border-l-2 border-l-[#0078D4]":"hover:bg-zinc-50 dark:hover:bg-zinc-900 border-l-2 border-l-transparent"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:v("flex flex-col items-center justify-center w-10 h-10 rounded-md border shrink-0 transition-colors",g?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800 text-red-600":"bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300"),children:[e.jsx("span",{className:"text-sm font-bold leading-none",children:f}),e.jsx("span",{className:"text-[8px] font-bold uppercase text-zinc-500",children:S})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-900 dark:text-zinc-100 truncate",children:t.createdBy||"Unknown"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400",children:t.time})]}),e.jsx("p",{className:v("text-xs line-clamp-2 leading-relaxed",a?"text-zinc-800 dark:text-zinc-200":"text-zinc-500 dark:text-zinc-400"),children:t.note||e.jsx("span",{className:"italic opacity-50",children:"No remarks"})}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx("span",{className:v("px-1.5 py-0.5 rounded text-[9px] font-bold uppercase border",t.shift==="Morning"?"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-900/20 dark:text-slate-400"),children:t.shift}),g?e.jsxs("span",{className:"text-[9px] font-bold text-red-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"}),"Issues"]}):e.jsxs("span",{className:"text-[9px] font-bold text-emerald-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),"Normal"]}),u&&e.jsx("span",{className:"text-[9px] font-bold text-[#0078D4]",children:"✓ Acked"})]})]})]})})});ge.displayName="ShiftListItem";function Nt(){const{currentUser:t}=ee(),i=ue(t,[K.LEAD,K.ENGINEER]),{filteredHistory:a,loading:c,saving:g,stats:u,filterDate:f,setFilterDate:S,filterShift:d,setFilterShift:N,filterStatus:z,setFilterStatus:j,searchText:C,setSearchText:A,clearFilters:s,handleSave:m,handleDelete:h,handleExportCSV:o,handleAcknowledge:w}=Ye(),[D,M]=l.useState(null),[I,F]=l.useState("view"),[U,P]=l.useState(!1),[E,r]=l.useState(null),n=l.useCallback(p=>{M(p),F("view")},[]),x=l.useCallback(()=>{M(null),F("create")},[]),b=l.useCallback(p=>{M(p),F("edit")},[]),k=l.useCallback(()=>{M(null),F("view")},[]),T=async p=>{await m(p,I==="edit"&&D,D?.id)&&k()},q=()=>{E&&(h(E.id,E.images),r(null),D?.id===E.id&&k())},V=l.useCallback(p=>e.jsx(ge,{data:p,onClick:()=>n(p),isSelected:D?.id===p.id,currentUser:t},p.id),[D,t,n]),O=f||d!=="All"||z!=="All",W=D!==null||I==="create";return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx(Le,{title:"Shift Handovers",icon:null,searchTerm:C,onSearch:A,actions:[{label:"New",icon:fe,onClick:x,variant:"primary",disabled:!i,hideTextOnMobile:!0},{label:"Export",icon:Ve,onClick:o,variant:"secondary",hideTextOnMobile:!0}],isFilterActive:O,onFilterClick:()=>P(!0)}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:v("flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#0a0a0a] transition-all",W?"hidden lg:flex lg:w-[350px] xl:w-[400px]":"w-full lg:w-[350px] xl:w-[400px]"),children:[e.jsxs("div",{className:"shrink-0 px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-zinc-500",children:[u.total," records"]}),O&&e.jsx("button",{onClick:s,className:"text-[10px] font-semibold text-[#0078D4] hover:underline",children:"Clear Filters"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 gap-3 text-zinc-400",children:[e.jsx(le,{size:24,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-medium",children:"Syncing..."})]}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-6",children:[e.jsx("div",{className:"w-12 h-12 bg-zinc-50 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-3 text-zinc-300",children:e.jsx(Xe,{size:20})}),e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"No logs found"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-[200px]",children:"Try adjusting your filters or create a new handover."})]}):e.jsx(Fe,{items:a,itemHeight:100,renderItem:V,containerHeight:"100%"})})]}),e.jsx("div",{className:v("flex-1 flex flex-col overflow-hidden bg-white dark:bg-zinc-900 transition-all",!W&&"hidden lg:flex"),children:I==="view"&&D?e.jsx(ne,{log:D,onClose:k,onEdit:b,onDelete:p=>r(p),onAcknowledge:w,currentUser:t}):I==="create"||I==="edit"?e.jsx(ae,{onSubmit:T,initialData:D,isEditing:I==="edit",currentUser:t,saving:g,onCancel:k}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-zinc-300 dark:text-zinc-700",children:[e.jsx("p",{className:"text-sm font-medium",children:"Select a log to view details"}),e.jsx("p",{className:"text-xs mt-1",children:"or create a new handover"})]})})]}),W&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsx("div",{className:"w-full max-h-[90vh] bg-white dark:bg-zinc-900 rounded-t-2xl overflow-hidden animate-in slide-in-from-bottom duration-300",children:I==="view"&&D?e.jsx(ne,{log:D,onClose:k,onEdit:b,onDelete:p=>r(p),onAcknowledge:w,currentUser:t}):e.jsx(ae,{onSubmit:T,initialData:D,isEditing:I==="edit",currentUser:t,saving:g,onCancel:k})})}),e.jsx(Ie,{isOpen:U,onClose:()=>P(!1),size:"sm",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900",children:"Filters"}),e.jsx("button",{onClick:()=>P(!1),children:e.jsx(ie,{size:18,className:"text-zinc-400"})})]}),footer:e.jsx("button",{onClick:()=>P(!1),className:"w-full py-3 bg-zinc-900 text-white rounded-lg text-xs font-bold uppercase",children:"Done"}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Date"}),e.jsx(be,{date:f?Q(f):void 0,setDate:p=>S(p?pe(p):""),className:"w-full bg-zinc-50 border-zinc-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Shift"}),e.jsx("div",{className:"flex gap-2",children:["All","Morning","Night"].map(p=>e.jsx(xe,{label:p,isActive:d===p,onClick:()=>N(p)},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Status"}),e.jsx("div",{className:"flex gap-2",children:["All","Normal","Issues"].map(p=>e.jsx(xe,{label:p,isActive:z===p,onClick:()=>j(p)},p))})]})]})}),e.jsx(Ee,{isOpen:!!E,onClose:()=>r(null),onConfirm:q,title:"Delete Log",message:"Are you sure you want to remove this handover log? Associated images will also be deleted.",isDanger:!0})]})}export{Nt as default};
