import{c as qe,g as Je,a as Te,e as $e,h as Be,r as y,j as e,X as we,L as ye,F as Xe,u as et,d as tt,T as st,C as rt,A as it}from"./index-DK6B-WCw.js";import{t as be,u as Ke,a as nt,i as at,U as ct,S as ot}from"./useTicketOptions-CDfYJuZt.js";import{i as ze,f as lt}from"./format-Xuj1Wk4j.js";import{p as je}from"./parse-B5HBKvJx.js";import{a as He,F as dt}from"./addYears-CztALyGx.js";import{C as _e}from"./cloud-download-Dc17wpCt.js";import{C as ut}from"./clock-nIUUpKTM.js";import{C as ht}from"./circle-alert--QTtUIUu.js";import{C as Ce,S as xt}from"./search-Bb0GrWoW.js";import{A as pt}from"./arrow-right-DkPDAcYM.js";import{D as ft}from"./database-F_kCxUSr.js";import{S as mt}from"./save-BEoUYHgs.js";import{P as bt}from"./plus-CgBOjWeQ.js";import{G as gt}from"./globe-DPNg0oVo.js";import{T as We}from"./trash-2-Bo3QcrYj.js";import{Z as Qe}from"./zap-BGSuEEfu.js";import"./firebaseConfig-BlIlsXYa.js";import"./useBaseQuery-BujZq4kw.js";import"./configService-CZgy8SXU.js";import"./protectedTokens-BgWIJsKD.js";import"./addDays-CsCA8S13.js";const kt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],vt=qe("circle-arrow-down",kt);const yt=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ge=qe("square-pen",yt);var ge={exports:{}};var zt=ge.exports,Oe;function jt(){return Oe||(Oe=1,(function(n,f){((m,d)=>{n.exports=d()})(zt,function m(){var d=typeof self<"u"?self:typeof window<"u"?window:d!==void 0?d:{},D,v=!d.document&&!!d.postMessage,x=d.IS_PAPA_WORKER||!1,R={},q=0,o={};function g(s){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var r=le(t);r.chunkSize=parseInt(r.chunkSize),t.step||t.chunk||(r.chunkSize=null),this._handle=new Q(r),(this._handle.streamer=this)._config=r}).call(this,s),this.parseChunk=function(t,r){var a=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<a){let j=this._config.newline;j||(c=this._config.quoteChar||'"',j=this._handle.guessLineEndings(t,c)),t=[...t.split(j).slice(a)].join(j)}this.isFirstChunk&&C(this._config.beforeFirstChunk)&&(c=this._config.beforeFirstChunk(t))!==void 0&&(t=c),this.isFirstChunk=!1,this._halted=!1;var a=this._partialLine+t,c=(this._partialLine="",this._handle.parse(a,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=c.meta.cursor,a=(this._finished||(this._partialLine=a.substring(t-this._baseIndex),this._baseIndex=t),c&&c.data&&(this._rowCount+=c.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),x)d.postMessage({results:c,workerId:o.WORKER_ID,finished:a});else if(C(this._config.chunk)&&!r){if(this._config.chunk(c,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=c=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(c.data),this._completeResults.errors=this._completeResults.errors.concat(c.errors),this._completeResults.meta=c.meta),this._completed||!a||!C(this._config.complete)||c&&c.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),a||c&&c.meta.paused||this._nextChunk(),c}this._halted=!0},this._sendError=function(t){C(this._config.error)?this._config.error(t):x&&this._config.error&&d.postMessage({workerId:o.WORKER_ID,error:t,finished:!1})}}function $(s){var t;(s=s||{}).chunkSize||(s.chunkSize=o.RemoteChunkSize),g.call(this,s),this._nextChunk=v?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),v||(t.onload=V(this._chunkLoaded,this),t.onerror=V(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!v),this._config.downloadRequestHeaders){var r,a=this._config.downloadRequestHeaders;for(r in a)t.setRequestHeader(r,a[r])}var c;this._config.chunkSize&&(c=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+c));try{t.send(this._config.downloadRequestBody)}catch(j){this._chunkError(j.message)}v&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(r=>(r=r.getResponseHeader("Content-Range"))!==null?parseInt(r.substring(r.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(r){r=t.statusText||r,this._sendError(new Error(r))}}function F(s){(s=s||{}).chunkSize||(s.chunkSize=o.LocalChunkSize),g.call(this,s);var t,r,a=typeof FileReader<"u";this.stream=function(c){this._input=c,r=c.slice||c.webkitSlice||c.mozSlice,a?((t=new FileReader).onload=V(this._chunkLoaded,this),t.onerror=V(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var c=this._input,j=(this._config.chunkSize&&(j=Math.min(this._start+this._config.chunkSize,this._input.size),c=r.call(c,this._start,j)),t.readAsText(c,this._config.encoding));a||this._chunkLoaded({target:{result:j}})},this._chunkLoaded=function(c){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(c.target.result)},this._chunkError=function(){this._sendError(t.error)}}function u(s){var t;g.call(this,s=s||{}),this.stream=function(r){return t=r,this._nextChunk()},this._nextChunk=function(){var r,a;if(!this._finished)return r=this._config.chunkSize,t=r?(a=t.substring(0,r),t.substring(r)):(a=t,""),this._finished=!t,this.parseChunk(a)}}function Y(s){g.call(this,s=s||{});var t=[],r=!0,a=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(c){this._input=c,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){a&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=V(function(c){try{t.push(typeof c=="string"?c:c.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(j){this._streamError(j)}},this),this._streamError=V(function(c){this._streamCleanUp(),this._sendError(c)},this),this._streamEnd=V(function(){this._streamCleanUp(),a=!0,this._streamData("")},this),this._streamCleanUp=V(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Q(s){var t,r,a,c,j=Math.pow(2,53),M=-j,ee=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,X=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,w=this,I=0,p=0,H=!1,i=!1,b=[],l={data:[],errors:[],meta:{}};function O(N){return s.skipEmptyLines==="greedy"?N.join("").trim()==="":N.length===1&&N[0].length===0}function B(){if(l&&a&&(ie("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),a=!1),s.skipEmptyLines&&(l.data=l.data.filter(function(k){return!O(k)})),G()){let k=function(U,K){C(s.transformHeader)&&(U=s.transformHeader(U,K)),b.push(U)};if(l)if(Array.isArray(l.data[0])){for(var N=0;G()&&N<l.data.length;N++)l.data[N].forEach(k);l.data.splice(0,1)}else l.data.forEach(k)}function S(k,U){for(var K=s.header?{}:[],A=0;A<k.length;A++){var T=A,_=k[A],_=((ne,z)=>(L=>(s.dynamicTypingFunction&&s.dynamicTyping[L]===void 0&&(s.dynamicTyping[L]=s.dynamicTypingFunction(L)),(s.dynamicTyping[L]||s.dynamicTyping)===!0))(ne)?z==="true"||z==="TRUE"||z!=="false"&&z!=="FALSE"&&((L=>{if(ee.test(L)&&(L=parseFloat(L),M<L&&L<j))return 1})(z)?parseFloat(z):X.test(z)?new Date(z):z===""?null:z):z)(T=s.header?A>=b.length?"__parsed_extra":b[A]:T,_=s.transform?s.transform(_,T):_);T==="__parsed_extra"?(K[T]=K[T]||[],K[T].push(_)):K[T]=_}return s.header&&(A>b.length?ie("FieldMismatch","TooManyFields","Too many fields: expected "+b.length+" fields but parsed "+A,p+U):A<b.length&&ie("FieldMismatch","TooFewFields","Too few fields: expected "+b.length+" fields but parsed "+A,p+U)),K}var P;l&&(s.header||s.dynamicTyping||s.transform)&&(P=1,!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(S),P=l.data.length):l.data=S(l.data,0),s.header&&l.meta&&(l.meta.fields=b),p+=P)}function G(){return s.header&&b.length===0}function ie(N,S,P,k){N={type:N,code:S,message:P},k!==void 0&&(N.row=k),l.errors.push(N)}C(s.step)&&(c=s.step,s.step=function(N){l=N,G()?B():(B(),l.data.length!==0&&(I+=N.data.length,s.preview&&I>s.preview?r.abort():(l.data=l.data[0],c(l,w))))}),this.parse=function(N,S,P){var k=s.quoteChar||'"',k=(s.newline||(s.newline=this.guessLineEndings(N,k)),a=!1,s.delimiter?C(s.delimiter)&&(s.delimiter=s.delimiter(N),l.meta.delimiter=s.delimiter):((k=((U,K,A,T,_)=>{var ne,z,L,ue;_=_||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var he=0;he<_.length;he++){for(var ae,fe=_[he],J=0,ce=0,W=0,te=(L=void 0,new Z({comments:T,delimiter:fe,newline:K,preview:10}).parse(U)),de=0;de<te.data.length;de++)A&&O(te.data[de])?W++:(ae=te.data[de].length,ce+=ae,L===void 0?L=ae:0<ae&&(J+=Math.abs(ae-L),L=ae));0<te.data.length&&(ce/=te.data.length-W),(z===void 0||J<=z)&&(ue===void 0||ue<ce)&&1.99<ce&&(z=J,ne=fe,ue=ce)}return{successful:!!(s.delimiter=ne),bestDelimiter:ne}})(N,s.newline,s.skipEmptyLines,s.comments,s.delimitersToGuess)).successful?s.delimiter=k.bestDelimiter:(a=!0,s.delimiter=o.DefaultDelimiter),l.meta.delimiter=s.delimiter),le(s));return s.preview&&s.header&&k.preview++,t=N,r=new Z(k),l=r.parse(t,S,P),B(),H?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return H},this.pause=function(){H=!0,r.abort(),t=C(s.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){w.streamer._halted?(H=!1,w.streamer.parseChunk(t,!0)):setTimeout(w.resume,3)},this.aborted=function(){return i},this.abort=function(){i=!0,r.abort(),l.meta.aborted=!0,C(s.complete)&&s.complete(l),t=""},this.guessLineEndings=function(U,k){U=U.substring(0,1048576);var k=new RegExp(se(k)+"([^]*?)"+se(k),"gm"),P=(U=U.replace(k,"")).split("\r"),k=U.split(`
`),U=1<k.length&&k[0].length<P[0].length;if(P.length===1||U)return`
`;for(var K=0,A=0;A<P.length;A++)P[A][0]===`
`&&K++;return K>=P.length/2?`\r
`:"\r"}}function se(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Z(s){var t=(s=s||{}).delimiter,r=s.newline,a=s.comments,c=s.step,j=s.preview,M=s.fastMode,ee=null,X=!1,w=s.quoteChar==null?'"':s.quoteChar,I=w;if(s.escapeChar!==void 0&&(I=s.escapeChar),(typeof t!="string"||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),a===t)throw new Error("Comment character same as delimiter");a===!0?a="#":(typeof a!="string"||-1<o.BAD_DELIMITERS.indexOf(a))&&(a=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var p=0,H=!1;this.parse=function(i,b,l){if(typeof i!="string")throw new Error("Input must be a string");var O=i.length,B=t.length,G=r.length,ie=a.length,N=C(c),S=[],P=[],k=[],U=p=0;if(!i)return J();if(M||M!==!1&&i.indexOf(w)===-1){for(var K=i.split(r),A=0;A<K.length;A++){if(k=K[A],p+=k.length,A!==K.length-1)p+=r.length;else if(l)return J();if(!a||k.substring(0,ie)!==a){if(N){if(S=[],ue(k.split(t)),ce(),H)return J()}else ue(k.split(t));if(j&&j<=A)return S=S.slice(0,j),J(!0)}}return J()}for(var T=i.indexOf(t,p),_=i.indexOf(r,p),ne=new RegExp(se(I)+se(w),"g"),z=i.indexOf(w,p);;)if(i[p]===w)for(z=p,p++;;){if((z=i.indexOf(w,z+1))===-1)return l||P.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:p}),ae();if(z===O-1)return ae(i.substring(p,z).replace(ne,w));if(w===I&&i[z+1]===I)z++;else if(w===I||z===0||i[z-1]!==I){T!==-1&&T<z+1&&(T=i.indexOf(t,z+1));var L=he((_=_!==-1&&_<z+1?i.indexOf(r,z+1):_)===-1?T:Math.min(T,_));if(i.substr(z+1+L,B)===t){k.push(i.substring(p,z).replace(ne,w)),i[p=z+1+L+B]!==w&&(z=i.indexOf(w,p)),T=i.indexOf(t,p),_=i.indexOf(r,p);break}if(L=he(_),i.substring(z+1+L,z+1+L+G)===r){if(k.push(i.substring(p,z).replace(ne,w)),fe(z+1+L+G),T=i.indexOf(t,p),z=i.indexOf(w,p),N&&(ce(),H))return J();if(j&&S.length>=j)return J(!0);break}P.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:p}),z++}}else if(a&&k.length===0&&i.substring(p,p+ie)===a){if(_===-1)return J();p=_+G,_=i.indexOf(r,p),T=i.indexOf(t,p)}else if(T!==-1&&(T<_||_===-1))k.push(i.substring(p,T)),p=T+B,T=i.indexOf(t,p);else{if(_===-1)break;if(k.push(i.substring(p,_)),fe(_+G),N&&(ce(),H))return J();if(j&&S.length>=j)return J(!0)}return ae();function ue(W){S.push(W),U=p}function he(W){var te=0;return te=W!==-1&&(W=i.substring(z+1,W))&&W.trim()===""?W.length:te}function ae(W){return l||(W===void 0&&(W=i.substring(p)),k.push(W),p=O,ue(k),N&&ce()),J()}function fe(W){p=W,ue(k),k=[],_=i.indexOf(r,p)}function J(W){if(s.header&&!b&&S.length&&!X){var te=S[0],de=Object.create(null),Ne=new Set(te);let Re=!1;for(let xe=0;xe<te.length;xe++){let oe=te[xe];if(de[oe=C(s.transformHeader)?s.transformHeader(oe,xe):oe]){let me,Ie=de[oe];for(;me=oe+"_"+Ie,Ie++,Ne.has(me););Ne.add(me),te[xe]=me,de[oe]++,Re=!0,(ee=ee===null?{}:ee)[me]=oe}else de[oe]=1,te[xe]=oe;Ne.add(oe)}Re&&console.warn("Duplicate headers found and renamed."),X=!0}return{data:S,errors:P,meta:{delimiter:t,linebreak:r,aborted:H,truncated:!!W,cursor:U+(b||0),renamedHeaders:ee}}}function ce(){c(J()),S=[],P=[]}},this.abort=function(){H=!0},this.getCharIndex=function(){return p}}function h(s){var t=s.data,r=R[t.workerId],a=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var c={abort:function(){a=!0,E(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:re,resume:re};if(C(r.userStep)){for(var j=0;j<t.results.data.length&&(r.userStep({data:t.results.data[j],errors:t.results.errors,meta:t.results.meta},c),!a);j++);delete t.results}else C(r.userChunk)&&(r.userChunk(t.results,c,t.file),delete t.results)}t.finished&&!a&&E(t.workerId,t.results)}function E(s,t){var r=R[s];C(r.userComplete)&&r.userComplete(t),r.terminate(),delete R[s]}function re(){throw new Error("Not implemented.")}function le(s){if(typeof s!="object"||s===null)return s;var t,r=Array.isArray(s)?[]:{};for(t in s)r[t]=le(s[t]);return r}function V(s,t){return function(){s.apply(t,arguments)}}function C(s){return typeof s=="function"}return o.parse=function(s,t){var r=(t=t||{}).dynamicTyping||!1;if(C(r)&&(t.dynamicTypingFunction=r,r={}),t.dynamicTyping=r,t.transform=!!C(t.transform)&&t.transform,!t.worker||!o.WORKERS_SUPPORTED)return r=null,o.NODE_STREAM_INPUT,typeof s=="string"?(s=(a=>a.charCodeAt(0)!==65279?a:a.slice(1))(s),r=new(t.download?$:u)(t)):s.readable===!0&&C(s.read)&&C(s.on)?r=new Y(t):(d.File&&s instanceof File||s instanceof Object)&&(r=new F(t)),r.stream(s);(r=(()=>{var a;return!!o.WORKERS_SUPPORTED&&(a=(()=>{var c=d.URL||d.webkitURL||null,j=m.toString();return o.BLOB_URL||(o.BLOB_URL=c.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",j,")();"],{type:"text/javascript"})))})(),(a=new d.Worker(a)).onmessage=h,a.id=q++,R[a.id]=a)})()).userStep=t.step,r.userChunk=t.chunk,r.userComplete=t.complete,r.userError=t.error,t.step=C(t.step),t.chunk=C(t.chunk),t.complete=C(t.complete),t.error=C(t.error),delete t.worker,r.postMessage({input:s,config:t,workerId:r.id})},o.unparse=function(s,t){var r=!1,a=!0,c=",",j=`\r
`,M='"',ee=M+M,X=!1,w=null,I=!1,p=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||o.BAD_DELIMITERS.filter(function(b){return t.delimiter.indexOf(b)!==-1}).length||(c=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(r=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(X=t.skipEmptyLines),typeof t.newline=="string"&&(j=t.newline),typeof t.quoteChar=="string"&&(M=t.quoteChar),typeof t.header=="boolean"&&(a=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");w=t.columns}t.escapeChar!==void 0&&(ee=t.escapeChar+M),t.escapeFormulae instanceof RegExp?I=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(I=/^[=+\-@\t\r].*$/)}})(),new RegExp(se(M),"g"));if(typeof s=="string"&&(s=JSON.parse(s)),Array.isArray(s)){if(!s.length||Array.isArray(s[0]))return H(null,s,X);if(typeof s[0]=="object")return H(w||Object.keys(s[0]),s,X)}else if(typeof s=="object")return typeof s.data=="string"&&(s.data=JSON.parse(s.data)),Array.isArray(s.data)&&(s.fields||(s.fields=s.meta&&s.meta.fields||w),s.fields||(s.fields=Array.isArray(s.data[0])?s.fields:typeof s.data[0]=="object"?Object.keys(s.data[0]):[]),Array.isArray(s.data[0])||typeof s.data[0]=="object"||(s.data=[s.data])),H(s.fields||[],s.data||[],X);throw new Error("Unable to serialize unrecognized input");function H(b,l,O){var B="",G=(typeof b=="string"&&(b=JSON.parse(b)),typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(b)&&0<b.length),ie=!Array.isArray(l[0]);if(G&&a){for(var N=0;N<b.length;N++)0<N&&(B+=c),B+=i(b[N],N);0<l.length&&(B+=j)}for(var S=0;S<l.length;S++){var P=(G?b:l[S]).length,k=!1,U=G?Object.keys(l[S]).length===0:l[S].length===0;if(O&&!G&&(k=O==="greedy"?l[S].join("").trim()==="":l[S].length===1&&l[S][0].length===0),O==="greedy"&&G){for(var K=[],A=0;A<P;A++){var T=ie?b[A]:A;K.push(l[S][T])}k=K.join("").trim()===""}if(!k){for(var _=0;_<P;_++){0<_&&!U&&(B+=c);var ne=G&&ie?b[_]:_;B+=i(l[S][ne],_)}S<l.length-1&&(!O||0<P&&!U)&&(B+=j)}}return B}function i(b,l){var O,B;return b==null?"":b.constructor===Date?JSON.stringify(b).slice(1,25):(B=!1,I&&typeof b=="string"&&I.test(b)&&(b="'"+b,B=!0),O=b.toString().replace(p,ee),(B=B||r===!0||typeof r=="function"&&r(b,l)||Array.isArray(r)&&r[l]||((G,ie)=>{for(var N=0;N<ie.length;N++)if(-1<G.indexOf(ie[N]))return!0;return!1})(O,o.BAD_DELIMITERS)||-1<O.indexOf(c)||O.charAt(0)===" "||O.charAt(O.length-1)===" ")?M+O+M:O)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!v&&!!d.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=Z,o.ParserHandle=Q,o.NetworkStreamer=$,o.FileStreamer=F,o.StringStreamer=u,o.ReadableStreamStreamer=Y,d.jQuery&&((D=d.jQuery).fn.parse=function(s){var t=s.config||{},r=[];return this.each(function(j){if(!(D(this).prop("tagName").toUpperCase()==="INPUT"&&D(this).attr("type").toLowerCase()==="file"&&d.FileReader)||!this.files||this.files.length===0)return!0;for(var M=0;M<this.files.length;M++)r.push({file:this.files[M],inputElem:this,instanceConfig:D.extend({},t)})}),a(),this;function a(){if(r.length===0)C(s.complete)&&s.complete();else{var j,M,ee,X,w=r[0];if(C(s.before)){var I=s.before(w.file,w.inputElem);if(typeof I=="object"){if(I.action==="abort")return j="AbortError",M=w.file,ee=w.inputElem,X=I.reason,void(C(s.error)&&s.error({name:j},M,ee,X));if(I.action==="skip")return void c();typeof I.config=="object"&&(w.instanceConfig=D.extend(w.instanceConfig,I.config))}else if(I==="skip")return void c()}var p=w.instanceConfig.complete;w.instanceConfig.complete=function(H){C(p)&&p(H,w.file,w.inputElem),c()},o.parse(w.file,w.instanceConfig)}}function c(){r.splice(0,1),a()}}),x&&(d.onmessage=function(s){s=s.data,o.WORKER_ID===void 0&&s&&(o.WORKER_ID=s.workerId),typeof s.input=="string"?d.postMessage({workerId:o.WORKER_ID,results:o.parse(s.input,s.config),finished:!0}):(d.File&&s.input instanceof File||s.input instanceof Object)&&(s=o.parse(s.input,s.config))&&d.postMessage({workerId:o.WORKER_ID,results:s,finished:!0})}),($.prototype=Object.create(g.prototype)).constructor=$,(F.prototype=Object.create(g.prototype)).constructor=F,(u.prototype=Object.create(u.prototype)).constructor=u,(Y.prototype=Object.create(g.prototype)).constructor=Y,o})})(ge)),ge.exports}var wt=jt();const Nt=Je(wt),Le="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Fe=n=>{if(!n)return new Date().toISOString();const f=n.trim();let m=je(f,"d/M/yy",new Date);if(ze(m))return m.getFullYear()<2e3&&(m=He(m,100),m.getFullYear()<2e3&&m.setFullYear(2e3+parseInt(f.split(/[-/]/)[2]))),m.toISOString();if(m=je(f,"d/M/yyyy",new Date),ze(m))return m.toISOString();const d=new Date(f);return isNaN(d.getTime())?new Date().toISOString():d.toISOString()},_t=n=>{const{ticketConfig:f,setTicketConfig:m}=Te(),{toast:d}=$e(),D=Be(),v=y.useRef(!1);y.useEffect(()=>{if(!f?.autoSync||!Le||!n||n.length===0)return;const x=async()=>{if(v.current)return;const q=new Date,o=q.toISOString().split("T")[0];if(f.lastSync===o)return;const[g,$]=f.syncTime.split(":"),F=new Date;if(F.setHours(parseInt(g),parseInt($),0,0),q>=F){console.log("Adding Auto-Sync to Queue..."),v.current=!0;try{const u=await fetch(Le);if(!u.ok)throw new Error("Failed to fetch CSV");const Y=await u.text();Nt.parse(Y,{header:!0,skipEmptyLines:!0,transformHeader:Q=>Q.trim(),complete:async Q=>{try{const Z=Q.data.map(h=>({ticketNumber:h["Ticket Number"]||h["Ticket No"]||"",shortDesc:h["Short Description & Detail"]||h.Detail||h.Description||"",status:h.Status||"Open",type:h["Ticket Type"]||"Incident",assign:h.Assign||"Unassigned",details:h.Detail||"",action:h.Ation||h.Action||"",resolvedDetail:h["Resolved detail"]||"",remark:h.Remark||"",date:Fe(h.Date),createdAt:Fe(h.Date)})).filter(h=>h.ticketNumber).filter(h=>{const E=n.find(re=>re.ticketNumber===h.ticketNumber);return E?E.status!==h.status||E.shortDesc!==h.shortDesc||E.assign!==h.assign||E.action!==h.action||(E.details||"")!==h.details||(E.remark||"")!==h.remark||(E.type||"Incident")!==h.type||(E.resolvedDetail||"")!==h.resolvedDetail:!0});Z.length>0?(await be.importLogsFromSheet(Z),D.invalidateQueries({queryKey:["ticketLogs"]}),d({title:"Auto Sync Completed",description:`Synced ${Z.length} updates from Sheet.`})):console.log("Auto Sync: No updates found."),m({...f,lastSync:o})}catch(se){console.error("Auto Sync Parse Error:",se)}finally{v.current=!1}},error:Q=>{console.error("Auto Sync CSV Error:",Q),v.current=!1}})}catch(u){console.error("Auto Sync Fetch Error:",u),v.current=!1}}},R=setInterval(x,6e4);return x(),()=>clearInterval(R)},[f,n,D,m,d])},Me="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Pe=n=>{if(!n)return new Date().toISOString();const f=new Date(n);if(!isNaN(f.getTime()))return f.toISOString();const m=String(n).trim();let d=je(m,"d/M/yy",new Date);return ze(d)?(d.getFullYear()<2e3&&(d=He(d,100),d.getFullYear()<2e3&&d.setFullYear(2e3+parseInt(m.split(/[-/]/)[2]))),d.toISOString()):(d=je(m,"d/M/yyyy",new Date),ze(d)?d.toISOString():new Date().toISOString())},ke=y.memo(({label:n,value:f,variant:m})=>{const d={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${d[m]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:f}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:n})]})});ke.displayName="StatBox";const Se=y.memo(({item:n,type:f})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${f==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",n.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:n.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${f==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:f==="new"?"New":"Update"})]}));Se.displayName="PreviewRow";function Ct({isOpen:n,onClose:f,onSyncComplete:m,currentLogs:d}){const{ticketConfig:D,setTicketConfig:v}=Te(),[x,R]=y.useState("preview"),[q,o]=y.useState("input"),[g,$]=y.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[F,u]=y.useState(null),Y=y.useCallback(()=>{o("input"),$({newItems:[],updatedItems:[],uptodateItems:[]}),u(null)},[]),Q=y.useCallback(async()=>{o("analyzing"),u(null);try{const h=await fetch(Me);if(!h.ok)throw new Error("Failed to fetch data from Apps Script ("+h.status+")");const E=await h.json();if(E.status==="error")throw new Error(E.message||"Unknown Script Error");const re=Array.isArray(E)?E:E.data||[];if(re.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const le=re.map(t=>({ticketNumber:t.ticketNo||t.ticketNumber||"",shortDesc:t.subject||t.shortDescription||t.description||"",status:t.status||"Open",type:t.ticketType||t.type||"Incident",assign:t.assignee||t.assign||"Unassigned",details:t.description||t.detail||"",action:t.actionTaken||t.action||"",resolvedDetail:t.resolutionNote||t.resolvedDetail||"",remark:t.remark||"",severity:t.severity||"Low",category:t.category||"",subCategory:t.subCategory||"",date:Pe(t.date||t.ticketDate||t.createdAt),createdAt:Pe(t.date||t.ticketDate||t.createdAt)})).filter(t=>t.ticketNumber),V=[],C=[],s=[];le.forEach(t=>{const r=d.find(a=>a.ticketNumber===t.ticketNumber);r?r.status!==t.status||r.shortDesc!==t.shortDesc||r.assign!==t.assign||r.action!==t.action||(r.details||"")!==t.details||(r.remark||"")!==t.remark||(r.type||"Incident")!==t.type||(r.resolvedDetail||"")!==t.resolvedDetail||(r.category||"")!==t.category||(r.subCategory||"")!==t.subCategory||(r.severity||"Low")!==t.severity?C.push({...t,_prev:r}):s.push(t):V.push(t)}),$({newItems:V,updatedItems:C,uptodateItems:s}),o("review")}catch(h){console.error(h),u("Sync Error: "+h.message),o("input")}},[d]),se=y.useCallback(async()=>{o("saving");try{const E=[...g.newItems,...g.updatedItems].map(({_prev:re,...le})=>le);E.length>0&&await be.importLogsFromSheet(E),m&&m(E.length),setTimeout(()=>{f(),Y()},1500),o("success")}catch(h){u("Database Error: "+h.message),o("review")}},[g.newItems,g.updatedItems,m,f,Y]);if(!n)return null;const Z=g.newItems.length+g.updatedItems.length;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-950 w-full max-w-lg rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(_e,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Sync Manager"}),e.jsxs("div",{className:"flex gap-3 mt-0.5",children:[e.jsx("button",{onClick:()=>R("preview"),className:`text-[9px] font-bold uppercase tracking-wider transition-colors ${x==="preview"?"text-blue-500":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"Manual Sync"}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-700",children:"|"}),e.jsx("button",{onClick:()=>R("schedule"),className:`text-[9px] font-bold uppercase tracking-wider transition-colors ${x==="schedule"?"text-blue-500":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"Auto Schedule"})]})]})]}),e.jsx("button",{onClick:f,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(we,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:[x==="schedule"&&e.jsxs("div",{className:"space-y-5 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(ut,{size:24,className:"text-purple-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Auto-Sync Schedule"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Automatically sync from Google Sheets daily at your preferred time."})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 rounded-xl p-4 border border-zinc-100 dark:border-zinc-800 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"Enable Auto-Sync"}),e.jsx("div",{className:"text-[10px] text-zinc-400",children:"Sync in background"})]}),e.jsx("button",{onClick:()=>v({...D,autoSync:!D.autoSync}),className:`w-10 h-5 rounded-full transition-colors relative ${D.autoSync?"bg-emerald-500":"bg-zinc-300 dark:bg-zinc-700"}`,children:e.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${D.autoSync?"translate-x-5":"translate-x-0"}`})})]}),D.autoSync&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-zinc-200 dark:border-zinc-700 animate-in fade-in slide-in-from-top-1 duration-150",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"Schedule Time"}),e.jsx("div",{className:"text-[10px] text-zinc-400",children:"Daily Execution"})]}),e.jsx("input",{type:"time",value:D.syncTime,onChange:h=>v({...D,syncTime:h.target.value}),className:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-1.5 font-mono text-sm font-bold text-zinc-900 dark:text-white outline-none focus:ring-2 focus:ring-purple-500/50"})]})]})]}),x==="preview"&&e.jsxs(e.Fragment,{children:[q==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(_e,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),F&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(ht,{size:14})," ",F]})]}),q==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(ye,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),q==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(ke,{label:"New",value:g.newItems.length,variant:"new"}),e.jsx(ke,{label:"Updates",value:g.updatedItems.length,variant:"update"}),e.jsx(ke,{label:"Unchanged",value:g.uptodateItems.length,variant:"unchanged"})]}),Z>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:"Preview Changes"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400",children:[Z," pending"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[200px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[g.newItems.map(h=>e.jsx(Se,{item:h,type:"new"},h.ticketNumber)),g.updatedItems.map(h=>e.jsx(Se,{item:h,type:"update"},h.ticketNumber))]})})]}):e.jsxs("div",{className:"py-6 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Ce,{size:28,className:"mx-auto mb-2 text-emerald-500/50"}),e.jsx("h3",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"All Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-0.5",children:"Database matches remote source"})]})]}),q==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Ce,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})]}),x==="preview"&&e.jsxs("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",children:[q==="input"&&e.jsxs("button",{onClick:Q,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(pt,{size:14})]}),q==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Y,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:se,disabled:Z===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(ft,{size:14})," Confirm Sync"]})]}),q==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(ye,{size:14,className:"animate-spin"})," Updating Database..."]})]}),x==="schedule"&&e.jsx("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end bg-zinc-50/50 dark:bg-zinc-900/30",children:e.jsx("button",{onClick:f,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})})]})})}const pe=y.memo(({label:n,required:f,...m})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide flex items-center gap-1",children:[n," ",f&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...m,className:`w-full h-8 px-2.5 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white placeholder:text-zinc-400 outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all disabled:opacity-50 ${m.className||""}`})]}));pe.displayName="CompactInput";const De=y.memo(({label:n,...f})=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:n}),e.jsx("textarea",{...f,className:`w-full px-2.5 py-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white placeholder:text-zinc-400 outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all resize-none ${f.className||""}`})]}));De.displayName="CompactTextarea";const ve=y.memo(({label:n,value:f,onChange:m,options:d,required:D})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide flex items-center gap-1",children:[n," ",D&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:f,onChange:v=>m(v.target.value),className:"w-full h-8 px-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all cursor-pointer",children:[e.jsx("option",{value:"",children:"Select..."}),d.map(v=>e.jsx("option",{value:v,children:v},v))]})]}));ve.displayName="CompactSelect";const Ee=y.memo(({label:n,value:f,onChange:m,options:d,colorMap:D={}})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:n}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.map(v=>{const x=f===v,R=D[v?.toLowerCase()]||"zinc",q={red:"bg-red-500 text-white",orange:"bg-orange-500 text-white",amber:"bg-amber-500 text-white",emerald:"bg-emerald-500 text-white",blue:"bg-blue-500 text-white",purple:"bg-purple-500 text-white",zinc:"bg-zinc-900 dark:bg-white text-white dark:text-zinc-900"}[R];return e.jsx("button",{type:"button",onClick:()=>m(v),className:`px-2.5 py-1 rounded-md text-[10px] font-bold transition-all ${x?q:"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:v},v)})})]}));Ee.displayName="PillPicker";const Ue={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",assign:"",remark:""};function St({isOpen:n,onClose:f,initialData:m,onSubmit:d,isSubmitting:D}){const{ticketOptions:v}=Ke(),[x,R]=y.useState(Ue),q={open:"red",pending:"amber",succeed:"emerald",closed:"zinc"},o={low:"emerald",medium:"blue",high:"orange",critical:"red"};y.useEffect(()=>(n&&(R(m||Ue),document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[m,n]);const g=y.useCallback((u,Y)=>{R(Q=>({...Q,[u]:Y}))},[]),$=y.useCallback(u=>{u.preventDefault(),d(x)},[x,d]);if(!n)return null;const F=!!m;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"w-full max-w-xl bg-white dark:bg-zinc-950 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${F?"bg-amber-500/10":"bg-blue-500/10"}`,children:e.jsx(Xe,{size:14,className:F?"text-amber-500":"text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:F?"Edit Ticket":"New Ticket"}),F&&e.jsxs("p",{className:"text-[9px] text-zinc-400",children:["#",x.ticketNumber]})]})]}),e.jsx("button",{onClick:f,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(we,{size:16})})]}),e.jsxs("form",{id:"ticket-form",onSubmit:$,className:"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(pe,{label:"Ticket Number",required:!0,disabled:F,value:x.ticketNumber,onChange:u=>g("ticketNumber",u.target.value),placeholder:"INC-0001"}),e.jsx(pe,{label:"Assignee",value:x.assign,onChange:u=>g("assign",u.target.value),placeholder:"Person in charge"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(ve,{label:"Type",value:x.type,onChange:u=>g("type",u),options:v.types||[]}),e.jsx(ve,{label:"Category",value:x.category,onChange:u=>g("category",u),options:v.categories||[]}),e.jsx(ve,{label:"Sub Category",value:x.subCategory,onChange:u=>g("subCategory",u),options:v.subCategories||[]})]}),e.jsx(Ee,{label:"Status",value:x.status,onChange:u=>g("status",u),options:v.statuses||[],colorMap:q}),e.jsx(Ee,{label:"Severity",value:x.severity,onChange:u=>g("severity",u),options:v.severities||[],colorMap:o}),e.jsx(pe,{label:"Subject",required:!0,value:x.shortDesc,onChange:u=>g("shortDesc",u.target.value),placeholder:"Brief description of the issue"}),e.jsx(De,{label:"Details",rows:2,value:x.details,onChange:u=>g("details",u.target.value),placeholder:"Detailed description..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(De,{label:"Action Taken",rows:2,value:x.action,onChange:u=>g("action",u.target.value),placeholder:"Steps taken..."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(pe,{label:"Resolution",value:x.resolvedDetail,onChange:u=>g("resolvedDetail",u.target.value),placeholder:"How it was resolved"}),e.jsx(pe,{label:"Remark",value:x.remark,onChange:u=>g("remark",u.target.value),placeholder:"Internal notes"})]})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-zinc-400",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Required"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:f,className:"px-3 py-1.5 text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:D,className:`flex items-center gap-1.5 px-4 py-1.5 rounded-lg text-xs font-bold text-white transition-all active:scale-[0.98] disabled:opacity-50 ${F?"bg-amber-500 hover:bg-amber-600":"bg-blue-500 hover:bg-blue-600"}`,children:D?e.jsx(ye,{size:14,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{size:14}),F?"Update":"Create"]})})]})]})]})})}const Ye=n=>{switch(n?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Ae=n=>{switch(n?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Ze=y.memo(({log:n,onClick:f,onSendToIncident:m,onEdit:d,onDelete:D})=>{const v=n.createdAt?new Date(n.createdAt):null,x=v?v.getDate():"-",R=v?v.toLocaleDateString("en-GB",{month:"short"}):"-",q=y.useCallback($=>{$.stopPropagation(),m(n,$)},[m,n]),o=y.useCallback($=>{$.stopPropagation(),d(n)},[d,n]),g=y.useCallback($=>{$.stopPropagation(),D(n.ticketNumber)},[D,n.ticketNumber]);return e.jsx("div",{onClick:f,className:"group bg-white dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 p-3 hover:border-zinc-300 dark:hover:border-zinc-700 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center w-10 h-10 bg-zinc-50 dark:bg-zinc-800 rounded-lg shrink-0 group-hover:bg-zinc-900 dark:group-hover:bg-white group-hover:text-white dark:group-hover:text-black transition-colors",children:[e.jsx("span",{className:"text-[8px] font-bold uppercase leading-none opacity-60",children:R}),e.jsx("span",{className:"text-sm font-black leading-none",children:x})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[e.jsxs("span",{className:"text-[10px] font-mono font-bold text-blue-500 bg-blue-50 dark:bg-blue-950/30 px-1.5 py-0.5 rounded",children:["#",n.ticketNumber]}),e.jsx("span",{className:`text-[8px] font-bold uppercase px-1.5 py-0.5 rounded border ${Ye(n.status)}`,children:n.status}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-700",children:"•"}),e.jsx("span",{className:"text-[9px] font-medium text-zinc-400",children:n.type})]}),e.jsx("p",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-200 line-clamp-1 leading-snug",children:n.shortDesc||n.details||"No Description"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-zinc-400",children:[e.jsx(ct,{size:10}),e.jsx("span",{className:"text-[9px] font-medium",children:n.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{size:10,className:Ae(n.severity)}),e.jsx("span",{className:`text-[9px] font-medium ${Ae(n.severity)}`,children:n.severity||"Low"})]})]})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-1",children:[e.jsx("button",{onClick:o,className:"p-1.5 rounded-lg text-zinc-300 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-950/30 transition-colors",title:"Edit",children:e.jsx(Ge,{size:14})}),e.jsx("button",{onClick:g,className:"p-1.5 rounded-lg text-zinc-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-950/30 transition-colors",title:"Delete",children:e.jsx(We,{size:14})}),e.jsxs("button",{onClick:q,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-zinc-50 dark:bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-900 dark:hover:bg-white dark:hover:text-black transition-colors active:scale-95",title:"Add to Timeline",children:[e.jsx(Qe,{size:12}),e.jsx("span",{className:"text-[9px] font-bold hidden sm:inline",children:"Incident"})]})]})]})})});Ze.displayName="LogItem";const Ve=y.memo(({log:n,onClose:f,onSendToIncident:m,onEdit:d,onDelete:D})=>{if(!n)return null;const v=n.createdAt?lt(new Date(n.createdAt),"dd MMM yyyy"):"-";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 animate-in fade-in duration-150",onClick:f,children:e.jsxs("div",{className:"w-full max-w-xl bg-white dark:bg-zinc-950 rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[85vh] shadow-xl animate-in zoom-in-95 duration-200",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-xl font-black text-zinc-900 dark:text-white",children:["#",n.ticketNumber]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rt,{size:11})," ",v]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ot,{size:11})," ",n.type]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${Ye(n.status)}`,children:n.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:d,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(Ge,{size:14})}),e.jsx("button",{onClick:D,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(We,{size:14})}),e.jsx("button",{onClick:f,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(we,{size:16})})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${Ae(n.severity)}`,children:n.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:n.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:n.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono",children:n.details||n.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(it,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:n.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Ce,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:n.resolvedDetail||"Pending"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:n.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:n.assign||"Unassigned"})]})]}),e.jsxs("button",{onClick:()=>{m(),f()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(Qe,{size:14})," Add to Timeline"]})]})]})})});Ve.displayName="TicketDetailModal";function Zt(){const{logs:n,loading:f,loadingMore:m,hasMore:d,loadMore:D,stats:v}=nt(),{toast:x}=$e(),{currentUser:R}=Te(),{ticketOptions:q}=Ke(),o=et(),g=Be(),[$,F]=y.useState(!1),[u,Y]=y.useState(""),[Q,se]=y.useState("All"),[Z,h]=y.useState("All"),[E,re]=y.useState(null),[le,V]=y.useState(!1),[C,s]=y.useState(null),[t,r]=y.useState(!1),[a,c]=y.useState(null);_t(n);const j=y.useCallback(()=>{s(null),V(!0)},[]),M=y.useCallback(i=>{s(i),V(!0)},[]),ee=y.useCallback(async i=>{r(!0);try{C?(await be.updateLog(C.ticketNumber,i),x({title:"Updated",description:"Ticket updated successfully."})):(await be.createLog(i),x({title:"Created",description:"New ticket created."})),g.invalidateQueries(["ticketLogs"]),V(!1),s(null),re(null)}catch(b){console.error(b),x({variant:"destructive",title:"Error",description:b.message})}finally{r(!1)}},[C,g,x]),X=y.useCallback(i=>{c(i)},[]),w=y.useCallback(async()=>{if(a)try{await be.deleteLog(a),x({title:"Deleted",description:"Ticket deleted."}),g.invalidateQueries(["ticketLogs"]),re(null)}catch(i){x({variant:"destructive",title:"Error",description:i.message})}finally{c(null)}},[a,g,x]),I=y.useCallback(async(i,b)=>{if(b&&b.stopPropagation(),!R){x({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const l=typeof R=="object"&&R!==null?{name:R.name,id:R.id,role:R.role}:{name:R},O={subject:i.shortDesc||i.details||"New Incident from Log",ticket:i.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(i.type)?i.type:"Incident",status:"Open",createdBy:l,impact:"",root_cause:i.details||"",action:i.action||""};await at.createIncident(O),x({title:"Successfully Added",description:`Ticket #${i.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>o("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(l){console.error(l),x({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[R,o,x]),p=y.useMemo(()=>n.filter(i=>{const b=i.ticketNumber?.toLowerCase().includes(u.toLowerCase())||i.shortDesc?.toLowerCase().includes(u.toLowerCase())||i.details&&i.details.toLowerCase().includes(u.toLowerCase()),l=Q==="All"||i.status===Q,O=Z==="All"||i.type===Z;return b&&l&&O}).sort((i,b)=>new Date(b.createdAt||0)-new Date(i.createdAt||0)),[n,u,Q,Z]),H=y.useCallback(i=>{re(i)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-zinc-950 transition-colors",children:[e.jsx("div",{className:"shrink-0 py-4 px-5 bg-white dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[8px] font-bold rounded",children:"SYSTEM"}),e.jsxs("span",{className:"text-[10px] font-bold text-blue-500",children:[v.total," Records"]})]}),e.jsx("h1",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Ticket Log"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-lg text-[10px] font-bold bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(bt,{size:12})," New"]}),e.jsxs("button",{onClick:()=>F(!0),disabled:f,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-lg text-[10px] font-bold bg-emerald-500 text-white hover:bg-emerald-600 active:scale-95 transition-all",children:[e.jsx(_e,{size:12})," Sync"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(xt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:u,onChange:i=>Y(i.target.value),className:"w-full h-9 pl-9 pr-9 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500/30 transition-all"}),u&&e.jsx("button",{onClick:()=>Y(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:e.jsx(we,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-50 dark:bg-zinc-800 px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[e.jsx(dt,{size:12,className:"text-zinc-400"}),e.jsxs("select",{value:Q,onChange:i=>se(i.target.value),className:"bg-transparent text-xs font-medium outline-none cursor-pointer text-zinc-600 dark:text-zinc-300",children:[e.jsx("option",{value:"All",children:"All Status"}),q.statuses.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsx("div",{className:"w-px h-4 bg-zinc-200 dark:bg-zinc-600"}),e.jsxs("select",{value:Z,onChange:i=>h(i.target.value),className:"bg-transparent text-xs font-medium outline-none cursor-pointer text-zinc-600 dark:text-zinc-300",children:[e.jsx("option",{value:"All",children:"All Types"}),q.types.map(i=>e.jsx("option",{value:i,children:i},i))]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:f?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-3 border-zinc-200 dark:border-zinc-700 border-t-zinc-900 dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(gt,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{Y(""),se("All"),h("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs("div",{className:"space-y-2",children:[p.map(i=>e.jsx(Ze,{log:i,onClick:()=>H(i),onSendToIncident:I,onEdit:M,onDelete:X},i.id)),d&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:D,disabled:m,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:m?e.jsx(ye,{className:"animate-spin",size:16}):e.jsx(vt,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),E&&e.jsx(Ve,{log:E,onClose:()=>re(null),onSendToIncident:()=>I(E),onEdit:()=>M(E),onDelete:()=>X(E.ticketNumber)}),e.jsx(St,{isOpen:le,onClose:()=>V(!1),initialData:C,onSubmit:ee,isSubmitting:t}),e.jsx(tt,{isOpen:!!a,onClose:()=>c(null),onConfirm:w,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${a}? This action cannot be undone.`,isDanger:!0}),e.jsx(Ct,{isOpen:$,onClose:()=>F(!1),currentLogs:n,onSyncComplete:i=>{x({title:"Sync Completed",description:`Updated ${i} records.`}),g.invalidateQueries({queryKey:["ticketLogs"]}),F(!1)}})]})}export{Zt as default};
