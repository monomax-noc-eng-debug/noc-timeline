import{e as _e,a3 as nt,a as Ve,a4 as Ze,r as j,j as e,F as Ce,C as it,L as Ne,R as Fe,X as ve,U as De,k as de,t as ct,T as Je,b as ot,O as lt,u as dt,p as ut,Q as Ue,A as ht,s as xt}from"./index-Q34mk0jU.js";import{t as ye,u as Ye,a as pt}from"./useTicketOptions-CSprutIN.js";import{u as mt}from"./useConfigs-C4F_9C_K.js";import{c as ft}from"./configService-DFdTgGxv.js";import{p as Ee}from"./parse-RAkaUwzF.js";import{i as Te,f as pe}from"./format-_IVVRDDj.js";import{i as bt}from"./incidentService-DXlXT8ar.js";import{C as Ae}from"./cloud-download-CcDfvnHD.js";import{C as Re,a as gt}from"./addYears-PKoCkgVc.js";import{A as kt}from"./arrow-right-DK_OLL0C.js";import{D as yt}from"./database-20xyokDw.js";import{u as vt}from"./useTeam-Cxgknaue.js";import{T as zt}from"./tag-BTX2i75d.js";import{P as jt}from"./panels-top-left-C6E6n-xb.js";import{S as wt}from"./save-BI_4ovMQ.js";import{Z as Xe}from"./zap-dCety7eh.js";import{T as et,P as Nt}from"./trash-2-CwNPF3Bm.js";import{S as _t}from"./search-ygDQTCIz.js";import{S as Pe}from"./sliders-horizontal-sQAoXSj-.js";import{G as Ct}from"./globe-C1RvpexM.js";import"./useBaseQuery-DdGex9By.js";const St=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],Dt=_e("circle-arrow-down",St);const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qe=_e("info",Et);const Tt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],At=_e("shield-alert",Tt);const Rt=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Oe=_e("square-pen",Rt);var ze={exports:{}};var Lt=ze.exports,Be;function Ot(){return Be||(Be=1,(function(s,d){((b,c)=>{s.exports=c()})(Lt,function b(){var c=typeof self<"u"?self:typeof window<"u"?window:c!==void 0?c:{},y,w=!c.document&&!!c.postMessage,x=c.IS_PAPA_WORKER||!1,v={},W=0,i={};function A(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(r){var a=ee(r);a.chunkSize=parseInt(a.chunkSize),r.step||r.chunk||(a.chunkSize=null),this._handle=new Q(a),(this._handle.streamer=this)._config=a}).call(this,t),this.parseChunk=function(r,a){var l=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<l){let g=this._config.newline;g||(o=this._config.quoteChar||'"',g=this._handle.guessLineEndings(r,o)),r=[...r.split(g).slice(l)].join(g)}this.isFirstChunk&&n(this._config.beforeFirstChunk)&&(o=this._config.beforeFirstChunk(r))!==void 0&&(r=o),this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+r,o=(this._partialLine="",this._handle.parse(l,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(r=o.meta.cursor,l=(this._finished||(this._partialLine=l.substring(r-this._baseIndex),this._baseIndex=r),o&&o.data&&(this._rowCount+=o.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),x)c.postMessage({results:o,workerId:i.WORKER_ID,finished:l});else if(n(this._config.chunk)&&!a){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!l||!n(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(r){n(this._config.error)?this._config.error(r):x&&this._config.error&&c.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function M(t){var r;(t=t||{}).chunkSize||(t.chunkSize=i.RemoteChunkSize),A.call(this,t),this._nextChunk=w?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),w||(r.onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!w),this._config.downloadRequestHeaders){var a,l=this._config.downloadRequestHeaders;for(a in l)r.setRequestHeader(a,l[a])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,r.setRequestHeader("Range","bytes="+this._start+"-"+o));try{r.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}w&&r.status===0&&this._chunkError()}},this._chunkLoaded=function(){r.readyState===4&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize||r.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(r),this.parseChunk(r.responseText)))},this._chunkError=function(a){a=r.statusText||a,this._sendError(new Error(a))}}function m(t){(t=t||{}).chunkSize||(t.chunkSize=i.LocalChunkSize),A.call(this,t);var r,a,l=typeof FileReader<"u";this.stream=function(o){this._input=o,a=o.slice||o.webkitSlice||o.mozSlice,l?((r=new FileReader).onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)):r=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var o=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),o=a.call(o,this._start,g)),r.readAsText(o,this._config.encoding));l||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(o){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(o.target.result)},this._chunkError=function(){this._sendError(r.error)}}function Z(t){var r;A.call(this,t=t||{}),this.stream=function(a){return r=a,this._nextChunk()},this._nextChunk=function(){var a,l;if(!this._finished)return a=this._config.chunkSize,r=a?(l=r.substring(0,a),r.substring(a)):(l=r,""),this._finished=!r,this.parseChunk(l)}}function T(t){A.call(this,t=t||{});var r=[],a=!0,l=!1;this.pause=function(){A.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){A.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(o){this._input=o,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&r.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):a=!0},this._streamData=X(function(o){try{r.push(typeof o=="string"?o:o.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(g){this._streamError(g)}},this),this._streamError=X(function(o){this._streamCleanUp(),this._sendError(o)},this),this._streamEnd=X(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Q(t){var r,a,l,o,g=Math.pow(2,53),F=-g,se=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,J=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,_=this,L=0,p=0,G=!1,z=!1,C=[],u={data:[],errors:[],meta:{}};function q(f){return t.skipEmptyLines==="greedy"?f.join("").trim()==="":f.length===1&&f[0].length===0}function B(){if(u&&l&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),l=!1),t.skipEmptyLines&&(u.data=u.data.filter(function(k){return!q(k)})),H()){let k=function($,V){n(t.transformHeader)&&($=t.transformHeader($,V)),C.push($)};if(u)if(Array.isArray(u.data[0])){for(var f=0;H()&&f<u.data.length;f++)u.data[f].forEach(k);u.data.splice(0,1)}else u.data.forEach(k)}function S(k,$){for(var V=t.header?{}:[],R=0;R<k.length;R++){var I=R,E=k[R],E=((ie,N)=>(U=>(t.dynamicTypingFunction&&t.dynamicTyping[U]===void 0&&(t.dynamicTyping[U]=t.dynamicTypingFunction(U)),(t.dynamicTyping[U]||t.dynamicTyping)===!0))(ie)?N==="true"||N==="TRUE"||N!=="false"&&N!=="FALSE"&&((U=>{if(se.test(U)&&(U=parseFloat(U),F<U&&U<g))return 1})(N)?parseFloat(N):J.test(N)?new Date(N):N===""?null:N):N)(I=t.header?R>=C.length?"__parsed_extra":C[R]:I,E=t.transform?t.transform(E,I):E);I==="__parsed_extra"?(V[I]=V[I]||[],V[I].push(E)):V[I]=E}return t.header&&(R>C.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+R,p+$):R<C.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+R,p+$)),V}var O;u&&(t.header||t.dynamicTyping||t.transform)&&(O=1,!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(S),O=u.data.length):u.data=S(u.data,0),t.header&&u.meta&&(u.meta.fields=C),p+=O)}function H(){return t.header&&C.length===0}function h(f,S,O,k){f={type:f,code:S,message:O},k!==void 0&&(f.row=k),u.errors.push(f)}n(t.step)&&(o=t.step,t.step=function(f){u=f,H()?B():(B(),u.data.length!==0&&(L+=f.data.length,t.preview&&L>t.preview?a.abort():(u.data=u.data[0],o(u,_))))}),this.parse=function(f,S,O){var k=t.quoteChar||'"',k=(t.newline||(t.newline=this.guessLineEndings(f,k)),l=!1,t.delimiter?n(t.delimiter)&&(t.delimiter=t.delimiter(f),u.meta.delimiter=t.delimiter):((k=(($,V,R,I,E)=>{var ie,N,U,he;E=E||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var me=0;me<E.length;me++){for(var ce,be=E[me],te=0,oe=0,Y=0,ae=(U=void 0,new re({comments:I,delimiter:be,newline:V,preview:10}).parse($)),ue=0;ue<ae.data.length;ue++)R&&q(ae.data[ue])?Y++:(ce=ae.data[ue].length,oe+=ce,U===void 0?U=ce:0<ce&&(te+=Math.abs(ce-U),U=ce));0<ae.data.length&&(oe/=ae.data.length-Y),(N===void 0||te<=N)&&(he===void 0||he<oe)&&1.99<oe&&(N=te,ie=be,he=oe)}return{successful:!!(t.delimiter=ie),bestDelimiter:ie}})(f,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=k.bestDelimiter:(l=!0,t.delimiter=i.DefaultDelimiter),u.meta.delimiter=t.delimiter),ee(t));return t.preview&&t.header&&k.preview++,r=f,a=new re(k),u=a.parse(r,S,O),B(),G?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return G},this.pause=function(){G=!0,a.abort(),r=n(t.chunk)?"":r.substring(a.getCharIndex())},this.resume=function(){_.streamer._halted?(G=!1,_.streamer.parseChunk(r,!0)):setTimeout(_.resume,3)},this.aborted=function(){return z},this.abort=function(){z=!0,a.abort(),u.meta.aborted=!0,n(t.complete)&&t.complete(u),r=""},this.guessLineEndings=function($,k){$=$.substring(0,1048576);var k=new RegExp(K(k)+"([^]*?)"+K(k),"gm"),O=($=$.replace(k,"")).split("\r"),k=$.split(`
`),$=1<k.length&&k[0].length<O[0].length;if(O.length===1||$)return`
`;for(var V=0,R=0;R<O.length;R++)O[R][0]===`
`&&V++;return V>=O.length/2?`\r
`:"\r"}}function K(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function re(t){var r=(t=t||{}).delimiter,a=t.newline,l=t.comments,o=t.step,g=t.preview,F=t.fastMode,se=null,J=!1,_=t.quoteChar==null?'"':t.quoteChar,L=_;if(t.escapeChar!==void 0&&(L=t.escapeChar),(typeof r!="string"||-1<i.BAD_DELIMITERS.indexOf(r))&&(r=","),l===r)throw new Error("Comment character same as delimiter");l===!0?l="#":(typeof l!="string"||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var p=0,G=!1;this.parse=function(z,C,u){if(typeof z!="string")throw new Error("Input must be a string");var q=z.length,B=r.length,H=a.length,h=l.length,f=n(o),S=[],O=[],k=[],$=p=0;if(!z)return te();if(F||F!==!1&&z.indexOf(_)===-1){for(var V=z.split(a),R=0;R<V.length;R++){if(k=V[R],p+=k.length,R!==V.length-1)p+=a.length;else if(u)return te();if(!l||k.substring(0,h)!==l){if(f){if(S=[],he(k.split(r)),oe(),G)return te()}else he(k.split(r));if(g&&g<=R)return S=S.slice(0,g),te(!0)}}return te()}for(var I=z.indexOf(r,p),E=z.indexOf(a,p),ie=new RegExp(K(L)+K(_),"g"),N=z.indexOf(_,p);;)if(z[p]===_)for(N=p,p++;;){if((N=z.indexOf(_,N+1))===-1)return u||O.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:p}),ce();if(N===q-1)return ce(z.substring(p,N).replace(ie,_));if(_===L&&z[N+1]===L)N++;else if(_===L||N===0||z[N-1]!==L){I!==-1&&I<N+1&&(I=z.indexOf(r,N+1));var U=me((E=E!==-1&&E<N+1?z.indexOf(a,N+1):E)===-1?I:Math.min(I,E));if(z.substr(N+1+U,B)===r){k.push(z.substring(p,N).replace(ie,_)),z[p=N+1+U+B]!==_&&(N=z.indexOf(_,p)),I=z.indexOf(r,p),E=z.indexOf(a,p);break}if(U=me(E),z.substring(N+1+U,N+1+U+H)===a){if(k.push(z.substring(p,N).replace(ie,_)),be(N+1+U+H),I=z.indexOf(r,p),N=z.indexOf(_,p),f&&(oe(),G))return te();if(g&&S.length>=g)return te(!0);break}O.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:p}),N++}}else if(l&&k.length===0&&z.substring(p,p+h)===l){if(E===-1)return te();p=E+H,E=z.indexOf(a,p),I=z.indexOf(r,p)}else if(I!==-1&&(I<E||E===-1))k.push(z.substring(p,I)),p=I+B,I=z.indexOf(r,p);else{if(E===-1)break;if(k.push(z.substring(p,E)),be(E+H),f&&(oe(),G))return te();if(g&&S.length>=g)return te(!0)}return ce();function he(Y){S.push(Y),$=p}function me(Y){var ae=0;return ae=Y!==-1&&(Y=z.substring(N+1,Y))&&Y.trim()===""?Y.length:ae}function ce(Y){return u||(Y===void 0&&(Y=z.substring(p)),k.push(Y),p=q,he(k),f&&oe()),te()}function be(Y){p=Y,he(k),k=[],E=z.indexOf(a,p)}function te(Y){if(t.header&&!C&&S.length&&!J){var ae=S[0],ue=Object.create(null),Se=new Set(ae);let Ie=!1;for(let fe=0;fe<ae.length;fe++){let le=ae[fe];if(ue[le=n(t.transformHeader)?t.transformHeader(le,fe):le]){let ge,Me=ue[le];for(;ge=le+"_"+Me,Me++,Se.has(ge););Se.add(ge),ae[fe]=ge,ue[le]++,Ie=!0,(se=se===null?{}:se)[ge]=le}else ue[le]=1,ae[fe]=le;Se.add(le)}Ie&&console.warn("Duplicate headers found and renamed."),J=!0}return{data:S,errors:O,meta:{delimiter:r,linebreak:a,aborted:G,truncated:!!Y,cursor:$+(C||0),renamedHeaders:se}}}function oe(){o(te()),S=[],O=[]}},this.abort=function(){G=!0},this.getCharIndex=function(){return p}}function ne(t){var r=t.data,a=v[r.workerId],l=!1;if(r.error)a.userError(r.error,r.file);else if(r.results&&r.results.data){var o={abort:function(){l=!0,D(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:P,resume:P};if(n(a.userStep)){for(var g=0;g<r.results.data.length&&(a.userStep({data:r.results.data[g],errors:r.results.errors,meta:r.results.meta},o),!l);g++);delete r.results}else n(a.userChunk)&&(a.userChunk(r.results,o,r.file),delete r.results)}r.finished&&!l&&D(r.workerId,r.results)}function D(t,r){var a=v[t];n(a.userComplete)&&a.userComplete(r),a.terminate(),delete v[t]}function P(){throw new Error("Not implemented.")}function ee(t){if(typeof t!="object"||t===null)return t;var r,a=Array.isArray(t)?[]:{};for(r in t)a[r]=ee(t[r]);return a}function X(t,r){return function(){t.apply(r,arguments)}}function n(t){return typeof t=="function"}return i.parse=function(t,r){var a=(r=r||{}).dynamicTyping||!1;if(n(a)&&(r.dynamicTypingFunction=a,a={}),r.dynamicTyping=a,r.transform=!!n(r.transform)&&r.transform,!r.worker||!i.WORKERS_SUPPORTED)return a=null,i.NODE_STREAM_INPUT,typeof t=="string"?(t=(l=>l.charCodeAt(0)!==65279?l:l.slice(1))(t),a=new(r.download?M:Z)(r)):t.readable===!0&&n(t.read)&&n(t.on)?a=new T(r):(c.File&&t instanceof File||t instanceof Object)&&(a=new m(r)),a.stream(t);(a=(()=>{var l;return!!i.WORKERS_SUPPORTED&&(l=(()=>{var o=c.URL||c.webkitURL||null,g=b.toString();return i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(l=new c.Worker(l)).onmessage=ne,l.id=W++,v[l.id]=l)})()).userStep=r.step,a.userChunk=r.chunk,a.userComplete=r.complete,a.userError=r.error,r.step=n(r.step),r.chunk=n(r.chunk),r.complete=n(r.complete),r.error=n(r.error),delete r.worker,a.postMessage({input:t,config:r,workerId:a.id})},i.unparse=function(t,r){var a=!1,l=!0,o=",",g=`\r
`,F='"',se=F+F,J=!1,_=null,L=!1,p=((()=>{if(typeof r=="object"){if(typeof r.delimiter!="string"||i.BAD_DELIMITERS.filter(function(C){return r.delimiter.indexOf(C)!==-1}).length||(o=r.delimiter),typeof r.quotes!="boolean"&&typeof r.quotes!="function"&&!Array.isArray(r.quotes)||(a=r.quotes),typeof r.skipEmptyLines!="boolean"&&typeof r.skipEmptyLines!="string"||(J=r.skipEmptyLines),typeof r.newline=="string"&&(g=r.newline),typeof r.quoteChar=="string"&&(F=r.quoteChar),typeof r.header=="boolean"&&(l=r.header),Array.isArray(r.columns)){if(r.columns.length===0)throw new Error("Option columns is empty");_=r.columns}r.escapeChar!==void 0&&(se=r.escapeChar+F),r.escapeFormulae instanceof RegExp?L=r.escapeFormulae:typeof r.escapeFormulae=="boolean"&&r.escapeFormulae&&(L=/^[=+\-@\t\r].*$/)}})(),new RegExp(K(F),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return G(null,t,J);if(typeof t[0]=="object")return G(_||Object.keys(t[0]),t,J)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||_),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),G(t.fields||[],t.data||[],J);throw new Error("Unable to serialize unrecognized input");function G(C,u,q){var B="",H=(typeof C=="string"&&(C=JSON.parse(C)),typeof u=="string"&&(u=JSON.parse(u)),Array.isArray(C)&&0<C.length),h=!Array.isArray(u[0]);if(H&&l){for(var f=0;f<C.length;f++)0<f&&(B+=o),B+=z(C[f],f);0<u.length&&(B+=g)}for(var S=0;S<u.length;S++){var O=(H?C:u[S]).length,k=!1,$=H?Object.keys(u[S]).length===0:u[S].length===0;if(q&&!H&&(k=q==="greedy"?u[S].join("").trim()==="":u[S].length===1&&u[S][0].length===0),q==="greedy"&&H){for(var V=[],R=0;R<O;R++){var I=h?C[R]:R;V.push(u[S][I])}k=V.join("").trim()===""}if(!k){for(var E=0;E<O;E++){0<E&&!$&&(B+=o);var ie=H&&h?C[E]:E;B+=z(u[S][ie],E)}S<u.length-1&&(!q||0<O&&!$)&&(B+=g)}}return B}function z(C,u){var q,B;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(B=!1,L&&typeof C=="string"&&L.test(C)&&(C="'"+C,B=!0),q=C.toString().replace(p,se),(B=B||a===!0||typeof a=="function"&&a(C,u)||Array.isArray(a)&&a[u]||((H,h)=>{for(var f=0;f<h.length;f++)if(-1<H.indexOf(h[f]))return!0;return!1})(q,i.BAD_DELIMITERS)||-1<q.indexOf(o)||q.charAt(0)===" "||q.charAt(q.length-1)===" ")?F+q+F:q)}},i.RECORD_SEP="",i.UNIT_SEP="",i.BYTE_ORDER_MARK="\uFEFF",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!w&&!!c.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=re,i.ParserHandle=Q,i.NetworkStreamer=M,i.FileStreamer=m,i.StringStreamer=Z,i.ReadableStreamStreamer=T,c.jQuery&&((y=c.jQuery).fn.parse=function(t){var r=t.config||{},a=[];return this.each(function(g){if(!(y(this).prop("tagName").toUpperCase()==="INPUT"&&y(this).attr("type").toLowerCase()==="file"&&c.FileReader)||!this.files||this.files.length===0)return!0;for(var F=0;F<this.files.length;F++)a.push({file:this.files[F],inputElem:this,instanceConfig:y.extend({},r)})}),l(),this;function l(){if(a.length===0)n(t.complete)&&t.complete();else{var g,F,se,J,_=a[0];if(n(t.before)){var L=t.before(_.file,_.inputElem);if(typeof L=="object"){if(L.action==="abort")return g="AbortError",F=_.file,se=_.inputElem,J=L.reason,void(n(t.error)&&t.error({name:g},F,se,J));if(L.action==="skip")return void o();typeof L.config=="object"&&(_.instanceConfig=y.extend(_.instanceConfig,L.config))}else if(L==="skip")return void o()}var p=_.instanceConfig.complete;_.instanceConfig.complete=function(G){n(p)&&p(G,_.file,_.inputElem),o()},i.parse(_.file,_.instanceConfig)}}function o(){a.splice(0,1),l()}}),x&&(c.onmessage=function(t){t=t.data,i.WORKER_ID===void 0&&t&&(i.WORKER_ID=t.workerId),typeof t.input=="string"?c.postMessage({workerId:i.WORKER_ID,results:i.parse(t.input,t.config),finished:!0}):(c.File&&t.input instanceof File||t.input instanceof Object)&&(t=i.parse(t.input,t.config))&&c.postMessage({workerId:i.WORKER_ID,results:t,finished:!0})}),(M.prototype=Object.create(A.prototype)).constructor=M,(m.prototype=Object.create(A.prototype)).constructor=m,(Z.prototype=Object.create(Z.prototype)).constructor=Z,(T.prototype=Object.create(A.prototype)).constructor=T,i})})(ze)),ze.exports}var It=Ot();const Mt=nt(It),$e="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Ft=["d/M/yyyy","yyyy-MM-dd","dd/MM/yy","dd/MM/yyyy"],Ut=s=>{if(!s||typeof s!="string")return null;const d=s.trim();if(d==="")return null;const b=new Date;for(const c of Ft){const y=Ee(d,c,b);if(Te(y))return y.toISOString()}return console.warn(`[parseDate] Failed to parse date: "${s}" - no matching format found`),null},Pt=s=>{const{configs:d,loading:b}=mt(),c=d.ticketSync,{toast:y}=Ve(),w=Ze(),x=j.useRef(!1);j.useEffect(()=>{if(b||!c?.autoSync||!$e||!s||s.length===0)return;const v=async()=>{if(x.current)return;const i=new Date,A=i.toISOString().split("T")[0];if(c.lastSync===A)return;const[M,m]=(c.syncTime||"08:00").split(":"),Z=new Date;if(Z.setHours(parseInt(M),parseInt(m),0,0),i>=Z){x.current=!0;try{const T=await fetch($e);if(!T.ok)throw new Error("Failed to fetch CSV");const Q=await T.text();Mt.parse(Q,{header:!0,skipEmptyLines:!0,transformHeader:K=>K.trim(),complete:async K=>{try{const ne=K.data.map(D=>{const ee=Ut(D.Date)||new Date().toISOString();return{ticketNumber:D["Ticket Number"]||D["Ticket No"]||"",shortDesc:D["Short Description & Detail"]||D.Detail||D.Description||"",status:D.Status||"Open",type:D["Ticket Type"]||"Incident",assign:D.Assign||"Unassigned",details:D.Detail||"",action:D.Ation||D.Action||"",resolvedDetail:D["Resolved detail"]||"",remark:D.Remark||"",date:ee,createdAt:ee}}).filter(D=>D.ticketNumber).filter(D=>{const P=s.find(ee=>ee.ticketNumber===D.ticketNumber);return P?P.status!==D.status||P.shortDesc!==D.shortDesc||P.assign!==D.assign||P.action!==D.action||(P.details||"")!==D.details||(P.remark||"")!==D.remark||(P.type||"Incident")!==D.type||(P.resolvedDetail||"")!==D.resolvedDetail:!0});ne.length>0&&(await ye.importLogsFromSheet(ne),w.invalidateQueries({queryKey:["ticketLogs"]}),y({title:"Auto Sync Completed",description:`Synced ${ne.length} updates from Sheet.`})),await ft.updateConfigs({...d,ticketSync:{...c,lastSync:A}})}catch(re){console.error("Auto Sync Parse Error:",re)}finally{x.current=!1}},error:K=>{console.error("Auto Sync CSV Error:",K),x.current=!1}})}catch(T){console.error("Auto Sync Fetch Error:",T),x.current=!1}}},W=setInterval(v,6e4);return v(),()=>clearInterval(W)},[c,s,w,d,b,y])},Ke="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",We=s=>{if(!s)return new Date().toISOString();const d=new Date(s);if(!isNaN(d.getTime()))return d.toISOString();const b=String(s).trim();let c=Ee(b,"d/M/yy",new Date);return Te(c)?(c.getFullYear()<2e3&&(c=gt(c,100),c.getFullYear()<2e3&&c.setFullYear(2e3+parseInt(b.split(/[-/]/)[2]))),c.toISOString()):(c=Ee(b,"d/M/yyyy",new Date),Te(c)?c.toISOString():new Date().toISOString())},je=j.memo(({label:s,value:d,variant:b})=>{const c={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${c[b]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:d}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:s})]})});je.displayName="StatBox";const Le=j.memo(({item:s,type:d})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${d==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",s.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:s.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${d==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:d==="new"?"New":"Update"})]}));Le.displayName="PreviewRow";function qt({isOpen:s,onClose:d,onSyncComplete:b,currentLogs:c}){const[y,w]=j.useState("input"),[x,v]=j.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[W,i]=j.useState(null),A=j.useCallback(()=>{w("input"),v({newItems:[],updatedItems:[],uptodateItems:[]}),i(null)},[]),M=j.useCallback(async()=>{w("analyzing"),i(null);try{const T=await fetch(Ke);if(!T.ok)throw new Error("Failed to fetch data from Apps Script ("+T.status+")");const Q=await T.json();if(Q.status==="error")throw new Error(Q.message||"Unknown Script Error");const K=Array.isArray(Q)?Q:Q.data||[];if(K.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const re=K.map(n=>({ticketNumber:n.ticketNo||n.ticketNumber||"",shortDesc:n.subject||n.shortDescription||n.description||"",status:n.status||"Open",type:n.ticketType||n.type||"Incident",assign:n.assignee||n.assign||"Unassigned",details:n.description||n.detail||"",action:n.actionTaken||n.action||"",resolvedDetail:n.resolutionNote||n.resolvedDetail||"",remark:n.remark||"",severity:n.severity||"Low",category:n.category||"",subCategory:n.subCategory||"",date:We(n.date||n.ticketDate||n.createdAt),createdAt:We(n.date||n.ticketDate||n.createdAt)})).filter(n=>n.ticketNumber),ne=Array.from(re.reduce((n,t)=>{const r=String(t.ticketNumber).trim();return n.set(r,{...t,ticketNumber:r}),n},new Map).values()),D=[],P=[],ee=[];ne.forEach(n=>{const t=c.find(r=>String(r.ticketNumber).trim()===n.ticketNumber);t?t.status!==n.status||t.shortDesc!==n.shortDesc||t.assign!==n.assign||t.action!==n.action||(t.details||"")!==n.details||(t.remark||"")!==n.remark||(t.type||"Incident")!==n.type||(t.resolvedDetail||"")!==n.resolvedDetail||(t.category||"")!==n.category||(t.subCategory||"")!==n.subCategory||(t.severity||"Low")!==n.severity?P.push({...n,_prev:t}):ee.push(n):D.push(n)});const X=(n,t)=>new Date(t.createdAt||0)-new Date(n.createdAt||0);v({newItems:D.sort(X),updatedItems:P.sort(X),uptodateItems:ee.sort(X)}),w("review")}catch(T){console.error(T),i("Sync Error: "+T.message),w("input")}},[c]),m=j.useCallback(async()=>{w("saving");try{const Q=[...x.newItems,...x.updatedItems].map(({_prev:K,...re})=>re);Q.length>0&&await ye.importLogsFromSheet(Q),b&&b(Q.length),setTimeout(()=>{d(),A()},1500),w("success")}catch(T){i("Database Error: "+T.message),w("review")}},[x.newItems,x.updatedItems,b,d,A]);if(!s)return null;const Z=x.newItems.length+x.updatedItems.length;return e.jsx(Ce,{isOpen:s,onClose:d,size:"md",showCloseButton:!1,headerClassName:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Ae,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Live Sync Manager"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"External Database Connector"})]})]}),e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(ve,{size:18})})]}),bodyClassName:"flex-1 overflow-y-auto custom-scrollbar p-5",footerClassName:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",footer:e.jsxs(e.Fragment,{children:[y==="input"&&e.jsxs("button",{onClick:M,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(kt,{size:14})]}),y==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:m,disabled:Z===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(yt,{size:14})," Confirm Sync"]})]}),y==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(Ne,{size:14,className:"animate-spin"})," Updating Database..."]}),y==="success"&&e.jsx("button",{onClick:d,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})]}),children:e.jsxs(e.Fragment,{children:[y==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(Ae,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),W&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(it,{size:14})," ",W]})]}),y==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(Ne,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),y==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(je,{label:"New",value:x.newItems.length,variant:"new"}),e.jsx(je,{label:"Updates",value:x.updatedItems.length,variant:"update"}),e.jsx(je,{label:"Unchanged",value:x.uptodateItems.length,variant:"unchanged"})]}),Z>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest",children:"Pending Sync Records"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[Z," items to process"]})]}),e.jsxs("button",{onClick:M,disabled:y==="analyzing",className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95",title:"Re-fetch latest data",children:[e.jsx(Fe,{size:12,className:y==="analyzing"?"animate-spin":""})," Refresh"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-[1.5rem] overflow-hidden shadow-inner",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[x.newItems.map(T=>e.jsx(Le,{item:T,type:"new"},T.ticketNumber)),x.updatedItems.map(T=>e.jsx(Le,{item:T,type:"update"},T.ticketNumber))]})})]}):e.jsxs("div",{className:"py-10 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Re,{size:32,className:"mx-auto mb-3 text-emerald-500/40"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-tight",children:"System Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1 max-w-[200px] mx-auto leading-relaxed",children:"Your local database matches the remote Google Sheets source."}),e.jsxs("button",{onClick:M,className:"mt-6 flex items-center gap-1.5 px-4 py-2 mx-auto bg-white dark:bg-zinc-800 rounded-xl text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95 shadow-sm",children:[e.jsx(Fe,{size:12})," Force Re-Check"]})]})]}),y==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Re,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})})}const ke=j.memo(({label:s,required:d,icon:b,...c})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[b&&e.jsx(b,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",d&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{...c,className:de("w-full h-11 px-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none disabled:opacity-50",c.className)})]}));ke.displayName="ModernInput";const xe=j.memo(({label:s,value:d,onChange:b,options:c,required:y,icon:w})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[w&&e.jsx(w,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",y&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:d,onChange:x=>b(x.target.value),className:de("w-full h-11 px-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none"),children:[e.jsx("option",{value:"",children:"Select..."}),c.map(x=>e.jsx("option",{value:x,children:x},x))]})]}));xe.displayName="ModernSelect";const we=j.memo(({label:s,icon:d,...b})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[d&&e.jsx(d,{size:10,className:"text-primary/70",strokeWidth:3}),s]}),e.jsx("textarea",{...b,className:de("w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none",b.className)})]}));we.displayName="ModernTextarea";const Bt=j.memo(({label:s,value:d,onChange:b,options:c,colorMap:y={}})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1",children:s}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(w=>{const x=d===w,v=w?.toLowerCase()||"zinc",W=y[v]||"zinc",i={red:"bg-rose-500 text-white shadow-lg shadow-rose-500/30",orange:"bg-orange-500 text-white shadow-lg shadow-orange-500/30",amber:"bg-amber-500 text-white shadow-lg shadow-amber-500/30",emerald:"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30",blue:"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30",purple:"bg-purple-600 text-white shadow-lg shadow-purple-500/30",zinc:"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg"}[W];return e.jsx("button",{type:"button",onClick:()=>b(w),className:de("h-10 px-4 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-300 active:scale-95",x?i:"bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:border-zinc-300"),children:w},w)})})]}));Bt.displayName="ModernPillPicker";const He={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",responsibility:"",assign:"",remark:""};function $t({isOpen:s,onClose:d,initialData:b,onSubmit:c,isSubmitting:y}){const{ticketOptions:w}=Ye(),{team:x}=vt(),[v,W]=j.useState(He);j.useEffect(()=>{let m=!0;return s&&setTimeout(()=>{m&&W(b||He)},0),()=>{m=!1}},[b,s]);const i=j.useCallback((m,Z)=>{W(T=>({...T,[m]:Z}))},[]),A=j.useCallback(m=>{m.preventDefault(),c(v)},[v,c]);if(!s)return null;const M=!!b;return e.jsx(Ce,{isOpen:s,onClose:d,size:"lg",showCloseButton:!1,headerClassName:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 relative",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:de("w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transform -rotate-3",M?"bg-amber-100 dark:bg-amber-500/20 text-amber-600":"bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600"),children:e.jsx(ct,{size:22,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:M?"Edit Ticket":"Create New Ticket"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:de("w-1.5 h-1.5 rounded-full",M?"bg-amber-500":"bg-indigo-500")}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:M?`Modifying Record ${v.ticketNumber}`:"Deploying Operational Log"})]})]})]}),e.jsx("button",{onClick:d,className:"w-10 h-10 flex items-center justify-center rounded-2xl hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-90",children:e.jsx(ve,{size:20,strokeWidth:2.5})})]}),footerClassName:"px-8 py-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/40",footer:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"opacity-70 text-rose-600 dark:text-rose-500",children:"*"})," Field Persistence Required"]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 md:flex-none h-12 px-6 rounded-2xl text-xs font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-200/50 dark:hover:bg-zinc-800 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:y,className:de("flex-1 md:flex-none flex items-center justify-center gap-2 h-12 px-8 rounded-2xl text-xs font-black uppercase tracking-widest text-white shadow-xl shadow-primary/20","transition-all active:scale-95 disabled:opacity-50",M?"bg-amber-500 hover:bg-amber-600":"bg-primary hover:brightness-110"),children:y?e.jsx(Ne,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:16,strokeWidth:2.5}),M?"Update Log":"Commit Ticket"]})})]})]}),bodyClassName:"px-6 py-6",children:e.jsxs("form",{id:"ticket-form",onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(ke,{label:"Ticket No.",icon:zt,required:!0,disabled:M,value:v.ticketNumber,onChange:m=>i("ticketNumber",m.target.value)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Responsibility",icon:De,value:v.responsibility,onChange:m=>i("responsibility",m),options:x.map(m=>m.name)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Type",icon:jt,value:v.type,onChange:m=>i("type",m),options:w.types||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Status",value:v.status,onChange:m=>i("status",m),options:w.statuses||[]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Severity",value:v.severity,onChange:m=>i("severity",m),options:w.severities||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx(xe,{label:"Category",value:v.category,onChange:m=>i("category",m),options:w.categories||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-5",children:e.jsx(xe,{label:"Sub-Category",value:v.subCategory,onChange:m=>i("subCategory",m),options:w.subCategories||[]})})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ke,{label:"Subject / Short Description",icon:qe,required:!0,value:v.shortDesc,onChange:m=>i("shortDesc",m.target.value),className:"font-bold"}),e.jsx(we,{label:"Ticket Details",rows:5,value:v.details,onChange:m=>i("details",m.target.value),className:"font-mono text-xs leading-relaxed"})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"flex flex-col h-full",children:e.jsx(we,{label:"Action Taken / Mitigation",icon:qe,value:v.action,onChange:m=>i("action",m.target.value),className:"bg-emerald-50/50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/20 flex-1 min-h-[180px]",wrapperClassName:"flex-1 flex flex-col"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(ke,{label:"Resolution Result",value:v.resolvedDetail,onChange:m=>i("resolvedDetail",m.target.value)}),e.jsx(ke,{label:"Assignee",icon:De,value:v.assign,onChange:m=>i("assign",m.target.value)}),e.jsx(we,{label:"Remarks",rows:2,value:v.remark,onChange:m=>i("remark",m.target.value)})]})]})]})})}const Kt=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Qe=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},tt=j.memo(({date:s})=>{const d=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:pe(d,"MMM")}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:pe(d,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5",children:pe(d,"yy")})]})});tt.displayName="DateBox";const rt=j.memo(({log:s,onLogClick:d,onSendToIncident:b,onEdit:c,onDelete:y,canEdit:w})=>{const x=()=>d(s),v=A=>{A.stopPropagation(),b(s,A)},W=A=>{A.stopPropagation(),c(s)},i=A=>{A.stopPropagation(),y(s.ticketNumber)};return e.jsxs("tr",{onClick:x,className:"group hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer border-b border-zinc-100 dark:border-zinc-800 last:border-0",children:[e.jsx("td",{className:"py-4 pl-6 pr-3 whitespace-nowrap",children:e.jsx(tt,{date:s.createdAt})}),e.jsx("td",{className:"py-4 px-3 whitespace-nowrap",children:e.jsxs("span",{className:"font-mono text-xs font-black text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-950/30 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-900/50 shadow-sm",children:["#",s.ticketNumber]})}),e.jsx("td",{className:"py-4 px-3 w-full",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-1 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md border ${Kt(s.status)} shadow-sm`,children:s.status}),e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx(Je,{size:10,className:Qe(s.severity)}),e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${Qe(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-4 h-4 rounded-md bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-[8px] font-black text-zinc-600 dark:text-zinc-300 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():e.jsx(De,{size:10})}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 truncate max-w-[120px]",children:s.assign||"Unassigned"})]}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-100/50 dark:bg-zinc-800/30 px-1.5 py-0.5 rounded",children:s.type})]})]})}),e.jsx("td",{className:"py-4 pl-3 pr-6 text-right whitespace-nowrap",children:w&&e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:v,className:"p-1.5 text-zinc-400 hover:text-amber-500 hover:bg-amber-50 rounded-md",title:"Add to Timeline",children:e.jsx(Xe,{size:16})}),e.jsx("button",{onClick:W,className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-blue-50 rounded-md",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:i,className:"p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 rounded-md",children:e.jsx(et,{size:16})})]})})]})});rt.displayName="TicketTableRow";function Wt({logs:s,onLogClick:d,onSendToIncident:b,onEdit:c,onDelete:y,canEdit:w}){return e.jsx("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:[e.jsx("th",{className:"py-4 pl-6 pr-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Date"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Ticket ID"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Operational Summary & Metadata"}),e.jsx("th",{className:"py-4 pl-3 pr-6 text-right text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:s.map(x=>e.jsx(rt,{log:x,onLogClick:d,onSendToIncident:b,onEdit:c,onDelete:y,canEdit:w},x.id))})]})})})}const Ht=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Ge=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},st=j.memo(({date:s})=>{const d=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:pe(d,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:pe(d,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:pe(d,"yy")})]})});st.displayName="DateBox";const at=j.memo(({log:s,onClick:d,onEdit:b,canEdit:c})=>e.jsx("div",{onClick:d,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] p-4 shadow-sm hover:shadow-md transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(st,{date:s.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 text-[10px] sm:text-xs font-black rounded-lg border border-blue-100 dark:border-blue-800",children:["#",s.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-black px-2 py-0.5 rounded-full border ${Ht(s.status)} shadow-sm`,children:s.status})]}),c&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:y=>{y.stopPropagation(),b(s)},className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:e.jsx(Oe,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:s.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{size:12,className:Ge(s.severity)}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${Ge(s.severity)}`,children:s.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-400 font-bold bg-zinc-50 dark:bg-zinc-800/50 px-2 py-0.5 rounded-lg",children:s.type})]})]})]})}));at.displayName="MobileTicketCard";function Qt({logs:s,onLogClick:d,onEdit:b,canEdit:c}){return e.jsx("div",{className:"md:hidden space-y-4",children:s.map(y=>e.jsx(at,{log:y,onClick:()=>d(y),onEdit:b,canEdit:c},y.id))})}const Gt=({log:s,onClose:d,onSendToIncident:b,onEdit:c,onDelete:y,canEdit:w})=>{if(!s)return null;const x=s.createdAt?pe(new Date(s.createdAt),"dd MMM yyyy"):"-",v=i=>{switch(i?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},W=i=>{switch(i?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}};return e.jsx(Ce,{isOpen:!0,onClose:d,size:"md",className:"max-h-[85vh]",header:e.jsxs("div",{className:"w-full flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-lg sm:text-xl font-black text-zinc-900 dark:text-white",children:["#",s.ticketNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:11})," ",x]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(At,{size:11})," ",s.type]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${v(s.status)}`,children:s.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-4",children:[w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:y,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(et,{size:14})})]}),e.jsx("button",{onClick:d,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(ve,{size:16})})]})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${W(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono max-h-48 overflow-y-auto custom-scrollbar",children:s.details||s.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(ht,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Re,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.resolvedDetail||"Pending"})]})]}),e.jsxs("div",{className:"pt-6 mt-6 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:s.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:s.assign||"Unassigned"})]})]}),w&&e.jsxs("button",{onClick:()=>{b(),d()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(Xe,{size:14})," Add to Timeline"]})]})]})})};function fr(){const{logs:s,loading:d,loadingMore:b,hasMore:c,loadMore:y,stats:w}=pt(),{toast:x}=Ve(),{currentUser:v}=ot(),W=lt(v,[Ue.LEAD,Ue.ENGINEER]),{ticketOptions:i}=Ye(),A=dt(),M=Ze(),[m,Z]=j.useState(!1),[T,Q]=j.useState(""),[K,re]=j.useState("All"),[ne,D]=j.useState("All"),[P,ee]=j.useState(null),X=j.useDeferredValue(T),[n,t]=j.useState(!1),[r,a]=j.useState(null),[l,o]=j.useState(!1),[g,F]=j.useState(null),[se,J]=j.useState(!1);Pt(s);const _=j.useCallback(()=>{a(null),t(!0)},[]),L=j.useCallback(h=>{a(h),t(!0)},[]),p=j.useCallback(async h=>{o(!0);try{r?(await ye.updateLog(r.ticketNumber,h),x({className:"bg-emerald-500 text-white border-none",title:"Update Successful",description:`Ticket #${r.ticketNumber} has been updated.`})):(await ye.createLog(h),x({className:"bg-indigo-500 text-white border-none",title:"Ticket Created",description:"New operational log has been recorded."})),M.invalidateQueries(["ticketLogs"]),t(!1),a(null),ee(null)}catch(f){console.error("Submit Error:",f),x({variant:"destructive",title:"Submission Failed",description:f.message||"Could not save the ticket."})}finally{o(!1)}},[r,M,x]),G=j.useCallback(h=>{F(h)},[]),z=j.useCallback(async()=>{if(g)try{await ye.deleteLog(g),x({title:"Ticket Deleted",description:`Ticket #${g} removed from system.`}),M.invalidateQueries(["ticketLogs"]),ee(null)}catch(h){x({variant:"destructive",title:"Delete Failed",description:h.message})}finally{F(null)}},[g,M,x]),C=j.useCallback(async(h,f)=>{if(f&&f.stopPropagation(),!v){x({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const S=typeof v=="object"&&v!==null?{name:v.name,id:v.id,role:v.role}:{name:v},O={subject:h.shortDesc||h.details||"New Incident from Log",ticket:h.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(h.type)?h.type:"Incident",status:"Open",createdBy:S,impact:"",root_cause:h.details||"",action:h.action||""};await bt.createIncident(O),x({title:"Successfully Added",description:`Ticket #${h.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>A("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(S){console.error(S),x({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[v,A,x]),u=j.useMemo(()=>s.filter(h=>{const f=h.ticketNumber?.toLowerCase().includes(X.toLowerCase())||h.shortDesc?.toLowerCase().includes(X.toLowerCase())||h.details&&h.details.toLowerCase().includes(X.toLowerCase()),S=K==="All"||h.status===K,O=ne==="All"||h.type===ne;return f&&S&&O}).sort((h,f)=>new Date(f.createdAt||0)-new Date(h.createdAt||0)),[s,X,K,ne]),q=K!=="All"||ne!=="All",B=j.useCallback(()=>{re("All"),D("All"),Q("")},[]),H=j.useCallback(h=>{ee(h)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx("div",{className:"shrink-0 py-5 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[9px] font-bold rounded uppercase tracking-wider",children:"System Log"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[w.total," Records"]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Ticket Management"})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:_,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Nt,{size:16})," New Ticket"]}),e.jsxs("button",{onClick:()=>Z(!0),disabled:d,className:"flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Ae,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(_t,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"",value:T,onChange:h=>Q(h.target.value),className:"w-full h-10 pl-10 pr-9 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),T&&e.jsx("button",{onClick:()=>Q(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ve,{size:14})})]}),e.jsxs("button",{onClick:()=>J(!0),className:de("h-10 px-3 flex items-center justify-center rounded-xl transition-all border",q?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 border-blue-200 dark:border-blue-800":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent"),children:[e.jsx(Pe,{size:18}),q&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-blue-500 rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ct,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{Q(""),re("All"),D("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Wt,{logs:u,onLogClick:H,onSendToIncident:C,onEdit:L,onDelete:G,canEdit:W}),e.jsx(Qt,{logs:u,onLogClick:H,onEdit:L,canEdit:W}),c&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:y,disabled:b,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:b?e.jsx(Ne,{className:"animate-spin",size:16}):e.jsx(Dt,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),P&&e.jsx(Gt,{log:P,onClose:()=>ee(null),onSendToIncident:()=>C(P),onEdit:()=>L(P),onDelete:()=>G(P.ticketNumber),canEdit:W}),e.jsx($t,{isOpen:n,onClose:()=>t(!1),initialData:r,onSubmit:p,isSubmitting:l}),e.jsx(ut,{isOpen:!!g,onClose:()=>F(null),onConfirm:z,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${g}? This action cannot be undone.`,isDanger:!0}),e.jsx(qt,{isOpen:m,onClose:()=>Z(!1),currentLogs:s,onSyncComplete:h=>{x({title:"Sync Completed",description:`Updated ${h} records.`}),M.invalidateQueries({queryKey:["ticketLogs"]}),Z(!1)}}),e.jsx(Ce,{isOpen:se,onClose:()=>J(!1),size:"md",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-500/20 text-blue-600 flex items-center justify-center",children:e.jsx(Pe,{size:20})}),e.jsx("h3",{className:"text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>J(!1),className:"w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 rounded-2xl text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(ve,{size:20,strokeWidth:2.5})})]}),footer:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[e.jsx("button",{onClick:()=>{B(),J(!1)},className:"flex-1 h-12 rounded-2xl text-xs font-black uppercase tracking-widest text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/50 transition-colors",children:"Reset Filters"}),e.jsx("button",{onClick:()=>J(!1),className:"flex-[2] h-12 rounded-2xl bg-blue-600 text-white text-xs font-black uppercase tracking-widest shadow-xl shadow-blue-500/30 hover:brightness-110 active:scale-95 transition-all",children:"Apply Constraints"})]}),children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Current Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...i.statuses].map(h=>e.jsx("button",{onClick:()=>re(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",K===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Log Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...i.types].map(h=>e.jsx("button",{onClick:()=>D(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",ne===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]})]})})]})}export{fr as default};
