import{f as y,g as d,h as s,s as h,t as u,q as w,w as R,i as f,k as i,l as v,m,o as l,n as A,p as I,v as O}from"./index-C3czKcPY.js";const o="incidents",D=(e,t)=>{if(!s)return console.error("Firebase not configured! Check your .env file"),t&&t(new Error("Firebase not configured")),e([]),()=>{};try{const n=w(d(s,o),l("createdAt","desc"),O(100));return I(n,r=>{const a=r.docs.map(c=>({id:c.id,...c.data()}));e(a)},r=>{console.error("Subscription error:",r.message),t&&t(r),e([])})}catch(n){return t&&t(n),e([]),()=>{}}},b=async e=>{try{const t=i(s,o,e),n=await A(t);return n.exists()?{id:n.id,...n.data()}:null}catch(t){u(t)}},q=async()=>{try{const e=w(d(s,o),l("createdAt","desc"));return(await f(e)).docs.map(n=>({id:n.id,...n.data()}))}catch(e){u(e)}},T=async e=>{try{return(await y(d(s,o),{...e,status:e.status||"Open",priority:e.priority||"Medium",timeline:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),serverTimestamp:h()})).id}catch(t){u(t)}},F=async(e,t)=>{try{const n=i(s,o,e);await v(n,{...t,updatedAt:new Date().toISOString()})}catch(n){u(n)}},C=async e=>{try{const t=i(s,o,e);await m(t)}catch(t){u(t)}},M=(e,t)=>{if(!e)return()=>{};const n=d(s,o,e,"events"),r=w(n);return I(r,a=>{const c=a.docs.map(p=>({id:p.id,...p.data()}));t(c)},a=>console.error("Error subscribing to events sub-collection:",a))},S=async(e,t)=>{try{const n=d(s,o,e,"events"),r={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},a=await y(n,r),c=i(s,o,e);return await v(c,{updatedAt:h()}),{id:a.id,...r}}catch(n){u(n)}},x=async(e,t,n)=>{try{const r=t.id||n.id;if(!r)throw new Error("Event ID missing for update");const a=i(s,o,e,"events",r),c={...n,updatedAt:new Date().toISOString()};return await v(a,c),{id:r,...c}}catch(r){u(r)}},B=async(e,t)=>{try{const n=t.id;if(!n)throw new Error("Event ID missing for delete");const r=i(s,o,e,"events",n);await m(r)}catch(n){u(n)}},L=async e=>{try{const t=d(s,o,e,"events");return(await f(t)).docs.map(r=>({id:r.id,...r.data()}))}catch(t){return console.error("Error fetching events:",t),[]}},N=S,k=async(e,t,n)=>{const r=i(s,o,e,"events",t);await v(r,{...n,updatedAt:new Date().toISOString()})},P=async(e,t)=>{const n=i(s,o,e,"events",t);await m(n)},_=async(e,t)=>{throw new Error("reorderEvents is not yet implemented for sub-collections")},j=async e=>{try{let t=0,n=0;for(const r of e){const a=w(d(s,o),R("ticket","==",r.ticket)),c=await f(a),p={...r,updatedAt:new Date().toISOString()};if(c.empty)await y(d(s,o),{...p,createdAt:r.createdAt||new Date().toISOString(),status:r.status||"Open",priority:r.priority||"Medium",timeline:[]}),t++;else{const g=c.docs[0].id,E=i(s,o,g);await v(E,p),n++}}return{created:t,updated:n}}catch(t){throw console.error("Import Error:",t),t}},G={subscribeIncidents:D,subscribeEvents:M,getIncidentById:b,getIncidents:q,createIncident:T,updateIncident:F,deleteIncident:C,addTimelineEvent:S,updateTimelineEvent:x,deleteTimelineEvent:B,getEvents:L,createEvent:N,updateEvent:k,deleteEvent:P,reorderEvents:_,importIncidentsFromSheet:j};export{G as i,D as s};
