import{b as J,a as oe,r as a,j as e,F as de,X as P,e as C,g as Q,T as I,w as re,M as ae,x as Y,A as ce,L as ne,C as xe}from"./index-DcZD2k9h.js";import{d as X,a as L,u as Z,b as me,c as be,e as he,f as ue,g as ee,q as pe,l as ge,o as te,h as fe}from"./firebaseConfig-Cp-1Ewx5.js";import{P as ke,a as je,p as K,b as ze,C as ve,D as we,c as Ne,d as ye}from"./dialog-BQbLaa3o.js";import{u as Se}from"./useTeam-BQcgl8q3.js";import{f as T}from"./format-B568ns5f.js";import{C as $}from"./clock-DL20RmIr.js";import{C as O}from"./circle-check-phxildm2.js";import{S as Ce}from"./save-DFC-vGgG.js";import{P as De}from"./pen-GHZeYAQI.js";import{T as Ae}from"./trash-2-k1Nm6ce8.js";import{S as Fe}from"./shield-B-blZcy-.js";import{P as Me}from"./plus-DYEr7uFB.js";import{D as Le}from"./download-DDMwPWki.js";import{S as Ee}from"./search-CxuukeRw.js";import{S as se}from"./sliders-horizontal-BeXwJgkJ.js";import{F as He}from"./funnel-yN01yvjQ.js";import"./button-COfjfEwE.js";import"./addYears-RECKJz7f.js";import"./addMonths-BfoHT1ak.js";import"./isSameMonth-CRYCS6Ki.js";import"./chevron-left-COURQH7j.js";import"./chevron-right-DoTw3tmc.js";import"./chevron-down-pZgQDRTB.js";import"./Combination-C2kwtb1-.js";import"./index-COH1NNCN.js";import"./configService-CpUaQNct.js";const E="shift_handovers",H={subscribeHandovers:(s,r=50)=>{const n=pe(ee(L,E),te("date","desc"),te("createdAt","desc"),ge(r));return fe(n,c=>{const f=c.docs.map(l=>({id:l.id,...l.data(),onDuty:l.data().onDuty||[],acknowledgedBy:l.data().acknowledgedBy||[]}));s(f)},c=>{console.error("Firestore subscription error:",c),s([])})},createHandover:async s=>{try{const r={...s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:s.acknowledgedBy||[],onDuty:s.onDuty||[]};return await ue(ee(L,E),r)}catch(r){throw console.error("Create handover error:",r),new Error("Failed to create handover log")}},updateHandover:async(s,r)=>{try{const n={...r,updatedAt:new Date().toISOString()};await Z(X(L,E,s),n)}catch(n){throw console.error("Update handover error:",n),new Error("Failed to update handover log")}},deleteHandover:async s=>{try{await he(X(L,E,s))}catch(r){throw console.error("Delete handover error:",r),new Error("Failed to delete handover log")}},toggleAcknowledge:async(s,r,n)=>{try{const c=X(L,E,s);await Z(c,{acknowledgedBy:n?me(r):be(r),updatedAt:new Date().toISOString()})}catch(c){throw console.error("Toggle acknowledge error:",c),new Error("Failed to update acknowledgment")}}},Ie=()=>{const s=J(d=>d.currentUser),r=J(d=>d.nocMembers),{toast:n}=oe(),[c,f]=a.useState([]),[l,p]=a.useState(!0),[z,o]=a.useState(!1),[i,u]=a.useState(""),[k,D]=a.useState("All"),[S,t]=a.useState("All"),[b,j]=a.useState(""),x=a.useCallback((d,m="success")=>{n({description:d,variant:m==="error"?"destructive":"default"})},[n]);a.useEffect(()=>{if(!s){f([]),p(!1);return}const d=H.subscribeHandovers(m=>{f(m||[]),p(!1)});return()=>d&&d()},[s]);const v=a.useMemo(()=>{if(!c.length)return[];const d=b.toLowerCase().trim();return c.filter(m=>{const y=(m.note||"").toLowerCase().includes(d),w=(m.onDuty||[]).some(le=>(le||"").toLowerCase().includes(d)),A=(m.status||"").toLowerCase().includes(d),q=!d||y||w||A,G=!i||m.date===i,U=k==="All"||m.shift===k,W=S==="All"||m.status===S;return q&&G&&U&&W})},[c,b,i,k,S]),M=a.useCallback(d=>{const m=Array.isArray(r)?r.length:0,y=(d.acknowledgedBy||[]).length,w=m>0?Math.round(y/m*100):0,A=m>0&&y>=m;return{total:m,acked:y,percentage:w,isComplete:A}},[r]),h=a.useMemo(()=>{const d=v.length,m=v.filter(w=>w.status!=="Normal").length,y=v.filter(w=>M(w).isComplete).length;return{total:d,withIssues:m,fullyAcked:y}},[v,M]),V=a.useCallback(async(d,m,y)=>{o(!0);try{return m?(await H.updateHandover(y,d),x("Log updated successfully")):(await H.createHandover(d),x("Log created successfully")),!0}catch(w){return console.error(w),x(w.message||"Save failed","error"),!1}finally{o(!1)}},[x]),R=a.useCallback(async d=>{try{await H.deleteHandover(d),x("Log deleted")}catch(m){console.error(m),x(m.message||"Delete failed","error")}},[x]),B=a.useCallback(async(d,m)=>{if(!s){x("Please login first!","error");return}const y=(d.acknowledgedBy||[]).includes(m);try{await H.toggleAcknowledge(d.id,m,y),x(y?"Acknowledgment removed":"Acknowledged âœ“")}catch(w){console.error(w),x(w.message||"Failed to update","error")}},[s,x]),_=a.useCallback(()=>{if(v.length===0){x("No data to export","error");return}try{const m=["Date,Time,Shift,Status,Team,Acknowledged,Note",...v.map(A=>{const q=new Date(A.date).toLocaleDateString("en-GB"),G=(A.note||"").replace(/"/g,'""'),U=(A.onDuty||[]).join("; "),W=(A.acknowledgedBy||[]).join("; ");return`"${q}","${A.time}","${A.shift}","${A.status}","${U}","${W}","${G}"`})].join(`
`),y=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a");w.href=URL.createObjectURL(y),w.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,w.click(),x("CSV exported successfully")}catch(d){console.error(d),x("Export failed","error")}},[v,x]),N=a.useCallback(()=>{u(""),D("All"),t("All"),j("")},[]);return{filteredHistory:v,loading:l,saving:z,stats:h,filterDate:i,setFilterDate:u,filterShift:k,setFilterShift:D,filterStatus:S,setFilterStatus:t,searchText:b,setSearchText:j,clearFilters:N,handleSave:V,handleDelete:R,handleAcknowledge:B,handleExportCSV:_,getAckStats:M}},Te=()=>{const[s,r]=a.useState(!1),[n,c]=a.useState(null),[f,l]=a.useState(null),[p,z]=a.useState(null),[o,i]=a.useState(!1),u=a.useCallback(()=>{c(null),r(!0)},[]),k=a.useCallback(v=>{c(v),r(!0)},[]),D=a.useCallback(()=>{r(!1),c(null)},[]),S=a.useCallback(v=>l(v),[]),t=a.useCallback(()=>l(null),[]),b=a.useCallback(v=>z(v),[]),j=a.useCallback(()=>z(null),[]),x=a.useCallback(()=>i(v=>!v),[]);return{isFormOpen:s,editingLog:n,viewingLog:f,deleteId:p,isFilterOpen:o,openCreateForm:u,openEditForm:k,closeForm:D,openViewModal:S,closeViewModal:t,confirmDelete:b,cancelDelete:j,toggleFilters:x}},Oe=(s,r,n,c,f)=>{const[l,p]=a.useState({date:"",time:"",shift:"Morning",onDuty:[],status:"Normal",note:""}),[z,o]=a.useState({});a.useEffect(()=>{if(s){if(r)p({...r,onDuty:r.onDuty||[]});else{const t=new Date,b=typeof n=="object"?n?.name:n;p({date:T(t,"yyyy-MM-dd"),time:T(t,"HH:mm"),shift:t.getHours()>=8&&t.getHours()<20?"Morning":"Night",onDuty:b?[b]:[],status:"Normal",note:""})}o({})}},[s,r,n]);const i=(t,b)=>{p(j=>({...j,[t]:b})),z[t]&&o(j=>({...j,[t]:null}))},u=t=>{p(b=>{const j=b.onDuty||[];return j.includes(t)?{...b,onDuty:j.filter(x=>x!==t)}:{...b,onDuty:[...j,t]}})},k=()=>{const t={};return l.date||(t.date="Date is required"),l.time||(t.time="Start time is required"),(!l.onDuty||l.onDuty.length===0)&&(t.onDuty="Select at least one member"),o(t),Object.keys(t).length===0},D=()=>{k()&&f(l)},S=a.useMemo(()=>{const t=new Set(c.map(x=>x.name)),b=[...c],j=typeof n=="object"?n?.name:n;return!r&&j&&!t.has(j)&&(b.push({id:"current-user",name:j,role:"Current",isActive:!0}),t.add(j)),r?.onDuty&&r.onDuty.forEach(x=>{t.has(x)||(b.push({id:x,name:x,role:"History",isActive:!1}),t.add(x))}),b},[c,r,n]);return{formData:l,errors:z,setField:i,toggleMember:u,handleSubmit:D,displayMembers:S}},g={sectionTitle:"flex items-center gap-2 text-xs font-black text-indigo-500 uppercase tracking-widest mb-4",label:"block text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",inputContainer:"relative transition-all group",input:"w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder:text-zinc-300",error:"text-[10px] font-bold text-red-500 mt-1 flex items-center gap-1",btnOption:"flex-1 flex items-center justify-center gap-2 rounded-lg text-[10px] font-black uppercase transition-all",btnActive:"bg-white dark:bg-zinc-800 text-black dark:text-white shadow-sm ring-1 ring-black/5 dark:ring-white/10",btnInactive:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",memberCard:"relative flex flex-col items-center justify-center p-3 rounded-2xl border transition-all duration-200 group"},ie=a.memo(({isOpen:s,onClose:r,onSubmit:n,initialData:c,isEditing:f,currentUser:l,saving:p=!1})=>{const{team:z}=Se(),{formData:o,errors:i,setField:u,toggleMember:k,handleSubmit:D,displayMembers:S}=Oe(s,c,l,z,n);return a.useEffect(()=>{const t=b=>{b.key==="Escape"&&s&&r()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,r]),s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-0 sm:p-4 bg-zinc-950/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:r,children:e.jsxs("div",{className:"w-full h-full sm:h-auto sm:max-h-[90vh] max-w-2xl bg-white dark:bg-[#121214] sm:rounded-[2rem] shadow-2xl border-0 sm:border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col animate-in zoom-in-95 slide-in-from-bottom-5 duration-300",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#121214] flex justify-between items-center sticky top-0 z-20 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-black uppercase tracking-tight text-zinc-900 dark:text-white flex items-center gap-2",children:[f?e.jsx(de,{size:22,className:"text-indigo-500"}):e.jsx($,{size:22,className:"text-indigo-500"}),f?"Edit Shift Log":"New Handover"]}),e.jsx("p",{className:"text-xs font-medium text-zinc-400 mt-1",children:"Record details for the next shift team."})]}),e.jsx("button",{onClick:r,disabled:p,className:"p-2.5 bg-zinc-50 dark:bg-zinc-800/50 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white rounded-full transition-all disabled:opacity-50",children:e.jsx(P,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 sm:p-8 space-y-8 bg-white dark:bg-[#121214]",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:g.sectionTitle,children:[e.jsx($,{size:14})," Shift Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsxs("div",{className:g.inputContainer,children:[e.jsx("label",{className:g.label,children:"Date"}),e.jsxs(ke,{children:[e.jsx(je,{asChild:!0,children:e.jsxs("button",{type:"button",className:C(g.input,"text-left flex items-center justify-between group-hover:border-zinc-300 dark:group-hover:border-zinc-700",!o.date&&"text-zinc-400",i.date&&"border-red-500 bg-red-50 dark:bg-red-950/20"),children:[o.date?T(K(o.date),"dd MMM yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(Q,{size:16,className:"text-zinc-400"})]})}),e.jsx(ze,{className:"w-auto p-0 bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 shadow-xl rounded-2xl",align:"start",children:e.jsx(ve,{mode:"single",selected:o.date?K(o.date):void 0,onSelect:t=>t&&u("date",T(t,"yyyy-MM-dd")),initialFocus:!0,className:"p-3"})})]}),i.date&&e.jsxs("p",{className:g.error,children:[e.jsx(I,{size:10})," ",i.date]})]}),e.jsxs("div",{className:g.inputContainer,children:[e.jsx("label",{className:g.label,children:"Start Time"}),e.jsx("input",{type:"time",value:o.time,onChange:t=>u("time",t.target.value),className:`${g.input} text-center tracking-widest ${i.time?"border-red-500 bg-red-50 dark:bg-red-950/20":""}`}),i.time&&e.jsxs("p",{className:g.error,children:[e.jsx(I,{size:10})," ",i.time]})]}),e.jsxs("div",{className:g.inputContainer,children:[e.jsx("label",{className:g.label,children:"Period"}),e.jsx("div",{className:"flex rounded-xl bg-zinc-50 dark:bg-zinc-900 p-1 border border-zinc-200 dark:border-zinc-800 h-11",children:["Morning","Night"].map(t=>e.jsxs("button",{type:"button",onClick:()=>u("shift",t),className:C(g.btnOption,o.shift===t?g.btnActive:g.btnInactive),children:[t==="Morning"?e.jsx(re,{size:14}):e.jsx(ae,{size:14})," ",t]},t))})]})]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("h3",{className:g.sectionTitle,children:[e.jsx(Y,{size:14})," Personnel On Duty"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:S.map(t=>{const b=o.onDuty.includes(t.name);return e.jsxs("button",{type:"button",onClick:()=>k(t.name),className:C(g.memberCard,b?"bg-indigo-50 dark:bg-indigo-950/30 border-indigo-500/50 shadow-sm":"bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700"),children:[b&&e.jsx("div",{className:"absolute top-2 right-2 text-indigo-500",children:e.jsx(O,{size:12,fill:"currentColor",className:"text-white dark:text-indigo-950"})}),e.jsx("div",{className:C("w-8 h-8 mb-2 rounded-full flex items-center justify-center text-xs font-black transition-colors",b?"bg-indigo-500 text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-400 group-hover:bg-zinc-200 dark:group-hover:bg-zinc-700"),children:t.name.charAt(0)}),e.jsx("span",{className:C("text-[10px] font-bold uppercase truncate w-full text-center",b?"text-indigo-700 dark:text-indigo-300":"text-zinc-500"),children:t.name.split(" ")[0]})]},t.id)})}),i.onDuty&&e.jsxs("p",{className:g.error,children:[e.jsx(I,{size:10})," ",i.onDuty]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:g.sectionTitle,children:[e.jsx(ce,{size:14})," Log Details"]}),e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:["Normal","Issues"].map(t=>e.jsxs("button",{type:"button",onClick:()=>u("status",t),className:C("px-3 py-1 rounded-md text-[10px] font-bold uppercase transition-all flex items-center gap-1.5",o.status===t?t==="Normal"?"bg-white dark:bg-zinc-800 text-emerald-600 shadow-sm":"bg-white dark:bg-zinc-800 text-red-500 shadow-sm":"text-zinc-400"),children:[o.status===t&&(t==="Normal"?e.jsx(O,{size:10}):e.jsx(I,{size:10})),t]},t))})]}),e.jsxs("div",{className:g.inputContainer,children:[e.jsx("label",{className:g.label,children:"Handover Remarks / Incidents"}),e.jsx("textarea",{rows:6,value:o.note,onChange:t=>u("note",t.target.value),className:C(g.input,"h-auto py-3 resize-none leading-relaxed"),placeholder:"Enter handover details here..."})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#121214] flex gap-3 shrink-0 z-20",children:[e.jsx("button",{type:"button",onClick:r,disabled:p,className:"flex-1 py-3.5 rounded-xl border border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-bold text-xs uppercase hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:D,disabled:p,className:"flex-[2] py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-xs uppercase shadow-lg shadow-indigo-500/20 flex items-center justify-center gap-2 hover:opacity-90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[p?e.jsx(ne,{size:16,className:"animate-spin"}):e.jsx(Ce,{size:16}),f?"Update Log":"Save Handover"]})]})]})}):null});ie.displayName="ShiftHandoverForm";const Be=a.memo(({log:s,currentUser:r,onAcknowledge:n,onView:c,onEdit:f,onDelete:l,ackStats:p})=>{const z=r&&(s.acknowledgedBy||[]).includes(r.name),o=r&&(s.createdBy===r.name||(s.onDuty||[]).includes(r.name));let i=s.date;try{i=T(K(s.date),"dd MMM")}catch{}return e.jsxs("div",{className:"group bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-4 sm:p-5 hover:border-indigo-300 dark:hover:border-indigo-700 hover:shadow-lg hover:shadow-indigo-500/10 transition-all duration-300 relative overflow-hidden",children:[e.jsx("div",{className:C("absolute left-0 top-0 bottom-0 w-1 transition-colors",s.status==="Normal"?"bg-emerald-500":"bg-red-500")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:items-start justify-between pl-3",children:[e.jsxs("div",{className:"flex gap-4 items-start cursor-pointer flex-1",onClick:c,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center w-14 h-14 bg-zinc-50 dark:bg-zinc-800 rounded-xl border border-zinc-100 dark:border-zinc-700 shrink-0",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-zinc-400",children:s.shift.substring(0,3)}),e.jsx("span",{className:"text-lg font-black text-zinc-900 dark:text-white leading-none",children:i.split(" ")[0]})]}),e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:C("px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border",s.status==="Normal"?"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 border-emerald-200 dark:border-emerald-800":"bg-red-50 dark:bg-red-950/30 text-red-600 border-red-200 dark:border-red-800"),children:s.status}),e.jsxs("span",{className:"text-xs text-zinc-400 flex items-center gap-1",children:[e.jsx($,{size:12})," ",s.time]})]}),e.jsx("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300 line-clamp-1 max-w-[200px] sm:max-w-md",children:s.note||e.jsx("span",{className:"italic text-zinc-400",children:"No remarks"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-500 dark:text-zinc-500",children:[e.jsx(Y,{size:12}),e.jsx("span",{className:"truncate max-w-[150px]",children:(s.onDuty||[]).join(", ")})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-3 mt-2 sm:mt-0 pt-3 sm:pt-0 border-t sm:border-0 border-zinc-100 dark:border-zinc-800 min-w-[200px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:n,className:C("h-9 px-3 rounded-lg text-xs font-bold uppercase transition-all flex items-center gap-1.5 border",z?"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 border-emerald-200 dark:border-emerald-800":"bg-white dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 border-zinc-200 dark:border-zinc-700 hover:border-indigo-300 dark:hover:border-indigo-700"),children:[e.jsx(O,{size:14,className:z?"fill-emerald-600 text-white":""}),z?"Acked":"Ack"]}),e.jsx("div",{className:"w-px h-6 bg-zinc-200 dark:bg-zinc-800 mx-1"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f,className:"p-2 text-zinc-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:e.jsx(De,{size:16})}),e.jsx("button",{onClick:l,className:"p-2 text-zinc-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(Ae,{size:16})})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsx("div",{className:"flex flex-wrap justify-end gap-1",children:(s.acknowledgedBy||[]).length>0?(s.acknowledgedBy||[]).map((u,k)=>e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-100 dark:border-emerald-900/50 text-[9px] font-bold text-emerald-700 dark:text-emerald-400",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),u.split(" ")[0]]},k)):e.jsx("span",{className:"text-[10px] text-zinc-300 italic",children:"No one yet"})})})]})]})]})});function Pe({log:s,isOpen:r,onClose:n,nocMembers:c=[]}){if(!s)return null;const f=s.acknowledgedBy||[],l=c.length>0?c:f.map(i=>({id:i,name:i})),p=l.length,z=f.length,o=p>0&&z>=p;return e.jsx(we,{open:r,onOpenChange:n,children:e.jsxs(Ne,{showCloseButton:!1,className:"w-full max-w-lg p-0 gap-0 overflow-hidden rounded-[2rem] border-zinc-200 dark:border-zinc-700 bg-white dark:bg-[#18181b]",children:[e.jsx(ye,{className:"sr-only",children:"Shift Log Details"}),e.jsx("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 bg-gradient-to-r from-zinc-50 to-white dark:from-zinc-900 dark:to-[#18181b]",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[s.shift==="Morning"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-600 dark:text-orange-400 px-2.5 py-1 rounded-full",children:[e.jsx(re,{size:12})," Morning Shift"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 text-indigo-600 dark:text-indigo-400 px-2.5 py-1 rounded-full",children:[e.jsx(ae,{size:12})," Night Shift"]}),s.status==="Normal"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 px-2.5 py-1 rounded-full",children:[e.jsx(O,{size:12})," Normal"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2.5 py-1 rounded-full animate-pulse",children:[e.jsx(I,{size:12})," Issues"]})]}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-tighter text-zinc-900 dark:text-white",children:"Shift Log Details"})]}),e.jsx("button",{onClick:n,className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-200/50 dark:bg-zinc-700/50 text-zinc-500 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-600 hover:text-zinc-800 dark:hover:text-zinc-200 transition-all backdrop-blur-sm",children:e.jsx(P,{size:18,strokeWidth:2.5})})]})}),e.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-6 max-h-[70vh]",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/30 p-5 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest flex items-center gap-1.5",children:[e.jsx(Fe,{size:12})," Acknowledgment Status"]}),e.jsxs("span",{className:`text-[10px] font-bold ${o?"text-emerald-600":"text-zinc-400"}`,children:[z," / ",p," Acknowledged"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:l.length>0?l.map((i,u)=>{const k=f.includes(i.name);return e.jsxs("div",{className:`flex items-center gap-2 px-2.5 py-2 rounded-xl text-[10px] font-bold border transition-all ${k?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800":"bg-white dark:bg-zinc-800 text-zinc-400 border-zinc-200 dark:border-zinc-700 opacity-60"}`,children:[k?e.jsx(O,{size:14,className:"shrink-0 text-emerald-500"}):e.jsx("div",{className:"w-3.5 h-3.5 rounded-full border-2 border-zinc-200 dark:border-zinc-600 shrink-0"}),e.jsx("span",{className:"truncate",children:i.name})]},i.id||u)}):e.jsx("div",{className:"col-span-full text-center py-2 text-xs text-zinc-400 italic",children:"No members list available"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 p-4 rounded-2xl",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx(Q,{size:12,className:"inline mr-1.5"}),"Date"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:new Date(s.date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 p-4 rounded-2xl",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx($,{size:12,className:"inline mr-1.5"}),"Time Logged"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:s.time})]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3 flex items-center gap-1.5",children:[e.jsx(Y,{size:12})," On Duty"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.onDuty&&s.onDuty.length>0?s.onDuty.map((i,u)=>e.jsxs("div",{className:"flex items-center gap-2 pl-1 pr-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-full shadow-sm",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-zinc-800 to-zinc-900 dark:from-white dark:to-zinc-100 text-white dark:text-black flex items-center justify-center text-[10px] font-black",children:i.charAt(0)}),e.jsx("span",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:i})]},u)):e.jsx("span",{className:"text-xs text-zinc-400 italic",children:"No staff assigned"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3",children:"Remarks / Note"}),e.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-900/30 p-5 rounded-2xl border border-zinc-100 dark:border-zinc-800 text-sm font-medium text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap min-h-[80px]",children:s.note||e.jsx("span",{className:"text-zinc-400 italic",children:"No additional remarks."})})]})]}),e.jsx("div",{className:"px-8 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50",children:e.jsx("button",{onClick:n,className:"w-full py-3 rounded-xl border-2 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 font-black uppercase text-[10px] tracking-widest hover:bg-white dark:hover:bg-zinc-800 transition-colors",children:"Close"})})]})})}const F=({label:s,isActive:r,onClick:n})=>e.jsx("button",{onClick:n,className:C("px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-wider transition-all border",r?"bg-white text-black border-white shadow-lg shadow-white/10 scale-105":"bg-zinc-800/50 text-zinc-500 border-zinc-700 hover:border-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:s});function mt(){const{currentUser:s,nocMembers:r}=J(),{filteredHistory:n,loading:c,saving:f,stats:l,filterDate:p,setFilterDate:z,filterShift:o,setFilterShift:i,filterStatus:u,setFilterStatus:k,searchText:D,setSearchText:S,clearFilters:t,handleSave:b,handleDelete:j,handleAcknowledge:x,handleExportCSV:v,getAckStats:M}=Ie(),h=Te(),V=async N=>{await b(N,!!h.editingLog,h.editingLog?.id)&&h.closeForm()},R=()=>{h.deleteId&&(j(h.deleteId),h.cancelDelete())},B=p||o!=="All"||u!=="All",_=l.total-l.withIssues;return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors relative",children:[e.jsx("div",{className:"shrink-0 py-3 px-3 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 relative z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 text-[9px] font-bold rounded uppercase tracking-wider",children:"Operations"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[l.total," Logs"]})]}),e.jsx("h1",{className:"text-lg sm:text-xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Shift Handover"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:h.openCreateForm,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-xs font-bold bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95 transition-all shadow-sm shadow-indigo-500/20 h-9",children:[e.jsx(Me,{size:16})," New Handover"]}),e.jsx("button",{onClick:v,className:"flex-none flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all h-9",title:"Export CSV",children:e.jsx(Le,{size:16})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 relative",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 sm:pb-0 no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 shrink-0 h-9",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] font-bold text-red-600 dark:text-red-400 uppercase tracking-wide",children:"Issues"}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white ml-1",children:l.withIssues})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-900/30 shrink-0 h-9",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide",children:"Normal"}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white ml-1",children:_})]})]}),e.jsxs("div",{className:"flex-1 flex gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Ee,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:D,onChange:N=>S(N.target.value),placeholder:"Search...",className:"w-full h-9 pl-9 pr-8 bg-zinc-100 dark:bg-zinc-800 border-none rounded-lg text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),D&&e.jsx("button",{onClick:()=>S(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500 p-1",children:e.jsx(P,{size:12})})]}),e.jsx("button",{onClick:h.toggleFilters,className:C("h-9 w-9 flex items-center justify-center rounded-lg transition-all border shrink-0",h.isFilterOpen?"bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-500/30":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent hover:bg-zinc-200 dark:hover:bg-zinc-700"),children:e.jsx(se,{size:16})})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 sm:p-6 bg-zinc-50/50 dark:bg-black/20 z-0 pb-20",children:e.jsx("div",{className:"max-w-6xl mx-auto space-y-3",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[e.jsx(ne,{className:"animate-spin text-indigo-500",size:32}),e.jsx("span",{className:"text-xs font-bold text-zinc-400",children:"Loading handovers..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-300",children:e.jsx(He,{size:32})}),e.jsx("h3",{className:"text-zinc-900 dark:text-white font-bold",children:"No records found"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Try adjusting your search or filters."}),B&&e.jsx("button",{onClick:t,className:"mt-4 text-indigo-500 text-xs font-bold hover:underline",children:"Clear all filters"})]}):n.map(N=>e.jsx(Be,{log:N,currentUser:s,onAcknowledge:()=>x(N,s?.name),onView:()=>h.openViewModal(N),onEdit:()=>h.openEditForm(N),onDelete:()=>h.confirmDelete(N.id),ackStats:M(N)},N.id))})}),h.isFilterOpen&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col justify-end pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm pointer-events-auto transition-opacity duration-300",onClick:h.toggleFilters}),e.jsx("div",{className:"pointer-events-auto w-full sm:max-w-lg mx-auto z-50 animate-in slide-in-from-bottom-full duration-300 ease-out",children:e.jsxs("div",{className:"bg-[#18181b] border-t border-zinc-800 sm:border-x rounded-t-3xl p-5 pb-8 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.5)] overflow-hidden relative",children:[e.jsx("div",{className:"w-12 h-1 bg-zinc-700 rounded-full mx-auto mb-6 opacity-50"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600/20 flex items-center justify-center text-blue-500",children:e.jsx(se,{size:16})}),e.jsx("h3",{className:"text-sm font-black text-white uppercase tracking-widest",children:"Advanced Filters"})]}),e.jsx("button",{onClick:h.toggleFilters,className:"w-8 h-8 rounded-full bg-zinc-800 hover:bg-zinc-700 flex items-center justify-center text-zinc-400 transition-colors",children:e.jsx(P,{size:14})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 pl-1",children:"Target Date"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:p,onChange:N=>z(N.target.value),className:"w-full bg-zinc-900 border border-zinc-800 text-white text-sm font-bold rounded-xl px-4 py-3 outline-none focus:border-blue-500 transition-colors appearance-none"}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none",children:e.jsx(Q,{size:16})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 pl-1",children:"Shift Period"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(F,{label:"All",isActive:o==="All",onClick:()=>i("All")}),e.jsx(F,{label:"Morning",isActive:o==="Morning",onClick:()=>i("Morning")}),e.jsx(F,{label:"Night",isActive:o==="Night",onClick:()=>i("Night")})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 pl-1",children:"Current Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(F,{label:"All",isActive:u==="All",onClick:()=>k("All")}),e.jsx(F,{label:"Normal",isActive:u==="Normal",onClick:()=>k("Normal")}),e.jsx(F,{label:"Issues",isActive:u==="Issues",onClick:()=>k("Issues")})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-zinc-800",children:[B&&e.jsx("button",{onClick:t,className:"flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-wider text-red-500 bg-red-500/10 hover:bg-red-500/20 transition-colors",children:"Reset"}),e.jsx("button",{onClick:h.toggleFilters,className:"flex-1 py-3 rounded-xl text-xs font-black uppercase tracking-wider text-white bg-blue-600 hover:bg-blue-500 shadow-lg shadow-blue-600/20 transition-all",children:"Apply Constraints"})]})]})})]}),e.jsx(ie,{isOpen:h.isFormOpen,onClose:h.closeForm,onSubmit:V,initialData:h.editingLog,isEditing:!!h.editingLog,currentUser:s,saving:f}),e.jsx(Pe,{isOpen:!!h.viewingLog,onClose:h.closeViewModal,log:h.viewingLog,nocMembers:r||[]}),e.jsx(xe,{isOpen:!!h.deleteId,onClose:h.cancelDelete,onConfirm:R,title:"Delete Handover Log",message:"Are you sure? This action cannot be undone.",isDanger:!0})]})}export{mt as default};
