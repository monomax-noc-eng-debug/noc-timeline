import{c as S}from"./index-DWA64BFG.js";import{k as u,d as a,b as s,h as E,u as p,i as y,c as w,g as m,q as h,o as l,j as v,l as D}from"./firebaseConfig-B-I4EWGW.js";const O=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],A=S("user",O),n="incidents",d="events",b={subscribeIncidents:(e,t=100)=>{const r=h(w(a,n),l("updatedAt","desc"),D(t));return v(r,o=>{const i=o.docs.map(c=>({id:c.id,...c.data(),status:c.data().status||"Open",type:c.data().type||"Incident",project:c.data().project||"MONOMAX"}));e(i)},o=>{console.error("Incidents subscription error:",o),e([])})},subscribeEvents:(e,t)=>{const r=h(w(a,n,e,d),l("order","asc"),l("date","desc"),l("time","desc"));return v(r,o=>{const i=o.docs.map(c=>({id:c.id,...c.data(),imageUrls:c.data().imageUrls||[]}));t(i)},o=>{console.error("Events subscription error:",o),t([])})},createIncident:async e=>{try{const t={...e,status:e.status||"Open",type:e.type||"Incident",priority:e.priority||"Medium",project:e.project||"MONOMAX",eventCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await y(w(a,n),t)}catch(t){throw console.error("Create incident error:",t),new Error("Failed to create incident")}},updateIncident:async(e,t)=>{try{await p(s(a,n,e),{...t,updatedAt:new Date().toISOString()})}catch(r){throw console.error("Update incident error:",r),new Error("Failed to update incident")}},deleteIncident:async e=>{try{const t=w(a,n,e,d),r=await m(t),o=u(a);r.docs.forEach(i=>{o.delete(i.ref)}),o.delete(s(a,n,e)),await o.commit()}catch(t){throw console.error("Delete incident error:",t),new Error("Failed to delete incident")}},createEvent:async(e,t)=>{try{const r=await y(w(a,n,e,d),{...t,order:t.order??-Date.now(),imageUrls:t.imageUrls||[],createdAt:new Date().toISOString()});return await p(s(a,n,e),{updatedAt:new Date().toISOString()}),r}catch(r){throw console.error("Create event error:",r),new Error("Failed to create event")}},updateEvent:async(e,t,r)=>{try{await p(s(a,n,e,d,t),{...r,updatedAt:new Date().toISOString()}),await p(s(a,n,e),{updatedAt:new Date().toISOString()})}catch(o){throw console.error("Update event error:",o),new Error("Failed to update event")}},deleteEvent:async(e,t)=>{try{await E(s(a,n,e,d,t)),await p(s(a,n,e),{updatedAt:new Date().toISOString()})}catch(r){throw console.error("Delete event error:",r),new Error("Failed to delete event")}},reorderEvents:async(e,t)=>{try{const r=u(a);t.forEach(o=>{const i=s(a,n,e,d,o.id);r.update(i,{order:o.order})}),await r.commit()}catch(r){throw console.error("Reorder events error:",r),new Error("Failed to reorder events")}}};export{A as U,b as i};
