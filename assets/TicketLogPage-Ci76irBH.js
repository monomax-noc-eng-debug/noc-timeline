import{d as te,r as i,j as e,F as _,J as fe,L as $,H as de,X as P,U as V,C as k,al as ke,ai as Fe,a as Re,b as Ee,P as Oe,u as Pe,ac as Ue,G as Be,ao as $e,Q as le,A as _e,I as We}from"./index-C3czKcPY.js";import{t as O,u as ze,a as qe,S as oe}from"./useTicketOptions-O6WAl--4.js";import{i as He}from"./incidentService-hSnMctO1.js";import{C as Q}from"./cloud-download-CshSW3w0.js";import{C as Y}from"./circle-check-BBL36_JP.js";import{A as Ge}from"./arrow-right-zQ-P0s3d.js";import{D as Ke}from"./database-jKWS8tZL.js";import{b as xe}from"./parse-Bm-acfNC.js";import{k as me,a as L}from"./format-DPgh7KlH.js";import{c as Ve}from"./addYears-Wkomck9s.js";import{u as Qe,S as se}from"./useTeam-BeIfdoMi.js";import{T as Ye}from"./tag-Dki7gCbV.js";import{P as Ze}from"./panels-top-left-3xTkezJA.js";import{S as Xe}from"./save-P60SZD5d.js";import{C as Je}from"./circle-check-big-BNvFpX3x.js";import{C as et}from"./clock-z-v43bZh.js";import{V as je}from"./VirtualizedList-CtEkDryk.js";import{Z as ve}from"./zap-Bo1WTbTg.js";import{T as Ne,P as tt}from"./trash-2-B1eE1hNZ.js";import{S as st}from"./search-DCEkWZIL.js";import{G as rt}from"./globe-BMDQejTj.js";import"./useBaseQuery-C-SPIq1p.js";import"./configService-BE8VHHI1.js";const at=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],it=te("circle-arrow-down",at);const nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],be=te("info",nt);const ct=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],dt=te("shield-alert",ct),lt=()=>{const t=i.useRef(!1);i.useEffect(()=>{t.current||(t.current=!0,O.checkAndSyncTickets())},[])},he="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",ue=t=>{if(!t)return new Date().toISOString();const s=new Date(t);if(!isNaN(s.getTime()))return s.toISOString();const a=String(t).trim();let n=xe(a,"d/M/yy",new Date);return me(n)?(n.getFullYear()<2e3&&(n=Ve(n,100),n.getFullYear()<2e3&&n.setFullYear(2e3+parseInt(a.split(/[-/]/)[2]))),n.toISOString()):(n=xe(a,"d/M/yyyy",new Date),me(n)?n.toISOString():new Date().toISOString())},U=i.memo(({label:t,value:s,variant:a})=>{const n={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${n[a]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:s}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});U.displayName="StatBox";const Z=i.memo(({item:t,type:s})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${s==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${s==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:s==="new"?"New":"Update"})]}));Z.displayName="PreviewRow";function ot({isOpen:t,onClose:s,onSyncComplete:a,currentLogs:n}){const[m,c]=i.useState("input"),[o,l]=i.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[g,b]=i.useState(null),j=i.useCallback(()=>{c("input"),l({newItems:[],updatedItems:[],uptodateItems:[]}),b(null)},[]),h=i.useCallback(async()=>{c("analyzing"),b(null);try{const p=await fetch(he);if(!p.ok)throw new Error("Failed to fetch data from Apps Script ("+p.status+")");const f=await p.json();if(f.status==="error")throw new Error(f.message||"Unknown Script Error");const N=Array.isArray(f)?f:f.data||[];if(N.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const D=N.map(r=>({ticketNumber:r.ticketNo||r.ticketNumber||"",shortDesc:r.subject||r.shortDescription||r.description||"",status:r.status||"Open",type:r.ticketType||r.type||"Incident",assign:r.assignee||r.assign||"Unassigned",details:r.description||r.detail||"",action:r.actionTaken||r.action||"",resolvedDetail:r.resolutionNote||r.resolvedDetail||"",remark:r.remark||"",severity:r.severity||"Low",category:r.category||"",subCategory:r.subCategory||"",date:ue(r.date||r.ticketDate||r.createdAt),createdAt:ue(r.date||r.ticketDate||r.createdAt)})).filter(r=>r.ticketNumber),S=Array.from(D.reduce((r,u)=>{const z=String(u.ticketNumber).trim();return r.set(z,{...u,ticketNumber:z}),r},new Map).values()),M=[],w=[],T=[];S.forEach(r=>{const u=n.find(z=>String(z.ticketNumber).trim()===r.ticketNumber);u?u.status!==r.status||u.shortDesc!==r.shortDesc||u.assign!==r.assign||u.action!==r.action||(u.details||"")!==r.details||(u.remark||"")!==r.remark||(u.type||"Incident")!==r.type||(u.resolvedDetail||"")!==r.resolvedDetail||(u.category||"")!==r.category||(u.subCategory||"")!==r.subCategory||(u.severity||"Low")!==r.severity?w.push({...r,_prev:u}):T.push(r):M.push(r)});const C=(r,u)=>new Date(u.createdAt||0)-new Date(r.createdAt||0);l({newItems:M.sort(C),updatedItems:w.sort(C),uptodateItems:T.sort(C)}),c("review")}catch(p){console.error(p),b("Sync Error: "+p.message),c("input")}},[n]),x=i.useCallback(async()=>{c("saving");try{const f=[...o.newItems,...o.updatedItems].map(({_prev:N,...D})=>D);f.length>0&&await O.importLogsFromSheet(f),a&&a(f.length),setTimeout(()=>{s(),j()},1500),c("success")}catch(p){b("Database Error: "+p.message),c("review")}},[o.newItems,o.updatedItems,a,s,j]);if(!t)return null;const v=o.newItems.length+o.updatedItems.length;return e.jsx(_,{isOpen:t,onClose:s,size:"md",showCloseButton:!1,headerClassName:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Q,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Live Sync Manager"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"External Database Connector"})]})]}),e.jsx("button",{onClick:s,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(P,{size:18})})]}),bodyClassName:"flex-1 overflow-y-auto custom-scrollbar p-5",footerClassName:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",footer:e.jsxs(e.Fragment,{children:[m==="input"&&e.jsxs("button",{onClick:h,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(Ge,{size:14})]}),m==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:x,disabled:v===0,className:"px-5 py-2 bg-[#0078D4] text-white rounded-lg text-xs font-bold hover:bg-[#106EBE] active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(Ke,{size:14})," Confirm Sync"]})]}),m==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx($,{size:14,className:"animate-spin"})," Updating Database..."]}),m==="success"&&e.jsx("button",{onClick:s,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})]}),children:e.jsxs(e.Fragment,{children:[m==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-[#0078D4]/10 dark:bg-[#0078D4]/20 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(Q,{size:24,className:"text-[#0078D4]"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),g&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(fe,{size:14})," ",g]})]}),m==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx($,{size:32,className:"animate-spin text-[#0078D4] mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),m==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(U,{label:"New",value:o.newItems.length,variant:"new"}),e.jsx(U,{label:"Updates",value:o.updatedItems.length,variant:"update"}),e.jsx(U,{label:"Unchanged",value:o.uptodateItems.length,variant:"unchanged"})]}),v>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-zinc-500",children:"Pending Sync Records"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[v," items to process"]})]}),e.jsxs("button",{onClick:h,disabled:m==="analyzing",className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-[#0078D4] transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95",title:"Re-fetch latest data",children:[e.jsx(de,{size:12,className:m==="analyzing"?"animate-spin":""})," Refresh"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-lg overflow-hidden shadow-inner",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[o.newItems.map(p=>e.jsx(Z,{item:p,type:"new"},p.ticketNumber)),o.updatedItems.map(p=>e.jsx(Z,{item:p,type:"update"},p.ticketNumber))]})})]}):e.jsxs("div",{className:"py-10 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-lg bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Y,{size:32,className:"mx-auto mb-3 text-emerald-500/40"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-tight",children:"System Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1 max-w-[200px] mx-auto leading-relaxed",children:"Your local database matches the remote Google Sheets source."}),e.jsxs("button",{onClick:h,className:"mt-6 flex items-center gap-1.5 px-4 py-2 mx-auto bg-white dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-[#0078D4] transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95 shadow-sm",children:[e.jsx(de,{size:12})," Force Re-Check"]})]})]}),m==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-lg flex items-center justify-center text-white mb-4",children:e.jsx(Y,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})})}const E=i.memo(({label:t,required:s,icon:a,...n})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-xs font-medium text-zinc-600 dark:text-zinc-400 ml-1 flex items-center gap-1.5",children:[a&&e.jsx(a,{size:10,className:"text-[#0078D4]",strokeWidth:2.5}),t," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...n,className:k("w-full h-11 px-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none disabled:opacity-50",n.className)})]}));E.displayName="ModernInput";const A=i.memo(({label:t,value:s,onChange:a,options:n,required:m,icon:c})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-xs font-medium text-zinc-600 dark:text-zinc-400 ml-1 flex items-center gap-1.5",children:[c&&e.jsx(c,{size:10,className:"text-[#0078D4]",strokeWidth:2.5}),t," ",m&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s,onChange:o=>a(o.target.value),className:k("w-full h-11 px-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none"),children:[e.jsx("option",{value:"",children:"Select..."}),n.map(o=>e.jsx("option",{value:o,children:o},o))]})]}));A.displayName="ModernSelect";const B=i.memo(({label:t,icon:s,...a})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-zinc-600 dark:text-zinc-400 ml-1 flex items-center gap-1.5",children:[s&&e.jsx(s,{size:10,className:"text-[#0078D4]",strokeWidth:2.5}),t]}),e.jsx("textarea",{...a,className:k("w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none",a.className)})]}));B.displayName="ModernTextarea";const xt=i.memo(({label:t,value:s,onChange:a,options:n,colorMap:m={}})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium text-zinc-600 dark:text-zinc-400 ml-1",children:t}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(c=>{const o=s===c,l=c?.toLowerCase()||"zinc",g=m[l]||"zinc",b={red:"bg-rose-500 text-white shadow-lg shadow-rose-500/30",orange:"bg-orange-500 text-white shadow-lg shadow-orange-500/30",amber:"bg-amber-500 text-white shadow-lg shadow-amber-500/30",emerald:"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30",blue:"bg-[#0078D4] text-white shadow-lg shadow-[#0078D4]/30",purple:"bg-purple-600 text-white shadow-lg shadow-purple-500/30",zinc:"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg"}[g];return e.jsx("button",{type:"button",onClick:()=>a(c),className:k("h-10 px-4 rounded-lg text-[11px] font-medium transition-all duration-300 active:scale-95",o?b:"bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:border-zinc-300"),children:c},c)})})]}));xt.displayName="ModernPillPicker";const pe={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",responsibility:"",assign:"",remark:""};function mt({isOpen:t,onClose:s,initialData:a,onSubmit:n,isSubmitting:m}){const{ticketOptions:c}=ze(),{team:o}=Qe(),[l,g]=i.useState(pe);i.useEffect(()=>{let x=!0;return t&&setTimeout(()=>{x&&g(a||pe)},0),()=>{x=!1}},[a,t]);const b=i.useCallback((x,v)=>{g(p=>({...p,[x]:v}))},[]),j=i.useCallback(x=>{x.preventDefault(),n(l)},[l,n]);if(!t)return null;const h=!!a;return e.jsx(_,{isOpen:t,onClose:s,size:"lg",showCloseButton:!1,headerClassName:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 relative",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:k("w-12 h-12 rounded-lg flex items-center justify-center shadow-lg transform -rotate-3",h?"bg-amber-100 dark:bg-amber-500/20 text-amber-600":"bg-[#0078D4]/10 dark:bg-[#0078D4]/20 text-[#0078D4]"),children:e.jsx(ke,{size:22,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:h?"Edit Ticket":"Create New Ticket"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:k("w-1.5 h-1.5 rounded-full",h?"bg-amber-500":"bg-[#0078D4]")}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:h?`Modifying Record ${l.ticketNumber}`:"Deploying Operational Log"})]})]})]}),e.jsx("button",{onClick:s,className:"w-10 h-10 flex items-center justify-center rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-red-500 transition-all active:scale-90",children:e.jsx(P,{size:20,strokeWidth:2.5})})]}),footerClassName:"px-8 py-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/40",footer:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-zinc-500",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-red-500",children:"*"})," Required fields"]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 md:flex-none h-10 px-5 rounded-md text-sm font-medium text-zinc-600 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:m,className:k("flex-1 md:flex-none flex items-center justify-center gap-2 h-10 px-6 rounded-md text-sm font-medium text-white shadow-md","transition-all active:scale-95 disabled:opacity-50",h?"bg-amber-500 hover:bg-amber-600":"bg-[#0078D4] hover:bg-[#106EBE]"),children:m?e.jsx($,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16,strokeWidth:2.5}),h?"Update Log":"Commit Ticket"]})})]})]}),bodyClassName:"px-6 py-6",children:e.jsxs("form",{id:"ticket-form",onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(E,{label:"Ticket No.",icon:Ye,required:!0,disabled:h,value:l.ticketNumber,onChange:x=>b("ticketNumber",x.target.value)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(A,{label:"Responsibility",icon:V,value:l.responsibility,onChange:x=>b("responsibility",x),options:o.map(x=>x.name)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(A,{label:"Type",icon:Ze,value:l.type,onChange:x=>b("type",x),options:c.types||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(A,{label:"Status",value:l.status,onChange:x=>b("status",x),options:c.statuses||[]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(A,{label:"Severity",value:l.severity,onChange:x=>b("severity",x),options:c.severities||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx(A,{label:"Category",value:l.category,onChange:x=>b("category",x),options:c.categories||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-5",children:e.jsx(A,{label:"Sub-Category",value:l.subCategory,onChange:x=>b("subCategory",x),options:c.subCategories||[]})})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Subject / Short Description",icon:be,required:!0,value:l.shortDesc,onChange:x=>b("shortDesc",x.target.value),className:"font-bold"}),e.jsx(B,{label:"Ticket Details",rows:5,value:l.details,onChange:x=>b("details",x.target.value),className:"font-mono text-xs leading-relaxed"})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"flex flex-col h-full",children:e.jsx(B,{label:"Action Taken / Mitigation",icon:be,value:l.action,onChange:x=>b("action",x.target.value),className:"bg-emerald-50/50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/20 flex-1 min-h-[180px]",wrapperClassName:"flex-1 flex flex-col"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(E,{label:"Resolution Result",value:l.resolvedDetail,onChange:x=>b("resolvedDetail",x.target.value)}),e.jsx(E,{label:"Assignee",icon:V,value:l.assign,onChange:x=>b("assign",x.target.value)}),e.jsx(B,{label:"Remarks",rows:2,value:l.remark,onChange:x=>b("remark",x.target.value)})]})]})]})})}const ye=i.memo(({label:t,value:s,icon:a,colorClass:n,borderColorClass:m})=>{const c=a;return e.jsx("div",{className:k("relative bg-white dark:bg-zinc-900 border-l-[3px] rounded-r-lg p-4","shadow-sm hover:shadow-md transition-shadow",m),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide mb-1",children:t}),e.jsx("h4",{className:"text-2xl font-bold text-zinc-900 dark:text-white leading-none",children:typeof s=="number"?s.toLocaleString():s})]}),e.jsx("div",{className:k("w-10 h-10 rounded-lg flex items-center justify-center bg-zinc-50 dark:bg-zinc-800"),children:e.jsx(c,{size:20,className:n,strokeWidth:2})})]})})});ye.displayName="StatCard";function bt({stats:t={}}){const s=[{label:"Total Tickets",value:t?.total||0,icon:ke,colorClass:"text-[#0078D4]",borderColorClass:"border-[#0078D4]"},{label:"Resolved",value:t?.succeed||0,icon:Je,colorClass:"text-emerald-500",borderColorClass:"border-emerald-500"},{label:"Pending",value:t?.pending||0,icon:et,colorClass:"text-amber-500",borderColorClass:"border-amber-500"},{label:"Incidents",value:t?.incidents||0,icon:fe,colorClass:"text-red-500",borderColorClass:"border-red-500"}];return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:s.map((a,n)=>e.jsx(ye,{label:a.label,value:a.value,icon:a.icon,colorClass:a.colorClass,borderColorClass:a.borderColorClass},n))})}const ht=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},ut=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},we=i.memo(({date:t})=>{const s=t?new Date(t):new Date;return e.jsxs("div",{className:"w-10 h-10 rounded-md bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] font-bold text-zinc-500 dark:text-zinc-500 uppercase leading-none",children:L(s,"MMM")}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white leading-none mt-0.5",children:L(s,"dd")}),e.jsx("span",{className:"text-[7px] font-medium text-zinc-400 dark:text-zinc-600 leading-none mt-0.5",children:L(s,"yy")})]})});we.displayName="DateBox";const X=i.memo(({log:t,onLogClick:s,onSendToIncident:a,onEdit:n,onDelete:m,canEdit:c})=>{const o=()=>s(t),l=h=>{h.stopPropagation(),a(t,h)},g=h=>{h.stopPropagation(),n(t)},b=h=>{h.stopPropagation(),m(t.ticketNumber)},j=t.status?.toLowerCase()==="open"?"border-l-red-500":t.status?.toLowerCase()==="pending"?"border-l-amber-500":t.status?.toLowerCase()==="succeed"?"border-l-emerald-500":"border-l-zinc-300";return e.jsxs("div",{onClick:o,className:`group hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer border-b border-zinc-100 dark:border-zinc-800 last:border-0 flex items-center border-l-[3px] ${j}`,children:[e.jsx("div",{className:"py-2.5 pl-4 pr-2 shrink-0",children:e.jsx(we,{date:t.createdAt})}),e.jsx("div",{className:"py-2.5 px-2 shrink-0",children:e.jsxs("span",{className:"font-mono text-xs font-semibold text-[#0078D4] bg-[#0078D4]/5 px-2 py-1 rounded",children:["#",t.ticketNumber]})}),e.jsx("div",{className:"py-2.5 px-2 flex-1 min-w-0",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium text-zinc-800 dark:text-zinc-100 line-clamp-1 group-hover:text-[#0078D4] transition-colors",children:t.shortDesc||t.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsx("span",{className:`text-[9px] font-semibold uppercase px-1.5 py-0.5 rounded ${ht(t.status)}`,children:t.status}),e.jsx("span",{className:`text-[9px] font-semibold ${ut(t.severity)}`,children:t.severity||"Low"}),e.jsx("span",{className:"text-[9px] text-zinc-400 bg-zinc-100 dark:bg-zinc-800 px-1.5 py-0.5 rounded",children:t.type}),t.assign&&e.jsxs("span",{className:"text-[9px] text-zinc-500 flex items-center gap-1",children:[e.jsx(V,{size:9})," ",t.assign]})]})]})}),e.jsx("div",{className:"py-2.5 pl-2 pr-4 shrink-0",children:c&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:l,className:"p-1.5 text-zinc-400 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/20 rounded",title:"Add to Timeline",children:e.jsx(ve,{size:14})}),e.jsx("button",{onClick:g,className:"p-1.5 text-zinc-400 hover:text-[#0078D4] hover:bg-[#0078D4]/10 rounded",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:b,className:"p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(Ne,{size:14})})]})})]})});X.displayName="TicketTableRow";const J=i.memo(()=>e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800 flex",children:[e.jsx("div",{className:"py-4 pl-6 pr-3 w-[70px] shrink-0 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Date"}),e.jsx("div",{className:"py-4 px-3 w-[120px] shrink-0 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Ticket ID"}),e.jsx("div",{className:"py-4 px-3 flex-1 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Operational Summary & Metadata"}),e.jsx("div",{className:"py-4 pl-3 pr-6 w-[130px] shrink-0 text-right text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Actions"})]}));J.displayName="TableHeader";function pt({logs:t,onLogClick:s,onSendToIncident:a,onEdit:n,onDelete:m,canEdit:c}){const o=i.useCallback(l=>e.jsx(X,{log:l,onLogClick:s,onSendToIncident:a,onEdit:n,onDelete:m,canEdit:c},l.id),[s,a,n,m,c]);return t.length<=20?e.jsxs("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:[e.jsx(J,{}),e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:t.map(l=>e.jsx(X,{log:l,onLogClick:s,onSendToIncident:a,onEdit:n,onDelete:m,canEdit:c},l.id))})]}):e.jsxs("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:[e.jsx(J,{}),e.jsx(je,{items:t,itemHeight:80,renderItem:o,containerHeight:"calc(100vh - 320px)"})]})}const gt=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},ge=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Ce=i.memo(({date:t})=>{const s=t?new Date(t):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-md bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-bold text-zinc-500 dark:text-zinc-500 uppercase leading-none",children:L(s,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-bold text-zinc-900 dark:text-white leading-none mt-0.5",children:L(s,"dd")}),e.jsx("span",{className:"text-[7px] font-medium text-zinc-400 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:L(s,"yy")})]})});Ce.displayName="DateBox";const ee=i.memo(({log:t,onClick:s,onEdit:a,canEdit:n})=>e.jsx("div",{onClick:s,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 shadow-sm hover:border-[#0078D4]/50 transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(Ce,{date:t.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-[#deecf9] dark:bg-blue-900/20 text-[#0078D4] dark:text-[#4ba0e8] text-[10px] sm:text-xs font-semibold rounded-md border border-blue-100 dark:border-blue-800/50",children:["#",t.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-semibold px-2 py-0.5 rounded-md border ${gt(t.status)}`,children:t.status})]}),n&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:m=>{m.stopPropagation(),a(t)},className:"p-1.5 text-zinc-400 hover:text-[#0078D4] hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors",children:e.jsx(se,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:t.shortDesc||t.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-bold text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.assign?t.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{size:12,className:ge(t.severity)}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${ge(t.severity)}`,children:t.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-500 border border-zinc-200 dark:border-zinc-800 dark:text-zinc-400 font-medium bg-zinc-50 dark:bg-zinc-900 px-2 py-0.5 rounded",children:t.type})]})]})]})}));ee.displayName="MobileTicketCard";function ft({logs:t,onLogClick:s,onEdit:a,canEdit:n}){const m=i.useCallback(c=>e.jsx(ee,{log:c,onClick:()=>s(c),onEdit:a,canEdit:n},c.id),[s,a,n]);return t.length<=15?e.jsx("div",{className:"md:hidden space-y-4",children:t.map(c=>e.jsx(ee,{log:c,onClick:()=>s(c),onEdit:a,canEdit:n},c.id))}):e.jsx("div",{className:"md:hidden",children:e.jsx(je,{items:t,itemHeight:140,renderItem:m,containerHeight:"calc(100vh - 280px)",className:"space-y-4"})})}const De=Be.memo(({log:t,onClose:s,onSendToIncident:a,onEdit:n,onDelete:m,canEdit:c})=>{if(!t)return null;const o=t.createdAt?L(new Date(t.createdAt),"dd MMM yyyy"):"-",l=b=>{switch(b?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},g=b=>{switch(b?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}};return e.jsx(_,{isOpen:!0,onClose:s,size:"md",showCloseButton:!1,className:"max-h-[85vh]",header:e.jsxs("div",{className:"w-full flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-[#0078D4] text-white text-[9px] font-semibold rounded-sm",children:"TICKET"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-zinc-900 dark:text-white",children:["#",t.ticketNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{size:11})," ",o]}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(dt,{size:11})," ",t.type]}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${l(t.status)}`,children:t.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-4",children:[c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-md text-zinc-500 hover:bg-[#0078D4] hover:text-white transition-colors",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:m,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-md text-zinc-500 hover:bg-red-600 hover:text-white transition-colors",children:e.jsx(Ne,{size:14})})]}),e.jsx("button",{onClick:s,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-md text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(P,{size:16})})]})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${g(t.severity)}`,children:t.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:t.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:t.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono max-h-48 overflow-y-auto custom-scrollbar",children:t.details||t.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(_e,{size:12,className:"text-[#0078D4]"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:t.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Y,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:t.resolvedDetail||"Pending"})]})]}),e.jsxs("div",{className:"pt-6 mt-6 border-t border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:t.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:t.assign||"Unassigned"})]})]}),c&&e.jsxs("button",{onClick:()=>{a(),s()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(ve,{size:14})," Add to Timeline"]})]})]})})});De.displayName="TicketDetailModal";function _t(){const{logs:t,loading:s,loadingMore:a,hasMore:n,loadMore:m,stats:c}=qe(),{toast:o}=Re(),{currentUser:l}=Ee(),g=Oe(l,[le.LEAD,le.ENGINEER]),{ticketOptions:b}=ze(),j=Pe(),h=Ue(),[x,v]=i.useState(!1),[p,f]=i.useState(""),[N,D]=i.useState("All"),[S,M]=i.useState("All"),[w,T]=i.useState(null),C=i.useDeferredValue(p),[r,u]=i.useState(!1),[z,W]=i.useState(null),[Se,re]=i.useState(!1),[I,q]=i.useState(null),[Te,F]=i.useState(!1);lt();const Ae=i.useCallback(()=>{W(null),u(!0)},[]),H=i.useCallback(d=>{W(d),u(!0)},[]),Le=i.useCallback(async d=>{re(!0);try{z?(await O.updateLog(z.ticketNumber,d),o({className:"bg-emerald-500 text-white border-none",title:"Update Successful",description:`Ticket #${z.ticketNumber} has been updated.`})):(await O.createLog(d),o({className:"bg-[#0078D4] text-white border-none",title:"Ticket Created",description:"New operational log has been recorded."})),h.invalidateQueries(["ticketLogs"]),u(!1),W(null),T(null)}catch(y){console.error("Submit Error:",y),o({variant:"destructive",title:"Submission Failed",description:y.message||"Could not save the ticket."})}finally{re(!1)}},[z,h,o]),ae=i.useCallback(d=>{q(d)},[]),Me=i.useCallback(async()=>{if(I)try{await O.deleteLog(I),o({title:"Ticket Deleted",description:`Ticket #${I} removed from system.`}),h.invalidateQueries(["ticketLogs"]),T(null)}catch(d){o({variant:"destructive",title:"Delete Failed",description:d.message})}finally{q(null)}},[I,h,o]),ie=i.useCallback(async(d,y)=>{if(y&&y.stopPropagation(),!l){o({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const R=typeof l=="object"&&l!==null?{name:l.name,id:l.id,role:l.role}:{name:l},K={subject:d.shortDesc||d.details||"New Incident from Log",ticket:d.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(d.type)?d.type:"Incident",status:"Open",createdBy:R,impact:"",root_cause:d.details||"",action:d.action||""};await He.createIncident(K),o({title:"Successfully Added",description:`Ticket #${d.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>j("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(R){console.error(R),o({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[l,j,o]),G=i.useMemo(()=>t.filter(d=>{const y=d.ticketNumber?.toLowerCase().includes(C.toLowerCase())||d.shortDesc?.toLowerCase().includes(C.toLowerCase())||d.details&&d.details.toLowerCase().includes(C.toLowerCase()),R=N==="All"||d.status===N,K=S==="All"||d.type===S;return y&&R&&K}).sort((d,y)=>new Date(y.createdAt||0)-new Date(d.createdAt||0)),[t,C,N,S]),ne=N!=="All"||S!=="All",Ie=i.useCallback(()=>{D("All"),M("All"),f("")},[]),ce=i.useCallback(d=>{T(d)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx("div",{className:"shrink-0 py-4 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-[#0078D4] text-white text-[10px] font-medium rounded",children:"System Log"}),e.jsxs("span",{className:"text-xs text-zinc-500",children:[c.total," Records"]})]}),e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-zinc-800 dark:text-white",children:"Ticket Management"})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:Ae,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium bg-[#0078D4] text-white hover:bg-[#106EBE] active:scale-[0.98] transition-all",children:[e.jsx(tt,{size:16})," New Ticket"]}),e.jsxs("button",{onClick:()=>v(!0),disabled:s,className:"flex-none flex items-center justify-center gap-2 px-3 py-2 rounded-md text-sm font-medium bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-[0.98] transition-all",children:[e.jsx(Q,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(st,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-[#0078D4] transition-colors"}),e.jsx("input",{type:"text",placeholder:"",value:p,onChange:d=>f(d.target.value),className:"w-full h-9 pl-9 pr-8 bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md text-sm outline-none focus:ring-1 focus:ring-[#0078D4] focus:border-[#0078D4] text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),p&&e.jsx("button",{onClick:()=>f(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(P,{size:14})})]}),e.jsxs("button",{onClick:()=>F(!0),className:k("h-9 px-3 flex items-center justify-center rounded-md transition-all border",ne?"bg-[#deecf9] text-[#0078D4] border-[#0078D4]/30":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-zinc-200 dark:border-zinc-700 hover:bg-zinc-200 dark:hover:bg-zinc-700"),children:[e.jsx(oe,{size:18}),ne&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-[#0078D4] rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[!s&&e.jsx(bt,{stats:c}),s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):G.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(rt,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{f(""),D("All"),M("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{logs:G,onLogClick:ce,onSendToIncident:ie,onEdit:H,onDelete:ae,canEdit:g}),e.jsx(ft,{logs:G,onLogClick:ce,onEdit:H,canEdit:g}),n&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:m,disabled:a,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:a?e.jsx($,{className:"animate-spin",size:16}):e.jsx(it,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})]})}),w&&e.jsx(De,{log:w,onClose:()=>T(null),onSendToIncident:()=>ie(w),onEdit:()=>H(w),onDelete:()=>ae(w.ticketNumber),canEdit:g}),e.jsx(mt,{isOpen:r,onClose:()=>u(!1),initialData:z,onSubmit:Le,isSubmitting:Se}),e.jsx($e,{isOpen:!!I,onClose:()=>q(null),onConfirm:Me,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${I}? This action cannot be undone.`,isDanger:!0}),e.jsx(ot,{isOpen:x,onClose:()=>v(!1),currentLogs:t,onSyncComplete:d=>{o({title:"Sync Completed",description:`Updated ${d} records.`}),h.invalidateQueries({queryKey:["ticketLogs"]}),v(!1)}}),e.jsx(_,{isOpen:Te,onClose:()=>F(!1),size:"md",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-[#deecf9] text-[#0078D4] flex items-center justify-center",children:e.jsx(oe,{size:18})}),e.jsx("h3",{className:"text-lg font-semibold text-zinc-800 dark:text-white",children:"Filters"})]}),e.jsx("button",{onClick:()=>F(!1),className:"w-8 h-8 flex items-center justify-center hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-zinc-600 dark:hover:text-white transition-all",children:e.jsx(P,{size:18})})]}),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>{Ie(),F(!1)},className:"flex-1 h-9 rounded-md text-sm font-medium text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:"Reset"}),e.jsx("button",{onClick:()=>F(!1),className:"flex-[2] h-9 rounded-md bg-[#0078D4] text-white text-sm font-medium hover:bg-[#106EBE] transition-all",children:"Apply Filters"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["All",...b.statuses].map(d=>e.jsx("button",{onClick:()=>D(d),className:k("h-8 px-3 rounded-md text-sm font-medium transition-all border",N===d?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:border-zinc-300 dark:hover:border-zinc-600"),children:d},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["All",...b.types].map(d=>e.jsx("button",{onClick:()=>M(d),className:k("h-8 px-3 rounded-md text-sm font-medium transition-all border",S===d?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:border-zinc-300 dark:hover:border-zinc-600"),children:d},d))})]})]})})]})}export{_t as default};
