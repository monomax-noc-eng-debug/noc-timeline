import{c as E,r as y}from"./index-Cu1hj24i.js";import{j as S,d as n,b as i,g,u,h,c as w,m as D,q as m,o as l,a as v,l as f}from"./firebaseConfig--jbwBVp3.js";import{c as O}from"./configService-Cf9dW1Z_.js";const I=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],U=E("user",I),a="incidents",p="events",F={subscribeIncidents:(e,t=500)=>{const r=m(w(n,a),l("updatedAt","desc"),f(t));return v(r,o=>{const s=o.docs.map(c=>{const d=c.data();return{id:c.id,...d,status:d.status||"Open",type:d.type||"Incident",project:d.project||"MONOMAX",_sortTime:new Date(d.updatedAt||d.createdAt||0).getTime()}});e(s)},o=>{console.error("Incidents subscription error:",o),e([])})},subscribeEvents:(e,t)=>{const r=m(w(n,a,e,p),l("order","asc"),l("date","desc"),l("time","desc"));return v(r,o=>{const s=o.docs.map(c=>({id:c.id,...c.data(),imageUrls:c.data().imageUrls||[]}));t(s)},o=>{console.error("Events subscription error:",o),t([])})},createIncident:async e=>{try{const t={...e,status:e.status||"Open",type:e.type||"Incident",priority:e.priority||"Medium",project:e.project||"MONOMAX",eventCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await h(w(n,a),t)}catch(t){throw console.error("Create incident error:",t),new Error("Failed to create incident")}},updateIncident:async(e,t)=>{try{await u(i(n,a,e),{...t,updatedAt:new Date().toISOString()})}catch(r){throw console.error("Update incident error:",r),new Error("Failed to update incident")}},deleteIncident:async e=>{try{const t=w(n,a,e,p),r=await D(t),o=S(n);r.docs.forEach(s=>{o.delete(s.ref)}),o.delete(i(n,a,e)),await o.commit()}catch(t){throw console.error("Delete incident error:",t),new Error("Failed to delete incident")}},createEvent:async(e,t)=>{try{const r=await h(w(n,a,e,p),{...t,order:t.order??-Date.now(),imageUrls:t.imageUrls||[],createdAt:new Date().toISOString()});return await u(i(n,a,e),{updatedAt:new Date().toISOString()}),r}catch(r){throw console.error("Create event error:",r),new Error("Failed to create event")}},updateEvent:async(e,t,r)=>{try{await u(i(n,a,e,p,t),{...r,updatedAt:new Date().toISOString()}),await u(i(n,a,e),{updatedAt:new Date().toISOString()})}catch(o){throw console.error("Update event error:",o),new Error("Failed to update event")}},deleteEvent:async(e,t)=>{try{await g(i(n,a,e,p,t)),await u(i(n,a,e),{updatedAt:new Date().toISOString()})}catch(r){throw console.error("Delete event error:",r),new Error("Failed to delete event")}},reorderEvents:async(e,t)=>{try{const r=S(n);t.forEach(o=>{const s=i(n,a,e,p,o.id);r.update(s,{order:o.order})}),await r.commit()}catch(r){throw console.error("Reorder events error:",r),new Error("Failed to reorder events")}}};function k(){const[e,t]=y.useState(O.getDefaultTicketOptions()),[r,o]=y.useState(!0);return y.useEffect(()=>{const s=O.subscribeTicketOptions(c=>{t(c),o(!1)});return()=>s()},[]),{ticketOptions:e,loading:r}}export{U,F as i,k as u};
