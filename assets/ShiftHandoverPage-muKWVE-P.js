const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/driveUpload-D3Mp_gcv.js","assets/index-C3czKcPY.js","assets/index-ltZyuBV8.css","assets/formatters-kIzuffS5.js","assets/format-DPgh7KlH.js","assets/addYears-Wkomck9s.js","assets/setYear-850W9rN9.js","assets/chevron-right-Ch1Og8Bl.js","assets/chevron-down-Oe6pi4Dz.js","assets/index-QYqCDngJ.js","assets/rotate-ccw-DHJdR8Te.js"])))=>i.map(i=>d[i]);
import{d as me,_ as ue,m as he,k as G,h as P,t as R,q as Z,g as J,o as $,v as ee,i as be,l as te,aj as pe,ak as fe,f as ge,p as je,b as Q,a as ve,r as o,j as e,X as ne,C as z,L as Y,J as ie,al as ke,ai as U,am as ze,an as ye,x as we,A as Ne,G as De,F as Se,ao as Ce,P as Ae,Q as re}from"./index-C3czKcPY.js";import{u as Ie,S as Fe}from"./useTeam-BeIfdoMi.js";import{a as B}from"./format-DPgh7KlH.js";import{D as le,f as oe}from"./formatters-kIzuffS5.js";import{T as Ee}from"./TimeInput-EBwNXEqU.js";import{I as Me,g as He,B as Le,C as Pe,a as Te,u as Oe,b as Re}from"./driveUpload-D3Mp_gcv.js";import{P as ce,T as Be}from"./trash-2-B1eE1hNZ.js";import{C as X}from"./clock-z-v43bZh.js";import{C as q}from"./circle-check-BBL36_JP.js";import{S as _e}from"./save-P60SZD5d.js";import{u as K}from"./setYear-850W9rN9.js";import{V as $e}from"./VirtualizedList-CtEkDryk.js";import{S as Ue}from"./search-DCEkWZIL.js";import{F as se}from"./funnel-V9DiZKv9.js";import{C as qe}from"./chevron-right-Ch1Og8Bl.js";import"./configService-BE8VHHI1.js";import"./addYears-Wkomck9s.js";import"./chevron-down-Oe6pi4Dz.js";import"./index-QYqCDngJ.js";import"./rotate-ccw-DHJdR8Te.js";const Ve=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],We=me("expand",Ve),T="shift_handovers",M={subscribeHandovers:(r,i=50)=>{const a=Z(J(P,T),$("date","desc"),$("createdAt","desc"),ee(i));return je(a,d=>{const y=d.docs.map(j=>({id:j.id,...j.data(),onDuty:j.data().onDuty||[],acknowledgedBy:j.data().acknowledgedBy||[]}));r(y)},d=>{console.error("Firestore subscription error:",d),r([])})},createHandover:async r=>{try{const i={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:r.acknowledgedBy||[],onDuty:r.onDuty||[]};return await ge(J(P,T),i)}catch(i){R(i)}},updateHandover:async(r,i)=>{try{const a={...i,updatedAt:new Date().toISOString()};await te(G(P,T,r),a)}catch(a){R(a)}},toggleAcknowledge:async(r,i,a)=>{try{const d=G(P,T,r);await te(d,{acknowledgedBy:a?pe(i):fe(i),updatedAt:new Date().toISOString()})}catch(d){R(d)}},createShift:r=>M.createHandover(r),getShifts:async(r=50)=>{try{const i=Z(J(P,T),$("date","desc"),$("createdAt","desc"),ee(r));return(await be(i)).docs.map(d=>({id:d.id,...d.data()}))}catch(i){R(i)}},updateShift:(r,i)=>M.updateHandover(r,i),deleteShift:(r,i=[])=>M.deleteHandover(r,i),deleteHandover:async(r,i=[])=>{try{i&&i.length>0&&Promise.all(i.map(a=>ue(async()=>{const{deleteFileFromDrive:d}=await import("./driveUpload-D3Mp_gcv.js").then(y=>y.c);return{deleteFileFromDrive:d}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({deleteFileFromDrive:d})=>d(a.id||a.url||a)))).catch(a=>console.error("Error cleaning up images:",a)),await he(G(P,T,r))}catch(a){R(a)}}},Ge=()=>{const r=Q(s=>s.currentUser),i=Q(s=>s.nocMembers),{toast:a}=ve(),[d,y]=o.useState([]),[j,p]=o.useState(!0),[g,b]=o.useState(!1),[v,w]=o.useState(""),[N,S]=o.useState("All"),[D,t]=o.useState("All"),[m,u]=o.useState(""),c=o.useCallback((s,n="success")=>{a({description:s,variant:n==="error"?"destructive":"default"})},[a]);o.useEffect(()=>{if(!r){y([]),p(!1);return}const s=M.subscribeHandovers(n=>{y(n||[]),p(!1)});return()=>s&&s()},[r]);const f=o.useMemo(()=>{if(!d.length)return[];const s=m.toLowerCase().trim();return d.filter(n=>{const x=(n.note||"").toLowerCase().includes(s),h=(n.onDuty||[]).some(xe=>(xe||"").toLowerCase().includes(s)),l=(n.status||"").toLowerCase().includes(s),C=!s||x||h||l,_=!v||n.date===v,V=N==="All"||n.shift===N,W=D==="All"||n.status===D;return C&&_&&V&&W})},[d,m,v,N,D]),A=o.useCallback(s=>{const n=Array.isArray(i)?i.length:0,x=(s.acknowledgedBy||[]).length,h=n>0?Math.round(x/n*100):0,l=n>0&&x>=n;return{total:n,acked:x,percentage:h,isComplete:l}},[i]),O=o.useMemo(()=>{const s=f.length,n=f.filter(h=>h.status!=="Normal").length,x=f.filter(h=>A(h).isComplete).length;return{total:s,withIssues:n,fullyAcked:x}},[f,A]),F=o.useCallback(async(s,n,x)=>{b(!0);try{return n?(await M.updateHandover(x,s),c("Log updated successfully")):(await M.createHandover(s),c("Log created successfully")),!0}catch(h){return console.error(h),c(h.message||"Save failed","error"),!1}finally{b(!1)}},[c]),I=o.useCallback(async s=>{try{await M.deleteHandover(s),c("Log deleted")}catch(n){console.error(n),c(n.message||"Delete failed","error")}},[c]),H=o.useCallback(async(s,n)=>{if(!r){c("Please login first!","error");return}const x=(s.acknowledgedBy||[]).includes(n);try{await M.toggleAcknowledge(s.id,n,x),c(x?"Acknowledgment removed":"Acknowledged âœ“")}catch(h){console.error(h),c(h.message||"Failed to update","error")}},[r,c]),L=o.useCallback(()=>{if(f.length===0){c("No data to export","error");return}try{const n=["Date,Time,Shift,Status,Team,Acknowledged,Note",...f.map(l=>{const C=new Date(l.date).toLocaleDateString("en-GB"),_=(l.note||"").replace(/"/g,'""'),V=(l.onDuty||[]).join("; "),W=(l.acknowledgedBy||[]).join("; ");return`"${C}","${l.time}","${l.shift}","${l.status}","${V}","${W}","${_}"`})].join(`
`),x=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a");h.href=URL.createObjectURL(x),h.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,h.click(),c("CSV exported successfully")}catch(s){console.error(s),c("Export failed","error")}},[f,c]),E=o.useCallback(()=>{w(""),S("All"),t("All"),u("")},[]);return{filteredHistory:f,loading:j,saving:g,stats:O,filterDate:v,setFilterDate:w,filterShift:N,setFilterShift:S,filterStatus:D,setFilterStatus:t,searchText:m,setSearchText:u,clearFilters:E,handleSave:F,handleDelete:I,handleAcknowledge:H,handleExportCSV:L,getAckStats:A}},Je=(r,i,a,d,y)=>{const[j,p]=o.useState({date:"",time:"",shift:"Morning",onDuty:[],status:"Normal",note:""}),[g,b]=o.useState({});o.useEffect(()=>{{if(i)p({...i,onDuty:i.onDuty||[]});else{const t=new Date,m=typeof a=="object"?a?.name:a;p({date:B(t,"yyyy-MM-dd"),time:B(t,"HH:mm"),shift:t.getHours()>=8&&t.getHours()<20?"Morning":"Night",onDuty:m?[m]:[],status:"Normal",note:""})}b({})}},[r,i,a]);const v=(t,m)=>{p(u=>({...u,[t]:m})),g[t]&&b(u=>({...u,[t]:null}))},w=t=>{p(m=>{const u=m.onDuty||[];return u.includes(t)?{...m,onDuty:u.filter(c=>c!==t)}:{...m,onDuty:[...u,t]}})},N=()=>{const t={};return j.date||(t.date="Date is required"),j.time||(t.time="Start time is required"),(!j.onDuty||j.onDuty.length===0)&&(t.onDuty="Select at least one member"),b(t),Object.keys(t).length===0},S=()=>{N()&&y(j)},D=o.useMemo(()=>{const t=new Set(d.map(c=>c.name)),m=[...d],u=typeof a=="object"?a?.name:a;return!i&&u&&!t.has(u)&&(m.push({id:"current-user",name:u,role:"Current",isActive:!0}),t.add(u)),i?.onDuty&&i.onDuty.forEach(c=>{t.has(c)||(m.push({id:c,name:c,role:"History",isActive:!1}),t.add(c))}),m},[d,i,a]);return{formData:j,errors:g,setField:v,toggleMember:w,handleSubmit:S,displayMembers:D}};function Qe({value:r=[],onChange:i,maxImages:a=10}){const[d,y]=o.useState(!1),[j,p]=o.useState(0),[g,b]=o.useState(""),[v,w]=o.useState({}),[N,S]=o.useState(!1),[D,t]=o.useState(0),m=o.useRef(null),u=o.useRef(null),c=o.useRef(!1),f=(r||[]).map((s,n)=>typeof s=="string"?{url:s,name:`Image ${n+1}`,id:`img-${n}`}:s),A=f.map(s=>s.url);o.useEffect(()=>{(!r||r.length===0)&&(w({}),b(""),p(0))},[r]),o.useEffect(()=>()=>{u.current&&clearInterval(u.current)},[]);const O=s=>{s&&(s.stopPropagation(),s.preventDefault()),c.current=!0,u.current&&(clearInterval(u.current),u.current=null),y(!1),p(0),b("Upload canceled"),m.current&&(m.current.value="")},F=async s=>{const n=s.target.files[0];if(n){if(!n.type.startsWith("image/")){b("Please select an image file only.");return}if(f.length>=a){b(`Maximum ${a} images allowed.`);return}b(""),y(!0),p(10),c.current=!1;try{u.current=setInterval(()=>{c.current||p(h=>h>=90?h:h+10)},300);const x=await Oe(n);if(u.current&&(clearInterval(u.current),u.current=null),c.current)return;if(x&&x.result==="success"&&x.url){p(100);const h={url:x.url,name:n.name,id:x.id||`img-${Date.now()}`};i([...f,h]),b("")}else throw new Error(x?.error||"Upload failed")}catch(x){if(u.current&&(clearInterval(u.current),u.current=null),c.current)return;console.error("Upload error:",x),b(x.message||"Drive upload failed. Check permissions.")}finally{c.current||y(!1),m.current&&(m.current.value="")}}},I=(s,n)=>{n?.stopPropagation();const x=f.filter((h,l)=>l!==s);i(x),w(h=>{const l={...h};return delete l[s],l})},H=s=>{w(n=>({...n,[s]:!0}))},L=(s,n)=>{n?.stopPropagation(),t(s),S(!0)},E=f.length<a;return e.jsxs("div",{className:"space-y-3",children:[f.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:f.map((s,n)=>e.jsxs("div",{className:"relative group rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 aspect-video bg-zinc-100 dark:bg-zinc-900 cursor-pointer hover:ring-2 hover:ring-[#0078D4]/50 transition-all",onClick:x=>L(n,x),children:[v[n]?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-400 gap-1",children:[e.jsx(Me,{size:24}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500",children:"Preview N/A"})]}):e.jsx("img",{src:He(s.url),alt:s.name||"Preview",className:"w-full h-full object-cover",referrerPolicy:"no-referrer",onError:()=>H(n)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx(We,{size:20,className:"text-white"})}),e.jsx("button",{type:"button",onClick:x=>I(n,x),className:"absolute top-1.5 right-1.5 p-1.5 bg-red-500 text-white rounded-md shadow-sm hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-all active:scale-95",title:"Remove Image",children:e.jsx(ne,{size:12,strokeWidth:2.5})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent pt-4 pb-1.5 px-2",children:e.jsx("span",{className:"text-[10px] font-bold text-white/90 truncate block",children:s.name||"Image"})})]},s.id||n))}),E&&e.jsxs("div",{onClick:()=>!d&&m.current?.click(),className:z("relative border border-dashed rounded-lg h-24 flex items-center justify-center transition-all group bg-zinc-50 dark:bg-zinc-900/50",d?"border-zinc-200 cursor-default":"border-zinc-300 dark:border-zinc-700 hover:border-[#0078D4] hover:bg-blue-50/50 dark:hover:bg-blue-900/10 cursor-pointer"),children:[d?e.jsxs("div",{className:"w-full px-6 flex flex-col gap-3 relative z-10",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#0078D4]",children:[e.jsx(Y,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold",children:"Syncing to Drive..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-semibold text-[#0078D4] tabular-nums",children:[j,"%"]}),e.jsx("button",{type:"button",onClick:O,className:"p-1.5 rounded-md bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/40 border border-transparent hover:border-red-200 dark:hover:border-red-800 transition-all shrink-0",title:"Cancel Upload",children:e.jsx(Le,{size:12,strokeWidth:2.5})})]})]}),e.jsx("div",{className:"h-1 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300",style:{width:`${j}%`}})})]}):e.jsx("div",{className:"flex flex-col items-center gap-2 text-zinc-500 group-hover:text-[#0078D4] transition-colors",children:f.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ce,{size:24,strokeWidth:1.5}),e.jsxs("span",{className:"text-xs font-semibold",children:["Add More (",f.length,"/",a,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:24,strokeWidth:1.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Click to Upload Images (Gallery)"})]})}),e.jsx("input",{type:"file",ref:m,onChange:F,className:"hidden",accept:"image/*"})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-rose-600 bg-rose-50 dark:bg-rose-950/20 px-3 py-2 rounded-md animate-in slide-in-from-top-1",children:[e.jsx(ie,{size:14}),e.jsx("span",{className:"text-xs font-semibold",children:g})]}),e.jsx(Te,{isOpen:N,onClose:()=>S(!1),imageUrl:A[D],allImages:A,initialIndex:D})]})}const k={sectionTitle:"flex items-center gap-2 text-xs font-bold text-[#0078D4] uppercase tracking-wider mb-4",label:"block text-[11px] font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",inputContainer:"relative transition-all group",input:"w-full h-10 bg-white dark:bg-zinc-900 border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 text-sm font-medium text-zinc-900 dark:text-white focus:ring-1 focus:ring-[#0078D4] focus:border-[#0078D4] outline-none transition-all placeholder:text-zinc-400",error:"text-[10px] font-semibold text-red-600 mt-1 flex items-center gap-1",btnOption:"flex-1 flex items-center justify-center gap-2 rounded-md text-[10px] font-bold uppercase transition-all",btnActive:"bg-white dark:bg-zinc-800 text-[#0078D4] shadow-sm border border-zinc-200 dark:border-zinc-700",btnInactive:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-200",memberCard:"relative flex flex-col items-center justify-center p-3 rounded-lg border transition-all duration-200 group"},de=o.memo(({onSubmit:r,initialData:i,isEditing:a,currentUser:d,saving:y=!1,onCancel:j})=>{const{team:p}=Ie(),{formData:g,errors:b,setField:v,toggleMember:w,handleSubmit:N,displayMembers:S}=Je(!0,i,d,p,r),D=t=>{v("images",t)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-[#121214] overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center bg-zinc-50/80 dark:bg-zinc-900/80 backdrop-blur-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold uppercase tracking-tight text-zinc-900 dark:text-white flex items-center gap-2",children:[a?e.jsx(ke,{size:20,className:"text-[#0078D4]"}):e.jsx(X,{size:20,className:"text-[#0078D4]"}),a?"Edit Shift Log":"New Handover"]}),e.jsx("p",{className:"text-xs font-medium text-zinc-500 mt-0.5",children:"Record details for the next shift team."})]}),a&&e.jsxs("div",{className:"px-3 py-1 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 text-[10px] font-bold uppercase tracking-wider border border-orange-100 dark:border-orange-900/30 flex items-center gap-1.5",children:[e.jsx(ie,{size:12})," Editing Mode"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(X,{size:14})," Shift Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:[e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:z(k.label,"truncate"),children:"Date"}),e.jsx(le,{date:g.date?K(g.date):void 0,setDate:t=>t&&v("date",oe(t)),placeholder:"Pick a date",className:z(k.input,b.date&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),b.date&&e.jsxs("p",{className:k.error,children:[e.jsx(U,{size:10})," ",b.date]})]}),e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:z(k.label,"truncate"),children:"Start Time"}),e.jsx(Ee,{value:g.time,onChange:t=>v("time",t.target.value),className:z(k.input,"text-center tracking-widest",b.time&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),b.time&&e.jsxs("p",{className:k.error,children:[e.jsx(U,{size:10})," ",b.time]})]}),e.jsxs("div",{className:z(k.inputContainer,"sm:col-span-2 lg:col-span-1"),children:[e.jsx("label",{className:z(k.label,"truncate"),children:"Period"}),e.jsx("div",{className:"flex rounded-lg bg-zinc-100 dark:bg-zinc-800/50 p-1 border border-zinc-200 dark:border-zinc-700 h-10 overflow-hidden",children:["Morning","Night"].map(t=>e.jsxs("button",{type:"button",onClick:()=>v("shift",t),className:z(k.btnOption,"min-w-0 overflow-hidden",g.shift===t?k.btnActive:k.btnInactive),children:[t==="Morning"?e.jsx(ze,{size:14,className:"shrink-0"}):e.jsx(ye,{size:14,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:t})]},t))})]})]})]}),e.jsx("hr",{className:"border-zinc-200 dark:border-zinc-800"}),e.jsxs("section",{children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(we,{size:14})," Personnel On Duty"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:S.map(t=>{const m=g.onDuty.includes(t.name);return e.jsxs("button",{type:"button",onClick:()=>w(t.name),className:z(k.memberCard,m?"bg-blue-50 dark:bg-blue-900/20 border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-[#0078D4] hover:shadow-sm"),children:[m&&e.jsx("div",{className:"absolute top-2 right-2 text-[#0078D4]",children:e.jsx(q,{size:14,fill:"currentColor",className:"text-white dark:text-blue-900"})}),e.jsx("div",{className:z("w-8 h-8 mb-2 rounded-full flex items-center justify-center text-xs font-bold transition-colors",m?"bg-[#0078D4] text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 group-hover:bg-zinc-200 dark:group-hover:bg-zinc-700"),children:t.name.charAt(0)}),e.jsx("span",{className:z("text-[10px] font-bold uppercase truncate w-full text-center",m?"text-[#0078D4]":"text-zinc-600"),children:t.name.split(" ")[0]})]},t.id)})}),b.onDuty&&e.jsxs("p",{className:k.error,children:[e.jsx(U,{size:10})," ",b.onDuty]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(Ne,{size:14})," Log Details"]}),e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:["Normal","Issues"].map(t=>e.jsxs("button",{type:"button",onClick:()=>v("status",t),className:z("px-3 py-1 rounded-md text-[10px] font-bold uppercase transition-all flex items-center gap-1.5",g.status===t?t==="Normal"?"bg-white dark:bg-zinc-800 text-emerald-600 shadow-sm":"bg-white dark:bg-zinc-800 text-red-500 shadow-sm":"text-zinc-400"),children:[g.status===t&&(t==="Normal"?e.jsx(q,{size:10}):e.jsx(U,{size:10})),t]},t))})]}),e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:k.label,children:"Handover Remarks / Incidents"}),e.jsx("textarea",{rows:6,value:g.note,onChange:t=>v("note",t.target.value),className:z(k.input,"h-auto py-3 resize-none leading-relaxed"),placeholder:"Enter handover details here..."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:k.label,children:"Attached Images"}),e.jsx(Qe,{value:g.images||[],onChange:D,maxImages:10})]})]}),e.jsx("div",{className:"h-10"})]}),e.jsxs("div",{className:"shrink-0 p-5 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 flex gap-3",children:[a&&e.jsx("button",{type:"button",onClick:j,disabled:y,className:"flex-1 py-2.5 rounded-lg border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 font-bold text-xs uppercase hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors disabled:opacity-50",children:"Cancel Edit"}),e.jsxs("button",{onClick:N,disabled:y,className:"flex-[2] py-2.5 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-lg font-bold text-xs uppercase shadow-sm flex items-center justify-center gap-2 hover:opacity-90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[y?e.jsx(Y,{size:16,className:"animate-spin"}):e.jsx(_e,{size:16}),a?"Update Handover":"Submit Handover"]})]})]})});de.displayName="ShiftHandoverForm";const ae=({label:r,isActive:i,onClick:a})=>e.jsx("button",{onClick:a,className:z("px-3 py-1.5 rounded-md text-xs font-bold uppercase tracking-wide transition-all border",i?"bg-[#dde7ee] text-[#0078D4] border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 text-zinc-600 border-zinc-200 dark:border-zinc-700 hover:border-[#0078D4] dark:hover:border-[#0078D4]"),children:r}),Xe=De.memo(({data:r,onClick:i,isSelected:a,onEdit:d,onDelete:y,onAcknowledge:j,currentUser:p})=>{const g=p&&(r.acknowledgedBy||[]).includes(p.name),b=Ae(p,[re.LEAD,re.ENGINEER])||p&&p.name===r.createdBy,v=r.status==="Issues",w=v?"issues":"normal";let N="--",S="",D="";try{if(r.date){const t=K(r.date);N=B(t,"dd"),S=B(t,"MMM"),D=B(t,"yyyy")}}catch(t){console.error("Date parse error",t)}return e.jsxs(Re,{variant:"interactive",selected:a,accent:a?"blue":w,showAccent:!1,size:"sm",onClick:i,className:z("group mb-2 mx-2 rounded-lg border transition-all duration-200",a?"bg-white dark:bg-zinc-900 border-[#0078D4] ring-1 ring-[#0078D4]/20 shadow-md z-10":"border-zinc-200 dark:border-zinc-800 hover:border-[#0078D4] hover:shadow-sm bg-white dark:bg-zinc-900"),children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0",children:[" ",e.jsx("div",{className:z("flex flex-col items-center justify-center w-10 h-10 rounded-md border shrink-0 transition-colors",v?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800 text-red-600":"bg-white dark:bg-zinc-800/50 border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-zinc-100"),children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-600 animate-pulse mb-1"}),e.jsx("span",{className:"text-[8px] font-bold uppercase text-red-600",children:"Alert"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base font-bold leading-none",children:N}),e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-500",children:S})]})}),e.jsxs("div",{className:"space-y-1 flex-1 min-w-0",children:[" ",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:z("px-1.5 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border",r.shift==="Morning"?"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-800":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-900/20 dark:text-slate-400 dark:border-slate-800"),children:r.shift}),!v&&e.jsxs("span",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-500 flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-600 dark:bg-emerald-500"}),"Normal"]})]}),e.jsx("p",{className:z("text-xs font-medium line-clamp-2 leading-relaxed break-words",a?"text-zinc-900 dark:text-zinc-100":"text-zinc-600 dark:text-zinc-400"),children:r.note||e.jsx("span",{className:"italic opacity-50",children:"No remarks provided."})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-zinc-50 dark:bg-zinc-800/80 pl-1 pr-2 py-0.5 rounded-full border border-zinc-200 dark:border-zinc-800",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-[8px] font-bold text-zinc-600",children:(r.createdBy||"?").charAt(0)}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-500 dark:text-zinc-400 truncate max-w-[80px]",children:r.createdBy?.split(" ")[0]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-mono text-zinc-400 dark:text-zinc-500 font-medium",children:[e.jsx(X,{size:10}),r.time]}),(r.acknowledgedBy||[]).length>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-emerald-50 dark:bg-emerald-900/20 rounded-full border border-emerald-100 dark:border-emerald-800",children:[e.jsx(q,{size:10,className:"text-emerald-600"}),e.jsx("span",{className:"text-[9px] font-bold text-emerald-600 dark:text-emerald-400",children:(r.acknowledgedBy||[]).length})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[p&&e.jsxs("button",{onClick:t=>{t.stopPropagation(),j&&j(r)},className:z("px-2 py-0.5 rounded text-[10px] font-bold uppercase flex items-center gap-1 transition-all border",g?"bg-emerald-50 text-emerald-600 border-emerald-200 hover:bg-emerald-100":"bg-white text-zinc-500 border-zinc-200 hover:bg-[#0078D4] hover:text-white hover:border-[#0078D4]"),title:g?"Acknowledged":"Acknowledge",children:[e.jsx(q,{size:10,className:g?"text-emerald-600":"fill-none"}),g?"Acked":"Ack"]}),e.jsxs("div",{className:z("flex items-center gap-1 transition-opacity",a?"opacity-100":"opacity-0 group-hover:opacity-100"),children:[b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),d(r)},className:"p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-[#0078D4] transition-colors",title:"Edit Log",children:e.jsx(Fe,{size:12})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),y(r)},className:"p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-red-600 transition-colors",title:"Delete Log",children:e.jsx(Be,{size:12})})]}),e.jsx(qe,{size:14,className:z("transition-transform text-zinc-300",a&&"text-[#0078D4] translate-x-1")})]})]})]})]})});function ft(){const{currentUser:r,nocMembers:i}=Q(),{filteredHistory:a,loading:d,saving:y,stats:j,filterDate:p,setFilterDate:g,filterShift:b,setFilterShift:v,filterStatus:w,setFilterStatus:N,searchText:S,setSearchText:D,clearFilters:t,handleSave:m,handleDelete:u,handleAcknowledge:c}=Ge(),[f,A]=o.useState(null),[O,F]=o.useState(!1),[I,H]=o.useState(null),L=o.useCallback(l=>{A(l)},[]),E=o.useCallback(()=>{A(null)},[]),s=async l=>{const C=!!f;await m(l,C,f?.id)&&!C&&E()},n=()=>{I&&(u(I.id,I.images),H(null),f?.id===I.id&&E())},x=o.useCallback(l=>e.jsx(Xe,{data:l,onClick:()=>L(l),isSelected:f?.id===l.id,onEdit:C=>L(C),onDelete:C=>H(C),onAcknowledge:C=>c(C,r?.name),currentUser:r},l.id),[f,r,L]),h=p||b!=="All"||w!=="All";return e.jsxs("div",{className:"flex flex-col md:flex-row h-[calc(100vh-64px)] bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsxs("div",{className:"w-full md:w-[350px] lg:w-[400px] xl:w-[450px] flex flex-col border-b md:border-b-0 md:border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#0a0a0a] z-10 shrink-0 h-[40%] md:h-full transition-all duration-300",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-semibold tracking-tight text-zinc-900 dark:text-white",children:"Shift Handovers"}),e.jsxs("p",{className:"text-[10px] font-medium text-zinc-500 uppercase tracking-wide",children:[j.total," Records Found"]})]}),e.jsx("button",{onClick:E,className:"w-7 h-7 rounded bg-[#0078D4] text-white flex items-center justify-center shadow-sm hover:bg-[#106EBE] transition-all",title:"New Handover",children:e.jsx(ce,{size:16})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Ue,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-[#0078D4] transition-colors"}),e.jsx("input",{type:"text",value:S,onChange:l=>D(l.target.value),placeholder:"Search logs...",className:"w-full h-8 pl-9 pr-3 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md text-xs font-normal focus:ring-1 focus:ring-[#0078D4] outline-none transition-all placeholder:text-zinc-400"})]}),e.jsx("button",{onClick:()=>F(!0),className:z("h-8 w-8 flex items-center justify-center rounded-md border transition-all",h?"bg-[#dde7ee] text-[#0078D4] border-[#0078D4]":"bg-white dark:bg-zinc-900 text-zinc-400 border-zinc-200 dark:border-zinc-800 hover:border-zinc-300"),children:e.jsx(se,{size:14})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative bg-white dark:bg-[#0a0a0a]",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 gap-3 text-zinc-400",children:[e.jsx(Y,{size:24,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-medium",children:"Syncing..."})]}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-6",children:[e.jsx("div",{className:"w-12 h-12 bg-zinc-50 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-3 text-zinc-300",children:e.jsx(se,{size:20})}),e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"No logs found"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-[200px]",children:"Try adjusting your filters or create a new handover."}),h&&e.jsx("button",{onClick:t,className:"mt-4 text-[10px] font-semibold text-[#0078D4] hover:underline",children:"Reset Filters"})]}):e.jsx($e,{items:a,itemHeight:140,renderItem:x,containerHeight:"100%"})})]}),e.jsx("div",{className:"flex-1 md:h-full h-auto overflow-hidden bg-white dark:bg-[#121214] relative flex flex-col",children:e.jsx(de,{onSubmit:s,initialData:f,isEditing:!!f,currentUser:r,saving:y,onCancel:E})}),e.jsx(Se,{isOpen:O,onClose:()=>F(!1),size:"sm",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900",children:"Filters"}),e.jsx("button",{onClick:()=>F(!1),children:e.jsx(ne,{size:18,className:"text-zinc-400"})})]}),footer:e.jsx("button",{onClick:()=>F(!1),className:"w-full py-3 bg-zinc-900 text-white rounded-lg text-xs font-bold uppercase",children:"Done"}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Date"}),e.jsx(le,{date:p?K(p):void 0,setDate:l=>g(l?oe(l):""),className:"w-full bg-zinc-50 border-zinc-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Shift"}),e.jsx("div",{className:"flex gap-2",children:["All","Morning","Night"].map(l=>e.jsx(ae,{label:l,isActive:b===l,onClick:()=>v(l)},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Status"}),e.jsx("div",{className:"flex gap-2",children:["All","Normal","Issues"].map(l=>e.jsx(ae,{label:l,isActive:w===l,onClick:()=>N(l)},l))})]})]})}),e.jsx(Ce,{isOpen:!!I,onClose:()=>H(null),onConfirm:n,title:"Delete Log",message:"Are you sure you want to remove this handover log? Associated images will also be deleted.",isDanger:!0})]})}export{ft as default};
