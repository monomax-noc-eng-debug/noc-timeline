const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FilterBar-CKf4JoHi.js","assets/index-DeB0UNQi.js","assets/index-B_3iS1_v.css","assets/configService-LpWpRo6h.js","assets/formatters-BaVPdGTo.js","assets/format-DGoV6LV2.js","assets/setYear-D3UzLEUF.js","assets/chevron-down-C0MtzhZK.js","assets/rotate-ccw-BIVUIMXV.js","assets/trash-2-I2HcWu5d.js"])))=>i.map(i=>d[i]);
import{e as ve,_ as ye,o as Ne,l as ee,i as U,t as J,q as oe,h as te,p as K,y as xe,k as ze,m as me,M as we,N as De,g as Se,x as Ce,b as se,O as Ae,a as Ee,r as n,j as e,X as Y,f as k,L as ce,C as he,P as Ie,T as V,S as re,Q as ae,D as pe,G as be,H as X,E as Me,F as Fe,K as Le}from"./index-DeB0UNQi.js";import{I as He,g as Pe,B as Oe,C as Te,a as Be,u as Re,b as $e,c as _e,S as Ue,d as qe,F as Ve,D as We,V as Ge}from"./FilterBar-CKf4JoHi.js";import{f as W}from"./format-DGoV6LV2.js";import{a as ne,D as fe,f as ge,T as Je,C as $}from"./formatters-BaVPdGTo.js";import{P as je,T as Ke}from"./trash-2-I2HcWu5d.js";import{p as Z}from"./setYear-D3UzLEUF.js";import{A as Qe}from"./activity-BTsV5vZ7.js";import{S as Xe}from"./save-C3fkMG-Q.js";import{F as Ye}from"./funnel-0qDYKk2D.js";import"./configService-LpWpRo6h.js";import"./chevron-down-C0MtzhZK.js";import"./rotate-ccw-BIVUIMXV.js";const Ze=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],et=ve("expand",Ze),q="shift_handovers",R={subscribeHandovers:(t,a=null,r=50)=>{const c=oe(te(U,q),K("date","desc"),K("createdAt","desc"),xe(r));return Ce(c,b=>{const u=b.docs.map(h=>({id:h.id,...h.data(),onDuty:h.data().onDuty||[],acknowledgedBy:h.data().acknowledgedBy||[]}));t(u)},b=>{console.error("Firestore subscription error:",b),a&&a(b),t([])})},createHandover:async t=>{try{const a={...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:t.acknowledgedBy||[],onDuty:t.onDuty||[]};return await Se(te(U,q),a)}catch(a){J(a)}},updateHandover:async(t,a)=>{try{const r={...a,updatedAt:new Date().toISOString()};await me(ee(U,q,t),r)}catch(r){J(r)}},toggleAcknowledge:async(t,a,r)=>{try{const c=ee(U,q,t);await me(c,{acknowledgedBy:r?we(a):De(a),updatedAt:new Date().toISOString()})}catch(c){J(c)}},createShift:t=>R.createHandover(t),getShifts:async(t=50)=>{try{const a=oe(te(U,q),K("date","desc"),K("createdAt","desc"),xe(t));return(await ze(a)).docs.map(c=>({id:c.id,...c.data()}))}catch(a){J(a)}},updateShift:(t,a)=>R.updateHandover(t,a),deleteShift:(t,a=[])=>R.deleteHandover(t,a),deleteHandover:async(t,a=[])=>{try{if(a&&a.length>0)try{const{deleteFileFromDrive:r}=await ye(async()=>{const{deleteFileFromDrive:c}=await import("./FilterBar-CKf4JoHi.js").then(b=>b.f);return{deleteFileFromDrive:c}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));await Promise.all(a.map(c=>r(c.id||c.url||c)))}catch(r){console.error("Error cleaning up images:",r)}await Ne(ee(U,q,t))}catch(r){J(r)}}},tt=()=>{const t=se(l=>l.currentUser),a=se(l=>l.nocMembers),{loading:r}=Ae(),{toast:c}=Ee(),[b,u]=n.useState([]),[h,N]=n.useState(!0),[m,D]=n.useState(null),[S,z]=n.useState(!1),[A,L]=n.useState(""),[s,p]=n.useState("All"),[o,C]=n.useState("All"),[F,v]=n.useState(""),g=n.useCallback((l,i="success")=>{c({description:l,variant:i==="error"?"destructive":"default"})},[c]);n.useEffect(()=>{if(r)return;if(!t){u([]),N(!1);return}const l=j=>{console.error("[useShiftLogic] Subscription error:",j),D(j.message||"Failed to load handover logs"),N(!1)},i=R.subscribeHandovers(j=>{u(j||[]),N(!1),D(null)},l);return()=>i?.()},[t,r]);const E=n.useMemo(()=>{if(!b.length)return[];const l=F.toLowerCase().trim();return b.filter(i=>{const j=(i.note||"").toLowerCase().includes(l),w=(i.onDuty||[]).some(de=>(de||"").toLowerCase().includes(l)),M=(i.status||"").toLowerCase().includes(l),O=!l||j||w||M,T=!A||i.date===A,d=s==="All"||i.shift===s,_=o==="All"||i.status===o;return O&&T&&d&&_})},[b,F,A,s,o]),H=n.useCallback(l=>{const i=Array.isArray(a)?a.length:0,j=(l.acknowledgedBy||[]).length,w=i>0?Math.round(j/i*100):0,M=i>0&&j>=i;return{total:i,acked:j,percentage:w,isComplete:M}},[a]),G=n.useMemo(()=>{const l=E.length,i=E.filter(w=>w.status!=="Normal").length,j=E.filter(w=>H(w).isComplete).length;return{total:l,withIssues:i,fullyAcked:j}},[E,H]),B=n.useCallback(async(l,i,j)=>{z(!0);try{return i?(await R.updateHandover(j,l),g("Log updated successfully")):(await R.createHandover(l),g("Log created successfully")),!0}catch(w){return console.error(w),g(w.message||"Save failed","error"),!1}finally{z(!1)}},[g]),P=n.useCallback(async l=>{try{await R.deleteHandover(l),g("Log deleted")}catch(i){console.error(i),g(i.message||"Delete failed","error")}},[g]),x=n.useCallback(async(l,i)=>{if(!t){g("Please login first!","error");return}const j=(l.acknowledgedBy||[]).includes(i);u(w=>w.map(M=>{if(M.id===l.id){const O=M.acknowledgedBy||[];return{...M,acknowledgedBy:j?O.filter(T=>T!==i):[...O,i]}}return M}));try{await R.toggleAcknowledge(l.id,i,j),g(j?"Acknowledgment removed":"Acknowledged âœ“")}catch(w){console.error(w),g(w.message||"Failed to update","error")}},[t,g]),f=n.useCallback(()=>{if(E.length===0){g("No data to export","error");return}try{const i=["Date,Time,Shift,Status,Team,Acknowledged,Note",...E.map(M=>{const O=new Date(M.date).toLocaleDateString("en-GB"),T=(M.note||"").replace(/"/g,'""'),d=(M.onDuty||[]).join("; "),_=(M.acknowledgedBy||[]).join("; ");return`"${O}","${M.time}","${M.shift}","${M.status}","${d}","${_}","${T}"`})].join(`
`),j=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a");w.href=URL.createObjectURL(j),w.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,w.click(),g("CSV exported successfully")}catch(l){console.error(l),g("Export failed","error")}},[E,g]),I=n.useCallback(()=>{L(""),p("All"),C("All"),v("")},[]);return{filteredHistory:E,loading:h,saving:S,error:m,stats:G,filterDate:A,setFilterDate:L,filterShift:s,setFilterShift:p,filterStatus:o,setFilterStatus:C,searchText:F,setSearchText:v,clearFilters:I,handleSave:B,handleDelete:P,handleAcknowledge:x,handleExportCSV:f,getAckStats:H}},st=(t,a,r,c,b)=>{const[u,h]=n.useState({date:"",time:"",shift:"Morning",onDuty:[],status:"Normal",note:""}),[N,m]=n.useState({});n.useEffect(()=>{{if(a)h({...a,onDuty:a.onDuty||[]});else{const s=new Date,p=typeof r=="object"?r?.name:r;h({date:W(s,"yyyy-MM-dd"),time:W(s,"HH:mm"),shift:s.getHours()>=8&&s.getHours()<20?"Morning":"Night",onDuty:p?[p]:[],status:"Normal",note:"",createdBy:p||""})}m({})}},[t,a,r]);const D=(s,p)=>{h(o=>({...o,[s]:p})),N[s]&&m(o=>({...o,[s]:null}))},S=s=>{h(p=>{const o=p.onDuty||[];return o.includes(s)?{...p,onDuty:o.filter(C=>C!==s)}:{...p,onDuty:[...o,s]}})},z=()=>{const s={};return u.date||(s.date="Date is required"),u.time||(s.time="Start time is required"),(!u.onDuty||u.onDuty.length===0)&&(s.onDuty="Select at least one member"),m(s),Object.keys(s).length===0},A=()=>{z()&&b(u)},L=n.useMemo(()=>{const s=new Set(c.map(C=>C.name)),p=[...c],o=typeof r=="object"?r?.name:r;return!a&&o&&!s.has(o)&&(p.push({id:"current-user",name:o,role:"Current",isActive:!0}),s.add(o)),a?.onDuty&&a.onDuty.forEach(C=>{s.has(C)||(p.push({id:C,name:C,role:"History",isActive:!1}),s.add(C))}),p},[c,a,r]);return{formData:u,errors:N,setField:D,toggleMember:S,handleSubmit:A,displayMembers:L}};function rt({value:t=[],onChange:a,maxImages:r=10}){const[c,b]=n.useState(!1),[u,h]=n.useState(0),[N,m]=n.useState(""),[D,S]=n.useState({}),[z,A]=n.useState(!1),[L,s]=n.useState(0),p=n.useRef(null),o=n.useRef(null),C=n.useRef(!1),F=(t||[]).map((x,f)=>typeof x=="string"?{url:x,name:`Image ${f+1}`,id:`img-${f}`}:x),v=F.map(x=>x.url);n.useEffect(()=>{(!t||t.length===0)&&(S({}),m(""),h(0))},[t]),n.useEffect(()=>()=>{o.current&&clearInterval(o.current)},[]);const g=x=>{x&&(x.stopPropagation(),x.preventDefault()),C.current=!0,o.current&&(clearInterval(o.current),o.current=null),b(!1),h(0),m("Upload canceled"),p.current&&(p.current.value="")},E=async x=>{const f=x.target.files[0];if(f){if(!f.type.startsWith("image/")){m("Please select an image file only.");return}if(F.length>=r){m(`Maximum ${r} images allowed.`);return}m(""),b(!0),h(10),C.current=!1;try{o.current=setInterval(()=>{C.current||h(l=>l>=90?l:l+10)},300);const I=await Re(f);if(o.current&&(clearInterval(o.current),o.current=null),C.current)return;if(I&&I.result==="success"&&I.url){h(100);const l={url:I.url,name:f.name,id:I.id||`img-${Date.now()}`};a([...F,l]),m("")}else throw new Error(I?.error||"Upload failed")}catch(I){if(o.current&&(clearInterval(o.current),o.current=null),C.current)return;console.error("Upload error:",I),m(I.message||"Drive upload failed. Check permissions.")}finally{C.current||b(!1),p.current&&(p.current.value="")}}},H=(x,f)=>{f?.stopPropagation();const I=F.filter((l,i)=>i!==x);a(I),S(l=>{const i={...l};return delete i[x],i})},G=x=>{S(f=>({...f,[x]:!0}))},B=(x,f)=>{f?.stopPropagation(),s(x),A(!0)},P=F.length<r;return e.jsxs("div",{className:"space-y-3",children:[F.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:F.map((x,f)=>e.jsxs("div",{className:"relative group rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 aspect-video bg-zinc-100 dark:bg-zinc-900 cursor-pointer hover:ring-2 hover:ring-[#0078D4]/50 transition-all",onClick:I=>B(f,I),children:[D[f]?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-400 gap-1",children:[e.jsx(He,{size:24}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500",children:"Preview N/A"})]}):e.jsx("img",{src:Pe(x.url),alt:x.name||"Preview",className:"w-full h-full object-cover",referrerPolicy:"no-referrer",onError:()=>G(f)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx(et,{size:20,className:"text-white"})}),e.jsx("button",{type:"button",onClick:I=>H(f,I),className:"absolute top-1.5 right-1.5 p-1.5 bg-red-500 text-white rounded-md shadow-sm hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-all active:scale-95",title:"Remove Image",children:e.jsx(Y,{size:12,strokeWidth:2.5})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent pt-4 pb-1.5 px-2",children:e.jsx("span",{className:"text-[10px] font-bold text-white/90 truncate block",children:x.name||"Image"})})]},x.id||f))}),P&&e.jsxs("div",{onClick:()=>!c&&p.current?.click(),className:k("relative border border-dashed rounded-lg h-24 flex items-center justify-center transition-all group bg-zinc-50 dark:bg-zinc-900/50",c?"border-zinc-200 cursor-default":"border-zinc-300 dark:border-zinc-700 hover:border-[#0078D4] hover:bg-blue-50/50 dark:hover:bg-blue-900/10 cursor-pointer"),children:[c?e.jsxs("div",{className:"w-full px-6 flex flex-col gap-3 relative z-10",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#0078D4]",children:[e.jsx(ce,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-semibold",children:"Syncing to Drive..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-semibold text-[#0078D4] tabular-nums",children:[u,"%"]}),e.jsx("button",{type:"button",onClick:g,className:"p-1.5 rounded-md bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/40 border border-transparent hover:border-red-200 dark:hover:border-red-800 transition-all shrink-0",title:"Cancel Upload",children:e.jsx(Oe,{size:12,strokeWidth:2.5})})]})]}),e.jsx("div",{className:"h-1 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300",style:{width:`${u}%`}})})]}):e.jsx("div",{className:"flex flex-col items-center gap-2 text-zinc-500 group-hover:text-[#0078D4] transition-colors",children:F.length>0?e.jsxs(e.Fragment,{children:[e.jsx(je,{size:24,strokeWidth:1.5}),e.jsxs("span",{className:"text-xs font-semibold",children:["Add More (",F.length,"/",r,")"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{size:24,strokeWidth:1.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Click to Upload Images (Gallery)"})]})}),e.jsx("input",{type:"file",ref:p,onChange:E,className:"hidden",accept:"image/*"})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-rose-600 bg-rose-50 dark:bg-rose-950/20 px-3 py-2 rounded-md animate-in slide-in-from-top-1",children:[e.jsx(he,{size:14}),e.jsx("span",{className:"text-xs font-semibold",children:N})]}),e.jsx(Be,{isOpen:z,onClose:()=>A(!1),imageUrl:v[L],allImages:v,initialIndex:L})]})}const y={sectionTitle:"flex items-center gap-2 text-xs font-bold text-[#0078D4] uppercase tracking-wider mb-4",label:"block text-[11px] font-semibold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",inputContainer:"relative transition-all group",input:"w-full h-10 bg-white dark:bg-zinc-900 border border-zinc-300 dark:border-zinc-700 rounded-lg px-3 text-sm font-medium text-zinc-900 dark:text-white focus:ring-1 focus:ring-[#0078D4] focus:border-[#0078D4] outline-none transition-all placeholder:text-zinc-400",error:"text-[10px] font-semibold text-red-600 mt-1 flex items-center gap-1",btnOption:"flex-1 flex items-center justify-center gap-2 rounded-md text-[10px] font-bold uppercase transition-all",btnActive:"bg-white dark:bg-zinc-800 text-[#0078D4] shadow-sm border border-zinc-200 dark:border-zinc-700",btnInactive:"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-200",memberCard:"relative flex flex-col items-center justify-center p-3 rounded-lg border transition-all duration-200 group"},ie=n.memo(({onSubmit:t,initialData:a,isEditing:r,currentUser:c,saving:b=!1,onCancel:u})=>{const{team:h}=$e(),{ticketOptions:N}=_e(),{formData:m,errors:D,setField:S,toggleMember:z,handleSubmit:A}=st(!0,a,c,h,t),L=s=>{S("images",s)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900 overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 px-4 sm:px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex flex-wrap justify-between items-center gap-3 bg-zinc-50/80 dark:bg-zinc-900/80 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold uppercase tracking-tight text-zinc-900 dark:text-white flex items-center gap-2",children:[r?e.jsx(Ie,{size:20,className:"text-[#0078D4] shrink-0"}):e.jsx(ne,{size:20,className:"text-[#0078D4] shrink-0"}),e.jsx("span",{className:"truncate",children:r?"Edit Shift Log":"New Handover"})]}),e.jsx("p",{className:"text-xs font-medium text-zinc-500 mt-0.5 truncate",children:"Record details for the next shift team."})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[r&&e.jsxs("div",{className:"px-2 sm:px-3 py-1 rounded-full bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 text-[9px] sm:text-[10px] font-bold uppercase tracking-wider border border-orange-100 dark:border-orange-900/30 flex items-center gap-1.5",children:[e.jsx(he,{size:12})," ",e.jsx("span",{className:"hidden sm:inline",children:"Editing"})]}),u&&e.jsx("button",{type:"button",onClick:u,className:"h-8 w-8 flex items-center justify-center rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-500 hover:text-zinc-900 transition-colors",title:"Close",children:e.jsx(Y,{size:18})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(ne,{size:14})," Shift Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5",children:[e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:k(y.label,"truncate"),children:"Date"}),e.jsx(fe,{date:m.date?Z(m.date):void 0,setDate:s=>s&&S("date",ge(s)),placeholder:"Pick a date",className:k(y.input,D.date&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),D.date&&e.jsxs("p",{className:y.error,children:[e.jsx(V,{size:10})," ",D.date]})]}),e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:k(y.label,"truncate"),children:"Start Time"}),e.jsx(Je,{value:m.time,onChange:s=>S("time",s.target.value),className:k(y.input,"text-center tracking-widest",D.time&&"border-red-500 bg-red-50 dark:bg-red-950/20")}),D.time&&e.jsxs("p",{className:y.error,children:[e.jsx(V,{size:10})," ",D.time]})]}),e.jsxs("div",{className:k(y.inputContainer,"sm:col-span-2 lg:col-span-1"),children:[e.jsx("label",{className:k(y.label,"truncate"),children:"Period"}),e.jsx("div",{className:"flex rounded-lg bg-zinc-100 dark:bg-zinc-800/50 p-1 border border-zinc-200 dark:border-zinc-700 h-10 overflow-hidden",children:["Morning","Night"].map(s=>e.jsxs("button",{type:"button",onClick:()=>S("shift",s),className:k(y.btnOption,"min-w-0 overflow-hidden",m.shift===s?y.btnActive:y.btnInactive),children:[s==="Morning"?e.jsx(re,{size:14,className:"shrink-0"}):e.jsx(ae,{size:14,className:"shrink-0"}),e.jsx("span",{className:"truncate",children:s})]},s))})]})]})]}),e.jsx("hr",{className:"border-zinc-200 dark:border-zinc-800"}),e.jsxs("section",{children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(pe,{size:14})," Responsibility"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:N.responsibilities?.map(s=>{const p=m.onDuty.includes(s);return e.jsxs("button",{type:"button",onClick:()=>z(s),className:k(y.memberCard,p?"bg-blue-50 dark:bg-blue-900/20 border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-[#0078D4] hover:shadow-sm"),children:[p&&e.jsx("div",{className:"absolute top-2 right-2 text-[#0078D4]",children:e.jsx($,{size:14,fill:"currentColor",className:"text-white dark:text-blue-900"})}),e.jsx("div",{className:k("w-8 h-8 mb-2 rounded-full flex items-center justify-center text-xs font-bold transition-colors",p?"bg-[#0078D4] text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 group-hover:bg-zinc-200 dark:group-hover:bg-zinc-700"),children:s.charAt(0)}),e.jsx("span",{className:k("text-[10px] font-bold uppercase truncate w-full text-center",p?"text-[#0078D4]":"text-zinc-600"),children:s})]},s)})}),D.onDuty&&e.jsxs("p",{className:y.error,children:[e.jsx(V,{size:10})," ",D.onDuty]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:y.sectionTitle,children:[e.jsx(Qe,{size:14})," Log Details"]}),e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:["Normal","Issues"].map(s=>e.jsxs("button",{type:"button",onClick:()=>S("status",s),className:k("px-3 py-1 rounded-md text-[10px] font-bold uppercase transition-all flex items-center gap-1.5",m.status===s?s==="Normal"?"bg-white dark:bg-zinc-800 text-emerald-600 shadow-sm":"bg-white dark:bg-zinc-800 text-red-500 shadow-sm":"text-zinc-400"),children:[m.status===s&&(s==="Normal"?e.jsx($,{size:10}):e.jsx(V,{size:10})),s]},s))})]}),e.jsxs("div",{className:y.inputContainer,children:[e.jsx("label",{className:y.label,children:"Handover Remarks / Incidents"}),e.jsx("textarea",{rows:6,value:m.note,onChange:s=>S("note",s.target.value),className:k(y.input,"h-auto py-3 resize-none leading-relaxed"),placeholder:"Enter handover details here..."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:y.label,children:"Attached Images"}),e.jsx(rt,{value:m.images||[],onChange:L,maxImages:10})]})]}),e.jsx("div",{className:"h-10"})]}),e.jsxs("div",{className:"shrink-0 p-5 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 flex gap-3",children:[r&&e.jsx("button",{type:"button",onClick:u,disabled:b,className:"flex-1 py-2.5 rounded-lg border border-zinc-300 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 font-bold text-xs uppercase hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors disabled:opacity-50",children:"Cancel Edit"}),e.jsxs("button",{onClick:A,disabled:b,className:"flex-[2] py-2.5 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-lg font-bold text-xs uppercase shadow-sm flex items-center justify-center gap-2 hover:opacity-90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[b?e.jsx(ce,{size:16,className:"animate-spin"}):e.jsx(Xe,{size:16}),r?"Update Handover":"Submit Handover"]})]})]})});ie.displayName="ShiftHandoverForm";const Q=({label:t,value:a,icon:r,className:c})=>e.jsxs("div",{className:k("space-y-1",c),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-zinc-500 uppercase tracking-wide",children:[r&&e.jsx(r,{size:12,className:"text-[#0078D4]"}),t]}),e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 break-words",children:a||"-"})]}),le=n.memo(({log:t,onClose:a,onEdit:r,onDelete:c,onAcknowledge:b,currentUser:u})=>{if(!t)return null;const h=t.status==="Issues",N=u&&(t.acknowledgedBy||[]).includes(u.name),m=be(u,[X.LEAD,X.ENGINEER])||u&&u.name===t.createdBy;let D=t.date,S="";try{const z=Z(t.date);D=W(z,"MMMM d, yyyy"),S=W(z,"EEEE")}catch{}return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900 overflow-hidden relative",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:a,className:"lg:hidden p-2 -ml-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full",children:e.jsx(Y,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:k("flex items-center gap-1.5 px-2 sm:px-2.5 py-1 rounded-md text-[10px] sm:text-xs font-bold border uppercase tracking-wider",t.shift==="Morning"?"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400 dark:border-amber-800":"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800"),children:[t.shift==="Morning"?e.jsx(re,{size:12,strokeWidth:2.5}):e.jsx(ae,{size:12,strokeWidth:2.5}),t.shift]}),e.jsx("span",{className:"hidden sm:inline text-zinc-300",children:"â€¢"}),e.jsx("span",{className:"text-xs sm:text-sm text-zinc-500 dark:text-zinc-400 font-medium",children:D})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[m&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(t),className:"p-1.5 sm:p-2 text-zinc-500 hover:text-[#0078D4] hover:bg-[#0078D4]/5 rounded-lg transition-colors",title:"Edit",children:e.jsx(Ue,{size:16})}),e.jsx("button",{onClick:()=>c(t),className:"p-1.5 sm:p-2 text-zinc-500 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(Ke,{size:16})})]}),e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-700 mx-1 sm:mx-2"}),e.jsxs("button",{onClick:()=>b&&b(t,u?.name),className:k("flex items-center gap-1 sm:gap-1.5 px-2 sm:px-3 py-1.5 text-[10px] sm:text-xs font-bold uppercase tracking-wide rounded-md transition-all shadow-sm border",N?"bg-emerald-50 text-emerald-600 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800":"bg-zinc-900 text-white border-zinc-900 hover:bg-zinc-800 dark:bg-white dark:text-black dark:border-white active:scale-95"),children:[e.jsx($,{size:14,className:N?"fill-emerald-600 text-white":""}),e.jsx("span",{className:"hidden sm:inline",children:N?"Acknowledged":"Acknowledge"}),e.jsx("span",{className:"sm:hidden",children:N?"Acked":"Ack"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:h?e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-[10px] font-bold uppercase text-rose-600 bg-rose-50 dark:bg-rose-500/10 px-2 py-0.5 rounded border border-rose-100 dark:border-rose-500/20",children:[e.jsx(V,{size:10})," Issues Reported"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-[10px] font-bold uppercase text-emerald-600 bg-emerald-50 dark:bg-emerald-500/10 px-2 py-0.5 rounded border border-emerald-100 dark:border-emerald-500/20",children:[e.jsx($,{size:10})," Normal"]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0 w-10 h-10 rounded-full bg-zinc-100 dark:bg-zinc-800 border-2 border-white dark:border-zinc-900 shadow-sm flex items-center justify-center overflow-hidden",children:e.jsx("span",{className:"text-sm font-black text-zinc-500",children:t.createdBy?t.createdBy.charAt(0).toUpperCase():"?"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold text-zinc-900 dark:text-white leading-tight",children:["Handover by ",t.createdBy]}),e.jsxs("p",{className:"text-xs text-zinc-500 dark:text-zinc-400 mt-0.5 flex items-center gap-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{size:12})," ",t.time]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"font-mono",children:S})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8 bg-zinc-50/50 dark:bg-zinc-950",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pb-6 border-b border-zinc-200 dark:border-zinc-800/50",children:[e.jsx(Q,{label:"Shift Type",value:t.shift,icon:t.shift==="Morning"?re:ae}),e.jsx(Q,{label:"Duty Count",value:`${(t.onDuty||[]).length} Person(s)`,icon:pe}),e.jsx(Q,{label:"Ack Count",value:`${(t.acknowledgedBy||[]).length} / ${(t.onDuty||[]).length||"-"}`,icon:$}),e.jsx(Q,{label:"Status",value:t.status,icon:h?V:$,className:h?"text-rose-600":"text-emerald-600"})]}),(t.onDuty||[]).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider flex items-center gap-2",children:"Personnel On Duty"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.onDuty||[]).map((z,A)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0078D4]/10 text-[#0078D4] flex items-center justify-center text-[10px] font-bold",children:z.charAt(0)}),e.jsx("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:z})]},A))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider",children:"Handover Note"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none bg-white dark:bg-zinc-800/40 p-5 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-sm",children:e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed text-zinc-700 dark:text-zinc-300",children:t.note||e.jsx("span",{className:"italic text-zinc-400",children:"No content provided."})})})]}),(t.images||[]).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-400 uppercase tracking-wider",children:"Attachments"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:(t.images||[]).map((z,A)=>e.jsxs("div",{className:"group relative aspect-video bg-zinc-100 dark:bg-zinc-800 rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-700",children:[e.jsx("img",{src:z,alt:"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsx("a",{href:z,target:"_blank",className:"absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/30 transition-colors",children:e.jsx(qe,{className:"text-white opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all"})})]},A))})]}),(t.acknowledgedBy||[]).length>0&&e.jsxs("div",{className:"pt-6 border-t border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1 rounded bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600",children:e.jsx($,{size:12})}),e.jsx("span",{className:"text-xs font-bold text-zinc-500 uppercase",children:"Acknowledged by"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.acknowledgedBy||[]).map((z,A)=>e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded bg-emerald-50 dark:bg-emerald-900/10 text-emerald-700 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-900/20",children:z},A))})]})]})]})});le.displayName="ShiftDetailPanel";const ue=({label:t,isActive:a,onClick:r})=>e.jsx("button",{onClick:r,className:k("px-3 py-1.5 rounded-md text-xs font-bold uppercase tracking-wide transition-all border",a?"bg-[#dde7ee] text-[#0078D4] border-[#0078D4] shadow-sm":"bg-white dark:bg-zinc-900 text-zinc-600 border-zinc-200 dark:border-zinc-700 hover:border-[#0078D4] dark:hover:border-[#0078D4]"),children:t}),ke=Me.memo(({data:t,onClick:a,isSelected:r,currentUser:c})=>{const b=t.status==="Issues",u=c&&(t.acknowledgedBy||[]).includes(c.name);let h="--",N="";try{if(t.date){const m=Z(t.date);h=W(m,"dd"),N=W(m,"MMM")}}catch{}return e.jsx("div",{onClick:a,className:k("group cursor-pointer px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 transition-all",r?"bg-[#0078D4]/5 border-l-2 border-l-[#0078D4]":"hover:bg-zinc-50 dark:hover:bg-zinc-900 border-l-2 border-l-transparent"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:k("flex flex-col items-center justify-center w-10 h-10 rounded-md border shrink-0 transition-colors",b?"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800 text-red-600":"bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300"),children:[e.jsx("span",{className:"text-sm font-bold leading-none",children:h}),e.jsx("span",{className:"text-[8px] font-bold uppercase text-zinc-500",children:N})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-900 dark:text-zinc-100 truncate",children:t.createdBy||"Unknown"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400",children:t.time})]}),e.jsx("p",{className:k("text-xs line-clamp-2 leading-relaxed",r?"text-zinc-800 dark:text-zinc-200":"text-zinc-500 dark:text-zinc-400"),children:t.note||e.jsx("span",{className:"italic opacity-50",children:"No remarks"})}),e.jsxs("div",{className:"flex items-center gap-2 pt-1 flex-wrap",children:[e.jsx("span",{className:k("px-1.5 py-0.5 rounded text-[9px] font-bold uppercase border",t.shift==="Morning"?"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/20 dark:text-amber-400":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-900/20 dark:text-slate-400"),children:t.shift}),b?e.jsxs("span",{className:"text-[9px] font-bold text-red-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"}),"Issues"]}):e.jsxs("span",{className:"text-[9px] font-bold text-emerald-600 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),"Normal"]}),u&&e.jsx("span",{className:"text-[9px] font-bold text-[#0078D4]",children:"âœ“ Acked"}),t.onDuty&&t.onDuty.length>0&&e.jsxs("span",{className:"text-[9px] font-medium text-zinc-500 dark:text-zinc-400 truncate max-w-[150px]",title:t.onDuty.join(", "),children:["ðŸ‘¥ ",t.onDuty.slice(0,2).join(", "),t.onDuty.length>2?` +${t.onDuty.length-2}`:""]})]})]})]})})});ke.displayName="ShiftListItem";function bt(){const{currentUser:t}=se(),a=be(t,[X.LEAD,X.ENGINEER]),{filteredHistory:r,loading:c,saving:b,stats:u,filterDate:h,setFilterDate:N,filterShift:m,setFilterShift:D,filterStatus:S,setFilterStatus:z,searchText:A,setSearchText:L,clearFilters:s,handleSave:p,handleDelete:o,handleExportCSV:C,handleAcknowledge:F}=tt(),[v,g]=n.useState(null),[E,H]=n.useState("view"),[G,B]=n.useState(!1),[P,x]=n.useState(null),f=n.useCallback(d=>{g(d),H("view")},[]);n.useEffect(()=>{if(v){const d=r.find(_=>_.id===v.id);d&&JSON.stringify(d)!==JSON.stringify(v)&&g(d)}},[r,v]);const I=n.useCallback(()=>{g(null),H("create")},[]),l=n.useCallback(d=>{g(d),H("edit")},[]),i=n.useCallback(()=>{g(null),H("view")},[]),j=async d=>{await p(d,E==="edit"&&v,v?.id)&&i()},w=()=>{P&&(o(P.id,P.images),x(null),v?.id===P.id&&i())},M=n.useCallback(d=>e.jsx(ke,{data:d,onClick:()=>f(d),isSelected:v?.id===d.id,currentUser:t},d.id),[v,t,f]),O=h||m!=="All"||S!=="All",T=v!==null||E==="create";return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx(Ve,{title:"Shift Handovers",icon:null,searchTerm:A,onSearch:L,actions:[{label:"New",icon:je,onClick:I,variant:"primary",disabled:!a,hideTextOnMobile:!0},{label:"Export",icon:We,onClick:C,variant:"secondary",hideTextOnMobile:!0}],isFilterActive:O,onFilterClick:()=>B(!0)}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:k("flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all",T?"hidden lg:flex lg:w-[350px] xl:w-[400px]":"w-full lg:w-[350px] xl:w-[400px]"),children:[e.jsxs("div",{className:"shrink-0 px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-zinc-500",children:[u.total," records"]}),O&&e.jsx("button",{onClick:s,className:"text-[10px] font-semibold text-[#0078D4] hover:underline",children:"Clear Filters"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 gap-3 text-zinc-400",children:[e.jsx(ce,{size:24,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-medium",children:"Syncing..."})]}):r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-6",children:[e.jsx("div",{className:"w-12 h-12 bg-zinc-50 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-3 text-zinc-300",children:e.jsx(Ye,{size:20})}),e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"No logs found"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-[200px]",children:"Try adjusting your filters or create a new handover."})]}):e.jsx(Ge,{items:r,itemHeight:100,renderItem:M,containerHeight:"100%"})})]}),e.jsx("div",{className:k("flex-1 flex-col overflow-hidden bg-white dark:bg-zinc-900 transition-all hidden lg:flex",!T&&"lg:items-center lg:justify-center"),children:E==="view"&&v?e.jsx(le,{log:v,onClose:i,onEdit:l,onDelete:d=>x(d),onAcknowledge:F,currentUser:t}):E==="create"||E==="edit"?e.jsx(ie,{onSubmit:j,initialData:v,isEditing:E==="edit",currentUser:t,saving:b,onCancel:i}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-zinc-300 dark:text-zinc-700",children:[e.jsx("p",{className:"text-sm font-medium",children:"Select a log to view details"}),e.jsx("p",{className:"text-xs mt-1",children:"or create a new handover"})]})})]}),T&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsx("div",{className:"w-full max-h-[90vh] bg-white dark:bg-zinc-900 rounded-t-2xl overflow-y-auto animate-in slide-in-from-bottom duration-300",children:E==="view"&&v?e.jsx(le,{log:v,onClose:i,onEdit:l,onDelete:d=>x(d),onAcknowledge:F,currentUser:t}):e.jsx(ie,{onSubmit:j,initialData:v,isEditing:E==="edit",currentUser:t,saving:b,onCancel:i})})}),e.jsx(Fe,{isOpen:G,onClose:()=>B(!1),size:"sm",header:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-sm font-medium text-zinc-900",children:"Filters"}),e.jsx("button",{onClick:()=>B(!1),children:e.jsx(Y,{size:18,className:"text-zinc-400"})})]}),footer:e.jsx("button",{onClick:()=>B(!1),className:"w-full py-3 bg-zinc-900 text-white rounded-lg text-xs font-bold uppercase",children:"Done"}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Date"}),e.jsx(fe,{date:h?Z(h):void 0,setDate:d=>N(d?ge(d):""),className:"w-full bg-zinc-50 border-zinc-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Shift"}),e.jsx("div",{className:"flex gap-2",children:["All","Morning","Night"].map(d=>e.jsx(ue,{label:d,isActive:m===d,onClick:()=>D(d)},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2 block",children:"Status"}),e.jsx("div",{className:"flex gap-2",children:["All","Normal","Issues"].map(d=>e.jsx(ue,{label:d,isActive:S===d,onClick:()=>z(d)},d))})]})]})}),e.jsx(Le,{isOpen:!!P,onClose:()=>x(null),onConfirm:w,title:"Delete Log",message:"Are you sure you want to remove this handover log? Associated images will also be deleted.",isDanger:!0})]})}export{bt as default};
