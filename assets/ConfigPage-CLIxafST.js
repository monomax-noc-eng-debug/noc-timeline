import{e as F,r,u as H,a as _,b as I,G as M,j as e,L as U,B as K,f as A,D as R,E as V,T as $,H as q}from"./index-DeB0UNQi.js";import{c as D}from"./configService-LpWpRo6h.js";import{A as Q}from"./arrow-left-BnDC8UDn.js";import{S as W}from"./save-C3fkMG-Q.js";import{T as B,a as J,L as X}from"./tv-BEUoDe-D.js";import{T as G,C as Y}from"./tag-BOCUZuXy.js";import{G as Z}from"./globe-Cuqv8OAl.js";import{L as ee}from"./layers-CqHJUMeP.js";import{S as se,P as te,T as ie}from"./trash-2-I2HcWu5d.js";const ne=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}]],ae=F("layout-panel-top",ne),re=()=>{const[m,L]=r.useState(!0),[O,c]=r.useState(null),[l,n]=r.useState({leagues:[],channels:[],cdnOptions:[],ticketSync:{autoSync:!1,syncTime:"08:00",lastSync:null}}),[u,z]=r.useState({types:[],statuses:[],severities:[],categories:[],subCategories:[]}),[h,k]=r.useState([]),[y,j]=r.useState([]);return r.useEffect(()=>{const g=d=>{console.error("[useConfigs] Subscription error:",d),c(d.message||"Failed to load configuration")},w=D.subscribeConfigs(d=>{n(i=>({...i,...d}))},g),o=D.subscribeTicketOptions(z,g),C=D.subscribeTeam(k,g),a=D.subscribeProjects(j,g);return setTimeout(()=>L(!1),0),()=>{w(),o(),C(),a()}},[]),{configs:l,setConfigs:n,ticketOptions:u,setTicketOptions:z,team:h,setTeam:k,projects:y,setProjects:j,loading:m,error:O}},b=r.memo(({items:m=[],onAdd:L,onRemove:O,onUpdate:c,canEdit:l,title:n,icon:u,placeholder:z="Search or Add..."})=>{const[h,k]=r.useState(""),[y,j]=r.useState(null),[g,w]=r.useState(""),{toast:o}=_(),C=r.useMemo(()=>{if(!h)return m.map((s,x)=>({item:s,idx:x}));const i=h.toLowerCase();return m.map((s,x)=>({item:s,idx:x})).filter(({item:s})=>(typeof s=="string"?s:s.label).toLowerCase().includes(i))},[m,h]),a=()=>{const i=h.trim();if(i){if(m.some(s=>(typeof s=="string"?s:s.label).toLowerCase()===i.toLowerCase())){o({variant:"destructive",title:"Duplicate",description:`"${i}" already exists.`});return}L(i),k("")}},d=i=>{const s=g.trim();if(s&&s!==m[i]){if(m.some((x,f)=>f!==i&&(typeof x=="string"?x:x.label).toLowerCase()===s.toLowerCase())){o({variant:"destructive",title:"Duplicate",description:`"${s}" already exists.`});return}c(i,s)}j(null)};return e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"shrink-0 p-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-2 bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 rounded-lg shadow-sm",children:e.jsx(u,{size:16,className:"text-zinc-600 dark:text-zinc-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 uppercase tracking-wide",children:n}),e.jsxs("p",{className:"text-[10px] font-medium text-zinc-400",children:[m.length," Records"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(se,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-[#0078D4] transition-colors"}),e.jsx("input",{value:h,onChange:i=>k(i.target.value),onKeyDown:i=>i.key==="Enter"&&l&&a(),placeholder:z,className:"w-full bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md pl-9 pr-3 py-2 text-xs font-medium outline-none focus:border-[#0078D4] focus:ring-1 focus:ring-[#0078D4] transition-all placeholder:font-medium"})]}),l&&e.jsx("button",{onClick:a,disabled:!h.trim(),className:"px-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-md hover:bg-zinc-800 dark:hover:bg-zinc-200 disabled:opacity-50 transition-colors",children:e.jsx(te,{size:16})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:C.length>0?C.map(({item:i,idx:s})=>{const x=y===s,f=typeof i=="string"?i:i.label;return e.jsxs("div",{className:"group flex items-center justify-between px-3 py-2 rounded-md hover:bg-zinc-50 dark:hover:bg-zinc-800/50 border border-transparent hover:border-zinc-100 dark:hover:border-zinc-800 transition-all",children:[x?e.jsx("input",{autoFocus:!0,value:g,onChange:t=>w(t.target.value),onBlur:()=>d(s),onKeyDown:t=>{t.key==="Enter"&&d(s),t.key==="Escape"&&j(null)},className:"flex-1 bg-transparent text-xs font-semibold text-[#0078D4] dark:text-[#0078D4] outline-none"}):e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-[10px] font-mono text-zinc-300 dark:text-zinc-600 w-6 shrink-0",children:String(s+1).padStart(2,"0")}),e.jsx("span",{onClick:()=>{l&&(j(s),w(f))},className:A("text-xs font-medium truncate cursor-pointer select-none text-zinc-600 dark:text-zinc-300",l&&"hover:text-[#0078D4] dark:hover:text-[#0078D4]"),children:f})]}),l&&!x&&e.jsx("button",{onClick:()=>O(s),className:"opacity-0 group-hover:opacity-100 p-1.5 text-zinc-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-all",children:e.jsx(ie,{size:12})})]},s)}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-300 dark:text-zinc-700 opacity-60",children:[e.jsx(X,{size:32,strokeWidth:1,className:"mb-2"}),e.jsx("span",{className:"text-xs font-medium",children:"No items found"})]})})]})});function fe(){const m=H(),{toast:L}=_(),{currentUser:O}=I(),{configs:c,setConfigs:l,ticketOptions:n,setTicketOptions:u,projects:z,setProjects:h,loading:k}=re(),[y,j]=r.useState(!1),[g,w]=r.useState(!1),[o,C]=r.useState("broadcast"),a=M(O,[q.LEAD]),d=r.useCallback(()=>w(!0),[]),i=async()=>{if(a){j(!0);try{await Promise.all([D.updateConfigs(c),D.updateTicketOptions(n),D.updateProjects(z)]),L({title:"Deployed",description:"Changes synced successfully.",className:"bg-emerald-500 text-white border-none font-bold"}),w(!1)}catch(t){L({variant:"destructive",title:"Failed",description:t.message})}finally{j(!1)}}},s=(t,S,v)=>({onAdd:N=>{d(),S(p=>v?{...p,[v]:[...p[v],N]}:[...p,N])},onRemove:N=>{d(),S(p=>v?{...p,[v]:p[v].filter((E,T)=>T!==N)}:p.filter((E,T)=>T!==N))},onUpdate:(N,p)=>{d(),S(E=>v?{...E,[v]:E[v].map((T,P)=>P===N?p:T)}:E.map((T,P)=>P===N?p:T))}}),x={onAdd:t=>{d(),l(S=>({...S,cdnOptions:[...S.cdnOptions,{id:t,label:t,color:"bg-zinc-500"}]}))},onRemove:s(c,l,"cdnOptions").onRemove,onUpdate:(t,S)=>{}};if(k)return e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx(U,{className:"animate-spin text-zinc-400"})});const f=[{id:"broadcast",label:"Broadcast",icon:B,desc:"Channels, Leagues, CDN"},{id:"tickets",label:"Ticketing",icon:G,desc:"Types, Severity, Status"},{id:"org",label:"Organization",icon:R,desc:"Projects, Teams"}];return e.jsxs("div",{className:"h-screen bg-white dark:bg-zinc-950 flex flex-col overflow-hidden font-sans",children:[e.jsxs("header",{className:"shrink-0 h-12 bg-[#0078D4] text-white flex items-center justify-between px-4 z-40 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Q,{size:20,className:"text-white"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-semibold text-lg tracking-tight",children:"Registry Hub"}),e.jsx("div",{className:"h-4 w-px bg-white/30 hidden sm:block"}),e.jsxs("span",{className:"text-xs font-medium text-white/80 hidden sm:block",children:[c.leagues?.length+c.channels?.length||0," Configuration Items"]})]})]}),a&&e.jsxs(K,{onClick:i,disabled:!g||y,className:A("h-8 rounded-sm px-4 font-semibold text-xs tracking-wide transition-all bg-white text-[#0078D4] hover:bg-white/90 shadow-sm border-none",!g&&"opacity-50 cursor-not-allowed"),children:[y?e.jsx(U,{size:14,className:"animate-spin mr-2"}):e.jsx(W,{size:14,className:"mr-2"}),y?"Saving...":"Save Changes"]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("nav",{className:"w-[260px] shrink-0 bg-[#f0f0f0] dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col py-2 overflow-y-auto hidden md:flex",children:[e.jsx("div",{className:"px-4 py-3 text-xs font-bold text-zinc-500 uppercase tracking-wider mb-1",children:"Configuration Groups"}),e.jsx("div",{className:"space-y-0.5 px-2",children:f.map(t=>e.jsxs("button",{onClick:()=>C(t.id),className:A("w-full flex items-center gap-3 px-3 py-2 rounded-sm text-left transition-all border-l-4",o===t.id?"bg-[#c7e0f4] dark:bg-[#0078D4]/20 border-[#0078D4] text-black dark:text-white":"border-transparent text-zinc-600 dark:text-zinc-400 hover:bg-[#e1dfdd] dark:hover:bg-zinc-800"),children:[e.jsx(t.icon,{size:18,className:A(o===t.id?"text-[#0078D4]":"text-zinc-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium leading-none",children:t.label}),e.jsx("div",{className:"text-[10px] mt-1 opacity-70 truncate max-w-[140px]",children:t.desc})]})]},t.id))})]}),e.jsx("main",{className:"flex-1 overflow-hidden bg-white dark:bg-zinc-950 p-6",children:e.jsxs("div",{className:"h-full w-full max-w-7xl mx-auto flex flex-col",children:[e.jsxs("div",{className:"mb-6 pb-2 border-b border-zinc-200 dark:border-zinc-800",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-zinc-800 dark:text-zinc-100 flex items-center gap-2",children:[f.find(t=>t.id===o)?.icon&&V.createElement(f.find(t=>t.id===o)?.icon,{size:24,className:"text-[#0078D4]"}),f.find(t=>t.id===o)?.label]}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Manage your system configurations and dictionaries."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar",children:[o==="broadcast"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(b,{title:"Leagues",icon:J,items:c.leagues,...s(c,l,"leagues"),canEdit:a}),e.jsx(b,{title:"Channels",icon:B,items:c.channels,...s(c,l,"channels"),canEdit:a,placeholder:"Add Channel..."}),e.jsx(b,{title:"CDN Providers",icon:Z,items:c.cdnOptions,...x,canEdit:a,placeholder:"Add Provider..."})]}),o==="tickets"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx(b,{title:"Types",icon:G,items:n.types,...s(n,u,"types"),canEdit:a}),e.jsx(b,{title:"Status",icon:Y,items:n.statuses,...s(n,u,"statuses"),canEdit:a}),e.jsx(b,{title:"Severity",icon:$,items:n.severities,...s(n,u,"severities"),canEdit:a}),e.jsx(b,{title:"Category",icon:ee,items:n.categories,...s(n,u,"categories"),canEdit:a})]}),o==="org"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-start",children:[e.jsx("div",{className:"lg:col-span-1 h-full flex flex-col gap-4",children:e.jsx(b,{title:"Projects / Tenants",icon:ae,items:z,...s(z,h),canEdit:a})}),e.jsxs("div",{className:"lg:col-span-2 h-full grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(b,{title:"Responsibility Options",icon:R,items:n.responsibilities||[],...s(n,u,"responsibilities"),canEdit:a,placeholder:"Add Name..."}),e.jsx(b,{title:"Assignee Options",icon:R,items:n.assignees||[],...s(n,u,"assignees"),canEdit:a,placeholder:"Add Assignee..."})]})]})]})]})})]}),e.jsx("div",{className:"md:hidden shrink-0 bg-white dark:bg-zinc-950 border-t border-zinc-200 dark:border-zinc-800 p-2 flex justify-between",children:f.map(t=>e.jsxs("button",{onClick:()=>C(t.id),className:A("flex flex-col items-center justify-center p-2 rounded-md transition-all flex-1",o===t.id?"text-[#0078D4] dark:text-white bg-zinc-50 dark:bg-zinc-900":"text-zinc-400"),children:[e.jsx(t.icon,{size:20,className:A("mb-1",o===t.id&&"fill-current opacity-20")}),e.jsx("span",{className:"text-[9px] font-medium",children:t.label})]},t.id))})]})}export{fe as default};
