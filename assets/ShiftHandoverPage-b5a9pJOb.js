import{a as _,f as ie,r as o,j as e,F as oe,X,b as D,e as te,T as B,i as J,M as K,A as de,L as re,C as ce}from"./index-B5gZUy_b.js";import{b as G,d as T,u as Q,e as le,f as xe,g as me,h as ue,c as Y,q as be,l as he,a as Z,o as ge}from"./firebaseConfig-hLvP2kJq.js";import{P as pe,a as fe,p as ee,b as ke,C as ze,S as je,F as ve}from"./popover-D4UUBEPM.js";import{u as we}from"./useTeam-CEyFYT0q.js";import{f as U}from"./format-B568ns5f.js";import{C as W}from"./clock-hKLIUH9B.js";import{U as se}from"./users-ByUllLbT.js";import{C as V}from"./circle-check-DyaCxfhJ.js";import{S as ye}from"./save-DSxoUrLg.js";import{C as Ne}from"./check-DRiuiuXZ.js";import{P as Se}from"./pencil-Dhhq354d.js";import{T as Ce}from"./trash-2-BnvYA_d1.js";import{P as De}from"./plus-BnYRYgUJ.js";import{C as Ae}from"./cloud-download-B-eN11rg.js";import{S as Fe}from"./search-C_CHO80W.js";import{S as Le}from"./sliders-horizontal-CooVqGG4.js";import"./button-DqjdshVh.js";import"./addMonths-C-BMKM1V.js";import"./addYears-Ds2_z7Vb.js";import"./isSameMonth-CRYCS6Ki.js";import"./chevron-left-ggRkBnJb.js";import"./chevron-right-CErjX4nG.js";import"./chevron-down-Dt1j9vQ8.js";import"./index-Bc0d1pA3.js";import"./configService-Bpcp19QX.js";const $="shift_handovers",I={subscribeHandovers:(r,s=50)=>{const c=be(Y(T,$),Z("date","desc"),Z("createdAt","desc"),he(s));return ge(c,h=>{const g=h.docs.map(p=>({id:p.id,...p.data(),onDuty:p.data().onDuty||[],acknowledgedBy:p.data().acknowledgedBy||[]}));r(g)},h=>{console.error("Firestore subscription error:",h),r([])})},createHandover:async r=>{try{const s={...r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),acknowledgedBy:r.acknowledgedBy||[],onDuty:r.onDuty||[]};return await ue(Y(T,$),s)}catch(s){throw console.error("Create handover error:",s),new Error("Failed to create handover log")}},updateHandover:async(r,s)=>{try{const c={...s,updatedAt:new Date().toISOString()};await Q(G(T,$,r),c)}catch(c){throw console.error("Update handover error:",c),new Error("Failed to update handover log")}},deleteHandover:async r=>{try{await me(G(T,$,r))}catch(s){throw console.error("Delete handover error:",s),new Error("Failed to delete handover log")}},toggleAcknowledge:async(r,s,c)=>{try{const h=G(T,$,r);await Q(h,{acknowledgedBy:c?le(s):xe(s),updatedAt:new Date().toISOString()})}catch(h){throw console.error("Toggle acknowledge error:",h),new Error("Failed to update acknowledgment")}}},Me=()=>{const r=_(a=>a.currentUser),s=_(a=>a.nocMembers),{toast:c}=ie(),[h,g]=o.useState([]),[p,m]=o.useState(!0),[v,d]=o.useState(!1),[n,z]=o.useState(""),[N,u]=o.useState("All"),[y,t]=o.useState("All"),[l,f]=o.useState(""),x=o.useCallback((a,i="success")=>{c({description:a,variant:i==="error"?"destructive":"default"})},[c]);o.useEffect(()=>{if(!r){g([]),m(!1);return}m(!0);const a=I.subscribeHandovers(i=>{g(i||[]),m(!1)});return()=>a&&a()},[r]);const C=o.useMemo(()=>{if(!h.length)return[];const a=l.toLowerCase().trim();return h.filter(i=>{const w=(i.note||"").toLowerCase().includes(a),j=(i.onDuty||[]).some(ae=>(ae||"").toLowerCase().includes(a)),S=(i.status||"").toLowerCase().includes(a),H=!a||w||j||S,F=!n||i.date===n,b=N==="All"||i.shift===N,q=y==="All"||i.status===y;return H&&F&&b&&q})},[h,l,n,N,y]),A=o.useCallback(a=>{const i=s.length,w=(a.acknowledgedBy||[]).length,j=i>0?Math.round(w/i*100):0,S=i>0&&w>=i;return{total:i,acked:w,percentage:j,isComplete:S}},[s]),L=o.useMemo(()=>{const a=C.length,i=C.filter(j=>j.status!=="Normal").length,w=C.filter(j=>A(j).isComplete).length;return{total:a,withIssues:i,fullyAcked:w}},[C,A]),M=o.useCallback(async(a,i,w)=>{d(!0);try{return i?(await I.updateHandover(w,a),x("Log updated successfully")):(await I.createHandover(a),x("Log created successfully")),!0}catch(j){return console.error(j),x(j.message||"Save failed","error"),!1}finally{d(!1)}},[x]),E=o.useCallback(async a=>{try{await I.deleteHandover(a),x("Log deleted")}catch(i){console.error(i),x(i.message||"Delete failed","error")}},[x]),P=o.useCallback(async(a,i)=>{if(!r){x("Please login first!","error");return}const w=(a.acknowledgedBy||[]).includes(i);try{await I.toggleAcknowledge(a.id,i,w),x(w?"Acknowledgment removed":"Acknowledged âœ“")}catch(j){console.error(j),x(j.message||"Failed to update","error")}},[r,x]),O=o.useCallback(()=>{if(C.length===0){x("No data to export","error");return}try{const i=["Date,Time,Shift,Status,Team,Acknowledged,Note",...C.map(S=>{const H=new Date(S.date).toLocaleDateString("en-GB"),F=(S.note||"").replace(/"/g,'""'),b=(S.onDuty||[]).join("; "),q=(S.acknowledgedBy||[]).join("; ");return`"${H}","${S.time}","${S.shift}","${S.status}","${b}","${q}","${F}"`})].join(`
`),w=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a");j.href=URL.createObjectURL(w),j.download=`NOC_Handover_${new Date().toISOString().split("T")[0]}.csv`,j.click(),x("CSV exported successfully")}catch(a){console.error(a),x("Export failed","error")}},[C,x]),R=o.useCallback(()=>{z(""),u("All"),t("All"),f("")},[]);return{filteredHistory:C,loading:p,saving:v,stats:L,filterDate:n,setFilterDate:z,filterShift:N,setFilterShift:u,filterStatus:y,setFilterStatus:t,searchText:l,setSearchText:f,clearFilters:R,handleSave:M,handleDelete:E,handleAcknowledge:P,handleExportCSV:O,getAckStats:A}},Ee=(r,s,c,h,g)=>{const p=o.useCallback(()=>{const t=new Date,l=t.getHours(),f=l>=20||l<8;return{date:U(t,"yyyy-MM-dd"),time:U(t,"HH:mm"),shift:f?"Night":"Morning",onDuty:c?.name?[c.name]:[],status:"Normal",note:"",acknowledgedBy:[]}},[c]),[m,v]=o.useState(p()),[d,n]=o.useState({});o.useEffect(()=>{r&&(v(s?{...s,onDuty:Array.isArray(s.onDuty)?s.onDuty:[],acknowledgedBy:Array.isArray(s.acknowledgedBy)?s.acknowledgedBy:[],note:s.note||""}:p()),n({}))},[r,s,p]);const z=o.useCallback((t,l)=>{v(f=>({...f,[t]:l})),n(f=>{if(f[t]){const x={...f};return delete x[t],x}return f})},[]),N=o.useCallback(t=>{v(l=>{const f=l.onDuty||[],C=f.includes(t)?f.filter(A=>A!==t):[...f,t];return{...l,onDuty:C}}),n(l=>{if(l.onDuty){const{onDuty:f,...x}=l;return x}return l})},[]),u=o.useCallback(()=>{const t={};return m.date||(t.date="Date is required"),m.time||(t.time="Time is required"),(!m.onDuty||m.onDuty.length===0)&&(t.onDuty="At least one staff member required"),n(t),Object.keys(t).length===0},[m]),y=o.useCallback(t=>{t?.preventDefault(),u()&&g({...m,updatedAt:new Date().toISOString()})},[m,u,g]);return{formData:m,errors:d,setField:z,toggleMember:N,handleSubmit:y,displayMembers:h}},k={sectionTitle:"flex items-center gap-2 text-xs font-black text-indigo-500 uppercase tracking-widest mb-4",label:"block text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-2",inputContainer:"relative transition-all group",input:"w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder:text-zinc-300",error:"text-[10px] font-bold text-red-500 mt-1 flex items-center gap-1",btnOption:"flex-1 flex items-center justify-center gap-2 rounded-lg text-[10px] font-black uppercase transition-all",btnActive:"bg-white dark:bg-zinc-800 text-black dark:text-white shadow-sm ring-1 ring-black/5 dark:ring-white/10",btnInactive:"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",memberCard:"relative flex flex-col items-center justify-center p-3 rounded-2xl border transition-all duration-200 group"},ne=o.memo(({isOpen:r,onClose:s,onSubmit:c,initialData:h,isEditing:g,currentUser:p,saving:m=!1})=>{const{team:v}=we(),{formData:d,errors:n,setField:z,toggleMember:N,handleSubmit:u,displayMembers:y}=Ee(r,h,p,v,c);return o.useEffect(()=>{const t=l=>{l.key==="Escape"&&r&&s()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,s]),r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-0 sm:p-4 bg-zinc-950/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:s,children:e.jsxs("div",{className:"w-full h-full sm:h-auto sm:max-h-[90vh] max-w-2xl bg-white dark:bg-[#121214] sm:rounded-[2rem] shadow-2xl border-0 sm:border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col animate-in zoom-in-95 slide-in-from-bottom-5 duration-300",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#121214] flex justify-between items-center sticky top-0 z-20 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-black uppercase tracking-tight text-zinc-900 dark:text-white flex items-center gap-2",children:[g?e.jsx(oe,{size:22,className:"text-indigo-500"}):e.jsx(W,{size:22,className:"text-indigo-500"}),g?"Edit Shift Log":"New Handover"]}),e.jsx("p",{className:"text-xs font-medium text-zinc-400 mt-1",children:"Record details for the next shift team."})]}),e.jsx("button",{onClick:s,disabled:m,className:"p-2.5 bg-zinc-50 dark:bg-zinc-800/50 text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white rounded-full transition-all disabled:opacity-50",children:e.jsx(X,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 sm:p-8 space-y-8 bg-white dark:bg-[#121214]",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(W,{size:14})," Shift Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:k.label,children:"Date"}),e.jsxs(pe,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs("button",{type:"button",className:D(k.input,"text-left flex items-center justify-between group-hover:border-zinc-300 dark:group-hover:border-zinc-700",!d.date&&"text-zinc-400",n.date&&"border-red-500 bg-red-50 dark:bg-red-950/20"),children:[d.date?U(ee(d.date),"dd MMM yyyy"):e.jsx("span",{children:"Pick a date"}),e.jsx(te,{size:16,className:"text-zinc-400"})]})}),e.jsx(ke,{className:"w-auto p-0 bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 shadow-xl rounded-2xl",align:"start",children:e.jsx(ze,{mode:"single",selected:d.date?ee(d.date):void 0,onSelect:t=>t&&z("date",U(t,"yyyy-MM-dd")),initialFocus:!0,className:"p-3"})})]}),n.date&&e.jsxs("p",{className:k.error,children:[e.jsx(B,{size:10})," ",n.date]})]}),e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:k.label,children:"Start Time"}),e.jsx("input",{type:"time",value:d.time,onChange:t=>z("time",t.target.value),className:`${k.input} text-center tracking-widest ${n.time?"border-red-500 bg-red-50 dark:bg-red-950/20":""}`}),n.time&&e.jsxs("p",{className:k.error,children:[e.jsx(B,{size:10})," ",n.time]})]}),e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:k.label,children:"Period"}),e.jsx("div",{className:"flex rounded-xl bg-zinc-50 dark:bg-zinc-900 p-1 border border-zinc-200 dark:border-zinc-800 h-11",children:["Morning","Night"].map(t=>e.jsxs("button",{type:"button",onClick:()=>z("shift",t),className:D(k.btnOption,d.shift===t?k.btnActive:k.btnInactive),children:[t==="Morning"?e.jsx(J,{size:14}):e.jsx(K,{size:14})," ",t]},t))})]})]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(se,{size:14})," Personnel On Duty"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:y.map(t=>{const l=d.onDuty.includes(t.name);return e.jsxs("button",{type:"button",onClick:()=>N(t.name),className:D(k.memberCard,l?"bg-indigo-50 dark:bg-indigo-950/30 border-indigo-500/50 shadow-sm":"bg-white dark:bg-zinc-900 border-zinc-100 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700"),children:[l&&e.jsx("div",{className:"absolute top-2 right-2 text-indigo-500",children:e.jsx(V,{size:12,fill:"currentColor",className:"text-white dark:text-indigo-950"})}),e.jsx("div",{className:D("w-8 h-8 mb-2 rounded-full flex items-center justify-center text-xs font-black transition-colors",l?"bg-indigo-500 text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-400 group-hover:bg-zinc-200 dark:group-hover:bg-zinc-700"),children:t.name.charAt(0)}),e.jsx("span",{className:D("text-[10px] font-bold uppercase truncate w-full text-center",l?"text-indigo-700 dark:text-indigo-300":"text-zinc-500"),children:t.name.split(" ")[0]})]},t.id)})}),n.onDuty&&e.jsxs("p",{className:k.error,children:[e.jsx(B,{size:10})," ",n.onDuty]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800/50"}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:k.sectionTitle,children:[e.jsx(de,{size:14})," Log Details"]}),e.jsx("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:["Normal","Issues"].map(t=>e.jsxs("button",{type:"button",onClick:()=>z("status",t),className:D("px-3 py-1 rounded-md text-[10px] font-bold uppercase transition-all flex items-center gap-1.5",d.status===t?t==="Normal"?"bg-white dark:bg-zinc-800 text-emerald-600 shadow-sm":"bg-white dark:bg-zinc-800 text-red-500 shadow-sm":"text-zinc-400"),children:[d.status===t&&(t==="Normal"?e.jsx(V,{size:10}):e.jsx(B,{size:10})),t]},t))})]}),e.jsxs("div",{className:k.inputContainer,children:[e.jsx("label",{className:k.label,children:"Handover Remarks / Incidents"}),e.jsx("textarea",{rows:6,value:d.note,onChange:t=>z("note",t.target.value),className:D(k.input,"h-auto py-3 resize-none leading-relaxed"),placeholder:"Enter handover details here..."})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 border-t border-zinc-100 dark:border-zinc-800 bg-white dark:bg-[#121214] flex gap-3 shrink-0 z-20",children:[e.jsx("button",{type:"button",onClick:s,disabled:m,className:"flex-1 py-3.5 rounded-xl border border-zinc-200 dark:border-zinc-800 text-zinc-500 dark:text-zinc-400 font-bold text-xs uppercase hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:u,disabled:m,className:"flex-[2] py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-xs uppercase shadow-lg shadow-indigo-500/20 flex items-center justify-center gap-2 hover:opacity-90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[m?e.jsx(re,{size:16,className:"animate-spin"}):e.jsx(ye,{size:16}),g?"Update Log":"Save Handover"]})]})]})}):null});ne.displayName="ShiftHandoverForm";function He({log:r,currentUser:s,nocMembers:c,onView:h,onEdit:g,onDelete:p,onAck:m,getAckStats:v,canEdit:d=!0}){const n=v?v(r):{total:c.length,acked:(r.acknowledgedBy||[]).length,percentage:0,isComplete:!1};!n.percentage&&c.length>0&&(n.percentage=Math.round(n.acked/n.total*100),n.isComplete=n.acked>=n.total);const z=r.shift==="Morning",N=z?"from-orange-500/10 to-amber-500/10 dark:from-orange-500/20 dark:to-amber-500/20 border-l-orange-500":"from-indigo-500/10 to-violet-500/10 dark:from-indigo-500/20 dark:to-violet-500/20 border-l-indigo-500";return e.jsxs("div",{onClick:h,className:`group relative bg-white dark:bg-[#0a0a0a] rounded-xl border border-zinc-200 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-xl transition-all duration-300 cursor-pointer overflow-hidden border-l-4 ${N}`,children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${z?"from-orange-500":"from-indigo-500"} opacity-[0.03] rounded-bl-full pointer-events-none`}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-zinc-100 dark:bg-zinc-800",children:e.jsx("div",{className:`h-full transition-all duration-500 ${n.isComplete?"bg-emerald-500":n.percentage>50?"bg-blue-500":n.percentage>0?"bg-amber-500":"bg-zinc-300 dark:bg-zinc-700"}`,style:{width:`${n.percentage}%`}})}),e.jsxs("div",{className:"flex px-3 py-2 gap-3 items-center relative",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0 pr-3 border-r border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${z?"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400":"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400"}`,children:z?e.jsx(J,{size:14}):e.jsx(K,{size:14})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-zinc-900 dark:text-white leading-none",children:new Date(r.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 font-mono mt-0.5 leading-none",children:r.time})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-3",children:[r.status!=="Normal"&&e.jsx("div",{className:"shrink-0 px-1.5 py-0.5 rounded bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 text-[8px] font-black text-red-600 dark:text-red-400 uppercase tracking-wide",children:"Issue"}),e.jsx("p",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300 truncate",children:r.note||e.jsx("span",{className:"text-zinc-400 italic",children:"No remarks."})})]}),e.jsxs("div",{className:"flex items-center gap-4 shrink-0 pl-3 border-l border-zinc-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"hidden md:flex flex-col items-end gap-0.5",children:[e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-wider",children:"Duty"}),e.jsx("div",{className:"flex -space-x-1",children:r.onDuty&&r.onDuty.length>0?r.onDuty.map((u,y)=>e.jsx("div",{title:u,className:"w-4 h-4 rounded-full bg-zinc-100 dark:bg-zinc-800 border border-white dark:border-black flex items-center justify-center text-[7px] font-black text-zinc-500 uppercase",children:u.charAt(0)},y)):e.jsx("span",{children:"-"})})]}),e.jsx("div",{className:"flex gap-1",children:c.map((u,y)=>{const t=(r.acknowledgedBy||[]).includes(u.name),f=(typeof s=="object"?s?.name:s)===u.name;return e.jsx("div",{onClick:x=>{x.stopPropagation(),f&&m(r,u.name)},className:`
                     w-5 h-5 rounded-full border flex items-center justify-center text-[7px] font-black transition-all duration-200
                     ${f?"cursor-pointer hover:scale-110 shadow-sm":"cursor-default"}
                     ${t?"bg-zinc-900 text-white dark:bg-white dark:text-black border-transparent":"bg-zinc-50 dark:bg-zinc-900 text-zinc-400 border-zinc-200 dark:border-zinc-800"}
                     ${f&&!t?"ring-1 ring-blue-500/50 animate-pulse":""}
                   `,title:`${u.name} ${t?"(Acknowledged)":"(Pending)"}`,children:t?e.jsx(Ne,{size:8,strokeWidth:4}):u.name.charAt(0)},u.id||y)})}),d&&e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),g(r)},className:"p-1 text-zinc-400 hover:text-blue-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded",children:e.jsx(Se,{size:10})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),p(r.id)},className:"p-1 text-zinc-400 hover:text-red-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded",children:e.jsx(Ce,{size:10})})]})]})]})]})}function Te({log:r,isOpen:s,onClose:c,nocMembers:h}){if(!s||!r)return null;const g=h.length,p=(r.acknowledgedBy||[]).length,m=g>0?Math.round(p/g*100):0,v=p>=g;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-zinc-900/60 dark:bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",onClick:c,children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-[#18181b] rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-zinc-700 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-300",onClick:d=>d.stopPropagation(),children:[e.jsx("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 bg-gradient-to-r from-zinc-50 to-white dark:from-zinc-900 dark:to-[#18181b]",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[r.shift==="Morning"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-600 dark:text-orange-400 px-2.5 py-1 rounded-full",children:[e.jsx(J,{size:12})," Morning Shift"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-gradient-to-r from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 text-indigo-600 dark:text-indigo-400 px-2.5 py-1 rounded-full",children:[e.jsx(K,{size:12})," Night Shift"]}),r.status==="Normal"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 px-2.5 py-1 rounded-full",children:[e.jsx(V,{size:12})," Normal"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] font-black uppercase bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2.5 py-1 rounded-full animate-pulse",children:[e.jsx(B,{size:12})," Issues"]})]}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-tighter text-zinc-900 dark:text-white",children:"Shift Log Details"})]}),e.jsx("button",{onClick:c,className:"p-2 bg-zinc-100 dark:bg-zinc-800 text-zinc-400 hover:text-black dark:hover:text-white rounded-full transition-colors hover:bg-zinc-200 dark:hover:bg-zinc-700",children:e.jsx(X,{size:20})})]})}),e.jsxs("div",{className:"p-8 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-2xl border-2 ${v?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500 flex items-center gap-1",children:[e.jsx(je,{size:12})," Acknowledgment Status"]}),e.jsxs("span",{className:`text-sm font-black ${v?"text-emerald-600":"text-amber-600"}`,children:[m,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-zinc-200 dark:bg-zinc-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-700 rounded-full ${v?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${m}%`}})}),e.jsxs("div",{className:"mt-2 text-[10px] font-bold text-zinc-500",children:[p," of ",g," team members acknowledged"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 p-4 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx(te,{size:10,className:"inline mr-1"}),"Date"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:new Date(r.date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 p-4 rounded-2xl border border-zinc-100 dark:border-zinc-800",children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-1",children:[e.jsx(W,{size:10,className:"inline mr-1"}),"Time Logged"]}),e.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:r.time})]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3 flex items-center gap-1",children:[e.jsx(se,{size:12})," On Duty"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.onDuty&&r.onDuty.length>0?r.onDuty.map((d,n)=>e.jsxs("div",{className:"flex items-center gap-2 pl-1 pr-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-full shadow-sm",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-zinc-800 to-zinc-900 dark:from-white dark:to-zinc-100 text-white dark:text-black flex items-center justify-center text-[10px] font-black",children:d.charAt(0)}),e.jsx("span",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:d})]},n)):e.jsx("span",{className:"text-xs text-zinc-400 italic",children:"No staff assigned"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3",children:"Remarks / Note"}),e.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-900/30 p-5 rounded-2xl border border-zinc-100 dark:border-zinc-800 text-sm font-medium text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap min-h-[80px]",children:r.note||e.jsx("span",{className:"text-zinc-400 italic",children:"No additional remarks."})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest block mb-3",children:"Acknowledged By"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((d,n)=>{const z=(r.acknowledgedBy||[]).includes(d.name);return e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[10px] font-bold border transition-all ${z?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800":"bg-zinc-50 dark:bg-zinc-800 text-zinc-400 border-zinc-200 dark:border-zinc-700 opacity-60"}`,children:[z?e.jsx(V,{size:12}):e.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current"}),d.name]},d.id||n)})})]})]}),e.jsx("div",{className:"px-8 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50",children:e.jsx("button",{onClick:c,className:"w-full py-3 rounded-xl border-2 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 font-black uppercase text-[10px] tracking-widest hover:bg-white dark:hover:bg-zinc-800 transition-colors",children:"Close"})})]})})}function ot(){const{currentUser:r}=_(),{filteredHistory:s,loading:c,saving:h,stats:g,filterDate:p,setFilterDate:m,filterShift:v,setFilterShift:d,filterStatus:n,setFilterStatus:z,searchText:N,setSearchText:u,clearFilters:y,handleSave:t,handleDelete:l,handleAcknowledge:f,handleExportCSV:x,getAckStats:C}=Me(),[A,L]=o.useState(!1),[M,E]=o.useState(null),[P,O]=o.useState(null),[R,a]=o.useState(null),[i,w]=o.useState(!1),j=()=>{E(null),L(!0)},S=b=>{E(b),L(!0)},H=async b=>{await t(b,!!M,M?.id)&&(L(!1),E(null))},F=p||v!=="All"||n!=="All";return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-zinc-950 transition-colors",children:[e.jsx("div",{className:"shrink-0 py-5 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 text-[9px] font-bold rounded uppercase tracking-wider",children:"Operations"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[g.total," Logs"]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Shift Handover"})]}),e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:j,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95 transition-all shadow-sm shadow-indigo-500/20",children:[e.jsx(De,{size:16})," New Handover"]}),e.jsx("button",{onClick:x,className:"flex-none flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all",title:"Export CSV",children:e.jsx(Ae,{size:16})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 sm:pb-0 no-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-800 shrink-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wide",children:"Issues"}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white",children:g.withIssues})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-zinc-100 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-800 shrink-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-wide",children:"Completed"}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white",children:g.fullyAcked})]})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Fe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:N,onChange:b=>u(b.target.value),placeholder:"Search notes, staff...",className:"w-full h-10 pl-10 pr-9 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),N&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(X,{size:14})})]}),e.jsx("button",{onClick:()=>w(!i),className:D("h-10 px-3 flex items-center justify-center rounded-xl transition-all border",F||i?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 border-indigo-200 dark:border-indigo-800":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent"),children:e.jsx(Le,{size:18})})]})]}),i&&e.jsxs("div",{className:"pt-2 flex flex-wrap gap-2 animate-in slide-in-from-top-2 duration-200",children:[e.jsx("input",{type:"date",value:p,onChange:b=>m(b.target.value),className:"h-9 px-3 bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-300 outline-none focus:border-indigo-500"}),e.jsxs("select",{value:v,onChange:b=>d(b.target.value),className:"h-9 px-3 bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-300 outline-none focus:border-indigo-500",children:[e.jsx("option",{value:"All",children:"All Shifts"}),e.jsx("option",{value:"Morning",children:"Morning"}),e.jsx("option",{value:"Night",children:"Night"})]}),e.jsxs("select",{value:n,onChange:b=>z(b.target.value),className:"h-9 px-3 bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-300 outline-none focus:border-indigo-500",children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Normal",children:"Normal"}),e.jsx("option",{value:"Issues",children:"With Issues"})]}),F&&e.jsx("button",{onClick:y,className:"h-9 px-3 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-colors",children:"Clear"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6 bg-zinc-50/50 dark:bg-black/20",children:e.jsx("div",{className:"max-w-6xl mx-auto space-y-4",children:c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[e.jsx(re,{className:"animate-spin text-indigo-500",size:32}),e.jsx("span",{className:"text-xs font-bold text-zinc-400",children:"Loading handovers..."})]}):s.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 text-zinc-300",children:e.jsx(ve,{size:32})}),e.jsx("h3",{className:"text-zinc-900 dark:text-white font-bold",children:"No records found"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Try adjusting your search or filters."}),F&&e.jsx("button",{onClick:y,className:"mt-4 text-indigo-500 text-xs font-bold hover:underline",children:"Clear all filters"})]}):s.map(b=>e.jsx(He,{log:b,currentUser:r,onAcknowledge:()=>f(b,r?.name),onView:()=>O(b),onEdit:()=>S(b),onDelete:()=>a(b.id),ackStats:C(b)},b.id))})}),e.jsx(ne,{isOpen:A,onClose:()=>L(!1),onSubmit:H,initialData:M,isEditing:!!M,currentUser:r,saving:h}),e.jsx(Te,{isOpen:!!P,onClose:()=>O(null),log:P}),e.jsx(ce,{isOpen:!!R,onClose:()=>a(null),onConfirm:()=>{l(R),a(null)},title:"Delete Handover Log",message:"Are you sure? This action cannot be undone.",isDanger:!0})]})}export{ot as default};
