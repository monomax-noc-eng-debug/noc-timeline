import{c as Pe,i as qe,h as ct,g as ot,k as lt,a as Fe,e as Ye,l as Je,r as z,j as e,X as Ce,L as Ne,F as dt,u as ut,d as ht,T as xt,C as pt,A as ft}from"./index-Cu1hj24i.js";import{Q as mt,u as gt}from"./useBaseQuery-BnRH9K7T.js";import{b as ye,g as bt,u as kt,d as ue,i as yt,s as vt,h as zt,c as ve,j as jt,o as Be,l as $e,k as wt,q as Ke,m as Nt,a as St}from"./firebaseConfig--jbwBVp3.js";import{i as Se,f as _t}from"./format-Xuj1Wk4j.js";import{p as _e}from"./parse-B5HBKvJx.js";import{a as Xe,F as Ct}from"./addYears-DqfvcqbY.js";import{u as et,i as Dt,U as Et}from"./useTicketOptions-CXOxnMow.js";import{C as Ae}from"./cloud-download-Ps8WC4wc.js";import{C as At}from"./clock-C3VHd1-G.js";import{C as Tt}from"./circle-alert-COENiKgS.js";import{C as Te,S as Rt}from"./search-CzE8fqzl.js";import{A as Ot}from"./arrow-right-b-83yzMy.js";import{D as It}from"./database-Cuigymbw.js";import{S as Lt}from"./save-eic3Sy5Q.js";import{P as Pt}from"./plus-Bqwbh0YV.js";import{G as Ft}from"./globe-D8xrZsem.js";import{T as tt}from"./trash-2-BELcC8hK.js";import{Z as st}from"./zap-DqWJJD1m.js";import"./protectedTokens-BgWIJsKD.js";import"./addDays-CsCA8S13.js";import"./configService-Cf9dW1Z_.js";const Mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],Ut=Pe("circle-arrow-down",Mt);const qt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Bt=Pe("shield-alert",qt);const $t=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],rt=Pe("square-pen",$t);var Kt=class extends mt{constructor(r,a){super(r,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(r){super.setOptions({...r,behavior:qe()})}getOptimisticResult(r){return r.behavior=qe(),super.getOptimisticResult(r)}fetchNextPage(r){return this.fetch({...r,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(r){return this.fetch({...r,meta:{fetchMore:{direction:"backward"}}})}createResult(r,a){const{state:l}=r,c=super.createResult(r,a),{isFetching:y,isRefetching:h,isError:p,isRefetchError:N}=c,T=l.fetchMeta?.fetchMore?.direction,u=p&&T==="forward",g=y&&T==="forward",P=p&&T==="backward",I=y&&T==="backward";return{...c,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ot(a,l.data),hasPreviousPage:ct(a,l.data),isFetchNextPageError:u,isFetchingNextPage:g,isFetchPreviousPageError:P,isFetchingPreviousPage:I,isRefetchError:N&&!u&&!P,isRefetching:h&&!g&&!I}}};function Ht(r,a){return gt(r,Kt)}const xe="ticket_logs",Qt="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Ee=async(r,a)=>{const l={action:r,ticketNumber:a.ticketNumber,ticketType:a.type??a.ticketType,status:a.status,severity:a.severity,category:a.category??"",subCategory:a.subCategory??"",shortDescription:a.shortDesc!==void 0?a.shortDesc:a.shortDescription,detail:a.details!==void 0?a.details:a.detail,actionTaken:a.action!==void 0?a.action:a.actionTaken,resolvedDetail:a.resolvedDetail??"",assign:a.assign??"",remark:a.remark??""};try{fetch(Qt,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(l)}).catch(c=>console.error("Sync Net Error",c))}catch(c){console.error("Sync Error",c)}},ge={subscribeLogs:(r,a=50)=>{const l=Ke(ve(ue,xe),Be("createdAt","desc"),$e(a));return St(l,c=>{const y=c.docs.map(h=>({id:h.id,...h.data()}));r(y,c.docs[c.docs.length-1])})},fetchMoreLogs:async(r,a=20)=>{try{const l=[Be("createdAt","desc"),$e(a)];r&&l.push(wt(r));const c=Ke(ve(ue,xe),...l),y=await Nt(c);return{data:y.docs.map(h=>({id:h.id,...h.data()})),lastDoc:y.docs[y.docs.length-1]||null}}catch{return{data:[],lastDoc:null}}},importLogsFromSheet:async r=>{const l=[];for(let c=0;c<r.length;c+=500)l.push(r.slice(c,c+500));for(const c of l){const y=jt(ue);c.forEach(h=>{const p=h.ticketNumber?ye(ue,xe,String(h.ticketNumber)):ye(ve(ue,xe));y.set(p,{...h,createdAt:h.date?new Date(h.date).toISOString():new Date().toISOString(),importedAt:new Date().toISOString()},{merge:!0})}),await y.commit()}return{success:!0,count:r.length}},createLog:async r=>{if(r.ticketNumber){const a=ye(ue,xe,String(r.ticketNumber));if((await yt(a)).exists())throw new Error(`Ticket ${r.ticketNumber} exists!`);await vt(a,{...r,createdAt:new Date().toISOString()})}else await zt(ve(ue,xe),{...r,createdAt:new Date().toISOString()});Ee("create",r)},updateLog:async(r,a)=>{const l=ye(ue,xe,String(r));await kt(l,a),Ee("update",{ticketNumber:r,...a})},deleteLog:async r=>{const a=ye(ue,xe,String(r));await bt(a),Ee("delete",{ticketNumber:r})}},Wt=()=>{const{data:r,fetchNextPage:a,hasNextPage:l,isFetchingNextPage:c,isLoading:y}=Ht({queryKey:["ticketLogs"],queryFn:async({pageParam:N=null})=>await ge.fetchMoreLogs(N),initialPageParam:null,getNextPageParam:N=>N.lastDoc||void 0}),h=r?.pages.flatMap(N=>N.data)||[],p={total:h.length,incidents:h.filter(N=>N.type==="Incident").length,requests:h.filter(N=>N.type==="Request"||N.type==="Service Request").length};return{logs:h,loading:y,loadingMore:c,hasMore:l,loadMore:a,stats:p}};var ze={exports:{}};var Gt=ze.exports,He;function Vt(){return He||(He=1,(function(r,a){((l,c)=>{r.exports=c()})(Gt,function l(){var c=typeof self<"u"?self:typeof window<"u"?window:c!==void 0?c:{},y,h=!c.document&&!!c.postMessage,p=c.IS_PAPA_WORKER||!1,N={},T=0,u={};function g(s){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var i=le(t);i.chunkSize=parseInt(i.chunkSize),t.step||t.chunk||(i.chunkSize=null),this._handle=new W(i),(this._handle.streamer=this)._config=i}).call(this,s),this.parseChunk=function(t,i){var o=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<o){let w=this._config.newline;w||(d=this._config.quoteChar||'"',w=this._handle.guessLineEndings(t,d)),t=[...t.split(w).slice(o)].join(w)}this.isFirstChunk&&D(this._config.beforeFirstChunk)&&(d=this._config.beforeFirstChunk(t))!==void 0&&(t=d),this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t,d=(this._partialLine="",this._handle.parse(o,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=d.meta.cursor,o=(this._finished||(this._partialLine=o.substring(t-this._baseIndex),this._baseIndex=t),d&&d.data&&(this._rowCount+=d.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),p)c.postMessage({results:d,workerId:u.WORKER_ID,finished:o});else if(D(this._config.chunk)&&!i){if(this._config.chunk(d,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=d=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(d.data),this._completeResults.errors=this._completeResults.errors.concat(d.errors),this._completeResults.meta=d.meta),this._completed||!o||!D(this._config.complete)||d&&d.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||d&&d.meta.paused||this._nextChunk(),d}this._halted=!0},this._sendError=function(t){D(this._config.error)?this._config.error(t):p&&this._config.error&&c.postMessage({workerId:u.WORKER_ID,error:t,finished:!1})}}function P(s){var t;(s=s||{}).chunkSize||(s.chunkSize=u.RemoteChunkSize),g.call(this,s),this._nextChunk=h?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(i){this._input=i,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),h||(t.onload=Y(this._chunkLoaded,this),t.onerror=Y(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!h),this._config.downloadRequestHeaders){var i,o=this._config.downloadRequestHeaders;for(i in o)t.setRequestHeader(i,o[i])}var d;this._config.chunkSize&&(d=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+d));try{t.send(this._config.downloadRequestBody)}catch(w){this._chunkError(w.message)}h&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(i=>(i=i.getResponseHeader("Content-Range"))!==null?parseInt(i.substring(i.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(i){i=t.statusText||i,this._sendError(new Error(i))}}function I(s){(s=s||{}).chunkSize||(s.chunkSize=u.LocalChunkSize),g.call(this,s);var t,i,o=typeof FileReader<"u";this.stream=function(d){this._input=d,i=d.slice||d.webkitSlice||d.mozSlice,o?((t=new FileReader).onload=Y(this._chunkLoaded,this),t.onerror=Y(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var d=this._input,w=(this._config.chunkSize&&(w=Math.min(this._start+this._config.chunkSize,this._input.size),d=i.call(d,this._start,w)),t.readAsText(d,this._config.encoding));o||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(d){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(d.target.result)},this._chunkError=function(){this._sendError(t.error)}}function f(s){var t;g.call(this,s=s||{}),this.stream=function(i){return t=i,this._nextChunk()},this._nextChunk=function(){var i,o;if(!this._finished)return i=this._config.chunkSize,t=i?(o=t.substring(0,i),t.substring(i)):(o=t,""),this._finished=!t,this.parseChunk(o)}}function V(s){g.call(this,s=s||{});var t=[],i=!0,o=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(d){this._input=d,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){o&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):i=!0},this._streamData=Y(function(d){try{t.push(typeof d=="string"?d:d.toString(this._config.encoding)),i&&(i=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(w){this._streamError(w)}},this),this._streamError=Y(function(d){this._streamCleanUp(),this._sendError(d)},this),this._streamEnd=Y(function(){this._streamCleanUp(),o=!0,this._streamData("")},this),this._streamCleanUp=Y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function W(s){var t,i,o,d,w=Math.pow(2,53),U=-w,ee=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,X=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,S=this,L=0,b=0,H=!1,n=!1,k=[],x={data:[],errors:[],meta:{}};function F(_){return s.skipEmptyLines==="greedy"?_.join("").trim()==="":_.length===1&&_[0].length===0}function $(){if(x&&o&&(ie("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),o=!1),s.skipEmptyLines&&(x.data=x.data.filter(function(v){return!F(v)})),G()){let v=function(B,K){D(s.transformHeader)&&(B=s.transformHeader(B,K)),k.push(B)};if(x)if(Array.isArray(x.data[0])){for(var _=0;G()&&_<x.data.length;_++)x.data[_].forEach(v);x.data.splice(0,1)}else x.data.forEach(v)}function E(v,B){for(var K=s.header?{}:[],R=0;R<v.length;R++){var O=R,C=v[R],C=((ne,j)=>(M=>(s.dynamicTypingFunction&&s.dynamicTyping[M]===void 0&&(s.dynamicTyping[M]=s.dynamicTypingFunction(M)),(s.dynamicTyping[M]||s.dynamicTyping)===!0))(ne)?j==="true"||j==="TRUE"||j!=="false"&&j!=="FALSE"&&((M=>{if(ee.test(M)&&(M=parseFloat(M),U<M&&M<w))return 1})(j)?parseFloat(j):X.test(j)?new Date(j):j===""?null:j):j)(O=s.header?R>=k.length?"__parsed_extra":k[R]:O,C=s.transform?s.transform(C,O):C);O==="__parsed_extra"?(K[O]=K[O]||[],K[O].push(C)):K[O]=C}return s.header&&(R>k.length?ie("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+R,b+B):R<k.length&&ie("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+R,b+B)),K}var q;x&&(s.header||s.dynamicTyping||s.transform)&&(q=1,!x.data.length||Array.isArray(x.data[0])?(x.data=x.data.map(E),q=x.data.length):x.data=E(x.data,0),s.header&&x.meta&&(x.meta.fields=k),b+=q)}function G(){return s.header&&k.length===0}function ie(_,E,q,v){_={type:_,code:E,message:q},v!==void 0&&(_.row=v),x.errors.push(_)}D(s.step)&&(d=s.step,s.step=function(_){x=_,G()?$():($(),x.data.length!==0&&(L+=_.data.length,s.preview&&L>s.preview?i.abort():(x.data=x.data[0],d(x,S))))}),this.parse=function(_,E,q){var v=s.quoteChar||'"',v=(s.newline||(s.newline=this.guessLineEndings(_,v)),o=!1,s.delimiter?D(s.delimiter)&&(s.delimiter=s.delimiter(_),x.meta.delimiter=s.delimiter):((v=((B,K,R,O,C)=>{var ne,j,M,he;C=C||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var pe=0;pe<C.length;pe++){for(var ae,be=C[pe],J=0,ce=0,Q=0,te=(M=void 0,new Z({comments:O,delimiter:be,newline:K,preview:10}).parse(B)),de=0;de<te.data.length;de++)R&&F(te.data[de])?Q++:(ae=te.data[de].length,ce+=ae,M===void 0?M=ae:0<ae&&(J+=Math.abs(ae-M),M=ae));0<te.data.length&&(ce/=te.data.length-Q),(j===void 0||J<=j)&&(he===void 0||he<ce)&&1.99<ce&&(j=J,ne=be,he=ce)}return{successful:!!(s.delimiter=ne),bestDelimiter:ne}})(_,s.newline,s.skipEmptyLines,s.comments,s.delimitersToGuess)).successful?s.delimiter=v.bestDelimiter:(o=!0,s.delimiter=u.DefaultDelimiter),x.meta.delimiter=s.delimiter),le(s));return s.preview&&s.header&&v.preview++,t=_,i=new Z(v),x=i.parse(t,E,q),$(),H?{meta:{paused:!0}}:x||{meta:{paused:!1}}},this.paused=function(){return H},this.pause=function(){H=!0,i.abort(),t=D(s.chunk)?"":t.substring(i.getCharIndex())},this.resume=function(){S.streamer._halted?(H=!1,S.streamer.parseChunk(t,!0)):setTimeout(S.resume,3)},this.aborted=function(){return n},this.abort=function(){n=!0,i.abort(),x.meta.aborted=!0,D(s.complete)&&s.complete(x),t=""},this.guessLineEndings=function(B,v){B=B.substring(0,1048576);var v=new RegExp(se(v)+"([^]*?)"+se(v),"gm"),q=(B=B.replace(v,"")).split("\r"),v=B.split(`
`),B=1<v.length&&v[0].length<q[0].length;if(q.length===1||B)return`
`;for(var K=0,R=0;R<q.length;R++)q[R][0]===`
`&&K++;return K>=q.length/2?`\r
`:"\r"}}function se(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Z(s){var t=(s=s||{}).delimiter,i=s.newline,o=s.comments,d=s.step,w=s.preview,U=s.fastMode,ee=null,X=!1,S=s.quoteChar==null?'"':s.quoteChar,L=S;if(s.escapeChar!==void 0&&(L=s.escapeChar),(typeof t!="string"||-1<u.BAD_DELIMITERS.indexOf(t))&&(t=","),o===t)throw new Error("Comment character same as delimiter");o===!0?o="#":(typeof o!="string"||-1<u.BAD_DELIMITERS.indexOf(o))&&(o=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var b=0,H=!1;this.parse=function(n,k,x){if(typeof n!="string")throw new Error("Input must be a string");var F=n.length,$=t.length,G=i.length,ie=o.length,_=D(d),E=[],q=[],v=[],B=b=0;if(!n)return J();if(U||U!==!1&&n.indexOf(S)===-1){for(var K=n.split(i),R=0;R<K.length;R++){if(v=K[R],b+=v.length,R!==K.length-1)b+=i.length;else if(x)return J();if(!o||v.substring(0,ie)!==o){if(_){if(E=[],he(v.split(t)),ce(),H)return J()}else he(v.split(t));if(w&&w<=R)return E=E.slice(0,w),J(!0)}}return J()}for(var O=n.indexOf(t,b),C=n.indexOf(i,b),ne=new RegExp(se(L)+se(S),"g"),j=n.indexOf(S,b);;)if(n[b]===S)for(j=b,b++;;){if((j=n.indexOf(S,j+1))===-1)return x||q.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:E.length,index:b}),ae();if(j===F-1)return ae(n.substring(b,j).replace(ne,S));if(S===L&&n[j+1]===L)j++;else if(S===L||j===0||n[j-1]!==L){O!==-1&&O<j+1&&(O=n.indexOf(t,j+1));var M=pe((C=C!==-1&&C<j+1?n.indexOf(i,j+1):C)===-1?O:Math.min(O,C));if(n.substr(j+1+M,$)===t){v.push(n.substring(b,j).replace(ne,S)),n[b=j+1+M+$]!==S&&(j=n.indexOf(S,b)),O=n.indexOf(t,b),C=n.indexOf(i,b);break}if(M=pe(C),n.substring(j+1+M,j+1+M+G)===i){if(v.push(n.substring(b,j).replace(ne,S)),be(j+1+M+G),O=n.indexOf(t,b),j=n.indexOf(S,b),_&&(ce(),H))return J();if(w&&E.length>=w)return J(!0);break}q.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:E.length,index:b}),j++}}else if(o&&v.length===0&&n.substring(b,b+ie)===o){if(C===-1)return J();b=C+G,C=n.indexOf(i,b),O=n.indexOf(t,b)}else if(O!==-1&&(O<C||C===-1))v.push(n.substring(b,O)),b=O+$,O=n.indexOf(t,b);else{if(C===-1)break;if(v.push(n.substring(b,C)),be(C+G),_&&(ce(),H))return J();if(w&&E.length>=w)return J(!0)}return ae();function he(Q){E.push(Q),B=b}function pe(Q){var te=0;return te=Q!==-1&&(Q=n.substring(j+1,Q))&&Q.trim()===""?Q.length:te}function ae(Q){return x||(Q===void 0&&(Q=n.substring(b)),v.push(Q),b=F,he(v),_&&ce()),J()}function be(Q){b=Q,he(v),v=[],C=n.indexOf(i,b)}function J(Q){if(s.header&&!k&&E.length&&!X){var te=E[0],de=Object.create(null),De=new Set(te);let Me=!1;for(let fe=0;fe<te.length;fe++){let oe=te[fe];if(de[oe=D(s.transformHeader)?s.transformHeader(oe,fe):oe]){let ke,Ue=de[oe];for(;ke=oe+"_"+Ue,Ue++,De.has(ke););De.add(ke),te[fe]=ke,de[oe]++,Me=!0,(ee=ee===null?{}:ee)[ke]=oe}else de[oe]=1,te[fe]=oe;De.add(oe)}Me&&console.warn("Duplicate headers found and renamed."),X=!0}return{data:E,errors:q,meta:{delimiter:t,linebreak:i,aborted:H,truncated:!!Q,cursor:B+(k||0),renamedHeaders:ee}}}function ce(){d(J()),E=[],q=[]}},this.abort=function(){H=!0},this.getCharIndex=function(){return b}}function m(s){var t=s.data,i=N[t.workerId],o=!1;if(t.error)i.userError(t.error,t.file);else if(t.results&&t.results.data){var d={abort:function(){o=!0,A(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:re,resume:re};if(D(i.userStep)){for(var w=0;w<t.results.data.length&&(i.userStep({data:t.results.data[w],errors:t.results.errors,meta:t.results.meta},d),!o);w++);delete t.results}else D(i.userChunk)&&(i.userChunk(t.results,d,t.file),delete t.results)}t.finished&&!o&&A(t.workerId,t.results)}function A(s,t){var i=N[s];D(i.userComplete)&&i.userComplete(t),i.terminate(),delete N[s]}function re(){throw new Error("Not implemented.")}function le(s){if(typeof s!="object"||s===null)return s;var t,i=Array.isArray(s)?[]:{};for(t in s)i[t]=le(s[t]);return i}function Y(s,t){return function(){s.apply(t,arguments)}}function D(s){return typeof s=="function"}return u.parse=function(s,t){var i=(t=t||{}).dynamicTyping||!1;if(D(i)&&(t.dynamicTypingFunction=i,i={}),t.dynamicTyping=i,t.transform=!!D(t.transform)&&t.transform,!t.worker||!u.WORKERS_SUPPORTED)return i=null,u.NODE_STREAM_INPUT,typeof s=="string"?(s=(o=>o.charCodeAt(0)!==65279?o:o.slice(1))(s),i=new(t.download?P:f)(t)):s.readable===!0&&D(s.read)&&D(s.on)?i=new V(t):(c.File&&s instanceof File||s instanceof Object)&&(i=new I(t)),i.stream(s);(i=(()=>{var o;return!!u.WORKERS_SUPPORTED&&(o=(()=>{var d=c.URL||c.webkitURL||null,w=l.toString();return u.BLOB_URL||(u.BLOB_URL=d.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",w,")();"],{type:"text/javascript"})))})(),(o=new c.Worker(o)).onmessage=m,o.id=T++,N[o.id]=o)})()).userStep=t.step,i.userChunk=t.chunk,i.userComplete=t.complete,i.userError=t.error,t.step=D(t.step),t.chunk=D(t.chunk),t.complete=D(t.complete),t.error=D(t.error),delete t.worker,i.postMessage({input:s,config:t,workerId:i.id})},u.unparse=function(s,t){var i=!1,o=!0,d=",",w=`\r
`,U='"',ee=U+U,X=!1,S=null,L=!1,b=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||u.BAD_DELIMITERS.filter(function(k){return t.delimiter.indexOf(k)!==-1}).length||(d=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(i=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(X=t.skipEmptyLines),typeof t.newline=="string"&&(w=t.newline),typeof t.quoteChar=="string"&&(U=t.quoteChar),typeof t.header=="boolean"&&(o=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");S=t.columns}t.escapeChar!==void 0&&(ee=t.escapeChar+U),t.escapeFormulae instanceof RegExp?L=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(L=/^[=+\-@\t\r].*$/)}})(),new RegExp(se(U),"g"));if(typeof s=="string"&&(s=JSON.parse(s)),Array.isArray(s)){if(!s.length||Array.isArray(s[0]))return H(null,s,X);if(typeof s[0]=="object")return H(S||Object.keys(s[0]),s,X)}else if(typeof s=="object")return typeof s.data=="string"&&(s.data=JSON.parse(s.data)),Array.isArray(s.data)&&(s.fields||(s.fields=s.meta&&s.meta.fields||S),s.fields||(s.fields=Array.isArray(s.data[0])?s.fields:typeof s.data[0]=="object"?Object.keys(s.data[0]):[]),Array.isArray(s.data[0])||typeof s.data[0]=="object"||(s.data=[s.data])),H(s.fields||[],s.data||[],X);throw new Error("Unable to serialize unrecognized input");function H(k,x,F){var $="",G=(typeof k=="string"&&(k=JSON.parse(k)),typeof x=="string"&&(x=JSON.parse(x)),Array.isArray(k)&&0<k.length),ie=!Array.isArray(x[0]);if(G&&o){for(var _=0;_<k.length;_++)0<_&&($+=d),$+=n(k[_],_);0<x.length&&($+=w)}for(var E=0;E<x.length;E++){var q=(G?k:x[E]).length,v=!1,B=G?Object.keys(x[E]).length===0:x[E].length===0;if(F&&!G&&(v=F==="greedy"?x[E].join("").trim()==="":x[E].length===1&&x[E][0].length===0),F==="greedy"&&G){for(var K=[],R=0;R<q;R++){var O=ie?k[R]:R;K.push(x[E][O])}v=K.join("").trim()===""}if(!v){for(var C=0;C<q;C++){0<C&&!B&&($+=d);var ne=G&&ie?k[C]:C;$+=n(x[E][ne],C)}E<x.length-1&&(!F||0<q&&!B)&&($+=w)}}return $}function n(k,x){var F,$;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):($=!1,L&&typeof k=="string"&&L.test(k)&&(k="'"+k,$=!0),F=k.toString().replace(b,ee),($=$||i===!0||typeof i=="function"&&i(k,x)||Array.isArray(i)&&i[x]||((G,ie)=>{for(var _=0;_<ie.length;_++)if(-1<G.indexOf(ie[_]))return!0;return!1})(F,u.BAD_DELIMITERS)||-1<F.indexOf(d)||F.charAt(0)===" "||F.charAt(F.length-1)===" ")?U+F+U:F)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!h&&!!c.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=Z,u.ParserHandle=W,u.NetworkStreamer=P,u.FileStreamer=I,u.StringStreamer=f,u.ReadableStreamStreamer=V,c.jQuery&&((y=c.jQuery).fn.parse=function(s){var t=s.config||{},i=[];return this.each(function(w){if(!(y(this).prop("tagName").toUpperCase()==="INPUT"&&y(this).attr("type").toLowerCase()==="file"&&c.FileReader)||!this.files||this.files.length===0)return!0;for(var U=0;U<this.files.length;U++)i.push({file:this.files[U],inputElem:this,instanceConfig:y.extend({},t)})}),o(),this;function o(){if(i.length===0)D(s.complete)&&s.complete();else{var w,U,ee,X,S=i[0];if(D(s.before)){var L=s.before(S.file,S.inputElem);if(typeof L=="object"){if(L.action==="abort")return w="AbortError",U=S.file,ee=S.inputElem,X=L.reason,void(D(s.error)&&s.error({name:w},U,ee,X));if(L.action==="skip")return void d();typeof L.config=="object"&&(S.instanceConfig=y.extend(S.instanceConfig,L.config))}else if(L==="skip")return void d()}var b=S.instanceConfig.complete;S.instanceConfig.complete=function(H){D(b)&&b(H,S.file,S.inputElem),d()},u.parse(S.file,S.instanceConfig)}}function d(){i.splice(0,1),o()}}),p&&(c.onmessage=function(s){s=s.data,u.WORKER_ID===void 0&&s&&(u.WORKER_ID=s.workerId),typeof s.input=="string"?c.postMessage({workerId:u.WORKER_ID,results:u.parse(s.input,s.config),finished:!0}):(c.File&&s.input instanceof File||s.input instanceof Object)&&(s=u.parse(s.input,s.config))&&c.postMessage({workerId:u.WORKER_ID,results:s,finished:!0})}),(P.prototype=Object.create(g.prototype)).constructor=P,(I.prototype=Object.create(g.prototype)).constructor=I,(f.prototype=Object.create(f.prototype)).constructor=f,(V.prototype=Object.create(g.prototype)).constructor=V,u})})(ze)),ze.exports}var Zt=Vt();const Yt=lt(Zt),Qe="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",We=r=>{if(!r)return new Date().toISOString();const a=r.trim();let l=_e(a,"d/M/yy",new Date);if(Se(l))return l.getFullYear()<2e3&&(l=Xe(l,100),l.getFullYear()<2e3&&l.setFullYear(2e3+parseInt(a.split(/[-/]/)[2]))),l.toISOString();if(l=_e(a,"d/M/yyyy",new Date),Se(l))return l.toISOString();const c=new Date(a);return isNaN(c.getTime())?new Date().toISOString():c.toISOString()},Jt=r=>{const{ticketConfig:a,setTicketConfig:l}=Fe(),{toast:c}=Ye(),y=Je(),h=z.useRef(!1);z.useEffect(()=>{if(!a?.autoSync||!Qe||!r||r.length===0)return;const p=async()=>{if(h.current)return;const T=new Date,u=T.toISOString().split("T")[0];if(a.lastSync===u)return;const[g,P]=a.syncTime.split(":"),I=new Date;if(I.setHours(parseInt(g),parseInt(P),0,0),T>=I){console.log("Adding Auto-Sync to Queue..."),h.current=!0;try{const f=await fetch(Qe);if(!f.ok)throw new Error("Failed to fetch CSV");const V=await f.text();Yt.parse(V,{header:!0,skipEmptyLines:!0,transformHeader:W=>W.trim(),complete:async W=>{try{const Z=W.data.map(m=>({ticketNumber:m["Ticket Number"]||m["Ticket No"]||"",shortDesc:m["Short Description & Detail"]||m.Detail||m.Description||"",status:m.Status||"Open",type:m["Ticket Type"]||"Incident",assign:m.Assign||"Unassigned",details:m.Detail||"",action:m.Ation||m.Action||"",resolvedDetail:m["Resolved detail"]||"",remark:m.Remark||"",date:We(m.Date),createdAt:We(m.Date)})).filter(m=>m.ticketNumber).filter(m=>{const A=r.find(re=>re.ticketNumber===m.ticketNumber);return A?A.status!==m.status||A.shortDesc!==m.shortDesc||A.assign!==m.assign||A.action!==m.action||(A.details||"")!==m.details||(A.remark||"")!==m.remark||(A.type||"Incident")!==m.type||(A.resolvedDetail||"")!==m.resolvedDetail:!0});Z.length>0?(await ge.importLogsFromSheet(Z),y.invalidateQueries({queryKey:["ticketLogs"]}),c({title:"Auto Sync Completed",description:`Synced ${Z.length} updates from Sheet.`})):console.log("Auto Sync: No updates found."),l({...a,lastSync:u})}catch(se){console.error("Auto Sync Parse Error:",se)}finally{h.current=!1}},error:W=>{console.error("Auto Sync CSV Error:",W),h.current=!1}})}catch(f){console.error("Auto Sync Fetch Error:",f),h.current=!1}}},N=setInterval(p,6e4);return p(),()=>clearInterval(N)},[a,r,y,l,c])},Ge="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Ve=r=>{if(!r)return new Date().toISOString();const a=new Date(r);if(!isNaN(a.getTime()))return a.toISOString();const l=String(r).trim();let c=_e(l,"d/M/yy",new Date);return Se(c)?(c.getFullYear()<2e3&&(c=Xe(c,100),c.getFullYear()<2e3&&c.setFullYear(2e3+parseInt(l.split(/[-/]/)[2]))),c.toISOString()):(c=_e(l,"d/M/yyyy",new Date),Se(c)?c.toISOString():new Date().toISOString())},je=z.memo(({label:r,value:a,variant:l})=>{const c={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${c[l]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:a}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:r})]})});je.displayName="StatBox";const Re=z.memo(({item:r,type:a})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${a==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",r.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:r.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${a==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:a==="new"?"New":"Update"})]}));Re.displayName="PreviewRow";function Xt({isOpen:r,onClose:a,onSyncComplete:l,currentLogs:c}){const{ticketConfig:y,setTicketConfig:h}=Fe(),[p,N]=z.useState("preview"),[T,u]=z.useState("input"),[g,P]=z.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[I,f]=z.useState(null),V=z.useCallback(()=>{u("input"),P({newItems:[],updatedItems:[],uptodateItems:[]}),f(null)},[]),W=z.useCallback(async()=>{u("analyzing"),f(null);try{const m=await fetch(Ge);if(!m.ok)throw new Error("Failed to fetch data from Apps Script ("+m.status+")");const A=await m.json();if(A.status==="error")throw new Error(A.message||"Unknown Script Error");const re=Array.isArray(A)?A:A.data||[];if(re.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const le=re.map(t=>({ticketNumber:t.ticketNo||t.ticketNumber||"",shortDesc:t.subject||t.shortDescription||t.description||"",status:t.status||"Open",type:t.ticketType||t.type||"Incident",assign:t.assignee||t.assign||"Unassigned",details:t.description||t.detail||"",action:t.actionTaken||t.action||"",resolvedDetail:t.resolutionNote||t.resolvedDetail||"",remark:t.remark||"",severity:t.severity||"Low",category:t.category||"",subCategory:t.subCategory||"",date:Ve(t.date||t.ticketDate||t.createdAt),createdAt:Ve(t.date||t.ticketDate||t.createdAt)})).filter(t=>t.ticketNumber),Y=[],D=[],s=[];le.forEach(t=>{const i=c.find(o=>o.ticketNumber===t.ticketNumber);i?i.status!==t.status||i.shortDesc!==t.shortDesc||i.assign!==t.assign||i.action!==t.action||(i.details||"")!==t.details||(i.remark||"")!==t.remark||(i.type||"Incident")!==t.type||(i.resolvedDetail||"")!==t.resolvedDetail||(i.category||"")!==t.category||(i.subCategory||"")!==t.subCategory||(i.severity||"Low")!==t.severity?D.push({...t,_prev:i}):s.push(t):Y.push(t)}),P({newItems:Y,updatedItems:D,uptodateItems:s}),u("review")}catch(m){console.error(m),f("Sync Error: "+m.message),u("input")}},[c]),se=z.useCallback(async()=>{u("saving");try{const A=[...g.newItems,...g.updatedItems].map(({_prev:re,...le})=>le);A.length>0&&await ge.importLogsFromSheet(A),l&&l(A.length),setTimeout(()=>{a(),V()},1500),u("success")}catch(m){f("Database Error: "+m.message),u("review")}},[g.newItems,g.updatedItems,l,a,V]);if(!r)return null;const Z=g.newItems.length+g.updatedItems.length;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-950 w-full max-w-lg rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Ae,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Sync Manager"}),e.jsxs("div",{className:"flex gap-3 mt-0.5",children:[e.jsx("button",{onClick:()=>N("preview"),className:`text-[9px] font-bold uppercase tracking-wider transition-colors ${p==="preview"?"text-blue-500":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"Manual Sync"}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-700",children:"|"}),e.jsx("button",{onClick:()=>N("schedule"),className:`text-[9px] font-bold uppercase tracking-wider transition-colors ${p==="schedule"?"text-blue-500":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"}`,children:"Auto Schedule"})]})]})]}),e.jsx("button",{onClick:a,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(Ce,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:[p==="schedule"&&e.jsxs("div",{className:"space-y-5 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(At,{size:24,className:"text-purple-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Auto-Sync Schedule"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Automatically sync from Google Sheets daily at your preferred time."})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 rounded-xl p-4 border border-zinc-100 dark:border-zinc-800 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"Enable Auto-Sync"}),e.jsx("div",{className:"text-[10px] text-zinc-400",children:"Sync in background"})]}),e.jsx("button",{onClick:()=>h({...y,autoSync:!y.autoSync}),className:`w-10 h-5 rounded-full transition-colors relative ${y.autoSync?"bg-emerald-500":"bg-zinc-300 dark:bg-zinc-700"}`,children:e.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ${y.autoSync?"translate-x-5":"translate-x-0"}`})})]}),y.autoSync&&e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-zinc-200 dark:border-zinc-700 animate-in fade-in slide-in-from-top-1 duration-150",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"Schedule Time"}),e.jsx("div",{className:"text-[10px] text-zinc-400",children:"Daily Execution"})]}),e.jsx("input",{type:"time",value:y.syncTime,onChange:m=>h({...y,syncTime:m.target.value}),className:"bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-1.5 font-mono text-sm font-bold text-zinc-900 dark:text-white outline-none focus:ring-2 focus:ring-purple-500/50"})]})]})]}),p==="preview"&&e.jsxs(e.Fragment,{children:[T==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(Ae,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),I&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(Tt,{size:14})," ",I]})]}),T==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(Ne,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),T==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(je,{label:"New",value:g.newItems.length,variant:"new"}),e.jsx(je,{label:"Updates",value:g.updatedItems.length,variant:"update"}),e.jsx(je,{label:"Unchanged",value:g.uptodateItems.length,variant:"unchanged"})]}),Z>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:"Preview Changes"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400",children:[Z," pending"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-xl overflow-hidden",children:e.jsxs("div",{className:"max-h-[200px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[g.newItems.map(m=>e.jsx(Re,{item:m,type:"new"},m.ticketNumber)),g.updatedItems.map(m=>e.jsx(Re,{item:m,type:"update"},m.ticketNumber))]})})]}):e.jsxs("div",{className:"py-6 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Te,{size:28,className:"mx-auto mb-2 text-emerald-500/50"}),e.jsx("h3",{className:"text-xs font-bold text-zinc-900 dark:text-white",children:"All Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-0.5",children:"Database matches remote source"})]})]}),T==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Te,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})]}),p==="preview"&&e.jsxs("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",children:[T==="input"&&e.jsxs("button",{onClick:W,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(Ot,{size:14})]}),T==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:V,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:se,disabled:Z===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(It,{size:14})," Confirm Sync"]})]}),T==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(Ne,{size:14,className:"animate-spin"})," Updating Database..."]})]}),p==="schedule"&&e.jsx("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end bg-zinc-50/50 dark:bg-zinc-900/30",children:e.jsx("button",{onClick:a,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})})]})})}const me=z.memo(({label:r,required:a,...l})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide flex items-center gap-1",children:[r," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...l,className:`w-full h-8 px-2.5 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white placeholder:text-zinc-400 outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all disabled:opacity-50 ${l.className||""}`})]}));me.displayName="CompactInput";const Oe=z.memo(({label:r,...a})=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:r}),e.jsx("textarea",{...a,className:`w-full px-2.5 py-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white placeholder:text-zinc-400 outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all resize-none ${a.className||""}`})]}));Oe.displayName="CompactTextarea";const we=z.memo(({label:r,value:a,onChange:l,options:c,required:y})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide flex items-center gap-1",children:[r," ",y&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a,onChange:h=>l(h.target.value),className:"w-full h-8 px-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-xs text-zinc-900 dark:text-white outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500 transition-all cursor-pointer",children:[e.jsx("option",{value:"",children:"Select..."}),c.map(h=>e.jsx("option",{value:h,children:h},h))]})]}));we.displayName="CompactSelect";const Ie=z.memo(({label:r,value:a,onChange:l,options:c,colorMap:y={}})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[9px] font-bold uppercase text-zinc-400 tracking-wide",children:r}),e.jsx("div",{className:"flex flex-wrap gap-1",children:c.map(h=>{const p=a===h,N=y[h?.toLowerCase()]||"zinc",T={red:"bg-red-500 text-white",orange:"bg-orange-500 text-white",amber:"bg-amber-500 text-white",emerald:"bg-emerald-500 text-white",blue:"bg-blue-500 text-white",purple:"bg-purple-500 text-white",zinc:"bg-zinc-900 dark:bg-white text-white dark:text-zinc-900"}[N];return e.jsx("button",{type:"button",onClick:()=>l(h),className:`px-2.5 py-1 rounded-md text-[10px] font-bold transition-all ${p?T:"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:h},h)})})]}));Ie.displayName="PillPicker";const Ze={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",assign:"",remark:""};function es({isOpen:r,onClose:a,initialData:l,onSubmit:c,isSubmitting:y}){const{ticketOptions:h}=et(),[p,N]=z.useState(Ze),T={open:"red",pending:"amber",succeed:"emerald",closed:"zinc"},u={low:"emerald",medium:"blue",high:"orange",critical:"red"};z.useEffect(()=>(r&&(N(l||Ze),document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[l,r]);const g=z.useCallback((f,V)=>{N(W=>({...W,[f]:V}))},[]),P=z.useCallback(f=>{f.preventDefault(),c(p)},[p,c]);if(!r)return null;const I=!!l;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-3 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"w-full max-w-xl bg-white dark:bg-zinc-950 rounded-xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${I?"bg-amber-500/10":"bg-blue-500/10"}`,children:e.jsx(dt,{size:14,className:I?"text-amber-500":"text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:I?"Edit Ticket":"New Ticket"}),I&&e.jsxs("p",{className:"text-[9px] text-zinc-400",children:["#",p.ticketNumber]})]})]}),e.jsx("button",{onClick:a,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(Ce,{size:16})})]}),e.jsxs("form",{id:"ticket-form",onSubmit:P,className:"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(me,{label:"Ticket Number",required:!0,disabled:I,value:p.ticketNumber,onChange:f=>g("ticketNumber",f.target.value),placeholder:"INC-0001"}),e.jsx(me,{label:"Assignee",value:p.assign,onChange:f=>g("assign",f.target.value),placeholder:"Person in charge"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(we,{label:"Type",value:p.type,onChange:f=>g("type",f),options:h.types||[]}),e.jsx(we,{label:"Category",value:p.category,onChange:f=>g("category",f),options:h.categories||[]}),e.jsx(we,{label:"Sub Category",value:p.subCategory,onChange:f=>g("subCategory",f),options:h.subCategories||[]})]}),e.jsx(Ie,{label:"Status",value:p.status,onChange:f=>g("status",f),options:h.statuses||[],colorMap:T}),e.jsx(Ie,{label:"Severity",value:p.severity,onChange:f=>g("severity",f),options:h.severities||[],colorMap:u}),e.jsx(me,{label:"Subject",required:!0,value:p.shortDesc,onChange:f=>g("shortDesc",f.target.value),placeholder:"Brief description of the issue"}),e.jsx(Oe,{label:"Details",rows:2,value:p.details,onChange:f=>g("details",f.target.value),placeholder:"Detailed description..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Oe,{label:"Action Taken",rows:2,value:p.action,onChange:f=>g("action",f.target.value),placeholder:"Steps taken..."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(me,{label:"Resolution",value:p.resolvedDetail,onChange:f=>g("resolvedDetail",f.target.value),placeholder:"How it was resolved"}),e.jsx(me,{label:"Remark",value:p.remark,onChange:f=>g("remark",f.target.value),placeholder:"Internal notes"})]})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-zinc-400",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Required"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"px-3 py-1.5 text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:y,className:`flex items-center gap-1.5 px-4 py-1.5 rounded-lg text-xs font-bold text-white transition-all active:scale-[0.98] disabled:opacity-50 ${I?"bg-amber-500 hover:bg-amber-600":"bg-blue-500 hover:bg-blue-600"}`,children:y?e.jsx(Ne,{size:14,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{size:14}),I?"Update":"Create"]})})]})]})]})})}const it=r=>{switch(r?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Le=r=>{switch(r?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},nt=z.memo(({log:r,onClick:a,onSendToIncident:l,onEdit:c,onDelete:y})=>{const h=r.createdAt?new Date(r.createdAt):null,p=h?h.getDate():"-",N=h?h.toLocaleDateString("en-GB",{month:"short"}):"-",T=z.useCallback(P=>{P.stopPropagation(),l(r,P)},[l,r]),u=z.useCallback(P=>{P.stopPropagation(),c(r)},[c,r]),g=z.useCallback(P=>{P.stopPropagation(),y(r.ticketNumber)},[y,r.ticketNumber]);return e.jsx("div",{onClick:a,className:"group bg-white dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 p-3 hover:border-zinc-300 dark:hover:border-zinc-700 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center w-10 h-10 bg-zinc-50 dark:bg-zinc-800 rounded-lg shrink-0 group-hover:bg-zinc-900 dark:group-hover:bg-white group-hover:text-white dark:group-hover:text-black transition-colors",children:[e.jsx("span",{className:"text-[8px] font-bold uppercase leading-none opacity-60",children:N}),e.jsx("span",{className:"text-sm font-black leading-none",children:p})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[e.jsxs("span",{className:"text-[10px] font-mono font-bold text-blue-500 bg-blue-50 dark:bg-blue-950/30 px-1.5 py-0.5 rounded",children:["#",r.ticketNumber]}),e.jsx("span",{className:`text-[8px] font-bold uppercase px-1.5 py-0.5 rounded border ${it(r.status)}`,children:r.status}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-700",children:"â€¢"}),e.jsx("span",{className:"text-[9px] font-medium text-zinc-400",children:r.type})]}),e.jsx("p",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-200 line-clamp-1 leading-snug",children:r.shortDesc||r.details||"No Description"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-zinc-400",children:[e.jsx(Et,{size:10}),e.jsx("span",{className:"text-[9px] font-medium",children:r.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xt,{size:10,className:Le(r.severity)}),e.jsx("span",{className:`text-[9px] font-medium ${Le(r.severity)}`,children:r.severity||"Low"})]})]})]}),e.jsxs("div",{className:"shrink-0 flex items-center gap-1",children:[e.jsx("button",{onClick:u,className:"p-1.5 rounded-lg text-zinc-300 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-950/30 transition-colors",title:"Edit",children:e.jsx(rt,{size:14})}),e.jsx("button",{onClick:g,className:"p-1.5 rounded-lg text-zinc-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-950/30 transition-colors",title:"Delete",children:e.jsx(tt,{size:14})}),e.jsxs("button",{onClick:T,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-zinc-50 dark:bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-900 dark:hover:bg-white dark:hover:text-black transition-colors active:scale-95",title:"Add to Timeline",children:[e.jsx(st,{size:12}),e.jsx("span",{className:"text-[9px] font-bold hidden sm:inline",children:"Incident"})]})]})]})})});nt.displayName="LogItem";const at=z.memo(({log:r,onClose:a,onSendToIncident:l,onEdit:c,onDelete:y})=>{if(!r)return null;const h=r.createdAt?_t(new Date(r.createdAt),"dd MMM yyyy"):"-";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 animate-in fade-in duration-150",onClick:a,children:e.jsxs("div",{className:"w-full max-w-xl bg-white dark:bg-zinc-950 rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[85vh] shadow-xl animate-in zoom-in-95 duration-200",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"px-6 py-5 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-xl font-black text-zinc-900 dark:text-white",children:["#",r.ticketNumber]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pt,{size:11})," ",h]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bt,{size:11})," ",r.type]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${it(r.status)}`,children:r.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:c,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(rt,{size:14})}),e.jsx("button",{onClick:y,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(tt,{size:14})}),e.jsx("button",{onClick:a,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(Ce,{size:16})})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${Le(r.severity)}`,children:r.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:r.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200",children:r.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono",children:r.details||r.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(ft,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:r.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Te,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:r.resolvedDetail||"Pending"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:r.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:r.assign||"Unassigned"})]})]}),e.jsxs("button",{onClick:()=>{l(),a()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(st,{size:14})," Add to Timeline"]})]})]})})});at.displayName="TicketDetailModal";function zs(){const{logs:r,loading:a,loadingMore:l,hasMore:c,loadMore:y,stats:h}=Wt(),{toast:p}=Ye(),{currentUser:N}=Fe(),{ticketOptions:T}=et(),u=ut(),g=Je(),[P,I]=z.useState(!1),[f,V]=z.useState(""),[W,se]=z.useState("All"),[Z,m]=z.useState("All"),[A,re]=z.useState(null),[le,Y]=z.useState(!1),[D,s]=z.useState(null),[t,i]=z.useState(!1),[o,d]=z.useState(null);Jt(r);const w=z.useCallback(()=>{s(null),Y(!0)},[]),U=z.useCallback(n=>{s(n),Y(!0)},[]),ee=z.useCallback(async n=>{i(!0);try{D?(await ge.updateLog(D.ticketNumber,n),p({title:"Updated",description:"Ticket updated successfully."})):(await ge.createLog(n),p({title:"Created",description:"New ticket created."})),g.invalidateQueries(["ticketLogs"]),Y(!1),s(null),re(null)}catch(k){console.error(k),p({variant:"destructive",title:"Error",description:k.message})}finally{i(!1)}},[D,g,p]),X=z.useCallback(n=>{d(n)},[]),S=z.useCallback(async()=>{if(o)try{await ge.deleteLog(o),p({title:"Deleted",description:"Ticket deleted."}),g.invalidateQueries(["ticketLogs"]),re(null)}catch(n){p({variant:"destructive",title:"Error",description:n.message})}finally{d(null)}},[o,g,p]),L=z.useCallback(async(n,k)=>{if(k&&k.stopPropagation(),!N){p({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const x=typeof N=="object"&&N!==null?{name:N.name,id:N.id,role:N.role}:{name:N},F={subject:n.shortDesc||n.details||"New Incident from Log",ticket:n.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(n.type)?n.type:"Incident",status:"Open",createdBy:x,impact:"",root_cause:n.details||"",action:n.action||""};await Dt.createIncident(F),p({title:"Successfully Added",description:`Ticket #${n.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>u("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(x){console.error(x),p({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[N,u,p]),b=z.useMemo(()=>r.filter(n=>{const k=n.ticketNumber?.toLowerCase().includes(f.toLowerCase())||n.shortDesc?.toLowerCase().includes(f.toLowerCase())||n.details&&n.details.toLowerCase().includes(f.toLowerCase()),x=W==="All"||n.status===W,F=Z==="All"||n.type===Z;return k&&x&&F}).sort((n,k)=>new Date(k.createdAt||0)-new Date(n.createdAt||0)),[r,f,W,Z]),H=z.useCallback(n=>{re(n)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-zinc-950 transition-colors",children:[e.jsx("div",{className:"shrink-0 py-4 px-5 bg-white dark:bg-zinc-900 border-b border-zinc-100 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[8px] font-bold rounded",children:"SYSTEM"}),e.jsxs("span",{className:"text-[10px] font-bold text-blue-500",children:[h.total," Records"]})]}),e.jsx("h1",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Ticket Log"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:w,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-lg text-[10px] font-bold bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(Pt,{size:12})," New"]}),e.jsxs("button",{onClick:()=>I(!0),disabled:a,className:"flex items-center gap-1.5 px-3.5 py-2 rounded-lg text-[10px] font-bold bg-emerald-500 text-white hover:bg-emerald-600 active:scale-95 transition-all",children:[e.jsx(Ae,{size:12})," Sync"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Rt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:f,onChange:n=>V(n.target.value),className:"w-full h-9 pl-9 pr-9 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500/30 transition-all"}),f&&e.jsx("button",{onClick:()=>V(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200",children:e.jsx(Ce,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-50 dark:bg-zinc-800 px-3 py-1.5 rounded-lg border border-zinc-200 dark:border-zinc-700",children:[e.jsx(Ct,{size:12,className:"text-zinc-400"}),e.jsxs("select",{value:W,onChange:n=>se(n.target.value),className:"bg-transparent text-xs font-medium outline-none cursor-pointer text-zinc-600 dark:text-zinc-300",children:[e.jsx("option",{value:"All",children:"All Status"}),T.statuses.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx("div",{className:"w-px h-4 bg-zinc-200 dark:bg-zinc-600"}),e.jsxs("select",{value:Z,onChange:n=>m(n.target.value),className:"bg-transparent text-xs font-medium outline-none cursor-pointer text-zinc-600 dark:text-zinc-300",children:[e.jsx("option",{value:"All",children:"All Types"}),T.types.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:a?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-3 border-zinc-200 dark:border-zinc-700 border-t-zinc-900 dark:border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ft,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{V(""),se("All"),m("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs("div",{className:"space-y-2",children:[b.map(n=>e.jsx(nt,{log:n,onClick:()=>H(n),onSendToIncident:L,onEdit:U,onDelete:X},n.id)),c&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:y,disabled:l,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:l?e.jsx(Ne,{className:"animate-spin",size:16}):e.jsx(Ut,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),A&&e.jsx(at,{log:A,onClose:()=>re(null),onSendToIncident:()=>L(A),onEdit:()=>U(A),onDelete:()=>X(A.ticketNumber)}),e.jsx(es,{isOpen:le,onClose:()=>Y(!1),initialData:D,onSubmit:ee,isSubmitting:t}),e.jsx(ht,{isOpen:!!o,onClose:()=>d(null),onConfirm:S,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${o}? This action cannot be undone.`,isDanger:!0}),e.jsx(Xt,{isOpen:P,onClose:()=>I(!1),currentLogs:r,onSyncComplete:n=>{p({title:"Sync Completed",description:`Updated ${n} records.`}),g.invalidateQueries({queryKey:["ticketLogs"]}),I(!1)}})]})}export{zs as default};
