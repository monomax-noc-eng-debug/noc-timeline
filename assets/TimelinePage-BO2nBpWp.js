import{c as R,r as n,j as e,b as L,T as me,X as K,L as je,R as de,d as Ke,C as Oe,F as Ae,A as xe,e as ze,S as Je,a as Re,h as Qe,f as Ye,g as Le}from"./index-B5gZUy_b.js";import{i as H}from"./incidentService-DcJgIx8b.js";import{u as Pe,U as et,a as tt}from"./useTicketOptions-CjlqhcHA.js";import{T as Q}from"./trash-2-BnvYA_d1.js";import{H as oe}from"./hash-C4LDxFEl.js";import{C as ye}from"./chevron-right-CErjX4nG.js";import{C as J}from"./circle-alert-CaNzur3n.js";import{C as re}from"./circle-check-DyaCxfhJ.js";import{C as W}from"./clock-hKLIUH9B.js";import{L as we}from"./layers-HGzSMS0U.js";import{S as rt}from"./search-C_CHO80W.js";import{S as st}from"./sliders-horizontal-CooVqGG4.js";import{P as se}from"./plus-BnYRYgUJ.js";import{C as at}from"./chevron-left-ggRkBnJb.js";import{C as nt,P as ae,B as he}from"./badge-f5N6yqSJ.js";import{C as it}from"./chevron-down-Dt1j9vQ8.js";import{S as ne}from"./shield-check-CKuJ_Zxx.js";import{P as _e}from"./panels-top-left-ADktj7f5.js";import{C as Ue}from"./check-DRiuiuXZ.js";import{S as Fe}from"./save-DSxoUrLg.js";import{C as ot}from"./copy-DUHLAVYi.js";import{c as ct}from"./configService-Bpcp19QX.js";import{Z as Be}from"./zap-DOh-sc34.js";import{B as ce}from"./button-DqjdshVh.js";import{A as lt}from"./arrow-left-DMHcKBmn.js";import{f as He}from"./format-B568ns5f.js";import{A as Ve}from"./arrow-right-BDuAE9MA.js";import{T as dt}from"./tag-BiwUdZ_o.js";import{L as xt}from"./layout-list-m9MHHpGE.js";import"./firebaseConfig-hLvP2kJq.js";import"./useBaseQuery-Bu4CR-PA.js";const mt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ut=R("circle-play",mt);const bt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],We=R("circle-x",bt);const ht=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],pt=R("cloud-upload",ht);const gt=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ne=R("download",gt);const ft=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],kt=R("file-plus-corner",ft);const jt=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],wt=R("fingerprint-pattern",jt);const vt=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],zt=R("flag",vt);const yt=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],Te=R("folder-kanban",yt);const Nt=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],Ct=R("image-off",Nt);const St=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],Et=R("image-plus",St);const Lt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Tt=R("image",Lt);const Mt=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Me=R("inbox",Mt);const Dt=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],It=R("layout-dashboard",Dt);const $t=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Ot=R("link",$t);const At=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],De=R("maximize-2",At);const Rt=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ve=R("message-square",Rt);const Pt=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Ie=R("minimize-2",Pt);const _t=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Ut=R("move",_t);const Ft=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Bt=R("workflow",Ft);const Ht=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Vt=R("wrench",Ht),Wt=()=>{const[t,r]=n.useState([]),[a,o]=n.useState(null),[c,f]=n.useState(!0),[m,x]=n.useState(""),[l,k]=n.useState("All"),[d,y]=n.useState("All");n.useEffect(()=>{f(!0);const w=H.subscribeIncidents(p=>{r(p||[]),f(!1)});return()=>w&&w()},[]);const C=n.useMemo(()=>{const w=m.toLowerCase().trim();return t.filter(p=>{const i=!w||(p.subject||"").toLowerCase().includes(w)||(p.project||"").toLowerCase().includes(w)||(p.ticket||"").toLowerCase().includes(w)||(p.createdBy?.name||p.createdBy||"").toLowerCase().includes(w),S=l==="All"||p.status===l,T=d==="All"||p.type===d;return i&&S&&T}).sort((p,i)=>{const S=p._sortTime||0;return(i._sortTime||0)-S})},[t,m,l,d]),D=n.useMemo(()=>{const w={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((p,i)=>{p.total++;const S=i.status?.replace(" ","").replace(/^\w/,T=>T.toLowerCase());return p[S]!==void 0?p[S]++:i.status==="In Progress"&&p.inProgress++,p},w)},[t]),v=n.useCallback(()=>{x(""),k("All"),y("All")},[]);return{incidents:t,filteredIncidents:C,selectedId:a,setSelectedId:o,loading:c,searchTerm:m,setSearchTerm:x,filterStatus:l,setFilterStatus:k,filterType:d,setFilterType:y,clearFilters:v,hasActiveFilters:!!m||l!=="All"||d!=="All",stats:D}},qt=t=>{const[r,a]=n.useState([]),[o,c]=n.useState(!1),[f,m]=n.useState(null);n.useEffect(()=>{if(!t){a([]),c(!1);return}c(!0);const k=H.subscribeEvents(t,d=>{const y=d.map(C=>({...C,_sortTime:new Date(`${C.date||"1970-01-01"}T${C.time||"00:00"}`).getTime()}));a(y),c(!1)});return()=>k()},[t]);const x=n.useMemo(()=>[...r].sort((k,d)=>k._sortTime!==d._sortTime?d._sortTime-k._sortTime:(d.order||0)-(k.order||0)),[r]),l=n.useMemo(()=>({total:r.length,withImages:r.filter(k=>k.imageUrls&&k.imageUrls.length>0).length,dateRange:x.length>0?{start:x[x.length-1]?.date,end:x[0]?.date}:null}),[r,x]);return{events:r,sortedEvents:x,loading:o,error:f,stats:l}},Gt=t=>{switch(t){case"Open":return{dot:"bg-rose-600",badge:"bg-rose-600/10 text-rose-600 border-rose-600/20",icon:J,gradient:"from-rose-600 to-rose-700"};case"In Progress":return{dot:"bg-indigo-600",badge:"bg-indigo-600/10 text-indigo-600 border-indigo-600/20",icon:ut,gradient:"from-indigo-600 to-indigo-700"};case"Monitoring":return{dot:"bg-orange-600",badge:"bg-orange-600/10 text-orange-600 border-orange-600/20",icon:W,gradient:"from-orange-600 to-orange-700"};case"Pending":return{dot:"bg-amber-600",badge:"bg-amber-600/10 text-amber-600 border-amber-600/20",icon:W,gradient:"from-amber-600 to-amber-700"};case"Succeed":case"Resolved":return{dot:"bg-emerald-600",badge:"bg-emerald-600/10 text-emerald-600 border-emerald-600/20",icon:re,gradient:"from-emerald-600 to-emerald-700"};case"Closed":return{dot:"bg-zinc-500",badge:"bg-zinc-100 text-zinc-500 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400",icon:We,gradient:"from-zinc-500 to-zinc-600"};default:return{dot:"bg-zinc-500",badge:"bg-zinc-100 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400",icon:J,gradient:"from-zinc-500 to-zinc-600"}}},Zt=t=>{switch(t){case"Critical":return{label:"CRIT",color:"text-rose-600 dark:text-rose-500",bg:"bg-rose-50 dark:bg-rose-900/20"};case"High":return{label:"HIGH",color:"text-orange-600 dark:text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"};case"Medium":return{label:"MED",color:"text-indigo-600 dark:text-indigo-500",bg:"bg-indigo-50 dark:bg-indigo-900/20"};case"Low":return{label:"LOW",color:"text-emerald-600 dark:text-emerald-500",bg:"bg-emerald-50 dark:bg-emerald-900/20"};default:return{label:"MED",color:"text-zinc-600",bg:"bg-zinc-50 dark:bg-zinc-800"}}},Xt=n.memo(({incident:t,isSelected:r,onClick:a,onDelete:o})=>{const c=Gt(t.status),f=Zt(t.priority||"Medium"),m=c.icon,x=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:a,className:L("group relative p-4 rounded-[2rem] border transition-all duration-300 cursor-pointer overflow-hidden mb-4",r?"bg-card border-foreground shadow-xl scale-[1.02] z-10":"bg-card/50 border-border hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-1"),children:[r&&e.jsx("div",{className:L("absolute top-0 bottom-0 left-0 w-2.5 bg-gradient-to-b",c.gradient)}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-xl bg-foreground text-background border border-transparent shadow-lg",children:[e.jsx("span",{className:L("w-2 h-2 rounded-full",c.dot,t.status==="Open"?"animate-pulse":"")}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.15em]",children:t.project||"CORE"})]}),e.jsx("div",{className:L("px-3 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest border border-transparent transition-colors",t.type==="Incident"?"bg-rose-600/10 text-rose-600":t.type==="Request"?"bg-indigo-600/10 text-indigo-600":"bg-amber-600/10 text-amber-600"),children:t.type||"EVENT"}),e.jsx("div",{className:L("px-2 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest border border-transparent shadow-sm",f.bg,f.color),children:f.label})]}),!r&&e.jsx("button",{onClick:l=>{l.stopPropagation(),o(t.id)},className:"w-9 h-9 flex items-center justify-center text-zinc-300 hover:text-rose-500 lg:opacity-0 group-hover:opacity-100 hover:bg-rose-50 dark:hover:bg-rose-950/20 rounded-xl transition-all active:scale-90",title:"Delete Incident Record",children:e.jsx(Q,{size:16})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("h3",{className:L("text-sm md:text-base font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors uppercase tracking-tight",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.subject||"UNTITLED OPERATION"})}),e.jsxs("div",{className:"flex justify-between items-center pt-5 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-400 bg-zinc-50 dark:bg-zinc-900/50 px-3 py-1 rounded-full border border-zinc-100 dark:border-zinc-800",children:[e.jsx(oe,{size:12,strokeWidth:3,className:"text-blue-500/50"}),e.jsx("span",{className:"text-[10px] font-black tabular-nums tracking-wider truncate max-w-[100px]",children:t.ticket||"UNLINKED"})]}),e.jsx("div",{className:"flex items-center gap-1.5 text-zinc-300 font-black text-[9px] uppercase tracking-widest",children:x})]}),e.jsxs("div",{className:L("flex items-center gap-2 px-3 py-1 rounded-full border shadow-sm transition-transform group-hover:scale-105",c.badge),children:[e.jsx(m,{size:12,strokeWidth:3}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tight",children:t.status})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(ye,{size:20,className:"text-zinc-300"})})]})}),Kt=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},$e=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Jt=n.memo(({log:t,isSelected:r,onClick:a})=>{const o=t.createdAt?new Date(t.createdAt):null,c=o?o.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:a,className:L("group relative p-4 rounded-[2rem] border transition-all duration-300 cursor-pointer overflow-hidden mb-3",r?"bg-white dark:bg-[#09090b] border-zinc-900 dark:border-zinc-500 shadow-xl shadow-zinc-200/50 dark:shadow-none scale-[1.02] z-10":"bg-white dark:bg-[#0c0c0e] border-zinc-100 dark:border-zinc-800/50 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-1"),children:[r&&e.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-2 bg-zinc-900 dark:bg-white"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:L("px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border",Kt(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:c})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:L("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(me,{size:10,className:L("shrink-0",$e(t.severity))}),e.jsx("span",{className:L("text-[9px] font-black uppercase tracking-widest",$e(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(ye,{size:18,className:"text-zinc-300"})})]})});function Qt(t,r){const[a,o]=n.useState(t);return n.useEffect(()=>{const c=setTimeout(()=>o(t),r);return()=>clearTimeout(c)},[t,r]),a}const Yt=({filteredIncidents:t,selectedId:r,onSelect:a,onAddIncident:o,onDeleteIncident:c,onExportCSV:f,stats:m,logs:x,selectedLogId:l,onSelectLog:k,logsLoading:d,logStats:y,viewMode:C,onViewModeChange:D,searchTerm:v,setSearchTerm:h,filterStatus:w,setFilterStatus:p,filterType:i,setFilterType:S,clearFilters:T,hasActiveFilters:I,loading:U,canEdit:_})=>{const{ticketOptions:F}=Pe(),[u,M]=n.useState(v),$=Qt(u,300),[s,b]=n.useState(!1);n.useEffect(()=>{h($)},[$,h]),n.useEffect(()=>{M(v)},[v]);const[N,z]=n.useState(20),A=n.useRef(null),E=C==="logs",P=E?x:t,B=E?d:U;n.useEffect(()=>{z(20)},[P?.length,C,w,i,$]),n.useEffect(()=>{const j=new IntersectionObserver(G=>{G[0].isIntersecting&&P?.length>N&&z(Y=>Y+20)},{threshold:.1});return A.current&&j.observe(A.current),()=>j.disconnect()},[P,N]);const q=j=>{p(j===w?"All":j)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsx("header",{className:"shrink-0 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 sticky top-0",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shadow-sm transition-colors ${E?"bg-indigo-600 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-black"}`,children:E?e.jsx(Me,{size:20}):e.jsx(we,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-black tracking-tight text-zinc-900 dark:text-white leading-none",children:E?"Inbox":"Cases"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("button",{onClick:()=>D("incidents"),className:`text-[10px] font-bold uppercase transition-colors ${E?"text-zinc-400 hover:text-zinc-600":"text-zinc-900 dark:text-white underline decoration-2 decoration-zinc-900 dark:decoration-white underline-offset-4"}`,children:"Cases"}),e.jsx("button",{onClick:()=>D("logs"),className:`text-[10px] font-bold uppercase transition-colors ${E?"text-indigo-600 dark:text-indigo-400 underline decoration-2 decoration-indigo-600 underline-offset-4":"text-zinc-400 hover:text-zinc-600"}`,children:"Logs"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(t),className:"hidden md:flex w-9 h-9 items-center justify-center rounded-lg border border-zinc-200 dark:border-zinc-800 text-zinc-400 hover:text-indigo-500 hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all",title:"Export CSV",children:e.jsx(Ne,{size:16})}),_&&e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-xs font-bold shadow-md hover:opacity-90 transition-all whitespace-nowrap",children:[e.jsx(kt,{size:16})," ",e.jsx("span",{className:"hidden lg:inline",children:"New Case"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(rt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:u,onChange:j=>M(j.target.value),placeholder:E?"Search logs...":"Search cases...",className:"w-full h-10 pl-10 pr-8 rounded-xl bg-zinc-100 dark:bg-zinc-900 border-none text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),u&&e.jsx("button",{onClick:()=>M(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(K,{size:14})})]}),e.jsxs("button",{onClick:()=>b(!0),className:`h-10 px-3 flex items-center justify-center rounded-xl transition-all border ${I?"bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 border-indigo-200 dark:border-indigo-800":"bg-zinc-100 dark:bg-zinc-900 text-zinc-500 border-transparent"}`,children:[e.jsx(st,{size:18}),I&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-indigo-500 rounded-full"})]})]}),!E&&m&&e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-1",children:[{label:"Open",count:m.open,color:"bg-red-500"},{label:"Pending",count:m.pending,color:"bg-amber-500"},{label:"Resolved",count:m.resolved,color:"bg-emerald-500"}].map(j=>e.jsxs("button",{onClick:()=>q(j.label),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-[10px] font-bold uppercase transition-all whitespace-nowrap flex-shrink-0
                      ${w===j.label?"bg-zinc-900 dark:bg-white text-white dark:text-black border-zinc-900":"bg-white dark:bg-zinc-900 text-zinc-500 border-zinc-200 dark:border-zinc-800"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${j.color}`}),j.label," ",e.jsxs("span",{className:"opacity-60",children:["(",j.count,")"]})]},j.label))})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:B&&N===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(je,{className:"animate-spin text-indigo-600",size:32}),e.jsx("p",{className:"text-xs font-bold text-zinc-400",children:"Loading data..."})]}):P?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[E?e.jsx(Me,{size:48,strokeWidth:1}):e.jsx(we,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),I&&e.jsx("button",{onClick:T,className:"mt-2 text-xs text-indigo-500 font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-3 pb-20 md:pb-4 w-full",children:[P.slice(0,N).map(j=>E?e.jsx(Jt,{log:j,isSelected:l===(j.ticketNumber||j.id),onClick:()=>k(j)},j.ticketNumber||j.id):e.jsx(Xt,{incident:j,isSelected:r===j.id,onClick:()=>a(j.id),onDelete:c},j.id)),e.jsx("div",{ref:A,className:"h-4 w-full"})]})}),s&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-3xl p-6 shadow-2xl animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Filters"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-full",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase block mb-3",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.statuses].map(j=>e.jsx("button",{onClick:()=>p(j),className:`px-4 py-2.5 rounded-xl text-xs font-bold border transition-all ${w===j?"bg-zinc-900 text-white dark:bg-white dark:text-black border-zinc-900":"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-zinc-400 uppercase block mb-3",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.types].map(j=>e.jsx("button",{onClick:()=>S(j),className:`px-4 py-2.5 rounded-xl text-xs font-bold border transition-all ${i===j?"bg-zinc-900 text-white dark:bg-white dark:text-black border-zinc-900":"bg-zinc-50 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]})]}),e.jsxs("div",{className:"mt-8 flex gap-3",children:[e.jsx("button",{onClick:()=>{T(),b(!1)},className:"flex-1 py-3.5 text-red-500 font-bold bg-red-50 dark:bg-red-900/20 rounded-xl hover:bg-red-100 transition-colors",children:"Reset"}),e.jsx("button",{onClick:()=>b(!1),className:"flex-[2] py-3.5 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors",children:"Done"})]})]})]}),!E&&_&&e.jsx("button",{onClick:o,className:"md:hidden absolute bottom-6 right-6 z-40 w-12 h-12 bg-indigo-600 text-white rounded-full shadow-xl shadow-indigo-600/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(se,{size:24})})]})},er=n.memo(Yt),ie=t=>{if(!t)return"";try{const r=new URL(t);if(r.hostname.includes("drive.google.com")||r.hostname.includes("docs.google.com")){let a=r.searchParams.get("id");if(!a){const o=r.pathname.split("/"),c=o.indexOf("d");c!==-1&&o[c+1]&&(a=o[c+1])}if(a)return`https://lh3.googleusercontent.com/d/${a}`}return r.hostname.includes("dropbox.com")?(r.searchParams.set("raw","1"),r.searchParams.delete("dl"),r.toString()):t}catch{return t}};function tr({isOpen:t,onClose:r,imageUrl:a,allImages:o=[],initialIndex:c=0}){const[f,m]=n.useState(c),[x,l]=n.useState(1),[k,d]=n.useState({x:0,y:0}),[y,C]=n.useState(!1),[D,v]=n.useState({x:0,y:0}),h=o.length>0?o:[a],w=h[f]||a,p=de.useRef(null),[i,S]=n.useState(!1);n.useEffect(()=>{const s=()=>S(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]),n.useEffect(()=>{const s=b=>{if(t)switch(b.key){case"ArrowRight":U();break;case"ArrowLeft":_();break;case"Escape":document.fullscreenElement?document.exitFullscreen():r();break;case"f":case"F":T();break;case"0":I();break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t,f,h.length,x]),n.useEffect(()=>{const s=p.current;if(!s)return;const b=N=>{if(!t)return;N.preventDefault();const A=-N.deltaY>0?1.1:.9,E=Math.min(Math.max(x*A,.5),10);l(E),E<=1&&d({x:0,y:0})};return s.addEventListener("wheel",b,{passive:!1}),()=>s.removeEventListener("wheel",b)},[t,x]);const T=s=>{s?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():p.current?.requestFullscreen().catch(b=>{console.error("Fullscreen failed:",b)})},I=()=>{l(1),d({x:0,y:0})};if(n.useEffect(()=>(t?(m(c||(a&&o.indexOf(a)>=0?o.indexOf(a):0)),I(),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t,c,a,o]),!t)return null;const U=s=>{s?.stopPropagation(),m(b=>(b+1)%h.length),I()},_=s=>{s?.stopPropagation(),m(b=>(b-1+h.length)%h.length),I()},F=s=>{x<=1||(s.preventDefault(),C(!0),v({x:s.clientX-k.x,y:s.clientY-k.y}))},u=s=>{!y||x<=1||(s.preventDefault(),d({x:s.clientX-D.x,y:s.clientY-D.y}))},M=()=>{C(!1)},$=s=>{s?.stopPropagation(),x===1?l(2.5):I()};return Ke.createPortal(e.jsxs("div",{ref:p,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${y?"cursor-grabbing":""}`,onClick:r,onMouseMove:u,onMouseUp:M,onMouseLeave:M,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:T,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:i?e.jsx(Ie,{size:24,className:"text-white"}):e.jsx(De,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",f+1," of ",h.length," • Click to ",i?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:$,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${x>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:x>1?"Reset Zoom":"Quick Zoom",children:x>1?e.jsx(Ie,{size:22}):e.jsx(De,{size:22})}),e.jsx("a",{href:ie(w),download:!0,target:"_blank",rel:"noreferrer",onClick:s=>s.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(Ne,{size:22})}),e.jsx("button",{onClick:r,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(K,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${k.x}px, ${k.y}px) scale(${x})`,cursor:x>1?y?"grabbing":"grab":"zoom-in"},onClick:s=>{s.stopPropagation(),x===1?l(2.5):I()},onMouseDown:F,children:[e.jsx("img",{src:ie(w),alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},onError:s=>{s.target.src="https://placehold.co/1200x800?text=Failed+to+load+image"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:x===1&&e.jsx(Ut,{size:64,className:"text-white/10"})})]})}),h.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(at,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:U,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(ye,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[h.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:h.map((s,b)=>e.jsx("button",{onClick:N=>{N.stopPropagation(),m(b),setIsZoomed(!1)},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${f===b?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},b))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",w.split("/").pop().substring(0,60)]})})]})]}),document.body)}const rr=t=>{const r=t.type?.toLowerCase()||"",a=t.desc?.toLowerCase()||"",o={message:ve,alert:J,check:re,clock:W,update:ae},c=t.iconType?o[t.iconType]:null;return r==="create"||a.includes("created")?{icon:c||se,colorClass:"text-indigo-600 bg-indigo-500/10 border-indigo-500/20"}:r==="update"||a.includes("updated")?{icon:c||ae,colorClass:"text-amber-600 bg-amber-500/10 border-amber-500/20"}:r==="status_change"||a.includes("resolved")||a.includes("closed")||a.includes("succeed")?{icon:c||re,colorClass:"text-emerald-600 bg-emerald-500/10 border-emerald-500/20"}:r==="alert"||a.includes("alert")||a.includes("error")||a.includes("failed")?{icon:c||J,colorClass:"text-rose-600 bg-rose-500/10 border-rose-500/20"}:{icon:c||ve,colorClass:"text-zinc-500 bg-zinc-100 dark:bg-zinc-800/50 border-zinc-200 dark:border-zinc-700"}},sr=t=>{switch(t){case"rose":return"bg-rose-600 text-white border-rose-500 shadow-rose-900/10";case"emerald":return"bg-emerald-600 text-white border-emerald-500 shadow-emerald-900/10";case"white":default:return"bg-zinc-100 text-zinc-900 border-zinc-200 shadow-sm dark:bg-zinc-200 dark:text-zinc-950"}},ar=t=>{switch(t){case"rose":return"text-rose-400 bg-rose-500/10 border-rose-500/30 shadow-rose-500/10";case"emerald":return"text-emerald-400 bg-emerald-500/10 border-emerald-500/30 shadow-emerald-500/10";case"white":return"text-white bg-white/10 border-white/20 shadow-white/5";default:return null}},nr=({src:t,index:r,onClick:a,className:o})=>{const[c,f]=n.useState(!1),m=n.useMemo(()=>{if(!t)return null;try{return typeof t=="object"&&(t instanceof File||t instanceof Blob)?URL.createObjectURL(t):typeof t=="string"?ie(t):null}catch(x){return console.error("Error processing image source:",x),null}},[t]);return c||!m?e.jsxs("div",{className:L(o,"flex flex-col items-center justify-center bg-zinc-900/50 border border-zinc-800 cursor-not-allowed"),title:"Image failed to load",children:[e.jsx(Ct,{className:"text-zinc-600 mb-1",size:16}),e.jsx("span",{className:"text-[8px] font-bold text-zinc-600 uppercase tracking-widest",children:"N/A"})]}):e.jsxs("button",{onClick:()=>a(m),className:L("relative group/img overflow-hidden cursor-zoom-in",o),children:[e.jsx("img",{src:m,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-1000 group-hover/img:scale-110",onError:()=>f(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-indigo-600/0 group-hover/img:bg-indigo-600/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(Tt,{size:16,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-4 transition-all duration-500"})})]})};function ir({event:t,index:r,isLastItem:a,onEdit:o,onDelete:c,onMove:f}){const[m,x]=n.useState(null),{icon:l,colorClass:k}=rr(t),y=ar(t.statusOnLineColor)||k,D=(t.date?new Date(t.date):new Date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),v=t.time||"00:00";let h=(t.imageUrls||[]).filter(w=>w);return!h.length&&t.image&&(h=[t.image]),e.jsxs("div",{className:"group relative flex w-full animate-in fade-in slide-in-from-bottom-6 duration-700",children:[e.jsxs("div",{className:"hidden lg:flex flex-col items-center w-24 shrink-0 pt-1.5 z-10 transition-all",children:[e.jsx("span",{className:"text-base font-black text-foreground tracking-widest tabular-nums uppercase leading-none",children:v}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-[0.2em] mt-1.5 whitespace-nowrap",children:D})]}),e.jsxs("div",{className:"relative flex flex-col items-center mr-4 md:mr-6 shrink-0",children:[t.statusOnLine&&e.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 z-30 pointer-events-none",children:e.jsx("div",{className:L("text-[8px] font-black uppercase px-3 py-1 rounded-full shadow-lg tracking-[0.2em] border",sr(t.statusOnLineColor||"white")),children:t.statusOnLine})}),e.jsx("div",{className:L("w-8 h-8 rounded-lg flex items-center justify-center border shadow-xl z-20 transition-all duration-500 group-hover:scale-110 bg-card border-border",y),children:e.jsx(l,{size:14,strokeWidth:2.5})}),!a&&e.jsx("div",{className:"absolute top-8 bottom-0 w-px bg-border/50 -z-10 group-hover:bg-border transition-colors"})]}),e.jsx("div",{className:"flex-1 min-w-0 pb-10",children:e.jsxs("div",{className:"bg-card border border-border rounded-[1.5rem] p-5 md:p-6 md:pt-8 shadow-xl transition-all duration-500 relative group/card overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-primary/5 blur-[60px] rounded-full pointer-events-none group-hover/card:bg-primary/10 transition-all duration-700"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4 relative z-10",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex lg:hidden items-center gap-2 mb-3",children:e.jsxs("div",{className:"px-3 py-1 rounded-full bg-secondary border border-border text-[9px] font-black text-zinc-400 tabular-nums uppercase tracking-[0.2em]",children:[v," • ",D]})}),e.jsx("h4",{className:"text-base font-black text-foreground tracking-widest leading-none uppercase group-hover/card:text-primary transition-colors duration-500",children:t.title||"OPERATIONAL UPDATE"})]}),e.jsxs("div",{className:"flex items-center gap-2 md:opacity-0 md:group-hover/card:opacity-100 transition-all duration-500 shrink-0",children:[f&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1.5 rounded-xl bg-zinc-900/50 border border-zinc-800",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),f(r,"up")},className:"w-7 h-7 flex items-center justify-center rounded-lg bg-zinc-800 text-zinc-500 hover:text-white hover:bg-zinc-700 transition-all active:scale-95",children:e.jsx(nt,{size:14})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),f(r,"down")},className:"w-7 h-7 flex items-center justify-center rounded-lg bg-zinc-800 text-zinc-500 hover:text-white hover:bg-zinc-700 transition-all active:scale-95",children:e.jsx(it,{size:14})})]}),e.jsx("button",{onClick:()=>o(t),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-900 border border-zinc-800 text-zinc-500 hover:text-blue-400 hover:border-blue-500/30 transition-all shadow-xl active:scale-95",children:e.jsx(ae,{size:16})}),e.jsx("button",{onClick:()=>c(t.id),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-900 border border-zinc-800 text-zinc-500 hover:text-rose-400 hover:border-rose-500/30 transition-all shadow-xl active:scale-95",children:e.jsx(Q,{size:16})})]})]}),e.jsxs("div",{className:"space-y-5 relative z-10",children:[e.jsx("p",{className:"text-sm text-zinc-400 leading-relaxed whitespace-pre-wrap font-medium tracking-normal text-justify md:text-left",children:t.desc||t.details}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 pt-1",children:h.map((w,p)=>e.jsx(nr,{index:p,src:w,onClick:x,className:"w-20 h-20 md:w-24 md:h-24 rounded-2xl border border-zinc-800 shadow-xl active:scale-95"},p))})]}),(t.updatedBy||t.createdBy)&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-border flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-foreground text-background flex items-center justify-center text-[10px] font-black shadow-lg",children:(t.updatedBy||t.createdBy||"u").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] font-bold text-zinc-500 uppercase tracking-widest leading-none mb-1",children:"Lead Operator"}),e.jsxs("p",{className:"text-[10px] font-black text-foreground group-hover:text-primary transition-colors uppercase tracking-widest leading-none",children:["@",t.updatedBy||t.createdBy]})]})]}),h.length>0&&e.jsxs("div",{className:"bg-secondary px-2.5 py-1 rounded-full border border-border text-[8px] font-black text-zinc-400 uppercase tracking-[0.2em] flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),h.length," RECORDS"]})]})]})}),e.jsx(tr,{isOpen:!!m,onClose:()=>x(null),imageUrl:m,allImages:h})]})}const or=n.memo(ir),cr=async t=>{const r="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec";try{return await(await fetch(r,{method:"POST",body:JSON.stringify(t)})).json()}catch(a){return{result:"error",error:a.message}}},lr=async t=>{try{return new Promise((r,a)=>{const o=new FileReader;o.readAsDataURL(t),o.onload=async()=>{const c=o.result.split(",")[1],f=await cr({base64:c,fileName:t.name,mimeType:t.type});r(f)},o.onerror=c=>a(c)})}catch(r){return{result:"error",error:r.message}}},pe=n.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),ge=n.memo(({error:t,className:r,...a})=>e.jsx("input",{...a,className:L("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-indigo-500/50 focus:ring-4 focus:ring-indigo-500/5",t?"border-rose-500":"",r)})),le=n.memo(({children:t,title:r,icon:a,badge:o})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[a&&e.jsx(a,{size:14,className:"text-zinc-400 group-hover/row:text-indigo-500 transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase tracking-[0.2em]",children:r})]}),o&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:o})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function dr({isOpen:t,onClose:r,onSubmit:a,onDelete:o,initialData:c,saving:f=!1}){const[m,x]=n.useState({date:"",time:"",desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]}),[l,k]=n.useState(c?.imageUrls?.length>0),[d,y]=n.useState(""),[C,D]=n.useState(!1),[v,h]=n.useState(0),[w,p]=n.useState({}),[i,S]=n.useState({isOpen:!1,type:null,index:null}),T=n.useRef(null);n.useEffect(()=>{const u=M=>{M.key==="Escape"&&!f&&r()};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[r,f]),n.useEffect(()=>{if(t){if(c){let u=c.imageUrls||[];!u.length&&c.image&&(u=[c.image]),x({...c,imageUrls:u}),k(u.length>0)}else{const u=new Date;x({date:u.toISOString().split("T")[0],time:`${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`,desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]}),k(!1)}y(""),p({})}},[t,c]);const I=u=>{const M=u||d;M&&!m.imageUrls.includes(M)&&(x($=>({...$,imageUrls:[...$.imageUrls,M]})),y(""))},U=async u=>{const M=u.target.files[0];if(!M)return;D(!0),h(0);const $=setInterval(()=>h(s=>s>=90?90:s+5),200);try{const s=await lr(M);s.result==="success"&&(h(100),setTimeout(()=>I(s.url),200))}catch(s){console.error(s)}finally{clearInterval($),setTimeout(()=>{D(!1),h(0)},500),u.target.value=""}},_=()=>{i.type==="item"?(o(c.id),r()):i.type==="image"&&x(u=>({...u,imageUrls:u.imageUrls.filter((M,$)=>$!==i.index)})),S({isOpen:!1,type:null,index:null})},F=u=>{if(u.preventDefault(),!m.desc?.trim()){p({desc:!0});return}const M=m.title||m.desc.trim().split(`
`)[0].substring(0,50)+(m.desc.length>50?"...":"")||"Operational Record";a({...m,title:M})};return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-zinc-950/80 backdrop-blur-sm animate-in fade-in",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#09090b] rounded-[2.5rem] shadow-2xl border border-zinc-100 dark:border-white/5 flex flex-col max-h-[92vh] animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"shrink-0 p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center shadow-lg",children:e.jsx(ne,{size:20,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:c?"Edit Operational Record":"Create New Record"}),e.jsx("p",{className:"text-[8px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"NOC Data Integration Tier 1"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(K,{size:18})})]}),e.jsxs("form",{id:"event-form",onSubmit:F,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsx(le,{title:"Temporal Matrix",icon:W,children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(pe,{label:"Deployment Date"}),e.jsx(ge,{type:"date",value:m.date,onChange:u=>x({...m,date:u.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(pe,{label:"Sync Time"}),e.jsx(ge,{type:"time",value:m.time,onChange:u=>x({...m,time:u.target.value})})]})]})}),e.jsx(le,{title:"Visual Personalization",icon:wt,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(pe,{label:"Marker Status",icon:oe}),e.jsx("div",{className:"flex gap-1.5",children:["white","rose","emerald"].map(u=>e.jsx("button",{type:"button",onClick:()=>x({...m,statusOnLineColor:u}),className:L("w-4 h-4 rounded-full border transition-all",u==="white"?"bg-white border-zinc-200":u==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",m.statusOnLineColor===u?"ring-4 ring-indigo-500/20 scale-110 shadow-lg":"opacity-30")},u))})]}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5 p-1 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl",children:[{id:"message",icon:ve},{id:"alert",icon:J},{id:"check",icon:re},{id:"clock",icon:W},{id:"update",icon:ae}].map(u=>e.jsx("button",{type:"button",onClick:()=>x({...m,iconType:u.id}),className:L("h-8 flex items-center justify-center rounded-lg transition-all",m.iconType===u.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(u.icon,{size:14,strokeWidth:2.5})},u.id))})]})}),e.jsx(le,{title:"Operational Narrative",icon:_e,children:e.jsx("textarea",{className:L("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[100px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",w.desc?"border-rose-500":""),placeholder:"Synchronize narrative report details...",value:m.desc,onChange:u=>x({...m,desc:u.target.value})})}),e.jsx(le,{title:"Intelligence Evidence",icon:Et,badge:e.jsxs("button",{type:"button",onClick:()=>k(!l),className:L("flex items-center gap-2 px-2 py-1 rounded-lg transition-all border",l?"bg-indigo-500/10 border-indigo-500/30 text-indigo-500":"bg-zinc-100 dark:bg-white/5 border-zinc-200 dark:border-white/10 text-zinc-400"),children:[e.jsx("div",{className:L("w-2 h-2 rounded-full",l?"bg-indigo-500 animate-pulse":"bg-zinc-300")}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:l?"Picture Hide":"Picture Show"}),l?e.jsx(Ue,{size:8,strokeWidth:4}):e.jsx(se,{size:8,strokeWidth:4})]}),children:l&&e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-top-2 duration-500",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(ge,{placeholder:"Asset URL...",value:d,onChange:u=>y(u.target.value)}),e.jsx(Ot,{size:10,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>I(),disabled:!d,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl transition-all active:scale-95 disabled:opacity-20",children:e.jsx(se,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>T.current.click(),className:"h-10 w-10 flex items-center justify-center bg-indigo-600 text-white rounded-xl transition-all active:scale-95 relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:T,className:"hidden",accept:"image/*",onChange:U}),C?e.jsx(je,{size:16,className:"animate-spin"}):e.jsx(pt,{size:16})]})]}),C&&e.jsxs("div",{className:"space-y-1.5 animate-in slide-in-from-top-1 duration-300",children:[e.jsxs("div",{className:"flex justify-between text-[8px] font-black uppercase tracking-widest text-indigo-500",children:[e.jsx("span",{children:"Transmitting Asset"}),e.jsxs("span",{children:[Math.round(v),"%"]})]}),e.jsx("div",{className:"h-1 w-full bg-zinc-100 dark:bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${v}%`}})})]}),m.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-6 gap-2 pt-1",children:m.imageUrls.map((u,M)=>e.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm cursor-pointer hover:scale-105 transition-all",children:[e.jsx("img",{src:ie(u),className:"w-full h-full object-cover",alt:"asset"}),e.jsx("button",{type:"button",onClick:$=>{$.stopPropagation(),S({isOpen:!0,type:"image",index:M})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Q,{size:12})})]},M))})]})})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center gap-3",children:[c&&e.jsx("button",{type:"button",onClick:()=>S({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-2xl bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Delete Event",children:e.jsx(Q,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:f||C,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3",children:[f?e.jsx(je,{size:18,className:"animate-spin"}):e.jsx(Fe,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em]",children:"Commit Record"})]})]})]}),e.jsx(Oe,{isOpen:i.isOpen,onClose:()=>S({isOpen:!1,type:null,index:null}),title:i.type==="item"?"Delete Event Record?":"Remove Asset?",message:i.type==="item"?"This operational record will be permanently purged from the timeline.":"This image asset will be removed from this record.",onConfirm:_,isDanger:!0})]}):null}function xr({isOpen:t,onClose:r,text:a,incident:o}){const[c,f]=de.useState(!1),[m,x]=de.useState("preview"),l=n.useMemo(()=>{if(o)return{meta:{Project:o.project||"-",Subject:o.subject||"-",Status:o.status||"-",Ticket:o.ticket||"-"},details:{Impact:o.impact||"-","Root Cause":o.root_cause||"-","Action Taken":o.action||"-"},timeline:(o.events||[]).map(v=>({date:v.date?new Date(v.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:v.time,desc:v.desc||v.title,originalDate:v.date,imageUrls:v.imageUrls||(v.image?[v.image]:[])}))};if(!a)return null;const d={meta:{},details:{},timeline:[]},y=a.split(`
`);let C=!1,D="";return y.forEach(v=>{const h=v.trim();if(!h)return;const w=v.indexOf(":");if(!C&&w!==-1&&w<20){const p=v.substring(0,w).trim(),i=v.substring(w+1).trim();["Project","Subject","Status","Ticket"].includes(p)?d.meta[p]=i:(["Impact","Root Cause","Action Taken"].includes(p),d.details[p]=i)}else if(C=!0,h.length<20&&/\d/.test(h)&&!h.includes("-"))D=h;else{const i=h.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);i?d.timeline.push({date:D,time:i[1],desc:i[2]||""}):d.timeline.push({date:D,time:null,desc:h})}}),d},[a,o]),k=async()=>{try{await navigator.clipboard.writeText(a),f(!0),setTimeout(()=>{f(!1),r()},1e3)}catch(d){console.error("Failed to copy:",d);const y=document.createElement("textarea");y.value=a,document.body.appendChild(y),y.select(),document.execCommand("copy"),document.body.removeChild(y),f(!0),setTimeout(()=>{f(!1),r()},1e3)}};return de.useEffect(()=>{const d=y=>{y.key==="Escape"&&t&&r()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[t,r]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-all",onClick:r,children:e.jsxs("div",{className:"bg-white dark:bg-[#09090b] w-full max-w-3xl h-[85vh] rounded-3xl border border-zinc-200 dark:border-zinc-800 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 relative",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(Ae,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>x("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${m==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>x("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${m==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(K,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",children:m==="raw"?e.jsx("textarea",{readOnly:!0,value:a,className:"w-full h-full p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l?.meta&&Object.entries(l.meta).map(([d,y])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:d}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:y})]},d))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(xe,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:l?.details&&Object.entries(l.details).map(([d,y])=>{let C=xe;return d.includes("Impact")&&(C=me),d.includes("Root")&&(C=Bt),d.includes("Action")&&(C=Vt),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:d})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:y==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):y})]},d)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(W,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),l?.timeline.map((d,y)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(y===0||d.date!==l.timeline[y-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(ze,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:d.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[d.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:d.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:d.desc}),d.imageUrls&&d.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:d.imageUrls.map((C,D)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ie(C),alt:`Evidence ${D+1}`,className:"w-full h-full object-cover",onError:v=>{v.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},D))})]})]},y)),l?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}),e.jsx("div",{className:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",children:e.jsx("button",{onClick:k,disabled:c,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${c?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{size:16})," Copy to Clipboard"]})})})]})}):null}function mr(){const[t,r]=n.useState([]),[a,o]=n.useState(!0);return n.useEffect(()=>{const c=ct.subscribeProjects(f=>{r(f),o(!1)});return()=>c()},[]),{projects:t,loading:a}}function ur({isOpen:t,onClose:r,incident:a,onUpdate:o,onDelete:c,onExport:f}){const{ticketOptions:m}=Pe(),{projects:x}=mr(),[l,k]=n.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});n.useEffect(()=>{a&&k({subject:a.subject||"",project:a.project||"",type:a.type||"Incident",ticket:a.ticket||"",status:a.status||"Open",priority:a.priority||"Medium",impact:a.impact||"",root_cause:a.root_cause||"",action:a.action||""})},[a,t]);const d=l.subject?.includes("|")&&l.subject?.includes("-"),y=i=>{let S={subject:i};if(i.includes("|")&&i.includes("-")){const T=i.split("|").map(I=>I.trim());if(T.length>=2){const I=T[0].split("-").map(U=>U.trim());if(I.length>=2){S.ticket=I[0],S.project=I[1];const U=m?.types||["Incident","Request","Maintenance"];S.type=U.find(_=>_.toLowerCase()===T[1].toLowerCase())||T[1],T.length>=3&&(S.subject=T.slice(2).join(" | "))}}}k(T=>({...T,...S}))};if(!t)return null;const C=i=>{i.preventDefault(),o(l),r()},D=i=>{const S={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:J},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:W},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:re},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:We}};return S[i]||S.Open},v=i=>{const S={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-indigo-500",bg:"bg-indigo-500/10"}};return S[i]||S.Medium},h="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",w="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 outline-none transition-all",p="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-xs font-black uppercase tracking-widest focus:ring-4 focus:ring-blue-500/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-[#08080a] w-full max-w-2xl rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-white/5 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 max-h-[92vh]",children:[e.jsxs("div",{className:"shrink-0 px-6 py-5 flex items-center justify-between bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(ne,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(K,{size:18})})]}),e.jsxs("form",{onSubmit:C,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-2xl bg-indigo-500/5 border border-indigo-500/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:L(h,"text-indigo-600 dark:text-indigo-400"),children:[e.jsx(_e,{size:10})," Protocol Signature (Subject)"]}),d&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Be,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-xl p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:l.subject,onChange:i=>y(i.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(xe,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:L(p,D(l.status).color),value:l.status,onChange:i=>k({...l,status:i.target.value}),children:(m.statuses||["Open","Pending","Succeed","Closed"]).map(i=>e.jsx("option",{value:i,className:"bg-white dark:bg-zinc-950",children:i},i))}),e.jsx(W,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(zt,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:L(p,v(l.priority).color),value:l.priority,onChange:i=>k({...l,priority:i.target.value}),children:(m.severities||["Critical","High","Medium","Low"]).map(i=>e.jsx("option",{value:i,className:"bg-white dark:bg-zinc-950",children:i},i))}),e.jsx(me,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(oe,{size:10,className:"text-blue-500"})," Ticket Identity"]}),e.jsx("input",{type:"text",className:w,value:l.ticket,onChange:i=>k({...l,ticket:i.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(Te,{size:10,className:"text-indigo-500"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:p,value:l.project,onChange:i=>k({...l,project:i.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(x&&x.length>0?x:["MONOMAX","MONO29","3BB GIGATV"]).map(i=>e.jsx("option",{value:i,className:"bg-white dark:bg-zinc-950",children:i},i))]}),e.jsx(Te,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(J,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[80px] resize-none transition-all",value:l.impact,onChange:i=>k({...l,impact:i.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(Je,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:l.root_cause,onChange:i=>k({...l,root_cause:i.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:h,children:[e.jsx(ne,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:l.action,onChange:i=>k({...l,action:i.target.value}),placeholder:""})]})]})]})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center justify-between border-t border-zinc-100 dark:border-white/5",children:[e.jsxs("button",{type:"button",onClick:c,className:"h-11 px-5 rounded-xl bg-rose-500/10 text-rose-500 font-black uppercase text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(Q,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r,className:"h-11 px-6 rounded-xl text-[9px] font-black uppercase tracking-widest text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl text-[9px] font-black uppercase tracking-widest shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(Fe,{size:14})," Commit Changes"]})]})]})]})})}function br({incident:t,onBack:r,onExport:a,onGenerateReport:o,onEdit:c,onDelete:f,canEdit:m}){if(!t)return null;const x=l=>{switch(l?.toLowerCase()){case"resolved":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"closed":return"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700";case"open":return"bg-blue-500/15 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800";default:return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800"}};return e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0 w-full",children:[e.jsx("button",{onClick:r,className:"mt-1 p-2 rounded-xl hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all active:scale-95 lg:hidden",children:e.jsx(lt,{size:20})}),e.jsxs("div",{className:"space-y-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-zinc-400 uppercase tracking-wider",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{size:12})," ",t.ticket||"NO-TICKET"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ze,{size:12})," ",t.createdAt?He(new Date(t.createdAt),"dd MMM yyyy"):"-"]})]}),e.jsx("h1",{className:"text-xl md:text-2xl font-black text-zinc-900 dark:text-zinc-100 leading-tight break-words line-clamp-2",children:t.subject}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsx(he,{variant:"outline",className:L("rounded-lg border font-bold uppercase tracking-wider",x(t.status)),children:t.status}),e.jsx(he,{variant:"outline",className:"rounded-lg border-zinc-200 dark:border-zinc-700 font-bold text-zinc-500 bg-zinc-50 dark:bg-zinc-900",children:t.type}),t.project&&e.jsx(he,{variant:"secondary",className:"rounded-lg font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400",children:t.project})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full lg:w-auto mt-2 lg:mt-0",children:[e.jsxs(ce,{variant:"outline",size:"sm",onClick:a,className:"h-9 gap-2 text-xs font-bold uppercase tracking-wide border-zinc-200 dark:border-zinc-700",children:[e.jsx(Ne,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),e.jsxs(ce,{variant:"outline",size:"sm",onClick:o,className:"h-9 gap-2 text-xs font-bold uppercase tracking-wide border-zinc-200 dark:border-zinc-700",children:[e.jsx(Ae,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Report"})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-6 bg-zinc-200 dark:bg-zinc-800 mx-1 hidden sm:block"}),e.jsx(ce,{variant:"outline",size:"icon",onClick:c,className:"h-9 w-9 rounded-xl border-zinc-200 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800",title:"Edit Details",children:e.jsx(ae,{size:16})}),e.jsx(ce,{variant:"outline",size:"icon",onClick:f,className:"h-9 w-9 rounded-xl border-zinc-200 dark:border-zinc-700 text-zinc-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/20 hover:border-red-200 dark:hover:border-red-900 transition-colors",title:"Delete Case",children:e.jsx(Q,{size:16})})]})]})]})}function hr({incident:t,isLoading:r,onUpdateIncident:a,onAddEvent:o,onDeleteEvent:c,onUpdateEvent:f,onReorderEvent:m,onDeleteIncident:x,onBack:l,canEdit:k}){const{currentUser:d}=Re(),y=n.useRef(null),C=n.useRef(null),[D,v]=n.useState(!1),[h,w]=n.useState(!1),[p,i]=n.useState(null),[S,T]=n.useState(!1),[I,U]=n.useState(""),_=n.useMemo(()=>t?.events?[...t.events].sort((s,b)=>{if(typeof s.order=="number"&&typeof b.order=="number"&&s.order!==b.order)return s.order-b.order;const N=`${s.date||"1970-01-01"}T${s.time||"00:00"}`,z=`${b.date||"1970-01-01"}T${b.time||"00:00"}`;return N<z?1:N>z?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center mb-6 shadow-inner",children:e.jsx(Ve,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-black text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs text-center",children:"Select an incident to view details"})]});const F=(s,b)=>{const N=[..._],z=b==="up"?s-1:s+1;if(z<0||z>=N.length)return;[N[s],N[z]]=[N[z],N[s]];const A=N.map((E,P)=>({...E,order:P}));m&&m(t.id,A)},u=s=>{const b=typeof d=="object"?d?.name:d;a(t.id,{...s,updatedBy:b})},M=async()=>{if(t)try{const s="EventDate,EventTime,StatusLabel,Description,ImageURLs";let b=[];[...t.events||[]].sort((B,q)=>{const j=`${B.date||"1970-01-01"}T${B.time||"00:00"}`,G=`${q.date||"1970-01-01"}T${q.time||"00:00"}`;return j<G?-1:j>G?1:0}).forEach(B=>{const q=B.date?new Date(B.date).toLocaleDateString("en-GB"):"-",j=B.time||"-",G=(B.statusOnLine||"").replace(/"/g,'""'),Y=(B.desc||B.title||"").replace(/"/g,'""').replace(/\n/g," "),ue=(B.imageUrls||[]).join(" ; ");b.push(`"${q}","${j}","${G}","${Y}","${ue}"`)});const z=[`Incident:,"${t.subject||""}"`,`Project:,"${t.project||""}"`,`Ticket:,"${t.ticket||""}"`,`Status:,"${t.status||""}"`,"",s,...b].join(`
`),A=new Blob(["\uFEFF"+z],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(A),P=document.createElement("a");P.href=E,P.download=`Timeline_${t.ticket||"Export"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(P),P.click(),document.body.removeChild(P),window.URL.revokeObjectURL(E)}catch(s){console.error("Export failed:",s)}},$=()=>{if(!t)return;let s=`[INCIDENT REPORT]
`;s+=`Project : ${t.project||"-"}
`,s+=`Ticket  : ${t.ticket||"-"}
`,s+=`Subject : ${t.subject||"-"}
`,s+=`Status  : ${t.status||"-"}

`,s+=`[DETAILS]
`,s+=`Impact     : ${t.impact||"-"}
`,s+=`Root Cause : ${t.root_cause||"-"}
`,s+=`Action     : ${t.action||"-"}

`,s+=`[TIMELINE]
`;const b=[...t.events||[]].sort((z,A)=>{const E=`${z.date||"1970-01-01"}T${z.time||"00:00"}`,P=`${A.date||"1970-01-01"}T${A.time||"00:00"}`;return E<P?-1:E>P?1:0});let N="";b.forEach(z=>{z.date!==N&&(s+=`
--- ${z.date?new Date(z.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,N=z.date);const A=z.time||"--:--",E=z.statusOnLine?` [${z.statusOnLine}]`:"";s+=`${A}${E} - ${z.desc||z.title}
`}),U(s),T(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 z-20 bg-white dark:bg-[#0e0e11] border-b border-zinc-100 dark:border-white/5 relative",children:e.jsx(br,{incident:t,onUpdate:u,onBack:l,onDelete:()=>x(t.id),onEdit:()=>w(!0),onGenerateReport:$,onExport:M,canEdit:k})}),e.jsx("div",{ref:C,className:"flex-1 overflow-y-auto px-4 md:px-8 py-12 custom-scrollbar bg-zinc-50 dark:bg-[#09090b] relative min-h-0",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] animate-pulse",children:"Synchronizing Timeline..."})]}):_.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsx(W,{size:48,className:"mb-4 opacity-50"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:"No operational records found"}),e.jsx("button",{onClick:()=>{i(null),v(!0)},className:"mt-8 h-14 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-2xl hover:scale-105 active:scale-95 transition-all",children:"Initialize Log"})]}):e.jsxs("div",{className:"flex flex-col pb-36 relative max-w-5xl mx-auto min-h-full",children:[e.jsx("div",{className:"absolute top-0 bottom-0 left-0 lg:left-[24px] w-[1px] bg-zinc-200/50 dark:bg-white/5 z-0 hidden lg:block"}),e.jsx("div",{className:"absolute top-0 bottom-0 left-[27px] lg:left-[151px] w-[2px] bg-zinc-200 dark:bg-zinc-800/80 z-0"}),_.map((s,b)=>{const N=b===0||s.date!==_[b-1].date;let z="-";try{z=s.date?new Date(s.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{}return e.jsx(or,{event:s,index:b,isLastItem:b===_.length-1,showDateHeader:N,dateLabel:z,onMove:F,onEdit:A=>{i(A),v(!0)},onDelete:A=>c(t.id,A),canEdit:k},s.id)}),e.jsx("div",{ref:y})]})}),e.jsx("div",{className:"absolute bottom-10 right-10 flex flex-col gap-4 z-40 items-end",children:k&&e.jsx("button",{onClick:()=>{i(null),v(!0)},className:"w-16 h-16 bg-indigo-600 hover:bg-indigo-700 text-white rounded-[2rem] shadow-2xl shadow-indigo-600/30 hover:scale-110 rotate-0 hover:rotate-90 transition-all duration-500 z-30 flex items-center justify-center active:scale-90",title:"Add Timeline Event",children:e.jsx(se,{size:32,strokeWidth:3})})}),e.jsx(dr,{isOpen:D,onClose:()=>v(!1),initialData:p,onDelete:s=>c(t.id,s),onSubmit:s=>{const b=typeof d=="object"?d?.name:d,N={...s};p?(N.updatedBy=b,f(t.id,p.id,N)):(N.createdBy=b,o(t.id,N)),v(!1)}}),e.jsx(xr,{isOpen:S,onClose:()=>T(!1),text:I,incident:t}),e.jsx(ur,{isOpen:h,onClose:()=>w(!1),incident:t,onUpdate:u,onDelete:()=>x(t.id),onExport:M})]})}const pr=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},gr=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-blue-500 bg-blue-50/50 dark:bg-blue-500/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},fe=n.memo(({label:t,value:r,icon:a,colorClass:o})=>e.jsxs("div",{className:"flex-1 p-4 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:L("p-1.5 rounded-lg shrink-0",o),children:e.jsx(a,{size:12})}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})),ke=n.memo(({title:t,icon:r,children:a,accentColor:o="text-zinc-400"})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 flex items-center gap-2 tracking-[0.3em] px-1",children:[e.jsx(r,{size:12,className:o})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-[2rem] shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:a})]})]}));function fr({log:t,onAddToIncident:r,onClose:a}){if(!t)return null;const o=t.createdAt?He(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-zinc-950/40 backdrop-blur-md animate-in fade-in transition-all duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-[#fafafa] dark:bg-[#050505] rounded-[3rem] shadow-2xl border border-zinc-200/50 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 slide-in-from-bottom-8 duration-500",children:[e.jsxs("div",{className:"relative shrink-0 p-8 border-b border-zinc-100 dark:border-zinc-900 bg-white dark:bg-[#09090b]",children:[e.jsx("button",{onClick:a,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-zinc-50 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all active:scale-90",children:e.jsx(K,{size:20})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-lg",children:e.jsx(oe,{size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 uppercase tracking-[0.3em]",children:"Operational Log"}),e.jsx("h2",{className:"text-3xl font-black text-zinc-900 dark:text-white tracking-tighter leading-none",children:t.ticketNumber})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ze,{size:12})," ",o]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ne,{size:12})," ",t.type]}),e.jsx("div",{className:L("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-widest",pr(t.status)),children:t.status})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(fe,{label:"Severity",value:t.severity||"Low",icon:me,colorClass:gr(t.severity)}),e.jsx(fe,{label:"Hierarchy",value:t.category||"N/A",icon:we,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(fe,{label:"Sub-Class",value:t.subCategory||"N/A",icon:dt,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(ke,{title:"Record Description",icon:xt,accentColor:"text-blue-500",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(ke,{title:"Action Deployed",icon:xe,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200 italic",children:t.action||"No defensive actions recorded."})}),e.jsx(ke,{title:"Resolution Status",icon:ne,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-white dark:bg-zinc-900/50 rounded-[2.5rem] border border-zinc-100 dark:border-zinc-900 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-lg font-black shadow-lg shadow-black/10 transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(et,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-[0.3em]",children:"Lead Engineer"}),e.jsxs("p",{className:"text-base font-black text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-zinc-300 group-hover:text-blue-500 transition-colors",children:[e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Profile Archive"}),e.jsx(Ve,{size:14})]})]})]}),e.jsxs("div",{className:"p-8 bg-white dark:bg-[#09090b] border-t border-zinc-100 dark:border-zinc-900 flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-16 bg-zinc-950 dark:bg-white text-white dark:text-black rounded-[1.5rem] text-[12px] font-black uppercase tracking-[0.3em] flex items-center justify-center gap-3 shadow-2xl transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Be,{size:18,className:"fill-current group-hover:animate-pulse"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[10px] font-bold text-zinc-400 uppercase tracking-widest opacity-60",children:"System will reconcile this log into a global incident archive."})]})]})})}function Kr(){const{currentUser:t}=Re(),r=Qe(t,[Le.LEAD,Le.ENGINEER]),{toast:a}=Ye(),[o,c]=n.useState("incidents"),{incidents:f,filteredIncidents:m,selectedId:x,setSelectedId:l,loading:k,stats:d,searchTerm:y,setSearchTerm:C,filterStatus:D,setFilterStatus:v,filterType:h,setFilterType:w,clearFilters:p,hasActiveFilters:i}=Wt(),{sortedEvents:S,loading:T}=qt(x),{logs:I,loading:U,stats:_}=tt(),[F,u]=n.useState(null),[M,$]=n.useState({isOpen:!1}),[s,b]=n.useState(!1),N=f.find(g=>g.id===x),z=n.useCallback((g,O="success")=>{a({description:g,variant:O==="error"?"destructive":"default"})},[a]),A=async()=>{b(!0);try{const g=typeof t=="object"?t:{name:"Admin"},O=await H.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:g,impact:"",root_cause:"",action:""});c("incidents"),l(O.id),z("Case created successfully")}catch(g){console.error(g),z("Failed to create incident","error")}finally{b(!1)}},E=async g=>{if(g){b(!0);try{const O=typeof t=="object"?t:{name:"System"},Z={subject:g.shortDesc||g.details||`Ticket #${g.ticketNumber}`,ticket:g.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(g.type)?g.type:"Incident",status:"Open",priority:g.severity||"Medium",createdBy:O,impact:"",root_cause:g.details||"",action:g.action||""},be=await H.createIncident(Z,g.ticketNumber);z(`Ticket #${g.ticketNumber} promoted to Case`),c("incidents"),l(be.id)}catch(O){console.error(O),z("Failed to promote ticket","error")}finally{b(!1)}}},P=g=>{$({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await H.deleteIncident(g),x===g&&l(null),$({isOpen:!1}),z("Case deleted")}catch{z("Failed to delete","error")}}})},B=async g=>{if(!g||g.length===0){z("No data to export","error");return}z("Preparing export...","info");try{const O="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription";let Z=[];for(const V of g){const Ge=V.createdAt?new Date(V.createdAt).toLocaleDateString("en-GB"):"-",te=X=>(X||"").replace(/"/g,'""').replace(/\n/g," "),Se=`"${Ge}","${te(V.project)}","${te(V.ticket)}","${te(V.type)}","${V.status}","${te(V.subject)}","${V.createdBy?.name||V.createdBy||""}"`,Ee=await H.getEvents(V.id);Ee.length>0?Ee.forEach(X=>{const Ze=X.date?new Date(X.date).toLocaleDateString("en-GB"):"-",Xe=te(X.desc||X.title);Z.push(`${Se},"${Ze}","${X.time||"-"}","${Xe}"`)}):Z.push(`${Se},"-","-","-"`),Z.push(",,,,,,,,,")}const be=[O,...Z].join(`
`),qe=new Blob(["\uFEFF"+be],{type:"text/csv;charset=utf-8;"}),Ce=URL.createObjectURL(qe),ee=document.createElement("a");ee.href=Ce,ee.download=`CaseExport_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(ee),ee.click(),setTimeout(()=>{document.body.removeChild(ee),window.URL.revokeObjectURL(Ce)},0),z("Export completed")}catch(O){console.error(O),z("Failed to export data","error")}},q=async(g,O)=>H.updateIncident(g,O),j=async(g,O)=>H.createEvent(g,O),G=async(g,O,Z)=>H.updateEvent(g,O,Z),Y=async(g,O)=>H.reorderEvents(g,O),ue=async(g,O)=>{$({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{await H.deleteEvent(g,O),$({isOpen:!1})}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-[#09090b] overflow-hidden relative",children:[e.jsx(Oe,{isOpen:M.isOpen,onClose:()=>$({isOpen:!1}),...M}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${x||F?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(er,{filteredIncidents:m,stats:d,loading:k,logs:I,logsLoading:U,logStats:_,selectedId:x,selectedLogId:F?.ticketNumber,onSelect:g=>{c("incidents"),l(g)},onSelectLog:u,onAddIncident:A,onDeleteIncident:P,onExportCSV:B,viewMode:o,onViewModeChange:g=>{c(g),g==="incidents"&&u(null),g==="logs"&&l(null)},searchTerm:y,setSearchTerm:C,filterStatus:D,setFilterStatus:v,filterType:h,setFilterType:w,clearFilters:p,hasActiveFilters:i,canEdit:r})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${x||F?"flex w-full":"hidden lg:flex"}
      `,children:o==="incidents"&&x?e.jsx(hr,{incident:N?{...N,events:S}:null,isLoading:T,onBack:()=>l(null),onUpdateIncident:q,onAddEvent:j,onUpdateEvent:G,onDeleteEvent:ue,onDeleteIncident:P,onReorderEvent:Y,saving:s,canEdit:r}):o==="logs"&&F?e.jsx(fr,{log:F,onAddToIncident:E,onClose:()=>u(null),canEdit:r}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 dark:text-zinc-700 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-zinc-100 dark:bg-zinc-900 rounded-3xl flex items-center justify-center mb-6 shadow-inner",children:e.jsx(It,{size:48,strokeWidth:1,className:"text-zinc-400 dark:text-zinc-600 opacity-50"})}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-400 dark:text-zinc-600",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-400 mt-2 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{Kr as default};
