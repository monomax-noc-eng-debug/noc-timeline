import{d as Se,y as nt,a as Ve,z as Ye,r as z,j as e,X as ve,L as Ne,e as de,F as ct,U as Ee,T as Ze,b as ot,t as lt,u as dt,C as ut,v as Me,g as ht,A as xt}from"./index-DG8grUyn.js";import{t as ye,u as Je,a as pt,i as mt}from"./useTicketOptions-BbjULAU7.js";import{u as ft}from"./useConfigs-Bz8exd3l.js";import{c as bt}from"./configService-CpUaQNct.js";import{p as _e}from"./parse-Bk6ren_S.js";import{i as Ce,f as pe}from"./format-B568ns5f.js";import{a as Xe}from"./addYears-RECKJz7f.js";import{C as Te}from"./cloud-download-E8KNxlG4.js";import{C as gt}from"./circle-alert-C-KG3N9y.js";import{R as Fe}from"./refresh-cw-C0mLscHk.js";import{C as Ae}from"./circle-check-BEXeFYoG.js";import{A as kt}from"./useBaseQuery-ruIVqelk.js";import{D as yt}from"./database-D8QRr5Jn.js";import{u as vt}from"./useTeam-B550Xvd9.js";import{T as zt}from"./tag-BWu-FnY6.js";import{P as jt}from"./panels-top-left-C_ZPa4mJ.js";import{S as wt}from"./save-B93v77qj.js";import{Z as et}from"./zap-LTmMFBcD.js";import{T as tt}from"./trash-2-CREMUFDH.js";import{P as Nt}from"./plus-B2FRZknz.js";import{S as _t}from"./search-U53RAdtz.js";import{S as Ue}from"./sliders-horizontal-CuogEloW.js";import{G as Ct}from"./globe-DHBEBFPC.js";import"./firebaseConfig-Cp-1Ewx5.js";import"./addMonths-BfoHT1ak.js";const St=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],Dt=Se("circle-arrow-down",St);const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Pe=Se("info",Et);const Tt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],At=Se("shield-alert",Tt);const Rt=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Oe=Se("square-pen",Rt);var ze={exports:{}};var Ot=ze.exports,qe;function Lt(){return qe||(qe=1,(function(s,d){((x,c)=>{s.exports=c()})(Ot,function x(){var c=typeof self<"u"?self:typeof window<"u"?window:c!==void 0?c:{},j,w=!c.document&&!!c.postMessage,p=c.IS_PAPA_WORKER||!1,y={},W=0,i={};function A(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(r){var a=ie(r);a.chunkSize=parseInt(a.chunkSize),r.step||r.chunk||(a.chunkSize=null),this._handle=new Q(a),(this._handle.streamer=this)._config=a}).call(this,t),this.parseChunk=function(r,a){var l=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<l){let g=this._config.newline;g||(o=this._config.quoteChar||'"',g=this._handle.guessLineEndings(r,o)),r=[...r.split(g).slice(l)].join(g)}this.isFirstChunk&&n(this._config.beforeFirstChunk)&&(o=this._config.beforeFirstChunk(r))!==void 0&&(r=o),this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+r,o=(this._partialLine="",this._handle.parse(l,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(r=o.meta.cursor,l=(this._finished||(this._partialLine=l.substring(r-this._baseIndex),this._baseIndex=r),o&&o.data&&(this._rowCount+=o.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),p)c.postMessage({results:o,workerId:i.WORKER_ID,finished:l});else if(n(this._config.chunk)&&!a){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!l||!n(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),l||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(r){n(this._config.error)?this._config.error(r):p&&this._config.error&&c.postMessage({workerId:i.WORKER_ID,error:r,finished:!1})}}function M(t){var r;(t=t||{}).chunkSize||(t.chunkSize=i.RemoteChunkSize),A.call(this,t),this._nextChunk=w?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),w||(r.onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!w),this._config.downloadRequestHeaders){var a,l=this._config.downloadRequestHeaders;for(a in l)r.setRequestHeader(a,l[a])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,r.setRequestHeader("Range","bytes="+this._start+"-"+o));try{r.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}w&&r.status===0&&this._chunkError()}},this._chunkLoaded=function(){r.readyState===4&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize||r.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(r),this.parseChunk(r.responseText)))},this._chunkError=function(a){a=r.statusText||a,this._sendError(new Error(a))}}function f(t){(t=t||{}).chunkSize||(t.chunkSize=i.LocalChunkSize),A.call(this,t);var r,a,l=typeof FileReader<"u";this.stream=function(o){this._input=o,a=o.slice||o.webkitSlice||o.mozSlice,l?((r=new FileReader).onload=X(this._chunkLoaded,this),r.onerror=X(this._chunkError,this)):r=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var o=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),o=a.call(o,this._start,g)),r.readAsText(o,this._config.encoding));l||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(o){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(o.target.result)},this._chunkError=function(){this._sendError(r.error)}}function Y(t){var r;A.call(this,t=t||{}),this.stream=function(a){return r=a,this._nextChunk()},this._nextChunk=function(){var a,l;if(!this._finished)return a=this._config.chunkSize,r=a?(l=r.substring(0,a),r.substring(a)):(l=r,""),this._finished=!r,this.parseChunk(l)}}function T(t){A.call(this,t=t||{});var r=[],a=!0,l=!1;this.pause=function(){A.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){A.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(o){this._input=o,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){l&&r.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):a=!0},this._streamData=X(function(o){try{r.push(typeof o=="string"?o:o.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(g){this._streamError(g)}},this),this._streamError=X(function(o){this._streamCleanUp(),this._sendError(o)},this),this._streamEnd=X(function(){this._streamCleanUp(),l=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Q(t){var r,a,l,o,g=Math.pow(2,53),F=-g,re=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Z=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,_=this,O=0,m=0,G=!1,v=!1,C=[],u={data:[],errors:[],meta:{}};function P(b){return t.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function q(){if(u&&l&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),l=!1),t.skipEmptyLines&&(u.data=u.data.filter(function(k){return!P(k)})),H()){let k=function(B,V){n(t.transformHeader)&&(B=t.transformHeader(B,V)),C.push(B)};if(u)if(Array.isArray(u.data[0])){for(var b=0;H()&&b<u.data.length;b++)u.data[b].forEach(k);u.data.splice(0,1)}else u.data.forEach(k)}function D(k,B){for(var V=t.header?{}:[],R=0;R<k.length;R++){var I=R,E=k[R],E=((ne,N)=>(U=>(t.dynamicTypingFunction&&t.dynamicTyping[U]===void 0&&(t.dynamicTyping[U]=t.dynamicTypingFunction(U)),(t.dynamicTyping[U]||t.dynamicTyping)===!0))(ne)?N==="true"||N==="TRUE"||N!=="false"&&N!=="FALSE"&&((U=>{if(re.test(U)&&(U=parseFloat(U),F<U&&U<g))return 1})(N)?parseFloat(N):Z.test(N)?new Date(N):N===""?null:N):N)(I=t.header?R>=C.length?"__parsed_extra":C[R]:I,E=t.transform?t.transform(E,I):E);I==="__parsed_extra"?(V[I]=V[I]||[],V[I].push(E)):V[I]=E}return t.header&&(R>C.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+R,m+B):R<C.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+R,m+B)),V}var L;u&&(t.header||t.dynamicTyping||t.transform)&&(L=1,!u.data.length||Array.isArray(u.data[0])?(u.data=u.data.map(D),L=u.data.length):u.data=D(u.data,0),t.header&&u.meta&&(u.meta.fields=C),m+=L)}function H(){return t.header&&C.length===0}function h(b,D,L,k){b={type:b,code:D,message:L},k!==void 0&&(b.row=k),u.errors.push(b)}n(t.step)&&(o=t.step,t.step=function(b){u=b,H()?q():(q(),u.data.length!==0&&(O+=b.data.length,t.preview&&O>t.preview?a.abort():(u.data=u.data[0],o(u,_))))}),this.parse=function(b,D,L){var k=t.quoteChar||'"',k=(t.newline||(t.newline=this.guessLineEndings(b,k)),l=!1,t.delimiter?n(t.delimiter)&&(t.delimiter=t.delimiter(b),u.meta.delimiter=t.delimiter):((k=((B,V,R,I,E)=>{var ne,N,U,he;E=E||[",","	","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var me=0;me<E.length;me++){for(var ce,be=E[me],ee=0,oe=0,J=0,se=(U=void 0,new te({comments:I,delimiter:be,newline:V,preview:10}).parse(B)),ue=0;ue<se.data.length;ue++)R&&P(se.data[ue])?J++:(ce=se.data[ue].length,oe+=ce,U===void 0?U=ce:0<ce&&(ee+=Math.abs(ce-U),U=ce));0<se.data.length&&(oe/=se.data.length-J),(N===void 0||ee<=N)&&(he===void 0||he<oe)&&1.99<oe&&(N=ee,ne=be,he=oe)}return{successful:!!(t.delimiter=ne),bestDelimiter:ne}})(b,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=k.bestDelimiter:(l=!0,t.delimiter=i.DefaultDelimiter),u.meta.delimiter=t.delimiter),ie(t));return t.preview&&t.header&&k.preview++,r=b,a=new te(k),u=a.parse(r,D,L),q(),G?{meta:{paused:!0}}:u||{meta:{paused:!1}}},this.paused=function(){return G},this.pause=function(){G=!0,a.abort(),r=n(t.chunk)?"":r.substring(a.getCharIndex())},this.resume=function(){_.streamer._halted?(G=!1,_.streamer.parseChunk(r,!0)):setTimeout(_.resume,3)},this.aborted=function(){return v},this.abort=function(){v=!0,a.abort(),u.meta.aborted=!0,n(t.complete)&&t.complete(u),r=""},this.guessLineEndings=function(B,k){B=B.substring(0,1048576);var k=new RegExp($(k)+"([^]*?)"+$(k),"gm"),L=(B=B.replace(k,"")).split("\r"),k=B.split(`
`),B=1<k.length&&k[0].length<L[0].length;if(L.length===1||B)return`
`;for(var V=0,R=0;R<L.length;R++)L[R][0]===`
`&&V++;return V>=L.length/2?`\r
`:"\r"}}function $(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function te(t){var r=(t=t||{}).delimiter,a=t.newline,l=t.comments,o=t.step,g=t.preview,F=t.fastMode,re=null,Z=!1,_=t.quoteChar==null?'"':t.quoteChar,O=_;if(t.escapeChar!==void 0&&(O=t.escapeChar),(typeof r!="string"||-1<i.BAD_DELIMITERS.indexOf(r))&&(r=","),l===r)throw new Error("Comment character same as delimiter");l===!0?l="#":(typeof l!="string"||-1<i.BAD_DELIMITERS.indexOf(l))&&(l=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var m=0,G=!1;this.parse=function(v,C,u){if(typeof v!="string")throw new Error("Input must be a string");var P=v.length,q=r.length,H=a.length,h=l.length,b=n(o),D=[],L=[],k=[],B=m=0;if(!v)return ee();if(F||F!==!1&&v.indexOf(_)===-1){for(var V=v.split(a),R=0;R<V.length;R++){if(k=V[R],m+=k.length,R!==V.length-1)m+=a.length;else if(u)return ee();if(!l||k.substring(0,h)!==l){if(b){if(D=[],he(k.split(r)),oe(),G)return ee()}else he(k.split(r));if(g&&g<=R)return D=D.slice(0,g),ee(!0)}}return ee()}for(var I=v.indexOf(r,m),E=v.indexOf(a,m),ne=new RegExp($(O)+$(_),"g"),N=v.indexOf(_,m);;)if(v[m]===_)for(N=m,m++;;){if((N=v.indexOf(_,N+1))===-1)return u||L.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:D.length,index:m}),ce();if(N===P-1)return ce(v.substring(m,N).replace(ne,_));if(_===O&&v[N+1]===O)N++;else if(_===O||N===0||v[N-1]!==O){I!==-1&&I<N+1&&(I=v.indexOf(r,N+1));var U=me((E=E!==-1&&E<N+1?v.indexOf(a,N+1):E)===-1?I:Math.min(I,E));if(v.substr(N+1+U,q)===r){k.push(v.substring(m,N).replace(ne,_)),v[m=N+1+U+q]!==_&&(N=v.indexOf(_,m)),I=v.indexOf(r,m),E=v.indexOf(a,m);break}if(U=me(E),v.substring(N+1+U,N+1+U+H)===a){if(k.push(v.substring(m,N).replace(ne,_)),be(N+1+U+H),I=v.indexOf(r,m),N=v.indexOf(_,m),b&&(oe(),G))return ee();if(g&&D.length>=g)return ee(!0);break}L.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:D.length,index:m}),N++}}else if(l&&k.length===0&&v.substring(m,m+h)===l){if(E===-1)return ee();m=E+H,E=v.indexOf(a,m),I=v.indexOf(r,m)}else if(I!==-1&&(I<E||E===-1))k.push(v.substring(m,I)),m=I+q,I=v.indexOf(r,m);else{if(E===-1)break;if(k.push(v.substring(m,E)),be(E+H),b&&(oe(),G))return ee();if(g&&D.length>=g)return ee(!0)}return ce();function he(J){D.push(J),B=m}function me(J){var se=0;return se=J!==-1&&(J=v.substring(N+1,J))&&J.trim()===""?J.length:se}function ce(J){return u||(J===void 0&&(J=v.substring(m)),k.push(J),m=P,he(k),b&&oe()),ee()}function be(J){m=J,he(k),k=[],E=v.indexOf(a,m)}function ee(J){if(t.header&&!C&&D.length&&!Z){var se=D[0],ue=Object.create(null),De=new Set(se);let Le=!1;for(let fe=0;fe<se.length;fe++){let le=se[fe];if(ue[le=n(t.transformHeader)?t.transformHeader(le,fe):le]){let ge,Ie=ue[le];for(;ge=le+"_"+Ie,Ie++,De.has(ge););De.add(ge),se[fe]=ge,ue[le]++,Le=!0,(re=re===null?{}:re)[ge]=le}else ue[le]=1,se[fe]=le;De.add(le)}Le&&console.warn("Duplicate headers found and renamed."),Z=!0}return{data:D,errors:L,meta:{delimiter:r,linebreak:a,aborted:G,truncated:!!J,cursor:B+(C||0),renamedHeaders:re}}}function oe(){o(ee()),D=[],L=[]}},this.abort=function(){G=!0},this.getCharIndex=function(){return m}}function ae(t){var r=t.data,a=y[r.workerId],l=!1;if(r.error)a.userError(r.error,r.file);else if(r.results&&r.results.data){var o={abort:function(){l=!0,S(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:K,resume:K};if(n(a.userStep)){for(var g=0;g<r.results.data.length&&(a.userStep({data:r.results.data[g],errors:r.results.errors,meta:r.results.meta},o),!l);g++);delete r.results}else n(a.userChunk)&&(a.userChunk(r.results,o,r.file),delete r.results)}r.finished&&!l&&S(r.workerId,r.results)}function S(t,r){var a=y[t];n(a.userComplete)&&a.userComplete(r),a.terminate(),delete y[t]}function K(){throw new Error("Not implemented.")}function ie(t){if(typeof t!="object"||t===null)return t;var r,a=Array.isArray(t)?[]:{};for(r in t)a[r]=ie(t[r]);return a}function X(t,r){return function(){t.apply(r,arguments)}}function n(t){return typeof t=="function"}return i.parse=function(t,r){var a=(r=r||{}).dynamicTyping||!1;if(n(a)&&(r.dynamicTypingFunction=a,a={}),r.dynamicTyping=a,r.transform=!!n(r.transform)&&r.transform,!r.worker||!i.WORKERS_SUPPORTED)return a=null,i.NODE_STREAM_INPUT,typeof t=="string"?(t=(l=>l.charCodeAt(0)!==65279?l:l.slice(1))(t),a=new(r.download?M:Y)(r)):t.readable===!0&&n(t.read)&&n(t.on)?a=new T(r):(c.File&&t instanceof File||t instanceof Object)&&(a=new f(r)),a.stream(t);(a=(()=>{var l;return!!i.WORKERS_SUPPORTED&&(l=(()=>{var o=c.URL||c.webkitURL||null,g=x.toString();return i.BLOB_URL||(i.BLOB_URL=o.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(l=new c.Worker(l)).onmessage=ae,l.id=W++,y[l.id]=l)})()).userStep=r.step,a.userChunk=r.chunk,a.userComplete=r.complete,a.userError=r.error,r.step=n(r.step),r.chunk=n(r.chunk),r.complete=n(r.complete),r.error=n(r.error),delete r.worker,a.postMessage({input:t,config:r,workerId:a.id})},i.unparse=function(t,r){var a=!1,l=!0,o=",",g=`\r
`,F='"',re=F+F,Z=!1,_=null,O=!1,m=((()=>{if(typeof r=="object"){if(typeof r.delimiter!="string"||i.BAD_DELIMITERS.filter(function(C){return r.delimiter.indexOf(C)!==-1}).length||(o=r.delimiter),typeof r.quotes!="boolean"&&typeof r.quotes!="function"&&!Array.isArray(r.quotes)||(a=r.quotes),typeof r.skipEmptyLines!="boolean"&&typeof r.skipEmptyLines!="string"||(Z=r.skipEmptyLines),typeof r.newline=="string"&&(g=r.newline),typeof r.quoteChar=="string"&&(F=r.quoteChar),typeof r.header=="boolean"&&(l=r.header),Array.isArray(r.columns)){if(r.columns.length===0)throw new Error("Option columns is empty");_=r.columns}r.escapeChar!==void 0&&(re=r.escapeChar+F),r.escapeFormulae instanceof RegExp?O=r.escapeFormulae:typeof r.escapeFormulae=="boolean"&&r.escapeFormulae&&(O=/^[=+\-@\t\r].*$/)}})(),new RegExp($(F),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return G(null,t,Z);if(typeof t[0]=="object")return G(_||Object.keys(t[0]),t,Z)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||_),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),G(t.fields||[],t.data||[],Z);throw new Error("Unable to serialize unrecognized input");function G(C,u,P){var q="",H=(typeof C=="string"&&(C=JSON.parse(C)),typeof u=="string"&&(u=JSON.parse(u)),Array.isArray(C)&&0<C.length),h=!Array.isArray(u[0]);if(H&&l){for(var b=0;b<C.length;b++)0<b&&(q+=o),q+=v(C[b],b);0<u.length&&(q+=g)}for(var D=0;D<u.length;D++){var L=(H?C:u[D]).length,k=!1,B=H?Object.keys(u[D]).length===0:u[D].length===0;if(P&&!H&&(k=P==="greedy"?u[D].join("").trim()==="":u[D].length===1&&u[D][0].length===0),P==="greedy"&&H){for(var V=[],R=0;R<L;R++){var I=h?C[R]:R;V.push(u[D][I])}k=V.join("").trim()===""}if(!k){for(var E=0;E<L;E++){0<E&&!B&&(q+=o);var ne=H&&h?C[E]:E;q+=v(u[D][ne],E)}D<u.length-1&&(!P||0<L&&!B)&&(q+=g)}}return q}function v(C,u){var P,q;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(q=!1,O&&typeof C=="string"&&O.test(C)&&(C="'"+C,q=!0),P=C.toString().replace(m,re),(q=q||a===!0||typeof a=="function"&&a(C,u)||Array.isArray(a)&&a[u]||((H,h)=>{for(var b=0;b<h.length;b++)if(-1<H.indexOf(h[b]))return!0;return!1})(P,i.BAD_DELIMITERS)||-1<P.indexOf(o)||P.charAt(0)===" "||P.charAt(P.length-1)===" ")?F+P+F:P)}},i.RECORD_SEP="",i.UNIT_SEP="",i.BYTE_ORDER_MARK="\uFEFF",i.BAD_DELIMITERS=["\r",`
`,'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!w&&!!c.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=te,i.ParserHandle=Q,i.NetworkStreamer=M,i.FileStreamer=f,i.StringStreamer=Y,i.ReadableStreamStreamer=T,c.jQuery&&((j=c.jQuery).fn.parse=function(t){var r=t.config||{},a=[];return this.each(function(g){if(!(j(this).prop("tagName").toUpperCase()==="INPUT"&&j(this).attr("type").toLowerCase()==="file"&&c.FileReader)||!this.files||this.files.length===0)return!0;for(var F=0;F<this.files.length;F++)a.push({file:this.files[F],inputElem:this,instanceConfig:j.extend({},r)})}),l(),this;function l(){if(a.length===0)n(t.complete)&&t.complete();else{var g,F,re,Z,_=a[0];if(n(t.before)){var O=t.before(_.file,_.inputElem);if(typeof O=="object"){if(O.action==="abort")return g="AbortError",F=_.file,re=_.inputElem,Z=O.reason,void(n(t.error)&&t.error({name:g},F,re,Z));if(O.action==="skip")return void o();typeof O.config=="object"&&(_.instanceConfig=j.extend(_.instanceConfig,O.config))}else if(O==="skip")return void o()}var m=_.instanceConfig.complete;_.instanceConfig.complete=function(G){n(m)&&m(G,_.file,_.inputElem),o()},i.parse(_.file,_.instanceConfig)}}function o(){a.splice(0,1),l()}}),p&&(c.onmessage=function(t){t=t.data,i.WORKER_ID===void 0&&t&&(i.WORKER_ID=t.workerId),typeof t.input=="string"?c.postMessage({workerId:i.WORKER_ID,results:i.parse(t.input,t.config),finished:!0}):(c.File&&t.input instanceof File||t.input instanceof Object)&&(t=i.parse(t.input,t.config))&&c.postMessage({workerId:i.WORKER_ID,results:t,finished:!0})}),(M.prototype=Object.create(A.prototype)).constructor=M,(f.prototype=Object.create(A.prototype)).constructor=f,(Y.prototype=Object.create(Y.prototype)).constructor=Y,(T.prototype=Object.create(A.prototype)).constructor=T,i})})(ze)),ze.exports}var It=Lt();const Mt=nt(It),Be="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",$e=s=>{if(!s)return new Date().toISOString();const d=s.trim();let x=_e(d,"d/M/yy",new Date);if(Ce(x))return x.getFullYear()<2e3&&(x=Xe(x,100),x.getFullYear()<2e3&&x.setFullYear(2e3+parseInt(d.split(/[-/]/)[2]))),x.toISOString();if(x=_e(d,"d/M/yyyy",new Date),Ce(x))return x.toISOString();const c=new Date(d);return isNaN(c.getTime())?new Date().toISOString():c.toISOString()},Ft=s=>{const{configs:d,loading:x}=ft(),c=d.ticketSync,{toast:j}=Ve(),w=Ye(),p=z.useRef(!1);z.useEffect(()=>{if(x||!c?.autoSync||!Be||!s||s.length===0)return;const y=async()=>{if(p.current)return;const i=new Date,A=i.toISOString().split("T")[0];if(c.lastSync===A)return;const[M,f]=(c.syncTime||"08:00").split(":"),Y=new Date;if(Y.setHours(parseInt(M),parseInt(f),0,0),i>=Y){p.current=!0;try{const T=await fetch(Be);if(!T.ok)throw new Error("Failed to fetch CSV");const Q=await T.text();Mt.parse(Q,{header:!0,skipEmptyLines:!0,transformHeader:$=>$.trim(),complete:async $=>{try{const ae=$.data.map(S=>({ticketNumber:S["Ticket Number"]||S["Ticket No"]||"",shortDesc:S["Short Description & Detail"]||S.Detail||S.Description||"",status:S.Status||"Open",type:S["Ticket Type"]||"Incident",assign:S.Assign||"Unassigned",details:S.Detail||"",action:S.Ation||S.Action||"",resolvedDetail:S["Resolved detail"]||"",remark:S.Remark||"",date:$e(S.Date),createdAt:$e(S.Date)})).filter(S=>S.ticketNumber).filter(S=>{const K=s.find(ie=>ie.ticketNumber===S.ticketNumber);return K?K.status!==S.status||K.shortDesc!==S.shortDesc||K.assign!==S.assign||K.action!==S.action||(K.details||"")!==S.details||(K.remark||"")!==S.remark||(K.type||"Incident")!==S.type||(K.resolvedDetail||"")!==S.resolvedDetail:!0});ae.length>0&&(await ye.importLogsFromSheet(ae),w.invalidateQueries({queryKey:["ticketLogs"]}),j({title:"Auto Sync Completed",description:`Synced ${ae.length} updates from Sheet.`})),await bt.updateConfigs({...d,ticketSync:{...c,lastSync:A}})}catch(te){console.error("Auto Sync Parse Error:",te)}finally{p.current=!1}},error:$=>{console.error("Auto Sync CSV Error:",$),p.current=!1}})}catch(T){console.error("Auto Sync Fetch Error:",T),p.current=!1}}},W=setInterval(y,6e4);return y(),()=>clearInterval(W)},[c,s,w,d,x,j])},Ke="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",We=s=>{if(!s)return new Date().toISOString();const d=new Date(s);if(!isNaN(d.getTime()))return d.toISOString();const x=String(s).trim();let c=_e(x,"d/M/yy",new Date);return Ce(c)?(c.getFullYear()<2e3&&(c=Xe(c,100),c.getFullYear()<2e3&&c.setFullYear(2e3+parseInt(x.split(/[-/]/)[2]))),c.toISOString()):(c=_e(x,"d/M/yyyy",new Date),Ce(c)?c.toISOString():new Date().toISOString())},je=z.memo(({label:s,value:d,variant:x})=>{const c={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${c[x]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:d}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:s})]})});je.displayName="StatBox";const Re=z.memo(({item:s,type:d})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${d==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",s.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:s.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${d==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:d==="new"?"New":"Update"})]}));Re.displayName="PreviewRow";function Ut({isOpen:s,onClose:d,onSyncComplete:x,currentLogs:c}){const[j,w]=z.useState("input"),[p,y]=z.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[W,i]=z.useState(null),A=z.useCallback(()=>{w("input"),y({newItems:[],updatedItems:[],uptodateItems:[]}),i(null)},[]),M=z.useCallback(async()=>{w("analyzing"),i(null);try{const T=await fetch(Ke);if(!T.ok)throw new Error("Failed to fetch data from Apps Script ("+T.status+")");const Q=await T.json();if(Q.status==="error")throw new Error(Q.message||"Unknown Script Error");const $=Array.isArray(Q)?Q:Q.data||[];if($.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const te=$.map(n=>({ticketNumber:n.ticketNo||n.ticketNumber||"",shortDesc:n.subject||n.shortDescription||n.description||"",status:n.status||"Open",type:n.ticketType||n.type||"Incident",assign:n.assignee||n.assign||"Unassigned",details:n.description||n.detail||"",action:n.actionTaken||n.action||"",resolvedDetail:n.resolutionNote||n.resolvedDetail||"",remark:n.remark||"",severity:n.severity||"Low",category:n.category||"",subCategory:n.subCategory||"",date:We(n.date||n.ticketDate||n.createdAt),createdAt:We(n.date||n.ticketDate||n.createdAt)})).filter(n=>n.ticketNumber),ae=Array.from(te.reduce((n,t)=>{const r=String(t.ticketNumber).trim();return n.set(r,{...t,ticketNumber:r}),n},new Map).values()),S=[],K=[],ie=[];ae.forEach(n=>{const t=c.find(r=>String(r.ticketNumber).trim()===n.ticketNumber);t?t.status!==n.status||t.shortDesc!==n.shortDesc||t.assign!==n.assign||t.action!==n.action||(t.details||"")!==n.details||(t.remark||"")!==n.remark||(t.type||"Incident")!==n.type||(t.resolvedDetail||"")!==n.resolvedDetail||(t.category||"")!==n.category||(t.subCategory||"")!==n.subCategory||(t.severity||"Low")!==n.severity?K.push({...n,_prev:t}):ie.push(n):S.push(n)});const X=(n,t)=>new Date(t.createdAt||0)-new Date(n.createdAt||0);y({newItems:S.sort(X),updatedItems:K.sort(X),uptodateItems:ie.sort(X)}),w("review")}catch(T){console.error(T),i("Sync Error: "+T.message),w("input")}},[c]),f=z.useCallback(async()=>{w("saving");try{const Q=[...p.newItems,...p.updatedItems].map(({_prev:$,...te})=>te);Q.length>0&&await ye.importLogsFromSheet(Q),x&&x(Q.length),setTimeout(()=>{d(),A()},1500),w("success")}catch(T){i("Database Error: "+T.message),w("review")}},[p.newItems,p.updatedItems,x,d,A]);if(!s)return null;const Y=p.newItems.length+p.updatedItems.length;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-950 w-full max-w-lg rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Te,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Live Sync Manager"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"External Database Connector"})]})]}),e.jsx("button",{onClick:d,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(ve,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:e.jsxs(e.Fragment,{children:[j==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(Te,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),W&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(gt,{size:14})," ",W]})]}),j==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(Ne,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),j==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(je,{label:"New",value:p.newItems.length,variant:"new"}),e.jsx(je,{label:"Updates",value:p.updatedItems.length,variant:"update"}),e.jsx(je,{label:"Unchanged",value:p.uptodateItems.length,variant:"unchanged"})]}),Y>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest",children:"Pending Sync Records"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[Y," items to process"]})]}),e.jsxs("button",{onClick:M,disabled:j==="analyzing",className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95",title:"Re-fetch latest data",children:[e.jsx(Fe,{size:12,className:j==="analyzing"?"animate-spin":""})," Refresh"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-[1.5rem] overflow-hidden shadow-inner",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[p.newItems.map(T=>e.jsx(Re,{item:T,type:"new"},T.ticketNumber)),p.updatedItems.map(T=>e.jsx(Re,{item:T,type:"update"},T.ticketNumber))]})})]}):e.jsxs("div",{className:"py-10 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Ae,{size:32,className:"mx-auto mb-3 text-emerald-500/40"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-tight",children:"System Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1 max-w-[200px] mx-auto leading-relaxed",children:"Your local database matches the remote Google Sheets source."}),e.jsxs("button",{onClick:M,className:"mt-6 flex items-center gap-1.5 px-4 py-2 mx-auto bg-white dark:bg-zinc-800 rounded-xl text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95 shadow-sm",children:[e.jsx(Fe,{size:12})," Force Re-Check"]})]})]}),j==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Ae,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})}),e.jsxs("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",children:[j==="input"&&e.jsxs("button",{onClick:M,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(kt,{size:14})]}),j==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:f,disabled:Y===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(yt,{size:14})," Confirm Sync"]})]}),j==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(Ne,{size:14,className:"animate-spin"})," Updating Database..."]}),j==="success"&&e.jsx("button",{onClick:d,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})]})]})})}const ke=z.memo(({label:s,required:d,icon:x,...c})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[x&&e.jsx(x,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",d&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{...c,className:de("w-full h-11 px-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none disabled:opacity-50",c.className)})]}));ke.displayName="ModernInput";const xe=z.memo(({label:s,value:d,onChange:x,options:c,required:j,icon:w})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[w&&e.jsx(w,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",j&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:d,onChange:p=>x(p.target.value),className:de("w-full h-11 px-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none"),children:[e.jsx("option",{value:"",children:"Select..."}),c.map(p=>e.jsx("option",{value:p,children:p},p))]})]}));xe.displayName="ModernSelect";const we=z.memo(({label:s,icon:d,...x})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[d&&e.jsx(d,{size:10,className:"text-primary/70",strokeWidth:3}),s]}),e.jsx("textarea",{...x,className:de("w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none",x.className)})]}));we.displayName="ModernTextarea";const Pt=z.memo(({label:s,value:d,onChange:x,options:c,colorMap:j={}})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1",children:s}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(w=>{const p=d===w,y=w?.toLowerCase()||"zinc",W=j[y]||"zinc",i={red:"bg-rose-500 text-white shadow-lg shadow-rose-500/30",orange:"bg-orange-500 text-white shadow-lg shadow-orange-500/30",amber:"bg-amber-500 text-white shadow-lg shadow-amber-500/30",emerald:"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30",blue:"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30",purple:"bg-purple-600 text-white shadow-lg shadow-purple-500/30",zinc:"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg"}[W];return e.jsx("button",{type:"button",onClick:()=>x(w),className:de("h-10 px-4 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-300 active:scale-95",p?i:"bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:border-zinc-300"),children:w},w)})})]}));Pt.displayName="ModernPillPicker";const He={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",responsibility:"",assign:"",remark:""};function qt({isOpen:s,onClose:d,initialData:x,onSubmit:c,isSubmitting:j}){const{ticketOptions:w}=Je(),{team:p}=vt(),[y,W]=z.useState(He);z.useEffect(()=>{let f=!0;return s&&setTimeout(()=>{f&&(W(x||He),document.body.style.overflow="hidden")},0),()=>{f=!1,document.body.style.overflow=""}},[x,s]);const i=z.useCallback((f,Y)=>{W(T=>({...T,[f]:Y}))},[]),A=z.useCallback(f=>{f.preventDefault(),c(y)},[y,c]);if(!s)return null;const M=!!x;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-zinc-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-[#0c0c0e] rounded-[2.5rem] border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[95vh] animate-in zoom-in-95 duration-400",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:de("w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transform -rotate-3",M?"bg-amber-100 dark:bg-amber-500/20 text-amber-600":"bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600"),children:e.jsx(ct,{size:22,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:M?"Edit Ticket":"Create New Ticket"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:de("w-1.5 h-1.5 rounded-full",M?"bg-amber-500":"bg-indigo-500")}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:M?`Modifying Record ${y.ticketNumber}`:"Deploying Operational Log"})]})]})]}),e.jsx("button",{onClick:d,className:"w-10 h-10 flex items-center justify-center rounded-2xl hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-90",children:e.jsx(ve,{size:20,strokeWidth:2.5})})]}),e.jsxs("form",{id:"ticket-form",onSubmit:A,className:"flex-1 overflow-y-auto custom-scrollbar px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(ke,{label:"Ticket No.",icon:zt,required:!0,disabled:M,value:y.ticketNumber,onChange:f=>i("ticketNumber",f.target.value)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Responsibility",icon:Ee,value:y.responsibility,onChange:f=>i("responsibility",f),options:p.map(f=>f.name)})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Type",icon:jt,value:y.type,onChange:f=>i("type",f),options:w.types||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Status",value:y.status,onChange:f=>i("status",f),options:w.statuses||[]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12 md:col-span-3",children:e.jsx(xe,{label:"Severity",value:y.severity,onChange:f=>i("severity",f),options:w.severities||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-4",children:e.jsx(xe,{label:"Category",value:y.category,onChange:f=>i("category",f),options:w.categories||[]})}),e.jsx("div",{className:"col-span-12 md:col-span-5",children:e.jsx(xe,{label:"Sub-Category",value:y.subCategory,onChange:f=>i("subCategory",f),options:w.subCategories||[]})})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ke,{label:"Subject / Short Description",icon:Pe,required:!0,value:y.shortDesc,onChange:f=>i("shortDesc",f.target.value),className:"font-bold"}),e.jsx(we,{label:"Ticket Details",rows:5,value:y.details,onChange:f=>i("details",f.target.value),className:"font-mono text-xs leading-relaxed"})]}),e.jsx("hr",{className:"border-dashed border-zinc-200 dark:border-zinc-800"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[e.jsx("div",{className:"flex flex-col h-full",children:e.jsx(we,{label:"Action Taken / Mitigation",icon:Pe,value:y.action,onChange:f=>i("action",f.target.value),className:"bg-emerald-50/50 dark:bg-emerald-900/10 border-emerald-100 dark:border-emerald-900/20 flex-1 min-h-[180px]",wrapperClassName:"flex-1 flex flex-col"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(ke,{label:"Resolution Result",value:y.resolvedDetail,onChange:f=>i("resolvedDetail",f.target.value)}),e.jsx(ke,{label:"Assignee",icon:Ee,value:y.assign,onChange:f=>i("assign",f.target.value)}),e.jsx(we,{label:"Remarks",rows:2,value:y.remark,onChange:f=>i("remark",f.target.value)})]})]})]}),e.jsxs("div",{className:"px-8 py-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/40 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"opacity-70 text-rose-600 dark:text-rose-500",children:"*"})," Field Persistence Required"]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 md:flex-none h-12 px-6 rounded-2xl text-xs font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-200/50 dark:hover:bg-zinc-800 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:j,className:de("flex-1 md:flex-none flex items-center justify-center gap-2 h-12 px-8 rounded-2xl text-xs font-black uppercase tracking-widest text-white shadow-xl shadow-primary/20","transition-all active:scale-95 disabled:opacity-50",M?"bg-amber-500 hover:bg-amber-600":"bg-primary hover:brightness-110"),children:j?e.jsx(Ne,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:16,strokeWidth:2.5}),M?"Update Log":"Commit Ticket"]})})]})]})]})})}const Bt=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Qe=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},rt=z.memo(({date:s})=>{const d=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:pe(d,"MMM")}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:pe(d,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5",children:pe(d,"yy")})]})});rt.displayName="DateBox";const st=z.memo(({log:s,onLogClick:d,onSendToIncident:x,onEdit:c,onDelete:j,canEdit:w})=>{const p=()=>d(s),y=A=>{A.stopPropagation(),x(s,A)},W=A=>{A.stopPropagation(),c(s)},i=A=>{A.stopPropagation(),j(s.ticketNumber)};return e.jsxs("tr",{onClick:p,className:"group hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer border-b border-zinc-100 dark:border-zinc-800 last:border-0",children:[e.jsx("td",{className:"py-4 pl-6 pr-3 whitespace-nowrap",children:e.jsx(rt,{date:s.createdAt})}),e.jsx("td",{className:"py-4 px-3 whitespace-nowrap",children:e.jsxs("span",{className:"font-mono text-xs font-black text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-950/30 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-900/50 shadow-sm",children:["#",s.ticketNumber]})}),e.jsx("td",{className:"py-4 px-3 w-full",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-1 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md border ${Bt(s.status)} shadow-sm`,children:s.status}),e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx(Ze,{size:10,className:Qe(s.severity)}),e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${Qe(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-4 h-4 rounded-md bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-[8px] font-black text-zinc-600 dark:text-zinc-300 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():e.jsx(Ee,{size:10})}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 truncate max-w-[120px]",children:s.assign||"Unassigned"})]}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-100/50 dark:bg-zinc-800/30 px-1.5 py-0.5 rounded",children:s.type})]})]})}),e.jsx("td",{className:"py-4 pl-3 pr-6 text-right whitespace-nowrap",children:w&&e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:y,className:"p-1.5 text-zinc-400 hover:text-amber-500 hover:bg-amber-50 rounded-md",title:"Add to Timeline",children:e.jsx(et,{size:16})}),e.jsx("button",{onClick:W,className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-blue-50 rounded-md",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:i,className:"p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 rounded-md",children:e.jsx(tt,{size:16})})]})})]})});st.displayName="TicketTableRow";function $t({logs:s,onLogClick:d,onSendToIncident:x,onEdit:c,onDelete:j,canEdit:w}){return e.jsx("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:[e.jsx("th",{className:"py-4 pl-6 pr-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Date"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Ticket ID"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Operational Summary & Metadata"}),e.jsx("th",{className:"py-4 pl-3 pr-6 text-right text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:s.map(p=>e.jsx(st,{log:p,onLogClick:d,onSendToIncident:x,onEdit:c,onDelete:j,canEdit:w},p.id))})]})})})}const Kt=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Ge=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},at=z.memo(({date:s})=>{const d=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:pe(d,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:pe(d,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:pe(d,"yy")})]})});at.displayName="DateBox";const it=z.memo(({log:s,onClick:d,onEdit:x,canEdit:c})=>e.jsx("div",{onClick:d,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] p-4 shadow-sm hover:shadow-md transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(at,{date:s.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 text-[10px] sm:text-xs font-black rounded-lg border border-blue-100 dark:border-blue-800",children:["#",s.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-black px-2 py-0.5 rounded-full border ${Kt(s.status)} shadow-sm`,children:s.status})]}),c&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:j=>{j.stopPropagation(),x(s)},className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:e.jsx(Oe,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:s.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:12,className:Ge(s.severity)}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${Ge(s.severity)}`,children:s.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-400 font-bold bg-zinc-50 dark:bg-zinc-800/50 px-2 py-0.5 rounded-lg",children:s.type})]})]})]})}));it.displayName="MobileTicketCard";function Wt({logs:s,onLogClick:d,onEdit:x,canEdit:c}){return e.jsx("div",{className:"md:hidden space-y-4",children:s.map(j=>e.jsx(it,{log:j,onClick:()=>d(j),onEdit:x,canEdit:c},j.id))})}const Ht=({log:s,onClose:d,onSendToIncident:x,onEdit:c,onDelete:j,canEdit:w})=>{if(!s)return null;const p=s.createdAt?pe(new Date(s.createdAt),"dd MMM yyyy"):"-",y=i=>{switch(i?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},W=i=>{switch(i?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:d,children:e.jsxs("div",{className:"w-[95vw] sm:w-full max-w-xl bg-white dark:bg-zinc-950 rounded-t-2xl sm:rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[85vh] shadow-2xl animate-in slide-in-from-bottom-10 sm:zoom-in-95 duration-200",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"px-5 sm:px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-lg sm:text-xl font-black text-zinc-900 dark:text-white",children:["#",s.ticketNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ht,{size:11})," ",p]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(At,{size:11})," ",s.type]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${y(s.status)}`,children:s.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:j,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(tt,{size:14})})]}),e.jsx("button",{onClick:d,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(ve,{size:16})})]})]}),e.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${W(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono max-h-48 overflow-y-auto custom-scrollbar",children:s.details||s.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(xt,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Ae,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.resolvedDetail||"Pending"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:s.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:s.assign||"Unassigned"})]})]}),w&&e.jsxs("button",{onClick:()=>{x(),d()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(et,{size:14})," Add to Timeline"]})]})]})})};function gr(){const{logs:s,loading:d,loadingMore:x,hasMore:c,loadMore:j,stats:w}=pt(),{toast:p}=Ve(),{currentUser:y}=ot(),W=lt(y,[Me.LEAD,Me.ENGINEER]),{ticketOptions:i}=Je(),A=dt(),M=Ye(),[f,Y]=z.useState(!1),[T,Q]=z.useState(""),[$,te]=z.useState("All"),[ae,S]=z.useState("All"),[K,ie]=z.useState(null),X=z.useDeferredValue(T),[n,t]=z.useState(!1),[r,a]=z.useState(null),[l,o]=z.useState(!1),[g,F]=z.useState(null),[re,Z]=z.useState(!1);Ft(s);const _=z.useCallback(()=>{a(null),t(!0)},[]),O=z.useCallback(h=>{a(h),t(!0)},[]),m=z.useCallback(async h=>{console.log("Submitting Ticket Form:",h),o(!0);try{r?(await ye.updateLog(r.ticketNumber,h),p({className:"bg-emerald-500 text-white border-none",title:"Update Successful",description:`Ticket #${r.ticketNumber} has been updated.`})):(await ye.createLog(h),p({className:"bg-indigo-500 text-white border-none",title:"Ticket Created",description:"New operational log has been recorded."})),M.invalidateQueries(["ticketLogs"]),t(!1),a(null),ie(null)}catch(b){console.error("Submit Error:",b),p({variant:"destructive",title:"Submission Failed",description:b.message||"Could not save the ticket."})}finally{o(!1)}},[r,M,p]),G=z.useCallback(h=>{F(h)},[]),v=z.useCallback(async()=>{if(g)try{await ye.deleteLog(g),p({title:"Ticket Deleted",description:`Ticket #${g} removed from system.`}),M.invalidateQueries(["ticketLogs"]),ie(null)}catch(h){p({variant:"destructive",title:"Delete Failed",description:h.message})}finally{F(null)}},[g,M,p]),C=z.useCallback(async(h,b)=>{if(b&&b.stopPropagation(),!y){p({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const D=typeof y=="object"&&y!==null?{name:y.name,id:y.id,role:y.role}:{name:y},L={subject:h.shortDesc||h.details||"New Incident from Log",ticket:h.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(h.type)?h.type:"Incident",status:"Open",createdBy:D,impact:"",root_cause:h.details||"",action:h.action||""};await mt.createIncident(L),p({title:"Successfully Added",description:`Ticket #${h.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>A("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(D){console.error(D),p({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[y,A,p]),u=z.useMemo(()=>s.filter(h=>{const b=h.ticketNumber?.toLowerCase().includes(X.toLowerCase())||h.shortDesc?.toLowerCase().includes(X.toLowerCase())||h.details&&h.details.toLowerCase().includes(X.toLowerCase()),D=$==="All"||h.status===$,L=ae==="All"||h.type===ae;return b&&D&&L}).sort((h,b)=>new Date(b.createdAt||0)-new Date(h.createdAt||0)),[s,X,$,ae]),P=$!=="All"||ae!=="All",q=z.useCallback(()=>{te("All"),S("All"),Q("")},[]),H=z.useCallback(h=>{ie(h)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx("div",{className:"shrink-0 py-5 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[9px] font-bold rounded uppercase tracking-wider",children:"System Log"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[w.total," Records"]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Ticket Management"})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:_,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Nt,{size:16})," New Ticket"]}),e.jsxs("button",{onClick:()=>Y(!0),disabled:d,className:"flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Te,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(_t,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"",value:T,onChange:h=>Q(h.target.value),className:"w-full h-10 pl-10 pr-9 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),T&&e.jsx("button",{onClick:()=>Q(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ve,{size:14})})]}),e.jsxs("button",{onClick:()=>Z(!0),className:de("h-10 px-3 flex items-center justify-center rounded-xl transition-all border",P?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 border-blue-200 dark:border-blue-800":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent"),children:[e.jsx(Ue,{size:18}),P&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-blue-500 rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ct,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{Q(""),te("All"),S("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{logs:u,onLogClick:H,onSendToIncident:C,onEdit:O,onDelete:G,canEdit:W}),e.jsx(Wt,{logs:u,onLogClick:H,onEdit:O,canEdit:W}),c&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:j,disabled:x,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:x?e.jsx(Ne,{className:"animate-spin",size:16}):e.jsx(Dt,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),K&&e.jsx(Ht,{log:K,onClose:()=>ie(null),onSendToIncident:()=>C(K),onEdit:()=>O(K),onDelete:()=>G(K.ticketNumber),canEdit:W}),e.jsx(qt,{isOpen:n,onClose:()=>t(!1),initialData:r,onSubmit:m,isSubmitting:l}),e.jsx(ut,{isOpen:!!g,onClose:()=>F(null),onConfirm:v,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${g}? This action cannot be undone.`,isDanger:!0}),e.jsx(Ut,{isOpen:f,onClose:()=>Y(!1),currentLogs:s,onSyncComplete:h=>{p({title:"Sync Completed",description:`Updated ${h} records.`}),M.invalidateQueries({queryKey:["ticketLogs"]}),Y(!1)}}),re&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>Z(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-[2.5rem] p-8 shadow-2xl animate-in slide-in-from-bottom duration-400 max-w-2xl mx-auto w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-500/20 text-blue-600 flex items-center justify-center",children:e.jsx(Ue,{size:20})}),e.jsx("h3",{className:"text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>Z(!1),className:"w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 rounded-2xl text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(ve,{size:20,strokeWidth:2.5})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Current Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...i.statuses].map(h=>e.jsx("button",{onClick:()=>te(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",$===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Log Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...i.types].map(h=>e.jsx("button",{onClick:()=>S(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",ae===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]})]}),e.jsxs("div",{className:"mt-10 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>{q(),Z(!1)},className:"flex-1 h-12 rounded-2xl text-xs font-black uppercase tracking-widest text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/50 transition-colors",children:"Reset Filters"}),e.jsx("button",{onClick:()=>Z(!1),className:"flex-[2] h-12 rounded-2xl bg-blue-600 text-white text-xs font-black uppercase tracking-widest shadow-xl shadow-blue-500/30 hover:brightness-110 active:scale-95 transition-all",children:"Apply Constraints"})]})]})]})]})}export{gr as default};
