const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TicketSyncModal-OXp6ssTj.js","assets/index-CDkxVpyL.js","assets/index-CZDvCB6v.css","assets/useTicketOptions-1NENMkK8.js","assets/useBaseQuery-CcOuYnM9.js","assets/configService-BD4Z94ql.js","assets/cloud-download-DYvcTZAJ.js","assets/sliders-horizontal-USruKLC5.js","assets/arrow-right-6xxmCear.js","assets/database-DONJxXxF.js","assets/parse-ChHvz_2n.js","assets/format-DU8rxv2E.js","assets/addYears-C7ezsmVv.js"])))=>i.map(i=>d[i]);
import{d as U,r as i,ak as Se,C as Te,j as e,y as m,ac as ee,X as q,U as X,L as Fe,a as Le,b as Ae,N as Me,u as Ee,a6 as Ie,an as Re,O as le,ag as Oe}from"./index-CDkxVpyL.js";import{t as F,F as de,u as xe,a as Pe,I as _e}from"./useTicketOptions-1NENMkK8.js";import{i as qe}from"./incidentService-TpS9UXlk.js";import{C as Ue}from"./circle-check-big-GocMzVxW.js";import{C as $e}from"./configService-BD4Z94ql.js";import{C as me,S as Be,a as Ve}from"./sliders-horizontal-USruKLC5.js";import{T as be,P as Ge}from"./trash-2-CUm5-oxb.js";import{f as A}from"./format-DU8rxv2E.js";import{V as Qe,u as He}from"./VirtualizedList-BTU-9biu.js";import{S as ue,F as We}from"./FilterBar-CnBzcUNb.js";import{T as he}from"./tag-DJ5affvW.js";import{P as pe}from"./panels-top-left-CIELI7SW.js";import{A as ge}from"./activity-BkKTYoZb.js";import{S as Ke}from"./save-1idTjAku.js";import{C as Xe}from"./cloud-download-DYvcTZAJ.js";import{G as Ze}from"./globe-CW3ERab5.js";import{C as Je}from"./chevron-right-C7jt9gz_.js";import"./useBaseQuery-CcOuYnM9.js";import"./search-B_qFLBYc.js";const Ye=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],et=U("chevrons-left",Ye);const tt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],st=U("chevrons-right",tt);const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}],["path",{d:"M8 12h8",key:"1wcyev"}]],it=U("circle-arrow-right",rt);const at=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],nt=U("info",at),ct=()=>{const t=i.useRef(!1);i.useEffect(()=>{t.current||(t.current=!0,F.checkAndSyncTickets())},[])},fe=i.memo(({label:t,value:n,icon:r,colorClass:a,borderColorClass:d})=>{const o=r;return e.jsx("div",{className:m("relative bg-white dark:bg-zinc-900 border-l-[3px] rounded-r-lg p-4","shadow-sm hover:shadow-md transition-shadow",d),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400 dark:text-zinc-500 uppercase tracking-wide mb-1",children:t}),e.jsx("h4",{className:"text-2xl font-bold text-zinc-900 dark:text-white leading-none",children:typeof n=="number"?n.toLocaleString():n})]}),e.jsx("div",{className:m("w-10 h-10 rounded-lg flex items-center justify-center bg-zinc-50 dark:bg-zinc-800"),children:e.jsx(o,{size:20,className:a,strokeWidth:2})})]})})});fe.displayName="StatCard";function lt({stats:t={}}){const n=[{label:"Total Tickets",value:t?.total||0,icon:Se,colorClass:"text-[#0078D4]",borderColorClass:"border-[#0078D4]"},{label:"Resolved",value:t?.succeed||0,icon:Ue,colorClass:"text-emerald-500",borderColorClass:"border-emerald-500"},{label:"Pending",value:t?.pending||0,icon:$e,colorClass:"text-amber-500",borderColorClass:"border-amber-500"},{label:"Incidents",value:t?.incidents||0,icon:Te,colorClass:"text-red-500",borderColorClass:"border-red-500"}];return e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:n.map((r,a)=>e.jsx(fe,{label:r.label,value:r.value,icon:r.icon,colorClass:r.colorClass,borderColorClass:r.borderColorClass},a))})}const dt=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-500";case"pending":return"bg-amber-500";case"in progress":return"bg-[#0078D4]";case"resolved":case"succeed":case"completed":return"bg-emerald-500";default:return"bg-zinc-400"}},ot=t=>{switch(t?.toLowerCase()){case"open":return{text:"text-red-600",bg:"bg-red-50"};case"pending":return{text:"text-amber-600",bg:"bg-amber-50"};case"in progress":return{text:"text-[#0078D4]",bg:"bg-blue-50"};case"resolved":case"succeed":case"completed":return{text:"text-emerald-600",bg:"bg-emerald-50"};default:return{text:"text-zinc-500",bg:"bg-zinc-50"}}},ke=i.memo(({log:t,onClick:n,isActive:r,onFlag:a,onDelete:d})=>{const o=dt(t.status),l=ot(t.status);return e.jsxs("div",{onClick:()=>n(t),className:m("group relative flex cursor-pointer transition-all border-b border-zinc-100 dark:border-zinc-800/50 hover:bg-zinc-50 dark:hover:bg-zinc-800/50",r?"bg-[#cce3f5] dark:bg-[#0078D4]/20":"bg-white dark:bg-zinc-900"),children:[e.jsx("div",{className:m("w-1 shrink-0",r?"bg-[#0078D4]":o)}),e.jsxs("div",{className:"flex-1 p-3 min-w-0 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.isFlagged&&e.jsx(de,{size:12,className:"text-amber-500 shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:m("w-5 h-5 rounded-full flex items-center justify-center font-bold text-[10px]",l.bg,l.text),children:t.assign?t.assign.charAt(0).toUpperCase():"?"}),e.jsx("span",{className:m("font-semibold truncate",r?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300"),children:t.assign||"Unassigned"})]})]}),e.jsx("span",{className:m("text-[10px] shrink-0",r?"text-zinc-700 dark:text-zinc-300":"text-zinc-400 group-hover:hidden"),children:t.createdAt?A(new Date(t.createdAt),"MMM dd"):""}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-2 shrink-0 animate-in fade-in duration-200",children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),a&&a(t)},className:m("transition-colors",t.isFlagged?"text-amber-500 hover:text-amber-600":"text-zinc-400 hover:text-amber-500"),title:t.isFlagged?"Remove Flag":"Flag to Top",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),d&&d(t.ticketNumber)},className:"text-zinc-400 hover:text-red-500 transition-colors",title:"Delete",children:e.jsx(be,{size:14})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.severity==="Critical"&&e.jsx(ee,{size:12,className:"text-red-500 shrink-0"}),e.jsx("h4",{className:m("text-sm font-semibold truncate",r?"text-[#0078D4]":"text-zinc-900 dark:text-white"),children:t.shortDesc||t.details||"(No Subject)"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs truncate",children:[e.jsxs("span",{className:"shrink-0 font-mono text-[10px] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 px-1.5 py-0.5 rounded",children:["#",t.ticketNumber]}),e.jsx("span",{className:m("truncate",r?"text-zinc-600 dark:text-zinc-400":"text-zinc-500"),children:t.details?.substring(0,60)||"No details preview..."}),!r&&e.jsx("span",{className:m("ml-auto shrink-0 px-1.5 py-0.5 rounded-[3px] text-[10px] font-medium uppercase tracking-wider",l.bg,l.text),children:t.status})]})]})]})});ke.displayName="TicketListItem";const ze=i.memo(({logs:t,onLogClick:n,isLoading:r,activeLogId:a,onFlag:d,onDelete:o})=>r?e.jsx("div",{className:"p-4 space-y-3",children:[1,2,3,4,5].map(l=>e.jsx("div",{className:"h-20 bg-zinc-100 dark:bg-zinc-800/50 rounded-lg animate-pulse"},l))}):!t||t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-zinc-400",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(me,{size:32})}),e.jsx("p",{className:"font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-sm",children:"No tickets found."})]}):e.jsx("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800 border-t border-zinc-200 dark:border-zinc-800",children:t.map(l=>e.jsx(ke,{log:l,onClick:n,isActive:a===l.ticketNumber,onFlag:d,onDelete:o},l.id||l.ticketNumber))}));ze.displayName="TicketTable";const xt=t=>{switch(t?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},oe=t=>{switch(t?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},je=i.memo(({date:t})=>{const n=t?new Date(t):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-md bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-bold text-zinc-500 dark:text-zinc-500 uppercase leading-none",children:A(n,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-bold text-zinc-900 dark:text-white leading-none mt-0.5",children:A(n,"dd")}),e.jsx("span",{className:"text-[7px] font-medium text-zinc-400 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:A(n,"yy")})]})});je.displayName="DateBox";const Z=i.memo(({log:t,onClick:n,onEdit:r,canEdit:a})=>e.jsx("div",{onClick:n,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 shadow-sm hover:border-[#0078D4]/50 transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(je,{date:t.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-[#deecf9] dark:bg-blue-900/20 text-[#0078D4] dark:text-[#4ba0e8] text-[10px] sm:text-xs font-semibold rounded-md border border-blue-100 dark:border-blue-800/50",children:["#",t.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-semibold px-2 py-0.5 rounded-md border ${xt(t.status)}`,children:t.status})]}),a&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:d=>{d.stopPropagation(),r(t)},className:"p-1.5 text-zinc-400 hover:text-[#0078D4] hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors",children:e.jsx(ue,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:t.shortDesc||t.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-bold text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.assign?t.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{size:12,className:oe(t.severity)}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider ${oe(t.severity)}`,children:t.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-500 border border-zinc-200 dark:border-zinc-800 dark:text-zinc-400 font-medium bg-zinc-50 dark:bg-zinc-900 px-2 py-0.5 rounded",children:t.type})]})]})]})}));Z.displayName="MobileTicketCard";function mt({logs:t,onLogClick:n,onEdit:r,canEdit:a}){const d=i.useCallback(o=>e.jsx(Z,{log:o,onClick:()=>n(o),onEdit:r,canEdit:a},o.id),[n,r,a]);return t.length<=15?e.jsx("div",{className:"md:hidden space-y-4",children:t.map(o=>e.jsx(Z,{log:o,onClick:()=>n(o),onEdit:r,canEdit:a},o.ticketNumber))}):e.jsx("div",{className:"md:hidden",children:e.jsx(Qe,{items:t,itemHeight:140,renderItem:d,containerHeight:"calc(100vh - 280px)",className:"space-y-4"})})}const L=i.memo(({label:t,required:n,icon:r,error:a,...d})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[r&&e.jsx(r,{size:10,className:"text-[#0078D4]"}),t," ",n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...d,className:m("w-full h-9 px-3 bg-zinc-50 dark:bg-zinc-800 border rounded-lg text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400","focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none disabled:opacity-50 disabled:bg-zinc-100 dark:disabled:bg-zinc-900",a?"border-red-400 dark:border-red-500":"border-zinc-200 dark:border-zinc-700")}),a&&e.jsx("p",{className:"text-[10px] text-red-500 font-medium",children:a})]}));L.displayName="FormInput";const N=i.memo(({label:t,value:n,onChange:r,options:a,required:d,icon:o,error:l})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[o&&e.jsx(o,{size:10,className:"text-[#0078D4]"}),t," ",d&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n,onChange:b=>r(b.target.value),className:m("w-full h-9 px-3 bg-zinc-50 dark:bg-zinc-800 border rounded-lg text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none",l?"border-red-400 dark:border-red-500":"border-zinc-200 dark:border-zinc-700"),children:[e.jsx("option",{value:"",children:"Select..."}),a.map(b=>e.jsx("option",{value:b,children:b},b))]}),l&&e.jsx("p",{className:"text-[10px] text-red-500 font-medium",children:l})]}));N.displayName="FormSelect";const _=i.memo(({label:t,icon:n,...r})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide flex items-center gap-1",children:[n&&e.jsx(n,{size:10,className:"text-[#0078D4]"}),t]}),e.jsx("textarea",{...r,className:m("w-full px-3 py-2 bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400","focus:ring-2 focus:ring-[#0078D4]/20 focus:border-[#0078D4] focus:outline-none")})]}));_.displayName="FormTextarea";const K={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",responsibility:"",assign:"",remark:""},J=i.memo(({onClose:t,onSubmit:n,initialData:r=null,isSubmitting:a=!1})=>{const{ticketOptions:d}=xe(),{team:o}=He(),[l,b]=i.useState(K),[h,y]=i.useState({}),g=r!==null;i.useEffect(()=>{b(r?{...K,...r}:K),y({})},[r]);const u=i.useCallback((c,f)=>{let S=f;c==="ticketNumber"&&(S=f.toUpperCase()),b(j=>({...j,[c]:S})),h[c]&&y(j=>({...j,[c]:null}))},[h]),D=i.useCallback(()=>{const c={},f=/^[A-Z]{3}\d{9}$/;return l.ticketNumber?.trim()?f.test(l.ticketNumber)||(c.ticketNumber="Format must be 3 letters + 9 numbers (e.g. SVR123456789)"):c.ticketNumber="Ticket Number is required",l.type?.trim()||(c.type="Type is required"),l.status?.trim()||(c.status="Status is required"),l.shortDesc?.trim()||(c.shortDesc="Subject is required"),y(c),Object.keys(c).length===0},[l]),w=i.useCallback(c=>{c.preventDefault(),D()&&n&&n(l)},[l,n,D]);return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(q,{size:18,className:"text-zinc-500"})}),e.jsxs("div",{children:[e.jsx("span",{className:m("px-2 py-0.5 text-[10px] font-semibold rounded",g?"bg-amber-500 text-white":"bg-[#0078D4] text-white"),children:g?"EDIT":"NEW"}),e.jsx("h2",{className:"text-base font-semibold text-zinc-900 dark:text-white mt-1",children:g?`Edit Ticket #${r?.ticketNumber}`:"Create New Ticket"})]})]})})}),e.jsxs("form",{id:"ticket-form-panel",onSubmit:w,className:"flex-1 overflow-y-auto custom-scrollbar p-5 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(L,{label:"Ticket No.",icon:he,required:!0,disabled:g,value:l.ticketNumber,onChange:c=>u("ticketNumber",c.target.value),error:h.ticketNumber,placeholder:"e.g. SVR090924001",maxLength:12}),e.jsx(N,{label:"Type",icon:pe,required:!0,value:l.type,onChange:c=>u("type",c),options:d.types||["Incident","Request","Problem"],error:h.type})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(N,{label:"Status",required:!0,value:l.status,onChange:c=>u("status",c),options:d.statuses||["Open","Pending","In Progress","Succeed"],error:h.status}),e.jsx(N,{label:"Severity",value:l.severity,onChange:c=>u("severity",c),options:d.severities||["Critical","High","Medium","Low"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(N,{label:"Category",value:l.category,onChange:c=>u("category",c),options:d.categories||[]}),e.jsx(N,{label:"Sub Category",value:l.subCategory,onChange:c=>u("subCategory",c),options:d.subCategories||[]})]}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800"}),e.jsx(L,{label:"Subject / Short Description",icon:nt,required:!0,value:l.shortDesc,onChange:c=>u("shortDesc",c.target.value),error:h.shortDesc,placeholder:"Brief description of the issue"}),e.jsx(_,{label:"Ticket Details",rows:3,value:l.details,onChange:c=>u("details",c.target.value),placeholder:"Describe the incident or request in detail..."}),e.jsx("hr",{className:"border-zinc-100 dark:border-zinc-800"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(N,{label:"Responsibility",icon:X,value:l.responsibility,onChange:c=>u("responsibility",c),options:o.map(c=>c.name)}),e.jsx(L,{label:"Assignee",icon:X,value:l.assign,onChange:c=>u("assign",c.target.value),placeholder:"Assigned to"})]}),e.jsx(_,{label:"Action Taken / Mitigation",icon:ge,rows:2,value:l.action,onChange:c=>u("action",c.target.value)}),e.jsx(L,{label:"Resolution Result",value:l.resolvedDetail,onChange:c=>u("resolvedDetail",c.target.value)}),e.jsx(_,{label:"Remarks",rows:2,value:l.remark,onChange:c=>u("remark",c.target.value)})]}),e.jsx("div",{className:"shrink-0 p-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 h-10 px-4 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 rounded-lg text-sm font-medium hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",form:"ticket-form-panel",disabled:a,className:m("flex-[2] flex items-center justify-center gap-2 h-10 px-4 rounded-lg text-sm font-medium text-white transition-all",g?"bg-amber-500 hover:bg-amber-600":"bg-[#0078D4] hover:bg-[#106EBE]","disabled:opacity-50"),children:a?e.jsx(Fe,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:16}),g?"Save Changes":"Create Ticket"]})})]})})]})});J.displayName="TicketFormPanel";const O=({label:t,value:n,icon:r,className:a})=>e.jsxs("div",{className:m("space-y-1",a),children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-zinc-500 uppercase tracking-wide",children:[r&&e.jsx(r,{size:12,className:"text-[#0078D4]"}),t]}),e.jsx("div",{className:"text-sm font-medium text-zinc-900 dark:text-zinc-100 break-words",children:n||"-"})]}),Y=i.memo(({ticket:t,onClose:n,onEdit:r,onDelete:a,onSendToIncident:d,canEdit:o})=>t?e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-6 py-3 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-all lg:hidden",children:e.jsx(q,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-500",children:[e.jsxs("span",{className:"font-mono bg-zinc-100 dark:bg-zinc-800 px-2 py-0.5 rounded text-xs",children:["#",t.ticketNumber]}),e.jsx("span",{children:"/"}),e.jsx("span",{children:t.type})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(t),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-zinc-600 dark:text-zinc-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-colors",children:[e.jsx(ue,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),e.jsx("button",{onClick:()=>a(t.ticketNumber),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors",title:"Delete Ticket",children:e.jsx(be,{size:16})})]}),e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-700 mx-2"}),e.jsxs("button",{onClick:()=>d(t),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-[#0078D4] hover:bg-[#0078D4]/10 rounded-md transition-colors",title:"Convert to Incident",children:[e.jsx(it,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"To Incident"})]}),e.jsx("button",{onClick:n,className:"p-2 ml-1 text-zinc-400 hover:text-zinc-600 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-md transition-all hidden lg:block",children:e.jsx(q,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-zinc-900",children:e.jsxs("div",{className:"p-6 max-w-5xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-zinc-900 dark:text-white leading-tight",children:t.shortDesc}),e.jsxs("div",{className:"flex items-center gap-3 pb-6 border-b border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[#0078D4]/10 text-[#0078D4] flex items-center justify-center font-bold text-lg",children:t.assign?t.assign.charAt(0).toUpperCase():e.jsx(X,{size:20})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white text-sm",children:t.assign||"Unassigned"}),e.jsx("span",{className:"text-zinc-400 text-xs",children:"â€¢"}),e.jsx("span",{className:"text-zinc-500 text-xs",children:t.createdAt?A(new Date(t.createdAt),"EEE, MMM d, yyyy h:mm a"):"-"})]}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Responsibility: ",t.responsibility||"-"]})]})]})]}),e.jsxs("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 rounded-lg p-4 grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsx(O,{label:"Status",value:t.status,icon:ge}),e.jsx(O,{label:"Severity",value:t.severity,icon:ee,className:t.severity==="Critical"?"text-red-600":""}),e.jsx(O,{label:"Category",value:t.category,icon:pe}),e.jsx(O,{label:"Sub-Category",value:t.subCategory,icon:he})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-wider flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-4 bg-[#0078D4] rounded-full"}),"Description"]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-zinc-700 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap",children:t.details||"No description provided."})]}),(t.action||t.resolvedDetail||t.remark)&&e.jsxs("div",{className:"space-y-6 pt-6 border-t border-zinc-100 dark:border-zinc-800",children:[t.action&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Action Taken"}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 bg-amber-50 dark:bg-amber-900/10 p-3 rounded-md border border-amber-100 dark:border-amber-900/20",children:t.action})]}),t.resolvedDetail&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-emerald-600 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(me,{size:12})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:t.resolvedDetail})]}),t.remark&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Remarks"}),e.jsxs("p",{className:"text-sm text-zinc-500 italic",children:['"',t.remark,'"']})]})]})]})})]}):null);Y.displayName="TicketDetailPanel";const bt=i.lazy(()=>Oe(()=>import("./TicketSyncModal-OXp6ssTj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),P=15,ve=i.memo(({currentPage:t,totalPages:n,totalItems:r,itemsPerPage:a,onPageChange:d})=>{if(n<=1)return null;const o=(t-1)*a+1,l=Math.min(t*a,r);return e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-zinc-50 dark:bg-zinc-900/50 border-t border-zinc-200 dark:border-zinc-800",children:[e.jsxs("p",{className:"text-xs text-zinc-500",children:["Showing ",o," - ",l," of ",r]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"w-7 h-7 flex items-center justify-center rounded border border-zinc-200 dark:border-zinc-700 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",disabled:t===1,onClick:()=>d(1),children:e.jsx(et,{size:14})}),e.jsx("button",{className:"w-7 h-7 flex items-center justify-center rounded border border-zinc-200 dark:border-zinc-700 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",disabled:t===1,onClick:()=>d(t-1),children:e.jsx(Ve,{size:14})}),e.jsxs("span",{className:"px-3 text-sm font-medium text-zinc-700 dark:text-zinc-300",children:[t," / ",n]}),e.jsx("button",{className:"w-7 h-7 flex items-center justify-center rounded border border-zinc-200 dark:border-zinc-700 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",disabled:t===n,onClick:()=>d(t+1),children:e.jsx(Je,{size:14})}),e.jsx("button",{className:"w-7 h-7 flex items-center justify-center rounded border border-zinc-200 dark:border-zinc-700 text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",disabled:t===n,onClick:()=>d(n),children:e.jsx(st,{size:14})})]})]})});ve.displayName="PaginationFooter";function Et(){const{logs:t,loading:n,stats:r}=Pe(),{toast:a}=Le(),{currentUser:d}=Ae(),o=Me(d,[le.LEAD,le.ENGINEER]),{ticketOptions:l}=xe(),b=Ee(),h=Ie(),[y,g]=i.useState(!1),[u,D]=i.useState(""),[w,c]=i.useState("All"),[f,S]=i.useState("All"),[j,$]=i.useState(1),[ut,M]=i.useState("inbox"),B=i.useDeferredValue(u),[k,E]=i.useState(null),[v,I]=i.useState("view"),[te,se]=i.useState(!1),[C,V]=i.useState(null),[Ne,T]=i.useState(!1);ct();const re=i.useCallback((s,x)=>{s(x),$(1)},[]),ie=i.useCallback(s=>{E(s),I("view")},[]),ye=i.useCallback(()=>{E(null),I("create")},[]),G=i.useCallback(s=>{E(s),I("edit")},[]),z=i.useCallback(()=>{E(null),I("view")},[]),ae=i.useCallback(async s=>{se(!0);try{v==="edit"&&k?(await F.updateLog(k.ticketNumber,s),a({className:"bg-emerald-500 text-white border-none",title:"Update Successful",description:`Ticket #${k.ticketNumber} has been updated.`})):(await F.createLog(s),a({className:"bg-[#0078D4] text-white border-none",title:"Ticket Created",description:"New operational log has been recorded."})),h.invalidateQueries(["ticketLogs"]),z()}catch(x){console.error("Submit Error:",x),a({variant:"destructive",title:"Submission Failed",description:x.message||"Could not save the ticket."})}finally{se(!1)}},[v,k,h,a,z]),Q=i.useCallback(s=>{V(s)},[]),we=i.useCallback(async()=>{if(C)try{await F.deleteLog(C),a({title:"Ticket Deleted",description:`Ticket #${C} removed.`}),h.invalidateQueries(["ticketLogs"]),z()}catch(s){a({variant:"destructive",title:"Delete Failed",description:s.message})}finally{V(null)}},[C,h,a,z]),ne=i.useCallback(async(s,x)=>{if(x&&x.stopPropagation(),!d){a({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const p=typeof d=="object"&&d!==null?{name:d.name,id:d.id,role:d.role}:{name:d};await qe.createIncident({subject:s.shortDesc||s.details||"New Incident from Log",ticket:s.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(s.type)?s.type:"Incident",status:"Open",createdBy:p,impact:"",root_cause:s.details||"",action:s.action||""}),a({title:"Successfully Added",description:`Ticket #${s.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>b("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(p){console.error(p),a({variant:"destructive",title:"Error",description:"Failed to add to timeline."})}},[d,b,a]),Ce=i.useCallback(async s=>{try{const x=!s.isFlagged;await F.updateLog(s.ticketNumber,{isFlagged:x}),h.invalidateQueries(["ticketLogs"]),a({title:x?"Flagged":"Unflagged",description:`Ticket #${s.ticketNumber} ${x?"pinned to top":"unpinned"}.`})}catch{a({variant:"destructive",title:"Error",description:"Failed to update flag status."})}},[h,a]),R=i.useMemo(()=>{let s=t;if(B){const x=B.toLowerCase();s=s.filter(p=>p.ticketNumber?.toLowerCase().includes(x)||p.shortDesc?.toLowerCase().includes(x)||p.details?.toLowerCase().includes(x))}return w!=="All"&&(s=s.filter(x=>x.status===w)),f!=="All"&&(s=s.filter(x=>x.type===f)),s.sort((x,p)=>x.isFlagged&&!p.isFlagged?-1:!x.isFlagged&&p.isFlagged?1:new Date(p.createdAt||0)-new Date(x.createdAt||0))},[t,B,w,f]),De=Math.ceil(R.length/P),H=i.useMemo(()=>{const s=(j-1)*P;return R.slice(s,s+P)},[R,j]),ce=i.useCallback(()=>{c("All"),S("All"),D(""),$(1)},[]),W=k!==null||v==="create";return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx(We,{title:"Ticketing Log",icon:_e,searchTerm:u,onSearch:s=>re(D,s),actions:[{label:"New",icon:Ge,onClick:()=>{M("new"),ye()},variant:"primary",disabled:!o,hideTextOnMobile:!0},{label:"Sync",icon:Xe,onClick:()=>{M("sync"),g(!0)},variant:"secondary",disabled:!o||n,hideTextOnMobile:!0}],isFilterActive:f!=="All",onFilterClick:()=>T(!0)}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:m("flex-1 flex flex-col overflow-hidden transition-all",W?"hidden lg:flex lg:w-[55%] xl:w-[60%]":"w-full"),children:e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsxs("div",{className:"h-full w-full space-y-4",children:[!n&&e.jsx(lt,{stats:r}),n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[40vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):H.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[40vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ze,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:ce,className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs("div",{className:"bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 overflow-hidden",children:[e.jsx(ze,{logs:H,onLogClick:ie,activeLogId:k?.ticketNumber,onFlag:Ce,onDelete:Q}),e.jsx(mt,{logs:H,onLogClick:ie,onEdit:G,canEdit:o}),e.jsx(ve,{currentPage:j,totalPages:De,totalItems:R.length,itemsPerPage:P,onPageChange:$})]})]})})}),e.jsx("div",{className:m("hidden lg:block shrink-0 overflow-hidden transition-all",W?"w-[45%] xl:w-[40%]":"w-0"),children:v==="view"?e.jsx(Y,{ticket:k,mode:v,onClose:z,onEdit:G,onDelete:Q,onSendToIncident:ne,canEdit:o}):e.jsx(J,{onClose:z,onSubmit:ae,initialData:k,isSubmitting:te})})]}),W&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black/50 flex items-end",children:e.jsx("div",{className:"w-full max-h-[90vh] bg-white dark:bg-zinc-900 rounded-t-2xl overflow-hidden animate-in slide-in-from-bottom duration-300",children:v==="view"?e.jsx(Y,{ticket:k,mode:v,onClose:z,onEdit:G,onDelete:Q,onSendToIncident:ne,canEdit:o}):e.jsx(J,{onClose:z,onSubmit:ae,initialData:k,isSubmitting:te})})}),e.jsx(Re,{isOpen:!!C,onClose:()=>V(null),onConfirm:we,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${C}?`,isDanger:!0}),e.jsx(i.Suspense,{fallback:null,children:y&&e.jsx(bt,{isOpen:y,onClose:()=>{g(!1),M("inbox")},currentLogs:t,onSyncComplete:s=>{a({title:"Sync Completed",description:`Updated ${s} records.`}),h.invalidateQueries({queryKey:["ticketLogs"]}),g(!1),M("inbox")}})}),Ne&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:()=>T(!1)}),e.jsxs("div",{className:"relative w-full sm:w-[400px] bg-white dark:bg-zinc-900 rounded-t-xl sm:rounded-xl p-5 shadow-2xl animate-in slide-in-from-bottom sm:zoom-in-95 duration-300 pointer-events-auto m-0 sm:m-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white flex items-center gap-2",children:[e.jsx(Be,{size:18,className:"text-[#0078D4]"})," Filters"]}),e.jsx("button",{onClick:()=>T(!1),className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-full text-zinc-600 hover:text-zinc-900 transition-colors",children:e.jsx(q,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...l.statuses].map(s=>{const x=s.toLowerCase(),p=r[x]!==void 0?r[x]:null;return e.jsxs("button",{onClick:()=>re(c,s),className:m("px-3 py-2 rounded-lg text-xs font-bold transition-all border flex items-center gap-1.5",w===s?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:[s,p!==null&&e.jsxs("span",{className:"opacity-60 text-[10px]",children:["(",p,")"]})]},s)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Ticket Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...l.types].map(s=>e.jsx("button",{onClick:()=>S(s),className:m("px-3 py-2 rounded-lg text-xs font-bold transition-all border",f===s?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:s},s))})]})]}),e.jsxs("div",{className:"mt-8 flex gap-3",children:[e.jsx("button",{onClick:()=>{ce(),T(!1)},className:"flex-1 py-2.5 text-zinc-600 font-bold bg-zinc-100 dark:bg-zinc-800 rounded-lg hover:bg-zinc-200 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>T(!1),className:"flex-[2] py-2.5 bg-[#0078D4] text-white font-bold rounded-lg shadow-lg shadow-[#0078D4]/20 hover:bg-[#106EBE] transition-colors text-sm",children:"Apply Filters"})]})]})]})]})}export{Et as default};
