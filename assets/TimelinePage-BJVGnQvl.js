import{d as H,r as a,j as e,e as T,T as Te,X as ne,L as Ee,R as X,f as wr,A as le,C as kt,F as Ze,g as et,S as kr,h as tt,i as jt,P as re,k as O,l as xe,m as zt,n as rt,o as nt,p as Ae,q as jr,s as zr,D as yr,b as yt,U as Nr,t as Cr,a as Sr,v as mt}from"./index-DG8grUyn.js";import{i as J,u as Nt,a as Ir}from"./useTicketOptions-BbjULAU7.js";import{H as we}from"./hash-Cql5CEV4.js";import{T as se}from"./trash-2-CREMUFDH.js";import{C as st}from"./chevron-right-D-O6HriP.js";import{L as Ye}from"./layers-C96pBT6a.js";import{D as Re}from"./download-BARICu0k.js";import{S as Mr}from"./search-U53RAdtz.js";import{S as Er}from"./sliders-horizontal-CuogEloW.js";import{C as ae}from"./circle-alert-C-KG3N9y.js";import{R as Rr}from"./refresh-cw-C0mLscHk.js";import{P as be}from"./plus-B2FRZknz.js";import{C as Dr}from"./chevron-left-DfFDGi4H.js";import{C as _r,P as de,u as Ct,B as Ge}from"./index-DpJJjFfk.js";import{C as Pr}from"./chevron-down-DdT0IlJb.js";import{C as ue}from"./clock-DWjRkW9L.js";import{C as De}from"./circle-check-BEXeFYoG.js";import{S as ge}from"./shield-check-B5RZC0Yk.js";import{P as St}from"./panels-top-left-C_ZPa4mJ.js";import{S as It}from"./save-B93v77qj.js";import{C as Tr}from"./check-B3eG3M7V.js";import{C as Ar}from"./copy-B3fOTsZv.js";import{c as Lr}from"./configService-CpUaQNct.js";import{Z as Mt}from"./zap-LTmMFBcD.js";import{B as me}from"./button-ELzcrGy8.js";import{u as qe,c as Et,R as Or,A as Fr,h as $r,a as Ur,b as Gr,F as Br,C as Hr,d as Wr}from"./Combination-BHEGN5e3.js";import{A as Kr}from"./arrow-left-D75rLXu5.js";import{f as Rt}from"./format-B568ns5f.js";import{H as Vr,L as Zr}from"./layout-list-B9319rap.js";import{T as Yr}from"./tag-BWu-FnY6.js";import{A as qr}from"./useBaseQuery-ruIVqelk.js";import"./firebaseConfig-Cp-1Ewx5.js";import"./index-DenzHOQf.js";const Jr=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Xr=H("ban",Jr);const Qr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],en=H("circle-x",Qr);const tn=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],rn=H("cloud-upload",tn);const nn=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],sn=H("ellipsis",nn);const an=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],on=H("file-plus-corner",an);const cn=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],ln=H("fingerprint-pattern",cn);const dn=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],un=H("flag",dn);const xn=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],pt=H("folder-kanban",xn);const mn=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],at=H("image-off",mn);const pn=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],hn=H("image-plus",pn);const bn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],gn=H("image",bn);const fn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],ht=H("inbox",fn);const vn=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],wn=H("layout-dashboard",vn);const kn=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],jn=H("link",kn);const zn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],bt=H("maximize-2",zn);const yn=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Je=H("message-square",yn);const Nn=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],gt=H("minimize-2",Nn);const Cn=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Sn=H("move",Cn);const In=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Mn=H("workflow",In);const En=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Rn=H("wrench",En),Dn=()=>{const[t,r]=a.useState([]),[n,s]=a.useState(null),[o,c]=a.useState(!0),[d,i]=a.useState(null),[m,g]=a.useState(""),[l,u]=a.useState("All"),[f,C]=a.useState("All");a.useEffect(()=>{c(!0),i(null);const j=J.subscribeIncidents(I=>{r(I||[]),c(!1),i(null)},I=>{console.error("useIncidents error:",I),i(I.message||"Failed to connect to database"),c(!1)});return()=>{typeof j=="function"&&j()}},[]);const b=a.useMemo(()=>{const j=m.toLowerCase().trim();return t.filter(v=>{const _=(v.subject||"").toLowerCase(),U=(v.project||"").toLowerCase(),A=(v.ticket||"").toLowerCase(),L=(typeof v.createdBy=="object"?v.createdBy.name:v.createdBy||"").toLowerCase(),F=!j||_.includes(j)||U.includes(j)||A.includes(j)||L.includes(j),R=l==="All"||v.status===l,G=f==="All"||v.type===f;return F&&R&&G}).sort((v,_)=>{const U=v.createdAt?new Date(v.createdAt).getTime():0;return(_.createdAt?new Date(_.createdAt).getTime():0)-U})},[t,m,l,f]),k=a.useMemo(()=>{const j={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((I,v)=>{I.total++;const _=v.status?.replace(/\s+/g,"").replace(/^\w/,U=>U.toLowerCase());return I[_]!==void 0?I[_]++:v.status==="In Progress"&&I.inProgress++,I},j)},[t]),w=a.useCallback(()=>{g(""),u("All"),C("All")},[]);return{incidents:t,filteredIncidents:b,selectedId:n,setSelectedId:s,loading:o,error:d,searchTerm:m,setSearchTerm:g,filterStatus:l,setFilterStatus:u,filterType:f,setFilterType:C,clearFilters:w,hasActiveFilters:!!m||l!=="All"||f!=="All",stats:k}},_n=t=>{const[r,n]=a.useState([]),[s,o]=a.useState(!1);a.useEffect(()=>{if(!t){setTimeout(()=>{n([])},0);return}const d=J.subscribeEvents(t,i=>{const m=(i||[]).map(g=>({...g,_sortTime:new Date(`${g.date||"1970-01-01"}T${g.time||"00:00"}`).getTime()}));n(m),o(!1)});return()=>d&&d()},[t]);const c=a.useMemo(()=>[...r].sort((d,i)=>i._sortTime-d._sortTime),[r]);return{events:r,sortedEvents:c,loading:s}},pe=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),ft=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},Pn=(t,r)=>{const n=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s;const c=r.endsWith(".csv")?r:`${r}.csv`;o.download=c,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(s)},0)},Tn=t=>{switch(t){case"Open":return{dot:"bg-rose-500",text:"text-rose-600",bg:"bg-rose-50 dark:bg-rose-500/10",border:"border-rose-200 dark:border-rose-500/20"};case"In Progress":return{dot:"bg-indigo-500",text:"text-indigo-600",bg:"bg-indigo-50 dark:bg-indigo-500/10",border:"border-indigo-200 dark:border-indigo-500/20"};case"Monitoring":case"Pending":return{dot:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-500/10",border:"border-amber-200 dark:border-amber-500/20"};case"Succeed":case"Resolved":return{dot:"bg-emerald-500",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-500/10",border:"border-emerald-200 dark:border-emerald-500/20"};case"Closed":return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"};default:return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"}}},An=a.memo(({incident:t,isSelected:r,onClick:n,onDelete:s})=>{const o=Tn(t.status),c=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative flex flex-col gap-2 p-3 rounded-lg border transition-all duration-200 cursor-pointer mb-2",r?"bg-white dark:bg-zinc-800/80 border-indigo-500/50 shadow-md transform scale-[1.01] z-10":"bg-white dark:bg-[#09090b] border-zinc-100 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-900"),children:[r&&e.jsx("div",{className:"absolute left-0 top-3 bottom-3 w-1 bg-indigo-500 rounded-r-full"}),e.jsxs("div",{className:T("flex justify-between items-start gap-2",r?"pl-2":""),children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-wrap",children:[e.jsx("div",{className:T("w-2 h-2 rounded-full shrink-0",o.dot)}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.project||"CORE"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase",children:t.type}),e.jsx("span",{className:"text-[10px] text-zinc-300 dark:text-zinc-700",children:"•"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400 uppercase flex items-center gap-1",children:[e.jsx(we,{size:10}),t.ticket||"-"]}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase ml-auto sm:ml-0",children:c})]}),!r&&e.jsx("button",{onClick:d=>{d.stopPropagation(),s(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:e.jsx(se,{size:12})})]}),e.jsx("div",{className:T("pr-4",r?"pl-2":""),children:e.jsx("h3",{className:T("text-sm font-bold leading-snug line-clamp-2 transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.subject||"Untitled Incident"})}),e.jsxs("div",{className:T("flex justify-between items-center mt-1",r?"pl-2":""),children:[e.jsx("span",{className:T("text-[10px] font-bold uppercase px-2 py-0.5 rounded-full border",o.bg,o.text,o.border),children:t.status}),r&&e.jsx(st,{size:14,className:"text-indigo-500"})]})]})}),Ln=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},vt=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},On=a.memo(({log:t,isSelected:r,onClick:n})=>{const s=t.createdAt?new Date(t.createdAt):null,o=s?s.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative p-4 rounded-[2rem] border transition-all duration-300 cursor-pointer overflow-hidden mb-3",r?"bg-white dark:bg-[#09090b] border-zinc-900 dark:border-zinc-500 shadow-xl shadow-zinc-200/50 dark:shadow-none scale-[1.02] z-10":"bg-white dark:bg-[#0c0c0e] border-zinc-100 dark:border-zinc-800/50 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-1"),children:[r&&e.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-2 bg-zinc-900 dark:bg-white"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:T("px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border",Ln(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:o})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:T("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(Te,{size:10,className:T("shrink-0",vt(t.severity))}),e.jsx("span",{className:T("text-[9px] font-black uppercase tracking-widest",vt(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(st,{size:18,className:"text-zinc-300"})})]})});function Fn(t,r){const[n,s]=a.useState(t);return a.useEffect(()=>{const o=setTimeout(()=>s(t),r);return()=>clearTimeout(o)},[t,r]),n}const $n=({filteredIncidents:t,selectedId:r,onSelect:n,onAddIncident:s,onDeleteIncident:o,onExportCSV:c,onSync:d,stats:i,logs:m,selectedLogId:g,onSelectLog:l,logsLoading:u,viewMode:f,onViewModeChange:C,searchTerm:b,setSearchTerm:k,filterStatus:w,setFilterStatus:p,filterType:j,setFilterType:I,clearFilters:v,hasActiveFilters:_,loading:U,error:A,canEdit:L})=>{const{ticketOptions:F}=Nt(),[R,G]=a.useState(b),x=Fn(R,300),[N,D]=a.useState(!1);a.useEffect(()=>{k(x)},[x,k]),a.useEffect(()=>{G(b)},[b]);const[h,S]=a.useState(20),P=a.useRef(null),M=f==="logs",y=M?m:t,W=M?u:U;a.useEffect(()=>{S(20)},[y?.length,f,w,j,x]),a.useEffect(()=>{const z=new IntersectionObserver(Z=>{Z[0].isIntersecting&&y?.length>h&&S(Y=>Y+20)},{threshold:.1});return P.current&&z.observe(P.current),()=>z.disconnect()},[y,h]);const $=z=>{p(z===w?"All":z)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsxs("header",{className:"shrink-0 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 transition-colors ${M?"bg-indigo-600 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-black"}`,children:M?e.jsx(ht,{size:16}):e.jsx(Ye,{size:16})}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>C("incidents"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${M?"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300":"bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm"}`,children:"Cases"}),e.jsx("button",{onClick:()=>C("logs"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${M?"bg-white dark:bg-zinc-800 text-indigo-600 dark:text-indigo-400 shadow-sm":"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,children:"Logs"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center gap-1.5",children:!M&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c(t),className:"hidden sm:flex w-8 h-8 items-center justify-center rounded-lg text-zinc-400 hover:text-indigo-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",title:"Export CSV",children:e.jsx(Re,{size:16})}),L&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 h-8 px-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[10px] font-bold uppercase tracking-wide shadow hover:opacity-90 transition-all",children:[e.jsx(on,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"New"})]})]})})]}),e.jsxs("div",{className:"flex gap-2 px-3 pb-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Mr,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:R,onChange:z=>G(z.target.value),placeholder:M?"Search logs...":"Search cases...",className:"w-full h-8 pl-8 pr-7 rounded-lg bg-zinc-100 dark:bg-zinc-900 border-none text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),R&&e.jsx("button",{onClick:()=>G(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ne,{size:12})})]}),e.jsx("button",{onClick:()=>D(!0),className:`h-8 w-8 flex items-center justify-center rounded-lg transition-all ${_?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600":"bg-zinc-100 dark:bg-zinc-900 text-zinc-500"}`,children:e.jsx(Er,{size:14})})]}),!M&&i&&e.jsx("div",{className:"flex gap-1.5 px-3 pb-2 overflow-x-auto no-scrollbar",children:[{label:"Open",count:i.open,color:"bg-red-500"},{label:"Pending",count:i.pending,color:"bg-amber-500"},{label:"Resolved",count:i.resolved,color:"bg-emerald-500"}].map(z=>e.jsxs("button",{onClick:()=>$(z.label),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[9px] font-bold uppercase tracking-wide transition-all whitespace-nowrap shrink-0 ${w===z.label?"bg-zinc-900 dark:bg-white text-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${z.color}`}),z.label,e.jsxs("span",{className:"opacity-50",children:["(",z.count,")"]})]},z.label))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:A&&!M?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(ae,{className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:A})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(Rr,{size:12}),"Retry"]})]}):W&&h===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(Ee,{className:"animate-spin text-indigo-600",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):y?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[M?e.jsx(ht,{size:40,strokeWidth:1}):e.jsx(Ye,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),_&&e.jsx("button",{onClick:v,className:"mt-2 text-xs text-indigo-500 font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[y.slice(0,h).map(z=>M?e.jsx(On,{log:z,isSelected:g===(z.ticketNumber||z.id),onClick:()=>l(z)},z.ticketNumber||z.id):e.jsx(An,{incident:z,isSelected:r===z.id,onClick:()=>n(z.id),onDelete:o},z.id)),e.jsx("div",{ref:P,className:"h-4 w-full"})]})}),N&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>D(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-2xl p-5 shadow-2xl animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h3",{className:"text-base font-black text-zinc-900 dark:text-white",children:"Filters"}),e.jsx("button",{onClick:()=>D(!1),className:"p-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-full",children:e.jsx(ne,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.statuses].map(z=>e.jsx("button",{onClick:()=>p(z),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${w===z?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:z},z))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.types].map(z=>e.jsx("button",{onClick:()=>I(z),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${j===z?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:z},z))})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{onClick:()=>{v(),D(!1)},className:"flex-1 py-3 text-red-500 font-bold bg-red-50 dark:bg-red-900/20 rounded-xl hover:bg-red-100 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>D(!1),className:"flex-[2] py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors text-sm",children:"Apply"})]})]})]}),!M&&L&&e.jsx("button",{onClick:s,className:"md:hidden absolute bottom-5 right-5 z-40 w-12 h-12 bg-indigo-600 text-white rounded-2xl shadow-xl shadow-indigo-600/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(be,{size:22})})]})},Un=a.memo($n),ke=t=>{if(!t)return"";try{const r=new URL(t);if(r.hostname.includes("drive.google.com")||r.hostname.includes("docs.google.com")){let n=r.searchParams.get("id");if(!n){const s=r.pathname.split("/"),o=s.indexOf("d");o!==-1&&s[o+1]&&(n=s[o+1])}if(n)return`https://drive.google.com/thumbnail?id=${n}&sz=w1000`}return t}catch{return t}},Gn=(t,r=[320,640,960,1280,1920])=>t?t.includes("drive.google.com")||t.includes("docs.google.com")?{srcset:t,sizes:"100vw"}:{srcset:r.map(o=>`${t}?w=${o} ${o}w`).join(", "),sizes:"(max-width: 640px) 320px, (max-width: 960px) 640px, (max-width: 1280px) 960px, 1280px"}:{srcset:"",sizes:""},Bn=t=>!t||typeof t!="string"?!1:t.includes("drive.google.com")||t.includes("docs.google.com"),Hn=async t=>Bn(t)?Promise.resolve("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"):new Promise(r=>{const n=new Image;n.crossOrigin="anonymous";const s=setTimeout(()=>{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},3e3);n.onload=()=>{clearTimeout(s);const o=document.createElement("canvas");o.width=20,o.height=20,o.getContext("2d").drawImage(n,0,0,20,20);try{const d=o.toDataURL("image/jpeg",.5);r(d)}catch{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")}},n.onerror=()=>{clearTimeout(s),r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},n.src=t}),Wn=t=>new Promise((r,n)=>{const s=new Image;s.onload=()=>r(),s.onerror=()=>n(new Error("Failed to preload image")),s.src=t});function Kn({src:t,alt:r="",className:n="",onClick:s,sizes:o,loading:c="lazy",placeholder:d="blur",fallback:i,onLoad:m,onError:g,...l}){const[u,f]=a.useState(null),[C,b]=a.useState(null),[k,w]=a.useState(!1),[p,j]=a.useState(c!=="lazy"),I=X.useRef(null),v=X.useRef(null),_=X.useRef(null);a.useEffect(()=>{if(!t){setTimeout(()=>f(null),0);return}try{if(typeof t=="object"&&(t instanceof File||t instanceof Blob)){const R=URL.createObjectURL(t);return setTimeout(()=>f(R),0),()=>URL.revokeObjectURL(R)}if(typeof t=="string"){const R=ke(t);setTimeout(()=>f(R),0),d==="blur"&&R&&(R.includes("drive.google.com")||R.includes("docs.google.com")?setTimeout(()=>b("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0):Hn(R).then(x=>{setTimeout(()=>b(x),0)}).catch(()=>{setTimeout(()=>b("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0)}))}}catch(R){console.error("Error processing image source:",R),setTimeout(()=>f(null),0)}},[t,d]),a.useEffect(()=>{if(c!=="lazy"){setTimeout(()=>j(!0),0);return}const R=v.current||I.current;if(!R){const G=setTimeout(()=>j(!0),50);return()=>clearTimeout(G)}if(!p)return _.current=new IntersectionObserver(G=>{G.forEach(x=>{x.isIntersecting&&(j(!0),_.current&&_.current.disconnect())})},{rootMargin:"50px",threshold:.01}),_.current.observe(R),()=>{_.current&&_.current.disconnect()}},[c,p]);const{srcset:U,sizesAttr:A}=a.useMemo(()=>u?Gn(u):{srcset:"",sizesAttr:""},[u]),L=R=>{m&&m(R)},F=R=>{w(!0),i&&R.target.src!==i?(R.target.src=i,w(!1)):g&&g(R)};return a.useEffect(()=>{p&&u&&!k&&Wn(u).catch(()=>{})},[p,u,k]),k&&!i?e.jsxs("div",{className:T("flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",n),onClick:s,children:[e.jsx(at,{className:"text-zinc-400 mb-1",size:20}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase",children:"Failed to load"})]}):c==="lazy"&&!p?e.jsx("div",{className:T("relative overflow-hidden bg-zinc-100 dark:bg-zinc-900",n),ref:v,children:C&&e.jsx("img",{src:C,alt:"",className:"absolute inset-0 w-full h-full object-cover filter blur-xl scale-110 opacity-50","aria-hidden":"true"})}):e.jsx("img",{ref:I,src:u||i,srcSet:U||void 0,sizes:o||A||void 0,alt:r,className:T(n),loading:c,onLoad:L,onError:F,onClick:s,decoding:"async",...l})}function Vn({isOpen:t,onClose:r,imageUrl:n,allImages:s=[],initialIndex:o=0}){const[c,d]=a.useState(o),[i,m]=a.useState(1),[g,l]=a.useState({x:0,y:0}),[u,f]=a.useState(!1),[C,b]=a.useState({x:0,y:0}),k=s.length>0?s:[n],w=k[c]||n,p=X.useRef(null),[j,I]=a.useState(!1);a.useEffect(()=>{const x=()=>I(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",x),()=>document.removeEventListener("fullscreenchange",x)},[]);const v=X.useCallback(()=>{m(1),l({x:0,y:0})},[]),_=X.useCallback(x=>{x?.stopPropagation(),d(N=>(N+1)%k.length),v()},[k.length,v]),U=X.useCallback(x=>{x?.stopPropagation(),d(N=>(N-1+k.length)%k.length),v()},[k.length,v]),A=X.useCallback(x=>{x?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():p.current?.requestFullscreen().catch(N=>{console.error("Fullscreen failed:",N)})},[]);if(a.useEffect(()=>{const x=N=>{if(t)switch(N.key){case"ArrowRight":_();break;case"ArrowLeft":U();break;case"Escape":document.fullscreenElement?document.exitFullscreen():r();break;case"f":case"F":A();break;case"0":v();break}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[t,_,U,r,v,A]),a.useEffect(()=>{const x=p.current;if(!x)return;const N=D=>{if(!t)return;D.preventDefault();const S=-D.deltaY>0?1.1:.9,P=Math.min(Math.max(i*S,.5),10);m(P),P<=1&&l({x:0,y:0})};return x.addEventListener("wheel",N,{passive:!1}),()=>x.removeEventListener("wheel",N)},[t,i]),a.useEffect(()=>{let x=!0,N=null;return t?N=setTimeout(()=>{if(!x)return;const D=o||(n&&s.indexOf(n)>=0?s.indexOf(n):0);d(D),v(),document.body.style.overflow="hidden"},0):document.body.style.overflow="",()=>{x=!1,N&&clearTimeout(N),document.body.style.overflow=""}},[t,o,n,s,v]),!t)return null;const L=x=>{i<=1||(x.preventDefault(),f(!0),b({x:x.clientX-g.x,y:x.clientY-g.y}))},F=x=>{!u||i<=1||(x.preventDefault(),l({x:x.clientX-C.x,y:x.clientY-C.y}))},R=()=>{f(!1)},G=x=>{x?.stopPropagation(),i===1?m(2.5):v()};return wr.createPortal(e.jsxs("div",{ref:p,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${u?"cursor-grabbing":""}`,onClick:r,onMouseMove:F,onMouseUp:R,onMouseLeave:R,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:A,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:j?e.jsx(gt,{size:24,className:"text-white"}):e.jsx(bt,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",c+1," of ",k.length," • Click to ",j?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:G,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${i>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:i>1?"Reset Zoom":"Quick Zoom",children:i>1?e.jsx(gt,{size:22}):e.jsx(bt,{size:22})}),e.jsx("a",{href:ke(w),download:!0,target:"_blank",rel:"noreferrer",onClick:x=>x.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(Re,{size:22})}),e.jsx("button",{onClick:r,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(ne,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${g.x}px, ${g.y}px) scale(${i})`,cursor:i>1?u?"grabbing":"grab":"zoom-in"},onClick:x=>{x.stopPropagation(),i===1?m(2.5):v()},onMouseDown:L,children:[e.jsx(Kn,{src:w,alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},loading:"eager",fallback:"https://placehold.co/1200x800?text=Failed+to+load+image"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:i===1&&e.jsx(Sn,{size:64,className:"text-white/10"})})]})}),k.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(Dr,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:_,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(st,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[k.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:k.map((x,N)=>e.jsx("button",{onClick:D=>{D.stopPropagation(),d(N),v()},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${c===N?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},N))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",w.split("/").pop().substring(0,60)]})})]})]}),document.body)}const Zn=t=>{const r=t.type?.toLowerCase()||"",n=t.desc?.toLowerCase()||"",s={message:Je,alert:ae,check:De,clock:ue,update:de},o=t.iconType?s[t.iconType]:null;return r==="create"||n.includes("created")?{icon:o||be,colorClass:"text-indigo-600 bg-indigo-50 dark:bg-indigo-900/30 border-indigo-200 dark:border-indigo-800"}:r==="update"||n.includes("updated")?{icon:o||de,colorClass:"text-amber-600 bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-800"}:r==="status_change"||n.includes("resolved")||n.includes("closed")||n.includes("succeed")?{icon:o||De,colorClass:"text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-800"}:r==="alert"||n.includes("alert")||n.includes("error")||n.includes("failed")?{icon:o||ae,colorClass:"text-rose-600 bg-rose-50 dark:bg-rose-900/30 border-rose-200 dark:border-rose-800"}:{icon:o||Je,colorClass:"text-zinc-500 bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700"}},Yn=t=>{switch(t){case"rose":return"bg-rose-50 text-rose-700 border-rose-200 dark:bg-rose-900/40 dark:text-rose-300 dark:border-rose-800";case"emerald":return"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-300 dark:border-emerald-800";case"white":default:return"bg-zinc-50 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}},qn=t=>{switch(t){case"rose":return"text-rose-600 bg-rose-50 border-rose-200 dark:bg-rose-900/20 dark:border-rose-800";case"emerald":return"text-emerald-600 bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-800";case"white":return"text-zinc-500 bg-white border-zinc-200 dark:bg-zinc-800 dark:border-zinc-700";default:return null}},Jn=({src:t,index:r,onClick:n,className:s})=>{const[o,c]=a.useState(!1),[d,i]=a.useState(null);return a.useEffect(()=>{c(!1)},[t]),a.useEffect(()=>{if(!t){i(null);return}let m=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(m=URL.createObjectURL(t),i(m)):typeof t=="string"&&i(ke(t)),()=>{m&&URL.revokeObjectURL(m)}},[t]),o||!d?e.jsx("div",{className:T(s,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(at,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>n(t),className:T("relative group/img overflow-hidden cursor-zoom-in",s),children:[e.jsx("img",{src:d,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>c(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(gn,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function Xn({event:t,index:r,isLastItem:n,onEdit:s,onDelete:o,onMove:c}){const[d,i]=a.useState(null),{icon:m,colorClass:g}=Zn(t),u=qn(t.statusOnLineColor)||g,C=(t.date?new Date(t.date):new Date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),b=t.time||"00:00";let k=(t.imageUrls||[]).filter(w=>w);return!k.length&&t.image&&(k=[t.image]),e.jsxs("div",{className:"group relative flex w-full gap-4 pb-8",children:[e.jsx("div",{className:"relative shrink-0 w-4 flex flex-col items-center",children:e.jsx("div",{className:T("absolute left-1/2 -translate-x-1/2 w-[2px] bg-zinc-700 dark:bg-zinc-600 z-0",r===0?"top-4":"-top-4",n?"bottom-auto h-12":"-bottom-4")})}),e.jsx("div",{className:"flex flex-col items-end shrink-0 w-14 pt-1 relative",children:e.jsxs("div",{className:"flex flex-col items-end w-full pr-1 relative z-10 transition-transform group-hover:scale-105",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 tabular-nums leading-none tracking-tight",children:b}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase mt-1 leading-none",children:C})]})}),e.jsxs("div",{className:"relative shrink-0 flex flex-col items-center pt-1 h-full",children:[t.statusOnLine&&e.jsx("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 z-30 whitespace-nowrap pb-1",children:e.jsx("div",{className:T("text-[9px] font-black uppercase px-2.5 py-0.5 rounded-full border shadow-sm bg-white dark:bg-black",Yn(t.statusOnLineColor||"white")),children:t.statusOnLine})}),e.jsx("div",{className:T("w-8 h-8 rounded-full flex items-center justify-center border-2 shadow-sm z-20 transition-all duration-300 bg-white dark:bg-[#09090b]",u),children:e.jsx(m,{size:14,strokeWidth:2.5})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative bg-white dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 shadow-sm hover:shadow-md hover:border-zinc-300 dark:hover:border-zinc-700 transition-all duration-300 group/card",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2 pb-2 border-b border-zinc-100 dark:border-zinc-800/50 border-dashed",children:[e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-white leading-snug break-words",children:t.title||"Operational Update"}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 opacity-100 sm:opacity-0 group-hover/card:opacity-100 transition-opacity",children:[c&&e.jsxs("div",{className:"hidden sm:flex items-center bg-zinc-100 dark:bg-zinc-800/50 rounded-lg p-0.5 border border-zinc-200 dark:border-zinc-700 mr-2",children:[e.jsx("button",{onClick:w=>{w.stopPropagation(),c(r,"up")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(_r,{size:12})}),e.jsx("button",{onClick:w=>{w.stopPropagation(),c(r,"down")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Pr,{size:12})})]}),e.jsx("button",{onClick:()=>s(t),className:"p-1.5 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded-lg transition-colors",title:"Edit",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-zinc-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(se,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-normal break-words max-w-full",children:t.desc||t.details}),k.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-2 border-t border-zinc-100 dark:border-zinc-800/50 border-dashed",children:k.map((w,p)=>e.jsx(Jn,{index:p,src:w,onClick:i,className:"w-20 h-20 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm"},p))}),(t.updatedBy||t.createdBy)&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-indigo-500 flex items-center justify-center text-[7px] font-bold text-white shadow-sm",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})})]})}),e.jsx(Vn,{isOpen:!!d,onClose:()=>i(null),imageUrl:d,allImages:k})]})}const Qn=a.memo(Xn),Dt="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec",es=async t=>new Promise((r,n)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=async()=>{try{const o=s.result.split(",")[1],c=await fetch(Dt,{method:"POST",body:JSON.stringify({action:"upload",name:t.name,mimeType:t.type,base64:o})});r(await c.json())}catch(o){n(o)}}}),Se=async t=>{if(!t)return;let r=t;t.includes("id=")&&(r=new URLSearchParams(new URL(t).search).get("id"));try{return await(await fetch(Dt,{method:"POST",body:JSON.stringify({action:"delete",fileId:r})})).json()}catch(n){console.error("Drive Delete Error:",n)}},Be=a.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),He=a.memo(({error:t,className:r,...n})=>e.jsx("input",{...n,className:T("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-indigo-500/50 focus:ring-4 focus:ring-indigo-500/5",t?"border-rose-500":"",r)})),Ie=a.memo(({children:t,title:r,icon:n,badge:s})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[n&&e.jsx(n,{size:14,className:"text-zinc-400 group-hover/row:text-indigo-500 transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase tracking-[0.2em]",children:r})]}),s&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:s})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function ts({isOpen:t,onClose:r,onSubmit:n,onDelete:s,initialData:o,saving:c=!1}){const[d,i]=a.useState({date:"",time:"",desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]}),[m,g]=a.useState(""),[l,u]=a.useState(!1),[f,C]=a.useState(0),[b,k]=a.useState(""),[w,p]=a.useState(null),[j,I]=a.useState({}),[v,_]=a.useState({isOpen:!1,type:null,index:null}),[U,A]=a.useState({}),L=a.useRef(null),F=a.useRef(null);a.useEffect(()=>{const h=S=>{S.key==="Escape"&&!c&&r()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[r,c]),a.useEffect(()=>{if(t){if(o){let h=o.imageUrls||[];!h.length&&o.image&&(h=[o.image]),i({...o,imageUrls:h})}else{const h=new Date;i({date:h.toISOString().split("T")[0],time:`${String(h.getHours()).padStart(2,"0")}:${String(h.getMinutes()).padStart(2,"0")}`,desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]})}k(""),p(null),g(""),I({}),A({})}},[t,o]);const R=async h=>{h&&(h.stopPropagation(),h.preventDefault()),F.current&&F.current.abort(),u(!1),C(0),w&&(await Se(w),p(null)),k("Transmission Purged")},G=h=>{const S=h||m;S&&!d.imageUrls.includes(S)&&(i(P=>({...P,imageUrls:[...P.imageUrls,S]})),g(""))},x=async h=>{const S=h.target.files[0];if(S){u(!0),C(15),k(""),F.current=new AbortController;try{const P=await es(S);if(F.current.signal.aborted){P.fileId&&await Se(P.fileId);return}if(P.result==="success")p(P.fileId),C(100),G(P.url),setTimeout(()=>{u(!1),C(0)},500);else throw new Error(P.error||"Sync Error")}catch(P){P.name==="AbortError"?k("Canceled"):(k("Upload Failed"),console.error(P)),u(!1)}finally{F.current=null,h.target.value=""}}},N=async()=>{if(v.type==="item"){if(d.imageUrls?.length>0)for(const h of d.imageUrls)await Se(h);s&&o?.id&&(s(o.id),r())}else if(v.type==="image"){const h=d.imageUrls[v.index];await Se(h),i(S=>({...S,imageUrls:S.imageUrls.filter((P,M)=>M!==v.index)}))}_({isOpen:!1,type:null,index:null})},D=h=>{if(h.preventDefault(),!d.desc?.trim()){I({desc:!0});return}n(d)};return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-zinc-950/80 backdrop-blur-sm animate-in fade-in",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white dark:bg-[#09090b] rounded-[2.5rem] shadow-2xl border border-zinc-100 dark:border-white/5 flex flex-col max-h-[92vh] animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"shrink-0 p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:o?"Edit Operation":"New Deployment"}),e.jsx("p",{className:"text-[8px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"Cloud Sync Tier-1 Enabled"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(ne,{size:18})})]}),e.jsxs("form",{id:"event-form",onSubmit:D,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsx(Ie,{title:"Temporal Matrix",icon:ue,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Be,{label:"Deployment Date"}),e.jsx(He,{type:"date",value:d.date,onChange:h=>i({...d,date:h.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Be,{label:"Sync Time"}),e.jsx(He,{type:"time",value:d.time,onChange:h=>i({...d,time:h.target.value})})]})]})}),e.jsx(Ie,{title:"Visual Personalization",icon:ln,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-xl border border-zinc-100 dark:border-white/5",children:[e.jsx(Be,{label:"Marker Status",icon:we}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(h=>e.jsx("button",{type:"button",onClick:()=>i({...d,statusOnLineColor:h}),className:T("w-5 h-5 rounded-full border-2 transition-all",h==="white"?"bg-white border-zinc-200":h==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",d.statusOnLineColor===h?"ring-4 ring-indigo-500/20 scale-110 shadow-lg border-indigo-500":"opacity-30 border-transparent")},h))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl",children:[{id:"message",icon:Je},{id:"alert",icon:ae},{id:"check",icon:De},{id:"clock",icon:ue},{id:"update",icon:de},{id:"activity",icon:le}].map(h=>e.jsx("button",{type:"button",onClick:()=>i({...d,iconType:h.id}),className:T("h-9 flex items-center justify-center rounded-lg transition-all",d.iconType===h.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(h.icon,{size:14,strokeWidth:2.5})},h.id))})]})}),e.jsx(Ie,{title:"Operational Narrative",icon:St,children:e.jsx("textarea",{className:T("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",j.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:d.desc,onChange:h=>i({...d,desc:h.target.value})})}),e.jsx(Ie,{title:"Intelligence Evidence",icon:hn,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(He,{placeholder:"Asset URL...",value:m,onChange:h=>g(h.target.value)}),e.jsx(jn,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>G(),disabled:!m,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(be,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>L.current.click(),disabled:l,className:"h-10 w-10 flex items-center justify-center bg-indigo-600 text-white rounded-xl transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:L,className:"hidden",accept:"image/*",onChange:x}),l?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(rn,{size:16})]})]}),(l||b)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-2xl p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:12,className:"animate-spin text-indigo-500"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-indigo-500 tabular-nums",children:[Math.round(f),"%"]}),e.jsx("button",{type:"button",onClick:R,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(Xr,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${f}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(ae,{size:12}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:b})]})}),d.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:d.imageUrls.map((h,S)=>e.jsxs("div",{className:"group relative aspect-square rounded-xl overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[U[S]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(at,{size:16})}):e.jsx("img",{src:ke(h),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>A(P=>({...P,[S]:!0}))}),e.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),_({isOpen:!0,type:"image",index:S})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(se,{size:16})})]},S))})]})})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center gap-3",children:[o&&e.jsx("button",{type:"button",onClick:()=>_({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-2xl bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(se,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:c||l,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[c?e.jsx(Ee,{size:18,className:"animate-spin"}):e.jsx(It,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em]",children:"Commit Record"})]})]})]}),e.jsx(kt,{isOpen:v.isOpen,onClose:()=>_({isOpen:!1,type:null,index:null}),title:v.type==="item"?"Purge Record?":"Remove Asset?",message:v.type==="item"?"This operational record will be permanently purged from the timeline. This action cannot be undone.":"This image asset will be removed from this record and purged from cloud storage.",onConfirm:N,isDanger:!0})]}):null}function rs({isOpen:t,onClose:r,text:n,incident:s}){const[o,c]=X.useState(!1),[d,i]=X.useState("preview"),m=a.useMemo(()=>{if(s)return{meta:{Project:s.project||"-",Subject:s.subject||"-",Status:s.status||"-",Ticket:s.ticket||"-"},details:{Impact:s.impact||"-","Root Cause":s.root_cause||"-","Action Taken":s.action||"-"},timeline:(s.events||[]).map(b=>({date:b.date?new Date(b.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:b.time,desc:b.desc||b.title,originalDate:b.date,imageUrls:b.imageUrls||(b.image?[b.image]:[])}))};if(!n)return null;const l={meta:{},details:{},timeline:[]},u=n.split(`
`);let f=!1,C="";return u.forEach(b=>{const k=b.trim();if(!k)return;const w=b.indexOf(":");if(!f&&w!==-1&&w<20){const p=b.substring(0,w).trim(),j=b.substring(w+1).trim();["Project","Subject","Status","Ticket"].includes(p)?l.meta[p]=j:(["Impact","Root Cause","Action Taken"].includes(p),l.details[p]=j)}else if(f=!0,k.length<20&&/\d/.test(k)&&!k.includes("-"))C=k;else{const j=k.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);j?l.timeline.push({date:C,time:j[1],desc:j[2]||""}):l.timeline.push({date:C,time:null,desc:k})}}),l},[n,s]),g=async()=>{try{await navigator.clipboard.writeText(n),c(!0),setTimeout(()=>{c(!1),r()},1e3)}catch(l){console.error("Failed to copy:",l);const u=document.createElement("textarea");u.value=n,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),c(!0),setTimeout(()=>{c(!1),r()},1e3)}};return X.useEffect(()=>{const l=u=>{u.key==="Escape"&&t&&r()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[t,r]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 dark:bg-black/80 backdrop-blur-sm z-[100] flex items-center justify-center p-4 transition-all",onClick:r,children:e.jsxs("div",{className:"bg-white dark:bg-[#09090b] w-full max-w-3xl h-[85vh] rounded-3xl border border-zinc-200 dark:border-zinc-800 shadow-2xl flex flex-col overflow-hidden animate-in zoom-in-95 relative",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(Ze,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>i("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>i("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${d==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(ne,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",children:d==="raw"?e.jsx("textarea",{readOnly:!0,value:n,className:"w-full h-full p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m?.meta&&Object.entries(m.meta).map(([l,u])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:l}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:u})]},l))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(le,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m?.details&&Object.entries(m.details).map(([l,u])=>{let f=le;return l.includes("Impact")&&(f=Te),l.includes("Root")&&(f=Mn),l.includes("Action")&&(f=Rn),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:l})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:u==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):u})]},l)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(ue,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),m?.timeline.map((l,u)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(u===0||l.date!==m.timeline[u-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(et,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:l.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[l.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:l.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:l.desc}),l.imageUrls&&l.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:l.imageUrls.map((f,C)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ke(f),alt:`Evidence ${C+1}`,className:"w-full h-full object-cover",onError:b=>{b.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},C))})]})]},u)),m?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}),e.jsx("div",{className:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",children:e.jsx("button",{onClick:g,disabled:o,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${o?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Tr,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ar,{size:16})," Copy to Clipboard"]})})})]})}):null}function ns(){const[t,r]=a.useState([]),[n,s]=a.useState(!0);return a.useEffect(()=>{const o=Lr.subscribeProjects(c=>{r(c),s(!1)});return()=>o()},[]),{projects:t,loading:n}}function ss({isOpen:t,onClose:r,incident:n,onUpdate:s,onDelete:o}){const{ticketOptions:c}=Nt(),{projects:d}=ns(),[i,m]=a.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});a.useEffect(()=>{n&&setTimeout(()=>{m({subject:n.subject||"",project:n.project||"",type:n.type||"Incident",ticket:n.ticket||"",status:n.status||"Open",priority:n.priority||"Medium",impact:n.impact||"",root_cause:n.root_cause||"",action:n.action||""})},0)},[n,t]);const g=i.subject?.includes("|")&&i.subject?.includes("-"),l=p=>{let j={subject:p};if(p.includes("|")&&p.includes("-")){const I=p.split("|").map(v=>v.trim());if(I.length>=2){const v=I[0].split("-").map(_=>_.trim());if(v.length>=2){j.ticket=v[0],j.project=v[1];const _=c?.types||["Incident","Request","Maintenance"];j.type=_.find(U=>U.toLowerCase()===I[1].toLowerCase())||I[1],I.length>=3&&(j.subject=I.slice(2).join(" | "))}}}m(I=>({...I,...j}))};if(!t)return null;const u=p=>{p.preventDefault(),s(i),r()},f=p=>{const j={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:ae},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:ue},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:De},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:en}};return j[p]||j.Open},C=p=>{const j={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-indigo-500",bg:"bg-indigo-500/10"}};return j[p]||j.Medium},b="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",k="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 outline-none transition-all",w="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-xs font-black uppercase tracking-widest focus:ring-4 focus:ring-blue-500/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-[#08080a] w-full max-w-2xl rounded-[2rem] shadow-2xl border border-zinc-200 dark:border-white/5 overflow-hidden flex flex-col animate-in zoom-in-95 duration-300 max-h-[92vh]",children:[e.jsxs("div",{className:"shrink-0 px-6 py-5 flex items-center justify-between bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(ne,{size:18})})]}),e.jsxs("form",{onSubmit:u,className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-2xl bg-indigo-500/5 border border-indigo-500/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:T(b,"text-indigo-600 dark:text-indigo-400"),children:[e.jsx(St,{size:10})," Protocol Signature (Subject)"]}),g&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Mt,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-xl p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:i.subject,onChange:p=>l(p.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(le,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(w,f(i.status).color),value:i.status,onChange:p=>m({...i,status:p.target.value}),children:(c.statuses||["Open","Pending","Succeed","Closed"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(ue,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(un,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(w,C(i.priority).color),value:i.priority,onChange:p=>m({...i,priority:p.target.value}),children:(c.severities||["Critical","High","Medium","Low"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(Te,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(we,{size:10,className:"text-blue-500"})," Ticket Identity"]}),e.jsx("input",{type:"text",className:k,value:i.ticket,onChange:p=>m({...i,ticket:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(pt,{size:10,className:"text-indigo-500"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:w,value:i.project,onChange:p=>m({...i,project:p.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(d&&d.length>0?d:["MONOMAX","MONO29","3BB GIGATV"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))]}),e.jsx(pt,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(ae,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[80px] resize-none transition-all",value:i.impact,onChange:p=>m({...i,impact:p.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(kr,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.root_cause,onChange:p=>m({...i,root_cause:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(ge,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.action,onChange:p=>m({...i,action:p.target.value}),placeholder:""})]})]})]}),e.jsxs("div",{className:"shrink-0 p-6 pt-2 flex items-center justify-between border-t border-zinc-100 dark:border-white/5",children:[e.jsxs("button",{type:"button",onClick:o,className:"h-11 px-5 rounded-xl bg-rose-500/10 text-rose-500 font-black uppercase text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(se,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"h-11 px-6 rounded-xl text-[9px] font-black uppercase tracking-widest text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl text-[9px] font-black uppercase tracking-widest shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(It,{size:14})," Commit Changes"]})]})]})]})]})})}var We="rovingFocusGroup.onEntryFocus",as={bubbles:!1,cancelable:!0},je="RovingFocusGroup",[Xe,_t,os]=jt(je),[is,Pt]=tt(je,[os]),[cs,ls]=is(je),Tt=a.forwardRef((t,r)=>e.jsx(Xe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Xe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ds,{...t,ref:r})})}));Tt.displayName=je;var ds=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:o=!1,dir:c,currentTabStopId:d,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:m,onEntryFocus:g,preventScrollOnEntryFocus:l=!1,...u}=t,f=a.useRef(null),C=xe(r,f),b=Ct(c),[k,w]=zt({prop:d,defaultProp:i??null,onChange:m,caller:je}),[p,j]=a.useState(!1),I=rt(g),v=_t(n),_=a.useRef(!1),[U,A]=a.useState(0);return a.useEffect(()=>{const L=f.current;if(L)return L.addEventListener(We,I),()=>L.removeEventListener(We,I)},[I]),e.jsx(cs,{scope:n,orientation:s,dir:b,loop:o,currentTabStopId:k,onItemFocus:a.useCallback(L=>w(L),[w]),onItemShiftTab:a.useCallback(()=>j(!0),[]),onFocusableItemAdd:a.useCallback(()=>A(L=>L+1),[]),onFocusableItemRemove:a.useCallback(()=>A(L=>L-1),[]),children:e.jsx(re.div,{tabIndex:p||U===0?-1:0,"data-orientation":s,...u,ref:C,style:{outline:"none",...t.style},onMouseDown:O(t.onMouseDown,()=>{_.current=!0}),onFocus:O(t.onFocus,L=>{const F=!_.current;if(L.target===L.currentTarget&&F&&!p){const R=new CustomEvent(We,as);if(L.currentTarget.dispatchEvent(R),!R.defaultPrevented){const G=v().filter(S=>S.focusable),x=G.find(S=>S.active),N=G.find(S=>S.id===k),h=[x,N,...G].filter(Boolean).map(S=>S.ref.current);Ot(h,l)}}_.current=!1}),onBlur:O(t.onBlur,()=>j(!1))})})}),At="RovingFocusGroupItem",Lt=a.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:o=!1,tabStopId:c,children:d,...i}=t,m=qe(),g=c||m,l=ls(At,n),u=l.currentTabStopId===g,f=_t(n),{onFocusableItemAdd:C,onFocusableItemRemove:b,currentTabStopId:k}=l;return a.useEffect(()=>{if(s)return C(),()=>b()},[s,C,b]),e.jsx(Xe.ItemSlot,{scope:n,id:g,focusable:s,active:o,children:e.jsx(re.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...i,ref:r,onMouseDown:O(t.onMouseDown,w=>{s?l.onItemFocus(g):w.preventDefault()}),onFocus:O(t.onFocus,()=>l.onItemFocus(g)),onKeyDown:O(t.onKeyDown,w=>{if(w.key==="Tab"&&w.shiftKey){l.onItemShiftTab();return}if(w.target!==w.currentTarget)return;const p=ms(w,l.orientation,l.dir);if(p!==void 0){if(w.metaKey||w.ctrlKey||w.altKey||w.shiftKey)return;w.preventDefault();let I=f().filter(v=>v.focusable).map(v=>v.ref.current);if(p==="last")I.reverse();else if(p==="prev"||p==="next"){p==="prev"&&I.reverse();const v=I.indexOf(w.currentTarget);I=l.loop?ps(I,v+1):I.slice(v+1)}setTimeout(()=>Ot(I))}}),children:typeof d=="function"?d({isCurrentTabStop:u,hasTabStop:k!=null}):d})})});Lt.displayName=At;var us={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function xs(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ms(t,r,n){const s=xs(t.key,n);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return us[s]}function Ot(t,r=!1){const n=document.activeElement;for(const s of t)if(s===n||(s.focus({preventScroll:r}),document.activeElement!==n))return}function ps(t,r){return t.map((n,s)=>t[(r+s)%t.length])}var hs=Tt,bs=Lt;function gs(t){const r=fs(t),n=a.forwardRef((s,o)=>{const{children:c,...d}=s,i=a.Children.toArray(c),m=i.find(ws);if(m){const g=m.props.children,l=i.map(u=>u===m?a.Children.count(g)>1?a.Children.only(null):a.isValidElement(g)?g.props.children:null:u);return e.jsx(r,{...d,ref:o,children:a.isValidElement(g)?a.cloneElement(g,void 0,l):null})}return e.jsx(r,{...d,ref:o,children:c})});return n.displayName=`${t}.Slot`,n}function fs(t){const r=a.forwardRef((n,s)=>{const{children:o,...c}=n;if(a.isValidElement(o)){const d=js(o),i=ks(c,o.props);return o.type!==a.Fragment&&(i.ref=s?nt(s,d):d),a.cloneElement(o,i)}return a.Children.count(o)>1?a.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var vs=Symbol("radix.slottable");function ws(t){return a.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===vs}function ks(t,r){const n={...r};for(const s in r){const o=t[s],c=r[s];/^on[A-Z]/.test(s)?o&&c?n[s]=(...i)=>{const m=c(...i);return o(...i),m}:o&&(n[s]=o):s==="style"?n[s]={...o,...c}:s==="className"&&(n[s]=[o,c].filter(Boolean).join(" "))}return{...t,...n}}function js(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Qe=["Enter"," "],zs=["ArrowDown","PageUp","Home"],Ft=["ArrowUp","PageDown","End"],ys=[...zs,...Ft],Ns={ltr:[...Qe,"ArrowRight"],rtl:[...Qe,"ArrowLeft"]},Cs={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ze="Menu",[fe,Ss,Is]=jt(ze),[oe,$t]=tt(ze,[Is,Et,Pt]),Le=Et(),Ut=Pt(),[Ms,ie]=oe(ze),[Es,ye]=oe(ze),Gt=t=>{const{__scopeMenu:r,open:n=!1,children:s,dir:o,onOpenChange:c,modal:d=!0}=t,i=Le(r),[m,g]=a.useState(null),l=a.useRef(!1),u=rt(c),f=Ct(o);return a.useEffect(()=>{const C=()=>{l.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>l.current=!1;return document.addEventListener("keydown",C,{capture:!0}),()=>{document.removeEventListener("keydown",C,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),e.jsx(Or,{...i,children:e.jsx(Ms,{scope:r,open:n,onOpenChange:u,content:m,onContentChange:g,children:e.jsx(Es,{scope:r,onClose:a.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:l,dir:f,modal:d,children:s})})})};Gt.displayName=ze;var Rs="MenuAnchor",ot=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,o=Le(n);return e.jsx(Fr,{...o,...s,ref:r})});ot.displayName=Rs;var it="MenuPortal",[Ds,Bt]=oe(it,{forceMount:void 0}),Ht=t=>{const{__scopeMenu:r,forceMount:n,children:s,container:o}=t,c=ie(it,r);return e.jsx(Ds,{scope:r,forceMount:n,children:e.jsx(Ae,{present:n||c.open,children:e.jsx(jr,{asChild:!0,container:o,children:s})})})};Ht.displayName=it;var q="MenuContent",[_s,ct]=oe(q),Wt=a.forwardRef((t,r)=>{const n=Bt(q,t.__scopeMenu),{forceMount:s=n.forceMount,...o}=t,c=ie(q,t.__scopeMenu),d=ye(q,t.__scopeMenu);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Ae,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:d.modal?e.jsx(Ps,{...o,ref:r}):e.jsx(Ts,{...o,ref:r})})})})}),Ps=a.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu),s=a.useRef(null),o=xe(r,s);return a.useEffect(()=>{const c=s.current;if(c)return $r(c)},[]),e.jsx(lt,{...t,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:O(t.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Ts=a.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu);return e.jsx(lt,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),As=gs("MenuContent.ScrollLock"),lt=a.forwardRef((t,r)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:d,disableOutsidePointerEvents:i,onEntryFocus:m,onEscapeKeyDown:g,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:f,onDismiss:C,disableOutsideScroll:b,...k}=t,w=ie(q,n),p=ye(q,n),j=Le(n),I=Ut(n),v=Ss(n),[_,U]=a.useState(null),A=a.useRef(null),L=xe(r,A,w.onContentChange),F=a.useRef(0),R=a.useRef(""),G=a.useRef(0),x=a.useRef(null),N=a.useRef("right"),D=a.useRef(0),h=b?Gr:a.Fragment,S=b?{as:As,allowPinchZoom:!0}:void 0,P=y=>{const W=R.current+y,$=v().filter(K=>!K.disabled),z=document.activeElement,Z=$.find(K=>K.ref.current===z)?.textValue,Y=$.map(K=>K.textValue),ce=Zs(Y,W,Z),Q=$.find(K=>K.textValue===ce)?.ref.current;(function K(E){R.current=E,window.clearTimeout(F.current),E!==""&&(F.current=window.setTimeout(()=>K(""),1e3))})(W),Q&&setTimeout(()=>Q.focus())};a.useEffect(()=>()=>window.clearTimeout(F.current),[]),Ur();const M=a.useCallback(y=>N.current===x.current?.side&&qs(y,x.current?.area),[]);return e.jsx(_s,{scope:n,searchRef:R,onItemEnter:a.useCallback(y=>{M(y)&&y.preventDefault()},[M]),onItemLeave:a.useCallback(y=>{M(y)||(A.current?.focus(),U(null))},[M]),onTriggerLeave:a.useCallback(y=>{M(y)&&y.preventDefault()},[M]),pointerGraceTimerRef:G,onPointerGraceIntentChange:a.useCallback(y=>{x.current=y},[]),children:e.jsx(h,{...S,children:e.jsx(Br,{asChild:!0,trapped:o,onMountAutoFocus:O(c,y=>{y.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:e.jsx(yr,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:g,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:f,onDismiss:C,children:e.jsx(hs,{asChild:!0,...I,dir:p.dir,orientation:"vertical",loop:s,currentTabStopId:_,onCurrentTabStopIdChange:U,onEntryFocus:O(m,y=>{p.isUsingKeyboardRef.current||y.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Hr,{role:"menu","aria-orientation":"vertical","data-state":ir(w.open),"data-radix-menu-content":"",dir:p.dir,...j,...k,ref:L,style:{outline:"none",...k.style},onKeyDown:O(k.onKeyDown,y=>{const $=y.target.closest("[data-radix-menu-content]")===y.currentTarget,z=y.ctrlKey||y.altKey||y.metaKey,Z=y.key.length===1;$&&(y.key==="Tab"&&y.preventDefault(),!z&&Z&&P(y.key));const Y=A.current;if(y.target!==Y||!ys.includes(y.key))return;y.preventDefault();const Q=v().filter(K=>!K.disabled).map(K=>K.ref.current);Ft.includes(y.key)&&Q.reverse(),Ks(Q)}),onBlur:O(t.onBlur,y=>{y.currentTarget.contains(y.target)||(window.clearTimeout(F.current),R.current="")}),onPointerMove:O(t.onPointerMove,ve(y=>{const W=y.target,$=D.current!==y.clientX;if(y.currentTarget.contains(W)&&$){const z=y.clientX>D.current?"right":"left";N.current=z,D.current=y.clientX}}))})})})})})})});Wt.displayName=q;var Ls="MenuGroup",dt=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"group",...s,ref:r})});dt.displayName=Ls;var Os="MenuLabel",Kt=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{...s,ref:r})});Kt.displayName=Os;var _e="MenuItem",wt="menu.itemSelect",Oe=a.forwardRef((t,r)=>{const{disabled:n=!1,onSelect:s,...o}=t,c=a.useRef(null),d=ye(_e,t.__scopeMenu),i=ct(_e,t.__scopeMenu),m=xe(r,c),g=a.useRef(!1),l=()=>{const u=c.current;if(!n&&u){const f=new CustomEvent(wt,{bubbles:!0,cancelable:!0});u.addEventListener(wt,C=>s?.(C),{once:!0}),zr(u,f),f.defaultPrevented?g.current=!1:d.onClose()}};return e.jsx(Vt,{...o,ref:m,disabled:n,onClick:O(t.onClick,l),onPointerDown:u=>{t.onPointerDown?.(u),g.current=!0},onPointerUp:O(t.onPointerUp,u=>{g.current||u.currentTarget?.click()}),onKeyDown:O(t.onKeyDown,u=>{const f=i.searchRef.current!=="";n||f&&u.key===" "||Qe.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Oe.displayName=_e;var Vt=a.forwardRef((t,r)=>{const{__scopeMenu:n,disabled:s=!1,textValue:o,...c}=t,d=ct(_e,n),i=Ut(n),m=a.useRef(null),g=xe(r,m),[l,u]=a.useState(!1),[f,C]=a.useState("");return a.useEffect(()=>{const b=m.current;b&&C((b.textContent??"").trim())},[c.children]),e.jsx(fe.ItemSlot,{scope:n,disabled:s,textValue:o??f,children:e.jsx(bs,{asChild:!0,...i,focusable:!s,children:e.jsx(re.div,{role:"menuitem","data-highlighted":l?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...c,ref:g,onPointerMove:O(t.onPointerMove,ve(b=>{s?d.onItemLeave(b):(d.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:O(t.onPointerLeave,ve(b=>d.onItemLeave(b))),onFocus:O(t.onFocus,()=>u(!0)),onBlur:O(t.onBlur,()=>u(!1))})})})}),Fs="MenuCheckboxItem",Zt=a.forwardRef((t,r)=>{const{checked:n=!1,onCheckedChange:s,...o}=t;return e.jsx(Qt,{scope:t.__scopeMenu,checked:n,children:e.jsx(Oe,{role:"menuitemcheckbox","aria-checked":Pe(n)?"mixed":n,...o,ref:r,"data-state":xt(n),onSelect:O(o.onSelect,()=>s?.(Pe(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Zt.displayName=Fs;var Yt="MenuRadioGroup",[$s,Us]=oe(Yt,{value:void 0,onValueChange:()=>{}}),qt=a.forwardRef((t,r)=>{const{value:n,onValueChange:s,...o}=t,c=rt(s);return e.jsx($s,{scope:t.__scopeMenu,value:n,onValueChange:c,children:e.jsx(dt,{...o,ref:r})})});qt.displayName=Yt;var Jt="MenuRadioItem",Xt=a.forwardRef((t,r)=>{const{value:n,...s}=t,o=Us(Jt,t.__scopeMenu),c=n===o.value;return e.jsx(Qt,{scope:t.__scopeMenu,checked:c,children:e.jsx(Oe,{role:"menuitemradio","aria-checked":c,...s,ref:r,"data-state":xt(c),onSelect:O(s.onSelect,()=>o.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Xt.displayName=Jt;var ut="MenuItemIndicator",[Qt,Gs]=oe(ut,{checked:!1}),er=a.forwardRef((t,r)=>{const{__scopeMenu:n,forceMount:s,...o}=t,c=Gs(ut,n);return e.jsx(Ae,{present:s||Pe(c.checked)||c.checked===!0,children:e.jsx(re.span,{...o,ref:r,"data-state":xt(c.checked)})})});er.displayName=ut;var Bs="MenuSeparator",tr=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"separator","aria-orientation":"horizontal",...s,ref:r})});tr.displayName=Bs;var Hs="MenuArrow",rr=a.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,o=Le(n);return e.jsx(Wr,{...o,...s,ref:r})});rr.displayName=Hs;var Ws="MenuSub",[Po,nr]=oe(Ws),he="MenuSubTrigger",sr=a.forwardRef((t,r)=>{const n=ie(he,t.__scopeMenu),s=ye(he,t.__scopeMenu),o=nr(he,t.__scopeMenu),c=ct(he,t.__scopeMenu),d=a.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:m}=c,g={__scopeMenu:t.__scopeMenu},l=a.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return a.useEffect(()=>l,[l]),a.useEffect(()=>{const u=i.current;return()=>{window.clearTimeout(u),m(null)}},[i,m]),e.jsx(ot,{asChild:!0,...g,children:e.jsx(Vt,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":ir(n.open),...t,ref:nt(r,o.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:O(t.onPointerMove,ve(u=>{c.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!d.current&&(c.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{n.onOpenChange(!0),l()},100))})),onPointerLeave:O(t.onPointerLeave,ve(u=>{l();const f=n.content?.getBoundingClientRect();if(f){const C=n.content?.dataset.side,b=C==="right",k=b?-5:5,w=f[b?"left":"right"],p=f[b?"right":"left"];c.onPointerGraceIntentChange({area:[{x:u.clientX+k,y:u.clientY},{x:w,y:f.top},{x:p,y:f.top},{x:p,y:f.bottom},{x:w,y:f.bottom}],side:C}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(u),u.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:O(t.onKeyDown,u=>{const f=c.searchRef.current!=="";t.disabled||f&&u.key===" "||Ns[s.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});sr.displayName=he;var ar="MenuSubContent",or=a.forwardRef((t,r)=>{const n=Bt(q,t.__scopeMenu),{forceMount:s=n.forceMount,...o}=t,c=ie(q,t.__scopeMenu),d=ye(q,t.__scopeMenu),i=nr(ar,t.__scopeMenu),m=a.useRef(null),g=xe(r,m);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Ae,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:e.jsx(lt,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:g,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:l=>{d.isUsingKeyboardRef.current&&m.current?.focus(),l.preventDefault()},onCloseAutoFocus:l=>l.preventDefault(),onFocusOutside:O(t.onFocusOutside,l=>{l.target!==i.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:O(t.onEscapeKeyDown,l=>{d.onClose(),l.preventDefault()}),onKeyDown:O(t.onKeyDown,l=>{const u=l.currentTarget.contains(l.target),f=Cs[d.dir].includes(l.key);u&&f&&(c.onOpenChange(!1),i.trigger?.focus(),l.preventDefault())})})})})})});or.displayName=ar;function ir(t){return t?"open":"closed"}function Pe(t){return t==="indeterminate"}function xt(t){return Pe(t)?"indeterminate":t?"checked":"unchecked"}function Ks(t){const r=document.activeElement;for(const n of t)if(n===r||(n.focus(),document.activeElement!==r))return}function Vs(t,r){return t.map((n,s)=>t[(r+s)%t.length])}function Zs(t,r,n){const o=r.length>1&&Array.from(r).every(g=>g===r[0])?r[0]:r,c=n?t.indexOf(n):-1;let d=Vs(t,Math.max(c,0));o.length===1&&(d=d.filter(g=>g!==n));const m=d.find(g=>g.toLowerCase().startsWith(o.toLowerCase()));return m!==n?m:void 0}function Ys(t,r){const{x:n,y:s}=t;let o=!1;for(let c=0,d=r.length-1;c<r.length;d=c++){const i=r[c],m=r[d],g=i.x,l=i.y,u=m.x,f=m.y;l>s!=f>s&&n<(u-g)*(s-l)/(f-l)+g&&(o=!o)}return o}function qs(t,r){if(!r)return!1;const n={x:t.clientX,y:t.clientY};return Ys(n,r)}function ve(t){return r=>r.pointerType==="mouse"?t(r):void 0}var Js=Gt,Xs=ot,Qs=Ht,ea=Wt,ta=dt,ra=Kt,na=Oe,sa=Zt,aa=qt,oa=Xt,ia=er,ca=tr,la=rr,da=sr,ua=or,Fe="DropdownMenu",[xa]=tt(Fe,[$t]),V=$t(),[ma,cr]=xa(Fe),lr=t=>{const{__scopeDropdownMenu:r,children:n,dir:s,open:o,defaultOpen:c,onOpenChange:d,modal:i=!0}=t,m=V(r),g=a.useRef(null),[l,u]=zt({prop:o,defaultProp:c??!1,onChange:d,caller:Fe});return e.jsx(ma,{scope:r,triggerId:qe(),triggerRef:g,contentId:qe(),open:l,onOpenChange:u,onOpenToggle:a.useCallback(()=>u(f=>!f),[u]),modal:i,children:e.jsx(Js,{...m,open:l,onOpenChange:u,dir:s,modal:i,children:n})})};lr.displayName=Fe;var dr="DropdownMenuTrigger",ur=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...o}=t,c=cr(dr,n),d=V(n);return e.jsx(Xs,{asChild:!0,...d,children:e.jsx(re.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:nt(r,c.triggerRef),onPointerDown:O(t.onPointerDown,i=>{!s&&i.button===0&&i.ctrlKey===!1&&(c.onOpenToggle(),c.open||i.preventDefault())}),onKeyDown:O(t.onKeyDown,i=>{s||(["Enter"," "].includes(i.key)&&c.onOpenToggle(),i.key==="ArrowDown"&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});ur.displayName=dr;var pa="DropdownMenuPortal",xr=t=>{const{__scopeDropdownMenu:r,...n}=t,s=V(r);return e.jsx(Qs,{...s,...n})};xr.displayName=pa;var mr="DropdownMenuContent",pr=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=cr(mr,n),c=V(n),d=a.useRef(!1);return e.jsx(ea,{id:o.contentId,"aria-labelledby":o.triggerId,...c,...s,ref:r,onCloseAutoFocus:O(t.onCloseAutoFocus,i=>{d.current||o.triggerRef.current?.focus(),d.current=!1,i.preventDefault()}),onInteractOutside:O(t.onInteractOutside,i=>{const m=i.detail.originalEvent,g=m.button===0&&m.ctrlKey===!0,l=m.button===2||g;(!o.modal||l)&&(d.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});pr.displayName=mr;var ha="DropdownMenuGroup",ba=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ta,{...o,...s,ref:r})});ba.displayName=ha;var ga="DropdownMenuLabel",fa=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ra,{...o,...s,ref:r})});fa.displayName=ga;var va="DropdownMenuItem",hr=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(na,{...o,...s,ref:r})});hr.displayName=va;var wa="DropdownMenuCheckboxItem",ka=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(sa,{...o,...s,ref:r})});ka.displayName=wa;var ja="DropdownMenuRadioGroup",za=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(aa,{...o,...s,ref:r})});za.displayName=ja;var ya="DropdownMenuRadioItem",Na=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(oa,{...o,...s,ref:r})});Na.displayName=ya;var Ca="DropdownMenuItemIndicator",Sa=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ia,{...o,...s,ref:r})});Sa.displayName=Ca;var Ia="DropdownMenuSeparator",br=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ca,{...o,...s,ref:r})});br.displayName=Ia;var Ma="DropdownMenuArrow",Ea=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(la,{...o,...s,ref:r})});Ea.displayName=Ma;var Ra="DropdownMenuSubTrigger",Da=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(da,{...o,...s,ref:r})});Da.displayName=Ra;var _a="DropdownMenuSubContent",Pa=a.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,o=V(n);return e.jsx(ua,{...o,...s,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Pa.displayName=_a;var Ta=lr,Aa=ur,La=xr,Oa=pr,Fa=hr,$a=br;function Ua({...t}){return e.jsx(Ta,{"data-slot":"dropdown-menu",...t})}function Ga({...t}){return e.jsx(Aa,{"data-slot":"dropdown-menu-trigger",...t})}function Ba({className:t,sideOffset:r=4,...n}){return e.jsx(La,{children:e.jsx(Oa,{"data-slot":"dropdown-menu-content",sideOffset:r,className:T("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...n})})}function Me({className:t,inset:r,variant:n="default",...s}){return e.jsx(Fa,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":n,className:T("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function Ha({className:t,...r}){return e.jsx($a,{"data-slot":"dropdown-menu-separator",className:T("bg-border -mx-1 my-1 h-px",t),...r})}function Wa({incident:t,onBack:r,onExport:n,onGenerateReport:s,onEdit:o,onDelete:c,canEdit:d}){if(!t)return null;const i=m=>{switch(m?.toLowerCase()){case"resolved":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"succeed":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"closed":return"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700";case"open":return"bg-blue-500/15 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"pending":return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800";default:return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800"}};return e.jsx("div",{className:"px-3 md:px-5 py-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:r,className:"mt-0.5 p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all active:scale-95 lg:hidden shrink-0",children:e.jsx(Kr,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(we,{size:10}),t.ticket||"NO-TICKET"]}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-600",children:"•"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(et,{size:10}),t.createdAt?Rt(new Date(t.createdAt),"dd MMM yy"):"-"]})]}),e.jsx("h1",{className:"text-base md:text-lg font-black text-zinc-900 dark:text-zinc-100 leading-tight truncate",children:t.subject}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 flex-wrap",children:[e.jsx(Ge,{variant:"outline",className:T("rounded-md border text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5",i(t.status)),children:t.status}),e.jsx(Ge,{variant:"outline",className:"rounded-md border-zinc-200 dark:border-zinc-700 text-[9px] font-bold text-zinc-500 bg-zinc-50 dark:bg-zinc-900 px-1.5 py-0.5",children:t.type}),t.project&&e.jsx(Ge,{variant:"secondary",className:"rounded-md text-[9px] font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5",children:t.project})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[e.jsx(me,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Export CSV",children:e.jsx(Re,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Generate Report",children:e.jsx(Ze,{size:14})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-800 mx-0.5"}),e.jsx(me,{variant:"ghost",size:"icon",onClick:o,className:"h-8 w-8 text-zinc-400 hover:text-zinc-900 dark:hover:text-white",title:"Edit Details",children:e.jsx(de,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 text-zinc-400 hover:text-red-600",title:"Delete Case",children:e.jsx(se,{size:14})})]})]}),e.jsxs(Ua,{children:[e.jsx(Ga,{asChild:!0,className:"md:hidden",children:e.jsx(me,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-400",children:e.jsx(sn,{size:16})})}),e.jsxs(Ba,{align:"end",className:"w-44",children:[e.jsxs(Me,{onClick:n,className:"gap-2",children:[e.jsx(Re,{size:14}),"Export CSV"]}),e.jsxs(Me,{onClick:s,className:"gap-2",children:[e.jsx(Ze,{size:14}),"Generate Report"]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Ha,{}),e.jsxs(Me,{onClick:o,className:"gap-2",children:[e.jsx(de,{size:14}),"Edit Details"]}),e.jsxs(Me,{onClick:c,className:"gap-2 text-red-600 focus:text-red-600",children:[e.jsx(se,{size:14}),"Delete Case"]})]})]})]})]})]})})}function Ka({incident:t,isLoading:r,onUpdateIncident:n,onAddEvent:s,onDeleteEvent:o,onUpdateEvent:c,onReorderEvent:d,onDeleteIncident:i,onBack:m,canEdit:g}){const{currentUser:l}=yt(),u=a.useRef(null),f=a.useRef(null),[C,b]=a.useState(!1),[k,w]=a.useState(!1),[p,j]=a.useState(null),[I,v]=a.useState(!1),[_,U]=a.useState(""),A=a.useMemo(()=>t?.events?[...t.events].sort((x,N)=>{if(typeof x.order=="number"&&typeof N.order=="number"&&x.order!==N.order)return x.order-N.order;const D=`${x.date||"1970-01-01"}T${x.time||"00:00"}`,h=`${N.date||"1970-01-01"}T${N.time||"00:00"}`;return D<h?1:D>h?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-6 shadow-xl shadow-zinc-200/50 dark:shadow-zinc-950/50",children:e.jsx(le,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-bold text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs text-center",children:"Select an incident to view details"})]})]});const L=(x,N)=>{const D=[...A],h=N==="up"?x-1:x+1;if(h<0||h>=D.length)return;[D[x],D[h]]=[D[h],D[x]];const S=D.map((P,M)=>({...P,order:M}));d&&d(t.id,S)},F=x=>{const N=typeof l=="object"?l?.name:l;n(t.id,{...x,updatedBy:N})},R=async()=>{if(t)try{const x=$=>{if($==null)return"";const z=String($);return z.includes(",")||z.includes(`
`)||z.includes('"')?`"${z.replace(/"/g,'""')}"`:z},N=[...t.events||[]].sort(($,z)=>{const Z=`${$.date||"1970-01-01"}T${$.time||"00:00"}`,Y=`${z.date||"1970-01-01"}T${z.time||"00:00"}`;return Z<Y?-1:Z>Y?1:0}),D=[`Incident,${x(t.subject)}`,`Project,${x(t.project)}`,`Ticket ID,${x(t.ticket)}`,`Current Status,${x(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],h=["Date","Time","Status","Description","Images"].join(","),S=N.map($=>{const z=$.date?new Date($.date).toLocaleDateString("en-GB"):"-",Z=$.time||"-",Y=x($.statusOnLine||""),ce=x($.desc||$.title||""),Q=x(($.imageUrls||[]).join(" ; "));return[z,Z,Y,ce,Q].join(",")}),P="\uFEFF"+[...D,h,...S].join(`
`),M=new Blob([P],{type:"text/csv;charset=utf-8;"}),y=URL.createObjectURL(M),W=document.createElement("a");W.href=y,W.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(y)}catch(x){console.error("Export failed:",x),alert("Failed to export CSV. Please check console.")}},G=()=>{if(!t)return;let x=`[INCIDENT REPORT]
`;x+=`Project : ${t.project||"-"}
`,x+=`Ticket  : ${t.ticket||"-"}
`,x+=`Subject : ${t.subject||"-"}
`,x+=`Status  : ${t.status||"-"}

`,x+=`[DETAILS]
`,x+=`Impact     : ${t.impact||"-"}
`,x+=`Root Cause : ${t.root_cause||"-"}
`,x+=`Action     : ${t.action||"-"}

`,x+=`[TIMELINE]
`;const N=[...t.events||[]].sort((h,S)=>{const P=`${h.date||"1970-01-01"}T${h.time||"00:00"}`,M=`${S.date||"1970-01-01"}T${S.time||"00:00"}`;return P<M?-1:P>M?1:0});let D="";N.forEach(h=>{h.date!==D&&(x+=`
--- ${h.date?new Date(h.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,D=h.date);const S=h.time||"--:--",P=h.statusOnLine?` [${h.statusOnLine}]`:"";x+=`${S}${P} - ${h.desc||h.title}
`}),U(x),v(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 z-20 bg-white dark:bg-[#0e0e11] border-b border-zinc-100 dark:border-zinc-800 relative shadow-sm",children:e.jsx(Wa,{incident:t,onUpdate:F,onBack:m,onDelete:()=>i(t.id),onEdit:()=>w(!0),onGenerateReport:G,onExport:R,canEdit:g})}),e.jsx("div",{ref:f,className:"flex-1 overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar bg-zinc-50/50 dark:bg-[#09090b] relative min-h-0",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsxs("div",{className:"w-32 h-32 bg-zinc-100 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-zinc-200 dark:border-zinc-800 animate-spin-slow",style:{animationDuration:"20s"}}),e.jsx(Vr,{size:48,className:"text-zinc-300 dark:text-zinc-600 opacity-80",strokeWidth:1})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-1",children:"No Timeline Events"}),e.jsx("p",{className:"text-xs text-zinc-400 max-w-xs text-center mb-8",children:"This case has no operational records yet. Start by adding your first update."}),g&&e.jsxs("button",{onClick:()=>{j(null),b(!0)},className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl text-xs font-bold uppercase tracking-wider shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all",children:[e.jsx(be,{size:16}),"Initialize Log"]})]}):e.jsxs("div",{className:"flex flex-col pb-36 relative max-w-4xl mx-auto min-h-full",children:[A.map((x,N)=>{const D=N===0||x.date!==A[N-1].date;let h="-";try{h=x.date?new Date(x.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{h="-"}return e.jsx(Qn,{event:x,index:N,isLastItem:N===A.length-1,showDateHeader:D,dateLabel:h,onMove:L,onEdit:S=>{j(S),b(!0)},onDelete:S=>o(t.id,S),canEdit:g},x.id)}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"absolute bottom-8 right-8 flex flex-col gap-4 z-40 items-end",children:g&&A.length>0&&!r&&e.jsx("button",{onClick:()=>{j(null),b(!0)},className:"w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl shadow-xl shadow-indigo-600/30 hover:scale-105 hover:rotate-90 transition-all duration-300 z-30 flex items-center justify-center active:scale-90",title:"Add Update",children:e.jsx(be,{size:28,strokeWidth:3})})}),e.jsx(ts,{isOpen:C,onClose:()=>b(!1),initialData:p,onDelete:x=>o(t.id,x),onSubmit:x=>{const N=typeof l=="object"?l?.name:l,D={...x};p?(D.updatedBy=N,c(t.id,p.id,D)):(D.createdBy=N,s(t.id,D)),b(!1)}}),e.jsx(rs,{isOpen:I,onClose:()=>v(!1),text:_,incident:t}),e.jsx(ss,{isOpen:k,onClose:()=>w(!1),incident:t,onUpdate:F,onDelete:()=>i(t.id),onExport:R})]})}const Va=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},Za=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-blue-500 bg-blue-50/50 dark:bg-blue-500/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},Ke=a.memo(({label:t,value:r,icon:n,colorClass:s})=>{const o=n;return e.jsxs("div",{className:"flex-1 p-4 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:T("p-1.5 rounded-lg shrink-0",s),children:e.jsx(o,{size:12})}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})}),Ve=a.memo(({title:t,icon:r,children:n,accentColor:s="text-zinc-400"})=>{const o=r;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 flex items-center gap-2 tracking-[0.3em] px-1",children:[e.jsx(o,{size:12,className:s})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-[2rem] shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:n})]})]})});function Ya({log:t,onAddToIncident:r,onClose:n}){if(!t)return null;const s=t.createdAt?Rt(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-zinc-950/40 backdrop-blur-md animate-in fade-in transition-all duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-[#fafafa] dark:bg-[#050505] rounded-[3rem] shadow-2xl border border-zinc-200/50 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] animate-in zoom-in-95 slide-in-from-bottom-8 duration-500",children:[e.jsxs("div",{className:"relative shrink-0 p-8 border-b border-zinc-100 dark:border-zinc-900 bg-white dark:bg-[#09090b]",children:[e.jsx("button",{onClick:n,className:"absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-zinc-50 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all active:scale-90",children:e.jsx(ne,{size:20})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-lg",children:e.jsx(we,{size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 uppercase tracking-[0.3em]",children:"Operational Log"}),e.jsx("h2",{className:"text-3xl font-black text-zinc-900 dark:text-white tracking-tighter leading-none",children:t.ticketNumber})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(et,{size:12})," ",s]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ge,{size:12})," ",t.type]}),e.jsx("div",{className:T("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-widest",Va(t.status)),children:t.status})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(Ke,{label:"Severity",value:t.severity||"Low",icon:Te,colorClass:Za(t.severity)}),e.jsx(Ke,{label:"Hierarchy",value:t.category||"N/A",icon:Ye,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(Ke,{label:"Sub-Class",value:t.subCategory||"N/A",icon:Yr,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(Ve,{title:"Record Description",icon:Zr,accentColor:"text-blue-500",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ve,{title:"Action Deployed",icon:le,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200 italic",children:t.action||"No defensive actions recorded."})}),e.jsx(Ve,{title:"Resolution Status",icon:ge,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-white dark:bg-zinc-900/50 rounded-[2.5rem] border border-zinc-100 dark:border-zinc-900 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-lg font-black shadow-lg shadow-black/10 transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(Nr,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-[0.3em]",children:"Lead Engineer"}),e.jsxs("p",{className:"text-base font-black text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-zinc-300 group-hover:text-blue-500 transition-colors",children:[e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Profile Archive"}),e.jsx(qr,{size:14})]})]})]}),e.jsxs("div",{className:"p-8 bg-white dark:bg-[#09090b] border-t border-zinc-100 dark:border-zinc-900 flex flex-col gap-4",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-16 bg-zinc-950 dark:bg-white text-white dark:text-black rounded-[1.5rem] text-[12px] font-black uppercase tracking-[0.3em] flex items-center justify-center gap-3 shadow-2xl transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Mt,{size:18,className:"fill-current group-hover:animate-pulse"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[10px] font-bold text-zinc-400 uppercase tracking-widest opacity-60",children:"System will reconcile this log into a global incident archive."})]})]})})}const qa=a.memo(({label:t,value:r,variant:n})=>{const s={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${s[n]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:r}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});qa.displayName="StatBox";const Ja=a.memo(({item:t,type:r})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${r==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticket]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.subject})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${r==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:r==="new"?"New":"Update"})]}));Ja.displayName="PreviewRow";function To(){const{currentUser:t}=yt(),r=Cr(t,[mt.LEAD,mt.ENGINEER]),{toast:n}=Sr(),[s,o]=a.useState("incidents"),{incidents:c,filteredIncidents:d,selectedId:i,setSelectedId:m,loading:g,error:l,stats:u,searchTerm:f,setSearchTerm:C,filterStatus:b,setFilterStatus:k,filterType:w,setFilterType:p,clearFilters:j,hasActiveFilters:I}=Dn(),{sortedEvents:v,loading:_}=_n(i),{logs:U,loading:A,stats:L}=Ir(),[F,R]=a.useState(null),[G,x]=a.useState({isOpen:!1}),[N,D]=a.useState(!1),[h,S]=a.useState(!1),P=c.find(E=>E.id===i),M=a.useCallback((E,B="success")=>{n({description:E,variant:B==="error"?"destructive":"default"})},[n]),y=async()=>{S(!0);try{const E=typeof t=="object"?t:{name:"Admin"},B=await J.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:E,impact:"",root_cause:"",action:""});o("incidents"),m(B),M("Case created successfully")}catch(E){console.error(E),M("Failed to create incident","error")}finally{S(!1)}},W=async E=>{if(E){S(!0);try{const B=typeof t=="object"?t:{name:"System"},te={subject:E.shortDesc||E.details||`Ticket #${E.ticketNumber}`,ticket:E.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(E.type)?E.type:"Incident",status:"Open",priority:E.severity||"Medium",createdBy:B,impact:"",root_cause:E.details||"",action:E.action||""},Ne=await J.createIncident(te,E.ticketNumber);M(`Ticket #${E.ticketNumber} promoted to Case`),o("incidents"),m(Ne)}catch(B){console.error(B),M("Failed to promote ticket","error")}finally{S(!1)}}},$=E=>{x({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await J.deleteIncident(E),i===E&&m(null),x({isOpen:!1}),M("Case deleted")}catch(B){console.error(B),M("Failed to delete","error")}}})},z=async E=>{if(!E||E.length===0){M("No data to export","error");return}M("Preparing export...","info");try{const B="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",te=E.map(async ee=>{const $e=`"${ft(ee.createdAt)}","${pe(ee.project)}","${pe(ee.ticket)}","${pe(ee.type)}","${ee.status}","${pe(ee.subject)}","${ee.createdBy?.name||ee.createdBy||""}"`;try{const Ue=await J.getEvents(ee.id);return Ue.length>0?Ue.map(Ce=>{const fr=ft(Ce.date),vr=pe(Ce.desc||Ce.title);return`${$e},"${fr}","${Ce.time||"-"}","${vr}"`}).join(`
`)+`
,,,,,,,,,`:`${$e},"-","-","-"
,,,,,,,,,`}catch{return`${$e},"Error fetching events","-","-"
,,,,,,,,,`}}),Ne=await Promise.all(te),gr=[B,...Ne].join(`
`);Pn(gr,`CaseExport_${new Date().toISOString().split("T")[0]}`),M("Export completed")}catch(B){console.error(B),M("Failed to export data","error")}},Z=async(E,B)=>{try{await J.updateIncident(E,B),M("Incident updated")}catch{M("Update failed","error")}},Y=async(E,B)=>{try{await J.createEvent(E,B),M("Timeline updated")}catch{M("Failed to add event","error")}},ce=async(E,B,te)=>{try{await J.updateEvent(E,B,te),M("Event updated")}catch{M("Failed to update event","error")}},Q=async(E,B)=>J.reorderEvents(E,B),K=async(E,B)=>{x({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await J.deleteEvent(E,B),M("Event removed")}catch{M("Failed to remove event","error")}finally{x({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx(kt,{isOpen:G.isOpen,onClose:()=>x({isOpen:!1}),...G}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${i||F?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(Un,{filteredIncidents:d,stats:u,loading:g,error:l,logs:U,logsLoading:A,logStats:L,selectedId:i,selectedLogId:F?.ticketNumber,onSelect:E=>{o("incidents"),m(E)},onSelectLog:R,onAddIncident:y,onDeleteIncident:$,onExportCSV:z,viewMode:s,onViewModeChange:E=>{o(E),E==="incidents"&&R(null),E==="logs"&&m(null)},searchTerm:f,setSearchTerm:C,filterStatus:b,setFilterStatus:k,filterType:w,setFilterType:p,clearFilters:j,hasActiveFilters:I,canEdit:r})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${i||F?"flex w-full":"hidden lg:flex"}
      `,children:s==="incidents"&&i?e.jsx(Ka,{incident:P?{...P,events:v}:null,isLoading:_,onBack:()=>m(null),onUpdateIncident:Z,onAddEvent:Y,onUpdateEvent:ce,onDeleteEvent:K,onDeleteIncident:$,onReorderEvent:Q,saving:h,canEdit:r}):s==="logs"&&F?e.jsx(Ya,{log:F,onAddToIncident:W,onClose:()=>R(null),canEdit:r}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-zinc-100 dark:bg-zinc-900 rounded-3xl flex items-center justify-center mb-6 shadow-inner",children:e.jsx(wn,{size:48,strokeWidth:1,className:"text-zinc-400 dark:text-zinc-500 opacity-50"})}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-2 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{To as default};
