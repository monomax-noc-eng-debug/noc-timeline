import{e as H,r as o,j as e,k as T,T as Ae,X as ne,C as se,R as kr,L as Ee,m as Q,n as jr,p as kt,F as Le,A as le,s as et,t as Ze,S as yr,v as zr,x as Nr,y as tt,z as jt,P as re,D as L,E as xe,G as yt,H as rt,I as nt,J as Oe,K as Cr,M as Sr,N as Ir,B as me,b as zt,U as Mr,O as Er,a as Rr,Q as mt}from"./index-Q34mk0jU.js";import{i as J}from"./incidentService-DXlXT8ar.js";import{u as Nt,a as Dr}from"./useTicketOptions-CSprutIN.js";import{H as we}from"./hash-Djg64o9_.js";import{T as ae,P as be}from"./trash-2-CwNPF3Bm.js";import{C as st}from"./chevron-right-MWDulPs6.js";import{L as Ye}from"./layers-CUr3yPnR.js";import{D as De}from"./download-CUpO-YDm.js";import{S as _r}from"./search-ygDQTCIz.js";import{S as Pr}from"./sliders-horizontal-sQAoXSj-.js";import{C as Tr,p as Ar,D as Lr,f as Or,u as qe,c as Ct,R as Fr,A as $r,h as Ur,a as Br,b as Gr,F as Hr,d as Wr,e as Kr}from"./formatters-CkvMZQNo.js";import{C as Vr,P as de}from"./pen-line-DoNQB_FU.js";import{C as Zr}from"./chevron-down-DTgGqtqR.js";import{C as ue}from"./index-DFPlaL-s.js";import{C as _e}from"./addYears-PKoCkgVc.js";import{T as Yr}from"./TimeInput-DeiDARlh.js";import{P as St}from"./panels-top-left-C6E6n-xb.js";import{S as It}from"./save-BI_4ovMQ.js";import{S as ge}from"./shield-check-DtcuAYQr.js";import{i as qr,f as Mt}from"./format-_IVVRDDj.js";import{C as Jr}from"./check-BzVhAMyo.js";import{C as Qr}from"./copy-BEi8nQi4.js";import{c as Xr}from"./configService-DFdTgGxv.js";import{Z as Et}from"./zap-dCety7eh.js";import{A as en}from"./arrow-left-CWXq2fbT.js";import{H as tn,L as rn}from"./layout-list-i8EqKrZP.js";import{T as nn}from"./tag-BTX2i75d.js";import{A as sn}from"./arrow-right-DK_OLL0C.js";import"./useBaseQuery-DdGex9By.js";import"./rotate-ccw-BGOjk6ld.js";const an=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],on=H("ban",an);const cn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ln=H("circle-x",cn);const dn=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],un=H("cloud-upload",dn);const xn=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],mn=H("ellipsis",xn);const pn=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],hn=H("file-plus-corner",pn);const bn=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],gn=H("fingerprint-pattern",bn);const fn=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],vn=H("flag",fn);const wn=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],pt=H("folder-kanban",wn);const kn=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],at=H("image-off",kn);const jn=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],yn=H("image-plus",jn);const zn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Nn=H("image",zn);const Cn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],ht=H("inbox",Cn);const Sn=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],In=H("layout-dashboard",Sn);const Mn=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],En=H("link",Mn);const Rn=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],bt=H("maximize-2",Rn);const Dn=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Je=H("message-square",Dn);const _n=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],gt=H("minimize-2",_n);const Pn=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Tn=H("move",Pn);const An=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Ln=H("workflow",An);const On=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Fn=H("wrench",On),$n=()=>{const[t,r]=o.useState([]),[n,s]=o.useState(null),[a,c]=o.useState(!0),[l,i]=o.useState(null),[m,g]=o.useState(""),[d,u]=o.useState("All"),[f,I]=o.useState("All");o.useEffect(()=>{c(!0),i(null);const z=J.subscribeIncidents(M=>{const w=(M||[]).map(N=>({...N,_searchString:`${N.subject||""} ${N.project||""} ${N.ticket||""} ${N.createdBy&&typeof N.createdBy=="object"?N.createdBy.name:N.createdBy||""} ${N.status||""} ${N.type||""}`.toLowerCase()}));r(w),c(!1),i(null)},M=>{console.error("useIncidents error:",M),i(M.message||"Failed to connect to database"),c(!1)});return()=>{typeof z=="function"&&z()}},[]);const b=o.useMemo(()=>{const z=m.toLowerCase().trim();return t.filter(w=>{const N=!z||(w._searchString||"").includes(z),U=d==="All"||w.status===d,A=f==="All"||w.type===f;return N&&U&&A}).sort((w,N)=>{const U=w.createdAt?new Date(w.createdAt).getTime():0;return(N.createdAt?new Date(N.createdAt).getTime():0)-U})},[t,m,d,f]),k=o.useMemo(()=>{const z={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((M,w)=>{M.total++;const N=w.status?.replace(/\s+/g,"").replace(/^\w/,U=>U.toLowerCase());return M[N]!==void 0?M[N]++:w.status==="In Progress"&&M.inProgress++,M},z)},[t]),v=o.useCallback(()=>{g(""),u("All"),I("All")},[]);return{incidents:t,filteredIncidents:b,selectedId:n,setSelectedId:s,loading:a,error:l,searchTerm:m,setSearchTerm:g,filterStatus:d,setFilterStatus:u,filterType:f,setFilterType:I,clearFilters:v,hasActiveFilters:!!m||d!=="All"||f!=="All",stats:k}},Un=t=>{const[r,n]=o.useState([]),[s,a]=o.useState(!1);o.useEffect(()=>{if(!t){setTimeout(()=>{n([])},0);return}const l=J.subscribeEvents(t,i=>{const m=(i||[]).map(g=>({...g,_sortTime:new Date(`${g.date||"1970-01-01"}T${g.time||"00:00"}`).getTime()}));n(m),a(!1)});return()=>l&&l()},[t]);const c=o.useMemo(()=>[...r].sort((l,i)=>i._sortTime-l._sortTime),[r]);return{events:r,sortedEvents:c,loading:s}},pe=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),ft=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},Bn=(t,r)=>{const n=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s;const c=r.endsWith(".csv")?r:`${r}.csv`;a.download=c,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),window.URL.revokeObjectURL(s)},0)},Gn=t=>{switch(t){case"Open":return{dot:"bg-rose-500",text:"text-rose-600",bg:"bg-rose-50 dark:bg-rose-500/10",border:"border-rose-200 dark:border-rose-500/20"};case"In Progress":return{dot:"bg-indigo-500",text:"text-indigo-600",bg:"bg-indigo-50 dark:bg-indigo-500/10",border:"border-indigo-200 dark:border-indigo-500/20"};case"Monitoring":case"Pending":return{dot:"bg-amber-500",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-500/10",border:"border-amber-200 dark:border-amber-500/20"};case"Succeed":case"Resolved":return{dot:"bg-emerald-500",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-500/10",border:"border-emerald-200 dark:border-emerald-500/20"};case"Closed":return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"};default:return{dot:"bg-zinc-400",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"}}},Hn=o.memo(({incident:t,isSelected:r,onClick:n,onDelete:s})=>{const a=Gn(t.status),c=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative flex flex-col gap-2 p-3 rounded-lg border transition-all duration-200 cursor-pointer mb-2",r?"bg-white dark:bg-zinc-800/80 border-indigo-500/50 shadow-md transform scale-[1.01] z-10":"bg-white dark:bg-[#09090b] border-zinc-100 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-900"),children:[r&&e.jsx("div",{className:"absolute left-0 top-3 bottom-3 w-1 bg-indigo-500 rounded-r-full"}),e.jsxs("div",{className:T("flex justify-between items-start gap-2",r?"pl-2":""),children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-wrap",children:[e.jsx("div",{className:T("w-2 h-2 rounded-full shrink-0",a.dot)}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.project||"CORE"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase",children:t.type}),e.jsx("span",{className:"text-[10px] text-zinc-300 dark:text-zinc-700",children:"•"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400 uppercase flex items-center gap-1",children:[e.jsx(we,{size:10}),t.ticket||"-"]}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase ml-auto sm:ml-0",children:c})]}),!r&&e.jsx("button",{onClick:l=>{l.stopPropagation(),s(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:e.jsx(ae,{size:12})})]}),e.jsx("div",{className:T("pr-4",r?"pl-2":""),children:e.jsx("h3",{className:T("text-sm font-bold leading-snug line-clamp-2 transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.subject||"Untitled Incident"})}),e.jsxs("div",{className:T("flex justify-between items-center mt-1",r?"pl-2":""),children:[e.jsx("span",{className:T("text-[10px] font-bold uppercase px-2 py-0.5 rounded-full border",a.bg,a.text,a.border),children:t.status}),r&&e.jsx(st,{size:14,className:"text-indigo-500"})]})]})}),Wn=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},vt=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Kn=o.memo(({log:t,isSelected:r,onClick:n})=>{const s=t.createdAt?new Date(t.createdAt):null,a=s?s.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs("div",{onClick:n,className:T("group relative p-4 rounded-[2rem] border transition-all duration-300 cursor-pointer overflow-hidden mb-3",r?"bg-white dark:bg-[#09090b] border-zinc-900 dark:border-zinc-500 shadow-xl shadow-zinc-200/50 dark:shadow-none scale-[1.02] z-10":"bg-white dark:bg-[#0c0c0e] border-zinc-100 dark:border-zinc-800/50 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-lg hover:-translate-y-1"),children:[r&&e.jsx("div",{className:"absolute top-0 bottom-0 left-0 w-2 bg-zinc-900 dark:bg-white"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:T("px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border",Wn(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:a})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:T("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(Ae,{size:10,className:T("shrink-0",vt(t.severity))}),e.jsx("span",{className:T("text-[9px] font-black uppercase tracking-widest",vt(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(st,{size:18,className:"text-zinc-300"})})]})});function Vn(t,r){const[n,s]=o.useState(t);return o.useEffect(()=>{const a=setTimeout(()=>s(t),r);return()=>clearTimeout(a)},[t,r]),n}const Zn=({filteredIncidents:t,selectedId:r,onSelect:n,onAddIncident:s,onDeleteIncident:a,onExportCSV:c,onSync:l,stats:i,logs:m,selectedLogId:g,onSelectLog:d,logsLoading:u,viewMode:f,onViewModeChange:I,searchTerm:b,setSearchTerm:k,filterStatus:v,setFilterStatus:p,filterType:z,setFilterType:M,clearFilters:w,hasActiveFilters:N,loading:U,error:A,canEdit:O})=>{const{ticketOptions:F}=Nt(),[D,B]=o.useState(b),x=Vn(D,300),[S,_]=o.useState(!1);o.useEffect(()=>{k(x)},[x,k]),o.useEffect(()=>{B(b)},[b]);const[h,j]=o.useState(20),P=o.useRef(null),E=f==="logs",C=E?m:t,W=E?u:U;o.useEffect(()=>{j(20)},[C?.length,f,v,z,x]),o.useEffect(()=>{const y=new IntersectionObserver(Z=>{Z[0].isIntersecting&&C?.length>h&&j(Y=>Y+20)},{threshold:.1});return P.current&&y.observe(P.current),()=>y.disconnect()},[C,h]);const $=y=>{p(y===v?"All":y)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsxs("header",{className:"shrink-0 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 transition-colors ${E?"bg-indigo-600 text-white":"bg-zinc-900 dark:bg-white text-white dark:text-black"}`,children:E?e.jsx(ht,{size:16}):e.jsx(Ye,{size:16})}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>I("incidents"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${E?"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300":"bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm"}`,children:"Cases"}),e.jsx("button",{onClick:()=>I("logs"),className:`px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${E?"bg-white dark:bg-zinc-800 text-indigo-600 dark:text-indigo-400 shadow-sm":"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,children:"Logs"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center gap-1.5",children:!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c(t),className:"hidden sm:flex w-8 h-8 items-center justify-center rounded-lg text-zinc-400 hover:text-indigo-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",title:"Export CSV",children:e.jsx(De,{size:16})}),O&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 h-8 px-3 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[10px] font-bold uppercase tracking-wide shadow hover:opacity-90 transition-all",children:[e.jsx(hn,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"New"})]})]})})]}),e.jsxs("div",{className:"flex gap-2 px-3 pb-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(_r,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",value:D,onChange:y=>B(y.target.value),placeholder:E?"Search logs...":"Search cases...",className:"w-full h-8 pl-8 pr-7 rounded-lg bg-zinc-100 dark:bg-zinc-900 border-none text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),D&&e.jsx("button",{onClick:()=>B(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ne,{size:12})})]}),e.jsx("button",{onClick:()=>_(!0),className:`h-8 w-8 flex items-center justify-center rounded-lg transition-all ${N?"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600":"bg-zinc-100 dark:bg-zinc-900 text-zinc-500"}`,children:e.jsx(Pr,{size:14})})]}),!E&&i&&e.jsx("div",{className:"flex gap-1.5 px-3 pb-2 overflow-x-auto no-scrollbar",children:[{label:"Open",count:i.open,color:"bg-red-500"},{label:"Pending",count:i.pending,color:"bg-amber-500"},{label:"Resolved",count:i.resolved,color:"bg-emerald-500"}].map(y=>e.jsxs("button",{onClick:()=>$(y.label),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[9px] font-bold uppercase tracking-wide transition-all whitespace-nowrap shrink-0 ${v===y.label?"bg-zinc-900 dark:bg-white text-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${y.color}`}),y.label,e.jsxs("span",{className:"opacity-50",children:["(",y.count,")"]})]},y.label))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:A&&!E?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(se,{className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:A})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(kr,{size:12}),"Retry"]})]}):W&&h===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(Ee,{className:"animate-spin text-indigo-600",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):C?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[E?e.jsx(ht,{size:40,strokeWidth:1}):e.jsx(Ye,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),N&&e.jsx("button",{onClick:w,className:"mt-2 text-xs text-indigo-500 font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[C.slice(0,h).map(y=>E?e.jsx(Kn,{log:y,isSelected:g===(y.ticketNumber||y.id),onClick:()=>d(y)},y.ticketNumber||y.id):e.jsx(Hn,{incident:y,isSelected:r===y.id,onClick:()=>n(y.id),onDelete:a},y.id)),e.jsx("div",{ref:P,className:"h-4 w-full"})]})}),S&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>_(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-2xl p-5 shadow-2xl animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h3",{className:"text-base font-black text-zinc-900 dark:text-white",children:"Filters"}),e.jsx("button",{onClick:()=>_(!1),className:"p-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-full",children:e.jsx(ne,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.statuses].map(y=>e.jsx("button",{onClick:()=>p(y),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${v===y?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-400 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.types].map(y=>e.jsx("button",{onClick:()=>M(y),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${z===y?"bg-zinc-900 text-white dark:bg-white dark:text-black":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:y},y))})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{onClick:()=>{w(),_(!1)},className:"flex-1 py-3 text-red-500 font-bold bg-red-50 dark:bg-red-900/20 rounded-xl hover:bg-red-100 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>_(!1),className:"flex-[2] py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors text-sm",children:"Apply"})]})]})]}),!E&&O&&e.jsx("button",{onClick:s,className:"md:hidden absolute bottom-5 right-5 z-40 w-12 h-12 bg-indigo-600 text-white rounded-2xl shadow-xl shadow-indigo-600/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(be,{size:22})})]})},Yn=o.memo(Zn),ke=t=>{if(!t)return"";try{const r=new URL(t);if(r.hostname.includes("drive.google.com")||r.hostname.includes("docs.google.com")){let n=r.searchParams.get("id");if(!n){const s=r.pathname.split("/"),a=s.indexOf("d");a!==-1&&s[a+1]&&(n=s[a+1])}if(n)return`https://drive.google.com/thumbnail?id=${n}&sz=w1000`}return t}catch{return t}},qn=(t,r=[320,640,960,1280,1920])=>t?t.includes("drive.google.com")||t.includes("docs.google.com")?{srcset:t,sizes:"100vw"}:{srcset:r.map(a=>`${t}?w=${a} ${a}w`).join(", "),sizes:"(max-width: 640px) 320px, (max-width: 960px) 640px, (max-width: 1280px) 960px, 1280px"}:{srcset:"",sizes:""},Jn=t=>!t||typeof t!="string"?!1:t.includes("drive.google.com")||t.includes("docs.google.com"),Qn=async t=>Jn(t)?Promise.resolve("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"):new Promise(r=>{const n=new Image;n.crossOrigin="anonymous";const s=setTimeout(()=>{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},3e3);n.onload=()=>{clearTimeout(s);const a=document.createElement("canvas");a.width=20,a.height=20,a.getContext("2d").drawImage(n,0,0,20,20);try{const l=a.toDataURL("image/jpeg",.5);r(l)}catch{r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")}},n.onerror=()=>{clearTimeout(s),r("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+")},n.src=t}),Xn=t=>new Promise((r,n)=>{const s=new Image;s.onload=()=>r(),s.onerror=()=>n(new Error("Failed to preload image")),s.src=t});function es({src:t,alt:r="",className:n="",onClick:s,sizes:a,loading:c="lazy",placeholder:l="blur",fallback:i,onLoad:m,onError:g,...d}){const[u,f]=o.useState(null),[I,b]=o.useState(null),[k,v]=o.useState(!1),[p,z]=o.useState(c!=="lazy"),M=Q.useRef(null),w=Q.useRef(null),N=Q.useRef(null);o.useEffect(()=>{if(!t){setTimeout(()=>f(null),0);return}try{if(typeof t=="object"&&(t instanceof File||t instanceof Blob)){const D=URL.createObjectURL(t);return setTimeout(()=>f(D),0),()=>URL.revokeObjectURL(D)}if(typeof t=="string"){const D=ke(t);setTimeout(()=>f(D),0),l==="blur"&&D&&(D.includes("drive.google.com")||D.includes("docs.google.com")?setTimeout(()=>b("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0):Qn(D).then(x=>{setTimeout(()=>b(x),0)}).catch(()=>{setTimeout(()=>b("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjNmNGY2Ii8+PC9zdmc+"),0)}))}}catch(D){console.error("Error processing image source:",D),setTimeout(()=>f(null),0)}},[t,l]),o.useEffect(()=>{if(c!=="lazy"){setTimeout(()=>z(!0),0);return}const D=w.current||M.current;if(!D){const B=setTimeout(()=>z(!0),50);return()=>clearTimeout(B)}if(!p)return N.current=new IntersectionObserver(B=>{B.forEach(x=>{x.isIntersecting&&(z(!0),N.current&&N.current.disconnect())})},{rootMargin:"50px",threshold:.01}),N.current.observe(D),()=>{N.current&&N.current.disconnect()}},[c,p]);const{srcset:U,sizesAttr:A}=o.useMemo(()=>u?qn(u):{srcset:"",sizesAttr:""},[u]),O=D=>{m&&m(D)},F=D=>{v(!0),i&&D.target.src!==i?(D.target.src=i,v(!1)):g&&g(D)};return o.useEffect(()=>{p&&u&&!k&&Xn(u).catch(()=>{})},[p,u,k]),k&&!i?e.jsxs("div",{className:T("flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",n),onClick:s,children:[e.jsx(at,{className:"text-zinc-400 mb-1",size:20}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase",children:"Failed to load"})]}):c==="lazy"&&!p?e.jsx("div",{className:T("relative overflow-hidden bg-zinc-100 dark:bg-zinc-900",n),ref:w,children:I&&e.jsx("img",{src:I,alt:"",className:"absolute inset-0 w-full h-full object-cover filter blur-xl scale-110 opacity-50","aria-hidden":"true"})}):e.jsx("img",{ref:M,src:u||i,srcSet:U||void 0,sizes:a||A||void 0,alt:r,className:T(n),loading:c,onLoad:O,onError:F,onClick:s,decoding:"async",...d})}function ts({isOpen:t,onClose:r,imageUrl:n,allImages:s=[],initialIndex:a=0}){const[c,l]=o.useState(a),[i,m]=o.useState(1),[g,d]=o.useState({x:0,y:0}),[u,f]=o.useState(!1),[I,b]=o.useState({x:0,y:0}),k=s.length>0?s:[n],v=k[c]||n,p=Q.useRef(null),[z,M]=o.useState(!1);o.useEffect(()=>{const x=()=>M(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",x),()=>document.removeEventListener("fullscreenchange",x)},[]);const w=Q.useCallback(()=>{m(1),d({x:0,y:0})},[]),N=Q.useCallback(x=>{x?.stopPropagation(),l(S=>(S+1)%k.length),w()},[k.length,w]),U=Q.useCallback(x=>{x?.stopPropagation(),l(S=>(S-1+k.length)%k.length),w()},[k.length,w]),A=Q.useCallback(x=>{x?.stopPropagation(),document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():p.current?.requestFullscreen().catch(S=>{console.error("Fullscreen failed:",S)})},[]);if(o.useEffect(()=>{const x=S=>{if(t)switch(S.key){case"ArrowRight":N();break;case"ArrowLeft":U();break;case"Escape":document.fullscreenElement?document.exitFullscreen():r();break;case"f":case"F":A();break;case"0":w();break}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[t,N,U,r,w,A]),o.useEffect(()=>{const x=p.current;if(!x)return;const S=_=>{if(!t)return;_.preventDefault();const j=-_.deltaY>0?1.1:.9,P=Math.min(Math.max(i*j,.5),10);m(P),P<=1&&d({x:0,y:0})};return x.addEventListener("wheel",S,{passive:!1}),()=>x.removeEventListener("wheel",S)},[t,i]),o.useEffect(()=>{let x=!0,S=null;return t?S=setTimeout(()=>{if(!x)return;const _=a||(n&&s.indexOf(n)>=0?s.indexOf(n):0);l(_),w(),document.body.style.overflow="hidden"},0):document.body.style.overflow="",()=>{x=!1,S&&clearTimeout(S),document.body.style.overflow=""}},[t,a,n,s,w]),!t)return null;const O=x=>{i<=1||(x.preventDefault(),f(!0),b({x:x.clientX-g.x,y:x.clientY-g.y}))},F=x=>{!u||i<=1||(x.preventDefault(),d({x:x.clientX-I.x,y:x.clientY-I.y}))},D=()=>{f(!1)},B=x=>{x?.stopPropagation(),i===1?m(2.5):w()};return jr.createPortal(e.jsxs("div",{ref:p,className:`fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-2xl animate-in fade-in duration-300 overflow-hidden select-none ${u?"cursor-grabbing":""}`,onClick:r,onMouseMove:F,onMouseUp:D,onMouseLeave:D,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/60 pointer-events-none"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-center z-50",children:[e.jsxs("div",{className:"flex items-center gap-4 cursor-pointer group/header",onClick:A,children:[e.jsx("div",{className:"w-10 h-10 md:w-14 md:h-14 bg-white/10 border border-white/10 rounded-2xl flex items-center justify-center backdrop-blur-xl shadow-2xl group-hover/header:bg-white/20 transition-all",children:z?e.jsx(gt,{size:24,className:"text-white"}):e.jsx(bt,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[12px] md:text-[14px] font-black text-white uppercase tracking-[0.3em]",children:"NOC Visual Intel"}),e.jsxs("span",{className:"text-[10px] md:text-[11px] font-bold text-white/30 uppercase tracking-widest leading-none mt-1 group-hover/header:text-white/50 transition-colors",children:["Ref ID ",c+1," of ",k.length," • Click to ",z?"Exit":"Maximize"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 pointer-events-auto",children:[e.jsx("button",{onClick:B,className:`p-4 rounded-2xl border border-white/10 transition-all active:scale-90 flex backdrop-blur-md ${i>1?"bg-white text-black":"bg-white/5 text-white hover:bg-white/10"}`,title:i>1?"Reset Zoom":"Quick Zoom",children:i>1?e.jsx(gt,{size:22}):e.jsx(bt,{size:22})}),e.jsx("a",{href:ke(v),download:!0,target:"_blank",rel:"noreferrer",onClick:x=>x.stopPropagation(),className:"p-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl border border-white/10 transition-all active:scale-90 backdrop-blur-md",children:e.jsx(De,{size:22})}),e.jsx("button",{onClick:r,className:"p-4 bg-white text-black rounded-2xl shadow-[0_20px_40px_rgba(0,0,0,0.4)] hover:shadow-white/10 hover:bg-zinc-200 transition-all active:scale-90",children:e.jsx(ne,{size:24,strokeWidth:3})})]})]}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"relative transition-transform duration-200 ease-out",style:{transform:`translate(${g.x}px, ${g.y}px) scale(${i})`,cursor:i>1?u?"grabbing":"grab":"zoom-in"},onClick:x=>{x.stopPropagation(),i===1?m(2.5):w()},onMouseDown:O,children:[e.jsx(es,{src:v,alt:"Preview",className:"max-w-[90vw] max-h-[80vh] md:max-w-[85vw] md:max-h-[85vh] rounded-lg md:rounded-[2rem] shadow-[0_0_120px_rgba(0,0,0,0.8)] border border-white/10 animate-in zoom-in-95 duration-500 pointer-events-none",style:{imageRendering:"auto"},loading:"eager",fallback:"https://placehold.co/1200x800?text=Failed+to+load+image"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",children:i===1&&e.jsx(Tn,{size:64,className:"text-white/10"})})]})}),k.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,className:"absolute left-4 md:left-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(Tr,{size:32,className:"group-hover:-translate-x-1.5 transition-transform",strokeWidth:4})}),e.jsx("button",{onClick:N,className:"absolute right-4 md:right-12 top-1/2 -translate-y-1/2 w-14 h-14 md:w-20 md:h-20 rounded-3xl bg-black/40 hover:bg-white text-white hover:text-black border border-white/10 transition-all duration-500 flex items-center justify-center group active:scale-90 z-50 backdrop-blur-xl shadow-2xl",children:e.jsx(st,{size:32,className:"group-hover:translate-x-1.5 transition-transform",strokeWidth:4})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-8 md:p-12 flex flex-col items-center gap-6 pointer-events-none z-50",children:[k.length>1&&e.jsx("div",{className:"flex gap-2 p-2 bg-black/60 backdrop-blur-2xl rounded-3xl border border-white/10 pointer-events-auto overflow-x-auto max-w-[85vw] no-scrollbar shadow-2xl",children:k.map((x,S)=>e.jsx("button",{onClick:_=>{_.stopPropagation(),l(S),w()},className:`h-2.5 rounded-full transition-all duration-700 ease-out ${c===S?"bg-white w-12 md:w-16 shadow-[0_0_20px_rgba(255,255,255,0.4)]":"bg-white/10 hover:bg-white/30 w-2.5"}`},S))}),e.jsx("div",{className:"bg-black/80 backdrop-blur-2xl border border-white/10 rounded-2xl px-6 py-3 shadow-2xl animate-in slide-in-from-bottom-4 duration-700",children:e.jsxs("p",{className:"text-[10px] md:text-[11px] font-black text-white/40 tracking-[0.4em] uppercase truncate max-w-[250px] md:max-w-2xl",children:["SRC: ",v.split("/").pop().substring(0,60)]})})]})]}),document.body)}const rs=t=>{const r=t.type?.toLowerCase()||"",n=t.desc?.toLowerCase()||"",s={message:Je,alert:se,check:_e,clock:ue,update:de},a=t.iconType?s[t.iconType]:null;return r==="create"||n.includes("created")?{icon:a||be,colorClass:"text-indigo-600 bg-indigo-50 dark:bg-indigo-900/30 border-indigo-200 dark:border-indigo-800"}:r==="update"||n.includes("updated")?{icon:a||de,colorClass:"text-amber-600 bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-800"}:r==="status_change"||n.includes("resolved")||n.includes("closed")||n.includes("succeed")?{icon:a||_e,colorClass:"text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-800"}:r==="alert"||n.includes("alert")||n.includes("error")||n.includes("failed")?{icon:a||se,colorClass:"text-rose-600 bg-rose-50 dark:bg-rose-900/30 border-rose-200 dark:border-rose-800"}:{icon:a||Je,colorClass:"text-zinc-500 bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700"}},ns=t=>{switch(t){case"rose":return"bg-rose-50 text-rose-700 border-rose-200 dark:bg-rose-900/40 dark:text-rose-300 dark:border-rose-800";case"emerald":return"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-300 dark:border-emerald-800";case"white":default:return"bg-zinc-50 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}},ss=t=>{switch(t){case"rose":return"text-rose-600 bg-rose-50 border-rose-200 dark:bg-rose-900/20 dark:border-rose-800";case"emerald":return"text-emerald-600 bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-800";case"white":return"text-zinc-500 bg-white border-zinc-200 dark:bg-zinc-800 dark:border-zinc-700";default:return null}},as=({src:t,index:r,onClick:n,className:s})=>{const[a,c]=o.useState(!1),[l,i]=o.useState(null);return o.useEffect(()=>{c(!1)},[t]),o.useEffect(()=>{if(!t){i(null);return}let m=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(m=URL.createObjectURL(t),i(m)):typeof t=="string"&&i(ke(t)),()=>{m&&URL.revokeObjectURL(m)}},[t]),a||!l?e.jsx("div",{className:T(s,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(at,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>n(t),className:T("relative group/img overflow-hidden cursor-zoom-in",s),children:[e.jsx("img",{src:l,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>c(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(Nn,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function os({event:t,index:r,isLastItem:n,onEdit:s,onDelete:a,onMove:c}){const[l,i]=o.useState(null),{icon:m,colorClass:g}=rs(t),u=ss(t.statusOnLineColor)||g,I=(t.date?new Date(t.date):new Date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),b=t.time||"00:00";let k=(t.imageUrls||[]).filter(v=>v);return!k.length&&t.image&&(k=[t.image]),e.jsxs("div",{className:"group relative flex w-full gap-4 pb-8",children:[e.jsx("div",{className:"relative shrink-0 w-4 flex flex-col items-center",children:e.jsx("div",{className:T("absolute left-1/2 -translate-x-1/2 w-[2px] bg-zinc-700 dark:bg-zinc-600 z-0",r===0?"top-4":"-top-4",n?"bottom-auto h-12":"-bottom-4")})}),e.jsx("div",{className:"flex flex-col items-end shrink-0 w-14 pt-1 relative",children:e.jsxs("div",{className:"flex flex-col items-end w-full pr-1 relative z-10 transition-transform group-hover:scale-105",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 tabular-nums leading-none tracking-tight",children:b}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase mt-1 leading-none",children:I})]})}),e.jsxs("div",{className:"relative shrink-0 flex flex-col items-center pt-1 h-full",children:[t.statusOnLine&&e.jsx("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 z-30 whitespace-nowrap pb-1",children:e.jsx("div",{className:T("text-[9px] font-black uppercase px-2.5 py-0.5 rounded-full border shadow-sm bg-white dark:bg-black",ns(t.statusOnLineColor||"white")),children:t.statusOnLine})}),e.jsx("div",{className:T("w-8 h-8 rounded-full flex items-center justify-center border-2 shadow-sm z-20 transition-all duration-300 bg-white dark:bg-[#09090b]",u),children:e.jsx(m,{size:14,strokeWidth:2.5})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative bg-white dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4 shadow-sm hover:shadow-md hover:border-zinc-300 dark:hover:border-zinc-700 transition-all duration-300 group/card",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2 pb-2 border-b border-zinc-100 dark:border-zinc-800/50 border-dashed",children:[e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-white leading-snug break-words",children:t.title||"Operational Update"}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 opacity-100 sm:opacity-0 group-hover/card:opacity-100 transition-opacity",children:[c&&e.jsxs("div",{className:"hidden sm:flex items-center bg-zinc-100 dark:bg-zinc-800/50 rounded-lg p-0.5 border border-zinc-200 dark:border-zinc-700 mr-2",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),c(r,"up")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Vr,{size:12})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),c(r,"down")},className:"p-1 hover:text-indigo-500 hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Zr,{size:12})})]}),e.jsx("button",{onClick:()=>s(t),className:"p-1.5 text-zinc-400 hover:text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 rounded-lg transition-colors",title:"Edit",children:e.jsx(de,{size:14})}),e.jsx("button",{onClick:()=>a(t.id),className:"p-1.5 text-zinc-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(ae,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-normal break-words max-w-full",children:t.desc||t.details}),k.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-2 border-t border-zinc-100 dark:border-zinc-800/50 border-dashed",children:k.map((v,p)=>e.jsx(as,{index:p,src:v,onClick:i,className:"w-20 h-20 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm"},p))}),(t.updatedBy||t.createdBy)&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-indigo-500 flex items-center justify-center text-[7px] font-bold text-white shadow-sm",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})})]})}),e.jsx(ts,{isOpen:!!l,onClose:()=>i(null),imageUrl:l,allImages:k})]})}const is=o.memo(os),Rt="https://script.google.com/macros/s/AKfycbzsxHS5m3rN6ZdyHS_iZndg-p9RfF6z7TJh_qLebxnUik724Bjf9fi4eiulZjQLs62JBA/exec",cs=async t=>new Promise((r,n)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=async()=>{try{const a=s.result.split(",")[1],c=await fetch(Rt,{method:"POST",body:JSON.stringify({action:"upload",name:t.name,mimeType:t.type,base64:a})});r(await c.json())}catch(a){n(a)}}}),Se=async t=>{if(!t)return;let r=t;t.includes("id=")&&(r=new URLSearchParams(new URL(t).search).get("id"));try{return await(await fetch(Rt,{method:"POST",body:JSON.stringify({action:"delete",fileId:r})})).json()}catch(n){console.error("Drive Delete Error:",n)}},He=o.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),ls=o.memo(({error:t,className:r,...n})=>e.jsx("input",{...n,className:T("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-indigo-500/50 focus:ring-4 focus:ring-indigo-500/5",t?"border-rose-500":"",r)})),Ie=o.memo(({children:t,title:r,icon:n,badge:s})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[n&&e.jsx(n,{size:14,className:"text-zinc-400 group-hover/row:text-indigo-500 transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase tracking-[0.2em]",children:r})]}),s&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:s})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function ds({isOpen:t,onClose:r,onSubmit:n,onDelete:s,initialData:a,saving:c=!1}){const[l,i]=o.useState({date:"",time:"",desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]}),[m,g]=o.useState(""),[d,u]=o.useState(!1),[f,I]=o.useState(0),[b,k]=o.useState(""),[v,p]=o.useState(null),[z,M]=o.useState({}),[w,N]=o.useState({isOpen:!1,type:null,index:null}),[U,A]=o.useState({}),O=o.useRef(null),F=o.useRef(null);o.useEffect(()=>{const h=j=>{j.key==="Escape"&&!c&&r()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[r,c]),o.useEffect(()=>{if(t){if(a){let h=a.imageUrls||[];!h.length&&a.image&&(h=[a.image]);let j=new Date;if(a.date){const P=typeof a.date=="string"?Ar(a.date):a.date;j=qr(P)?P:new Date}i({...a,date:j,imageUrls:h})}else{const h=new Date;i({date:h,time:`${String(h.getHours()).padStart(2,"0")}:${String(h.getMinutes()).padStart(2,"0")}`,desc:"",statusOnLine:"",statusOnLineColor:"white",iconType:"message",imageUrls:[]})}k(""),p(null),g(""),M({}),A({})}},[t,a]);const D=async h=>{h&&(h.stopPropagation(),h.preventDefault()),F.current&&F.current.abort(),u(!1),I(0),v&&(await Se(v),p(null)),k("Transmission Purged")},B=h=>{const j=h||m;j&&!l.imageUrls.includes(j)&&(i(P=>({...P,imageUrls:[...P.imageUrls,j]})),g(""))},x=async h=>{const j=h.target.files[0];if(j){u(!0),I(15),k(""),F.current=new AbortController;try{const P=await cs(j);if(F.current.signal.aborted){P.fileId&&await Se(P.fileId);return}if(P.result==="success")p(P.fileId),I(100),B(P.url),setTimeout(()=>{u(!1),I(0)},500);else throw new Error(P.error||"Sync Error")}catch(P){P.name==="AbortError"?k("Canceled"):(k("Upload Failed"),console.error(P)),u(!1)}finally{F.current=null,h.target.value=""}}},S=async()=>{if(w.type==="item"){if(l.imageUrls?.length>0)for(const h of l.imageUrls)await Se(h);s&&a?.id&&(s(a.id),r())}else if(w.type==="image"){const h=l.imageUrls[w.index];await Se(h),i(j=>({...j,imageUrls:j.imageUrls.filter((P,E)=>E!==w.index)}))}N({isOpen:!1,type:null,index:null})},_=h=>{if(h.preventDefault(),!l.desc?.trim()){M({desc:!0});return}const j={...l,date:Or(l.date)};n(j)};return t?e.jsxs(e.Fragment,{children:[e.jsx(kt,{isOpen:w.isOpen,onClose:()=>N({isOpen:!1,type:null,index:null}),title:w.type==="item"?"Purge Record?":"Remove Asset?",message:w.type==="item"?"This operational record will be permanently purged from the timeline. This action cannot be undone.":"This image asset will be removed from this record and purged from cloud storage.",onConfirm:S,isDanger:!0}),e.jsx(Le,{isOpen:t,onClose:r,isLoading:c,size:"md",showCloseButton:!1,headerClassName:"p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:a?"Edit Operation":"New Deployment"})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(ne,{size:18})})]}),footerClassName:"p-6 pt-2 flex items-center gap-3 border-t-0",footer:e.jsxs(e.Fragment,{children:[a&&e.jsx("button",{type:"button",onClick:()=>N({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-2xl bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(ae,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:c||d,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-2xl shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[c?e.jsx(Ee,{size:18,className:"animate-spin"}):e.jsx(It,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em]",children:"Commit Record"})]})]}),bodyClassName:"p-6 space-y-8",children:e.jsxs("form",{id:"event-form",onSubmit:_,className:"space-y-8",children:[e.jsx(Ie,{title:"Temporal Matrix",icon:ue,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(He,{label:"Deployment Date"}),e.jsx(Lr,{date:l.date,setDate:h=>i({...l,date:h}),placeholder:"Select date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(He,{label:"Sync Time"}),e.jsx(Yr,{value:l.time,onChange:h=>i({...l,time:h.target.value})})]})]})}),e.jsx(Ie,{title:"Visual Personalization",icon:gn,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-xl border border-zinc-100 dark:border-white/5",children:[e.jsx(He,{label:"Marker Status",icon:we}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(h=>e.jsx("button",{type:"button",onClick:()=>i({...l,statusOnLineColor:h}),className:T("w-5 h-5 rounded-full border-2 transition-all",h==="white"?"bg-white border-zinc-200":h==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",l.statusOnLineColor===h?"ring-4 ring-indigo-500/20 scale-110 shadow-lg border-indigo-500":"opacity-30 border-transparent")},h))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl",children:[{id:"message",icon:Je},{id:"alert",icon:se},{id:"check",icon:_e},{id:"clock",icon:ue},{id:"update",icon:de},{id:"activity",icon:le}].map(h=>e.jsx("button",{type:"button",onClick:()=>i({...l,iconType:h.id}),className:T("h-9 flex items-center justify-center rounded-lg transition-all",l.iconType===h.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(h.icon,{size:14,strokeWidth:2.5})},h.id))})]})}),e.jsx(Ie,{title:"Operational Narrative",icon:St,children:e.jsx("textarea",{className:T("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-xl p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",z.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:l.desc,onChange:h=>i({...l,desc:h.target.value})})}),e.jsx(Ie,{title:"Intelligence Evidence",icon:yn,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(ls,{placeholder:"Asset URL...",value:m,onChange:h=>g(h.target.value)}),e.jsx(En,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>B(),disabled:!m,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(be,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>O.current.click(),disabled:d,className:"h-10 w-10 flex items-center justify-center bg-indigo-600 text-white rounded-xl transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:O,className:"hidden",accept:"image/*",onChange:x}),d?e.jsx(Ee,{size:16,className:"animate-spin"}):e.jsx(un,{size:16})]})]}),(d||b)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-2xl p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:d?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{size:12,className:"animate-spin text-indigo-500"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-indigo-500 tabular-nums",children:[Math.round(f),"%"]}),e.jsx("button",{type:"button",onClick:D,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(on,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300 ease-out",style:{width:`${f}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(se,{size:12}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:b})]})}),l.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:l.imageUrls.map((h,j)=>e.jsxs("div",{className:"group relative aspect-square rounded-xl overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[U[j]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(at,{size:16})}):e.jsx("img",{src:ke(h),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>A(P=>({...P,[j]:!0}))}),e.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),N({isOpen:!0,type:"image",index:j})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(ae,{size:16})})]},j))})]})})]})})]}):null}function us({isOpen:t,onClose:r,text:n,incident:s}){const[a,c]=Q.useState(!1),[l,i]=Q.useState("preview"),m=o.useMemo(()=>{if(s)return{meta:{Project:s.project||"-",Subject:s.subject||"-",Status:s.status||"-",Ticket:s.ticket||"-"},details:{Impact:s.impact||"-","Root Cause":s.root_cause||"-","Action Taken":s.action||"-"},timeline:(s.events||[]).map(b=>({date:b.date?new Date(b.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:b.time,desc:b.desc||b.title,originalDate:b.date,imageUrls:b.imageUrls||(b.image?[b.image]:[])}))};if(!n)return null;const d={meta:{},details:{},timeline:[]},u=n.split(`
`);let f=!1,I="";return u.forEach(b=>{const k=b.trim();if(!k)return;const v=b.indexOf(":");if(!f&&v!==-1&&v<20){const p=b.substring(0,v).trim(),z=b.substring(v+1).trim();["Project","Subject","Status","Ticket"].includes(p)?d.meta[p]=z:(["Impact","Root Cause","Action Taken"].includes(p),d.details[p]=z)}else if(f=!0,k.length<20&&/\d/.test(k)&&!k.includes("-"))I=k;else{const z=k.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);z?d.timeline.push({date:I,time:z[1],desc:z[2]||""}):d.timeline.push({date:I,time:null,desc:k})}}),d},[n,s]),g=async()=>{try{await navigator.clipboard.writeText(n),c(!0),setTimeout(()=>{c(!1),r()},1e3)}catch(d){console.error("Failed to copy:",d);const u=document.createElement("textarea");u.value=n,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),c(!0),setTimeout(()=>{c(!1),r()},1e3)}};return t?e.jsx(Le,{isOpen:t,onClose:r,size:"2xl",showCloseButton:!1,headerClassName:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-xl shadow-sm",children:e.jsx(Ze,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>i("preview"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${l==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>i("raw"),className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md transition-all ${l==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(ne,{size:20})})]}),bodyClassName:"p-0 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",footerClassName:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",footer:e.jsx("button",{onClick:g,disabled:a,className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${a?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Jr,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qr,{size:16})," Copy to Clipboard"]})}),children:l==="raw"?e.jsx("textarea",{readOnly:!0,value:n,className:"w-full h-full min-h-[50vh] p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m?.meta&&Object.entries(m.meta).map(([d,u])=>e.jsxs("div",{className:"p-4 rounded-2xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-400 block mb-1",children:d}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:u})]},d))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(le,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:m?.details&&Object.entries(m.details).map(([d,u])=>{let f=le;return d.includes("Impact")&&(f=Ae),d.includes("Root")&&(f=Ln),d.includes("Action")&&(f=Fn),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-zinc-500",children:d})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:u==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):u})]},d)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-black uppercase tracking-widest text-zinc-400 flex items-center gap-2",children:[e.jsx(ue,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),m?.timeline.map((d,u)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(u===0||d.date!==m.timeline[u-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(et,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:d.date})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[d.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:d.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:d.desc}),d.imageUrls&&d.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:d.imageUrls.map((f,I)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ke(f),alt:`Evidence ${I+1}`,className:"w-full h-full object-cover",onError:b=>{b.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},I))})]})]},u)),m?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}):null}function xs(){const[t,r]=o.useState([]),[n,s]=o.useState(!0);return o.useEffect(()=>{const a=Xr.subscribeProjects(c=>{r(c),s(!1)});return()=>a()},[]),{projects:t,loading:n}}function ms({isOpen:t,onClose:r,incident:n,onUpdate:s,onDelete:a}){const{ticketOptions:c}=Nt(),{projects:l}=xs(),[i,m]=o.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});o.useEffect(()=>{n&&setTimeout(()=>{m({subject:n.subject||"",project:n.project||"",type:n.type||"Incident",ticket:n.ticket||"",status:n.status||"Open",priority:n.priority||"Medium",impact:n.impact||"",root_cause:n.root_cause||"",action:n.action||""})},0)},[n,t]);const g=i.subject?.includes("|")&&i.subject?.includes("-"),d=p=>{let z={subject:p};if(p.includes("|")&&p.includes("-")){const M=p.split("|").map(w=>w.trim());if(M.length>=2){const w=M[0].split("-").map(N=>N.trim());if(w.length>=2){z.ticket=w[0],z.project=w[1];const N=c?.types||["Incident","Request","Maintenance"];z.type=N.find(U=>U.toLowerCase()===M[1].toLowerCase())||M[1],M.length>=3&&(z.subject=M.slice(2).join(" | "))}}}m(M=>({...M,...z}))};if(!t)return null;const u=p=>{p.preventDefault(),s(i),r()},f=p=>{const z={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:se},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:ue},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:_e},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:ln}};return z[p]||z.Open},I=p=>{const z={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-indigo-500",bg:"bg-indigo-500/10"}};return z[p]||z.Medium},b="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",k="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-blue-500/5 focus:border-blue-500 outline-none transition-all",v="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 text-xs font-black uppercase tracking-widest focus:ring-4 focus:ring-blue-500/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx(Le,{isOpen:t,onClose:r,size:"lg",showCloseButton:!1,headerClassName:"px-6 py-5 bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(ge,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-black uppercase tracking-tight text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(ne,{size:18})})]}),footerClassName:"p-6 pt-2 border-t border-zinc-100 dark:border-white/5 flex items-center justify-between",footer:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:a,className:"h-11 px-5 rounded-xl bg-rose-500/10 text-rose-500 font-black uppercase text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(ae,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"h-11 px-6 rounded-xl text-[9px] font-black uppercase tracking-widest text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",form:"incident-form",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-xl text-[9px] font-black uppercase tracking-widest shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(It,{size:14})," Commit Changes"]})]})]}),bodyClassName:"p-6",children:e.jsxs("form",{id:"incident-form",onSubmit:u,className:"space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-2xl bg-indigo-500/5 border border-indigo-500/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:T(b,"text-indigo-600 dark:text-indigo-400"),children:[e.jsx(St,{size:10})," Protocol Signature (Subject)"]}),g&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Et,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-xl p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:i.subject,onChange:p=>d(p.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(le,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(v,f(i.status).color),value:i.status,onChange:p=>m({...i,status:p.target.value}),children:(c.statuses||["Open","Pending","Succeed","Closed"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(ue,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(vn,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:T(v,I(i.priority).color),value:i.priority,onChange:p=>m({...i,priority:p.target.value}),children:(c.severities||["Critical","High","Medium","Low"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))}),e.jsx(Ae,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-2xl bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(we,{size:10,className:"text-blue-500"})," Ticket Identity"]}),e.jsx("input",{type:"text",className:k,value:i.ticket,onChange:p=>m({...i,ticket:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(pt,{size:10,className:"text-indigo-500"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:v,value:i.project,onChange:p=>m({...i,project:p.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(l&&l.length>0?l:["MONOMAX","MONO29","3BB GIGATV"]).map(p=>e.jsx("option",{value:p,className:"bg-white dark:bg-zinc-950",children:p},p))]}),e.jsx(pt,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(se,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[80px] resize-none transition-all",value:i.impact,onChange:p=>m({...i,impact:p.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(yr,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.root_cause,onChange:p=>m({...i,root_cause:p.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:b,children:[e.jsx(ge,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-2xl p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 min-h-[100px] resize-none transition-all",value:i.action,onChange:p=>m({...i,action:p.target.value}),placeholder:""})]})]})]})]})})}const Dt=Nr("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Re({className:t,variant:r,asChild:n=!1,...s}){const a=n?zr:"span";return e.jsx(a,{"data-slot":"badge",className:T(Dt({variant:r}),t),...s})}Re.variants=Dt;var ps=o.createContext(void 0);function _t(t){const r=o.useContext(ps);return t||r||"ltr"}var We="rovingFocusGroup.onEntryFocus",hs={bubbles:!1,cancelable:!0},je="RovingFocusGroup",[Qe,Pt,bs]=jt(je),[gs,Tt]=tt(je,[bs]),[fs,vs]=gs(je),At=o.forwardRef((t,r)=>e.jsx(Qe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Qe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(ws,{...t,ref:r})})}));At.displayName=je;var ws=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:a=!1,dir:c,currentTabStopId:l,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:m,onEntryFocus:g,preventScrollOnEntryFocus:d=!1,...u}=t,f=o.useRef(null),I=xe(r,f),b=_t(c),[k,v]=yt({prop:l,defaultProp:i??null,onChange:m,caller:je}),[p,z]=o.useState(!1),M=rt(g),w=Pt(n),N=o.useRef(!1),[U,A]=o.useState(0);return o.useEffect(()=>{const O=f.current;if(O)return O.addEventListener(We,M),()=>O.removeEventListener(We,M)},[M]),e.jsx(fs,{scope:n,orientation:s,dir:b,loop:a,currentTabStopId:k,onItemFocus:o.useCallback(O=>v(O),[v]),onItemShiftTab:o.useCallback(()=>z(!0),[]),onFocusableItemAdd:o.useCallback(()=>A(O=>O+1),[]),onFocusableItemRemove:o.useCallback(()=>A(O=>O-1),[]),children:e.jsx(re.div,{tabIndex:p||U===0?-1:0,"data-orientation":s,...u,ref:I,style:{outline:"none",...t.style},onMouseDown:L(t.onMouseDown,()=>{N.current=!0}),onFocus:L(t.onFocus,O=>{const F=!N.current;if(O.target===O.currentTarget&&F&&!p){const D=new CustomEvent(We,hs);if(O.currentTarget.dispatchEvent(D),!D.defaultPrevented){const B=w().filter(j=>j.focusable),x=B.find(j=>j.active),S=B.find(j=>j.id===k),h=[x,S,...B].filter(Boolean).map(j=>j.ref.current);Ft(h,d)}}N.current=!1}),onBlur:L(t.onBlur,()=>z(!1))})})}),Lt="RovingFocusGroupItem",Ot=o.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:a=!1,tabStopId:c,children:l,...i}=t,m=qe(),g=c||m,d=vs(Lt,n),u=d.currentTabStopId===g,f=Pt(n),{onFocusableItemAdd:I,onFocusableItemRemove:b,currentTabStopId:k}=d;return o.useEffect(()=>{if(s)return I(),()=>b()},[s,I,b]),e.jsx(Qe.ItemSlot,{scope:n,id:g,focusable:s,active:a,children:e.jsx(re.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...i,ref:r,onMouseDown:L(t.onMouseDown,v=>{s?d.onItemFocus(g):v.preventDefault()}),onFocus:L(t.onFocus,()=>d.onItemFocus(g)),onKeyDown:L(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){d.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const p=ys(v,d.orientation,d.dir);if(p!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let M=f().filter(w=>w.focusable).map(w=>w.ref.current);if(p==="last")M.reverse();else if(p==="prev"||p==="next"){p==="prev"&&M.reverse();const w=M.indexOf(v.currentTarget);M=d.loop?zs(M,w+1):M.slice(w+1)}setTimeout(()=>Ft(M))}}),children:typeof l=="function"?l({isCurrentTabStop:u,hasTabStop:k!=null}):l})})});Ot.displayName=Lt;var ks={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function js(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ys(t,r,n){const s=js(t.key,n);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return ks[s]}function Ft(t,r=!1){const n=document.activeElement;for(const s of t)if(s===n||(s.focus({preventScroll:r}),document.activeElement!==n))return}function zs(t,r){return t.map((n,s)=>t[(r+s)%t.length])}var Ns=At,Cs=Ot;function Ss(t){const r=Is(t),n=o.forwardRef((s,a)=>{const{children:c,...l}=s,i=o.Children.toArray(c),m=i.find(Es);if(m){const g=m.props.children,d=i.map(u=>u===m?o.Children.count(g)>1?o.Children.only(null):o.isValidElement(g)?g.props.children:null:u);return e.jsx(r,{...l,ref:a,children:o.isValidElement(g)?o.cloneElement(g,void 0,d):null})}return e.jsx(r,{...l,ref:a,children:c})});return n.displayName=`${t}.Slot`,n}function Is(t){const r=o.forwardRef((n,s)=>{const{children:a,...c}=n;if(o.isValidElement(a)){const l=Ds(a),i=Rs(c,a.props);return a.type!==o.Fragment&&(i.ref=s?nt(s,l):l),o.cloneElement(a,i)}return o.Children.count(a)>1?o.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Ms=Symbol("radix.slottable");function Es(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ms}function Rs(t,r){const n={...r};for(const s in r){const a=t[s],c=r[s];/^on[A-Z]/.test(s)?a&&c?n[s]=(...i)=>{const m=c(...i);return a(...i),m}:a&&(n[s]=a):s==="style"?n[s]={...a,...c}:s==="className"&&(n[s]=[a,c].filter(Boolean).join(" "))}return{...t,...n}}function Ds(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Xe=["Enter"," "],_s=["ArrowDown","PageUp","Home"],$t=["ArrowUp","PageDown","End"],Ps=[..._s,...$t],Ts={ltr:[...Xe,"ArrowRight"],rtl:[...Xe,"ArrowLeft"]},As={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ye="Menu",[fe,Ls,Os]=jt(ye),[oe,Ut]=tt(ye,[Os,Ct,Tt]),Fe=Ct(),Bt=Tt(),[Fs,ie]=oe(ye),[$s,ze]=oe(ye),Gt=t=>{const{__scopeMenu:r,open:n=!1,children:s,dir:a,onOpenChange:c,modal:l=!0}=t,i=Fe(r),[m,g]=o.useState(null),d=o.useRef(!1),u=rt(c),f=_t(a);return o.useEffect(()=>{const I=()=>{d.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>d.current=!1;return document.addEventListener("keydown",I,{capture:!0}),()=>{document.removeEventListener("keydown",I,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),e.jsx(Fr,{...i,children:e.jsx(Fs,{scope:r,open:n,onOpenChange:u,content:m,onContentChange:g,children:e.jsx($s,{scope:r,onClose:o.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:f,modal:l,children:s})})})};Gt.displayName=ye;var Us="MenuAnchor",ot=o.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,a=Fe(n);return e.jsx($r,{...a,...s,ref:r})});ot.displayName=Us;var it="MenuPortal",[Bs,Ht]=oe(it,{forceMount:void 0}),Wt=t=>{const{__scopeMenu:r,forceMount:n,children:s,container:a}=t,c=ie(it,r);return e.jsx(Bs,{scope:r,forceMount:n,children:e.jsx(Oe,{present:n||c.open,children:e.jsx(Cr,{asChild:!0,container:a,children:s})})})};Wt.displayName=it;var q="MenuContent",[Gs,ct]=oe(q),Kt=o.forwardRef((t,r)=>{const n=Ht(q,t.__scopeMenu),{forceMount:s=n.forceMount,...a}=t,c=ie(q,t.__scopeMenu),l=ze(q,t.__scopeMenu);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Oe,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:l.modal?e.jsx(Hs,{...a,ref:r}):e.jsx(Ws,{...a,ref:r})})})})}),Hs=o.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu),s=o.useRef(null),a=xe(r,s);return o.useEffect(()=>{const c=s.current;if(c)return Ur(c)},[]),e.jsx(lt,{...t,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:L(t.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Ws=o.forwardRef((t,r)=>{const n=ie(q,t.__scopeMenu);return e.jsx(lt,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Ks=Ss("MenuContent.ScrollLock"),lt=o.forwardRef((t,r)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:a,onOpenAutoFocus:c,onCloseAutoFocus:l,disableOutsidePointerEvents:i,onEntryFocus:m,onEscapeKeyDown:g,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:f,onDismiss:I,disableOutsideScroll:b,...k}=t,v=ie(q,n),p=ze(q,n),z=Fe(n),M=Bt(n),w=Ls(n),[N,U]=o.useState(null),A=o.useRef(null),O=xe(r,A,v.onContentChange),F=o.useRef(0),D=o.useRef(""),B=o.useRef(0),x=o.useRef(null),S=o.useRef("right"),_=o.useRef(0),h=b?Gr:o.Fragment,j=b?{as:Ks,allowPinchZoom:!0}:void 0,P=C=>{const W=D.current+C,$=w().filter(K=>!K.disabled),y=document.activeElement,Z=$.find(K=>K.ref.current===y)?.textValue,Y=$.map(K=>K.textValue),ce=sa(Y,W,Z),X=$.find(K=>K.textValue===ce)?.ref.current;(function K(R){D.current=R,window.clearTimeout(F.current),R!==""&&(F.current=window.setTimeout(()=>K(""),1e3))})(W),X&&setTimeout(()=>X.focus())};o.useEffect(()=>()=>window.clearTimeout(F.current),[]),Br();const E=o.useCallback(C=>S.current===x.current?.side&&oa(C,x.current?.area),[]);return e.jsx(Gs,{scope:n,searchRef:D,onItemEnter:o.useCallback(C=>{E(C)&&C.preventDefault()},[E]),onItemLeave:o.useCallback(C=>{E(C)||(A.current?.focus(),U(null))},[E]),onTriggerLeave:o.useCallback(C=>{E(C)&&C.preventDefault()},[E]),pointerGraceTimerRef:B,onPointerGraceIntentChange:o.useCallback(C=>{x.current=C},[]),children:e.jsx(h,{...j,children:e.jsx(Hr,{asChild:!0,trapped:a,onMountAutoFocus:L(c,C=>{C.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:e.jsx(Ir,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:g,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:f,onDismiss:I,children:e.jsx(Ns,{asChild:!0,...M,dir:p.dir,orientation:"vertical",loop:s,currentTabStopId:N,onCurrentTabStopIdChange:U,onEntryFocus:L(m,C=>{p.isUsingKeyboardRef.current||C.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Wr,{role:"menu","aria-orientation":"vertical","data-state":cr(v.open),"data-radix-menu-content":"",dir:p.dir,...z,...k,ref:O,style:{outline:"none",...k.style},onKeyDown:L(k.onKeyDown,C=>{const $=C.target.closest("[data-radix-menu-content]")===C.currentTarget,y=C.ctrlKey||C.altKey||C.metaKey,Z=C.key.length===1;$&&(C.key==="Tab"&&C.preventDefault(),!y&&Z&&P(C.key));const Y=A.current;if(C.target!==Y||!Ps.includes(C.key))return;C.preventDefault();const X=w().filter(K=>!K.disabled).map(K=>K.ref.current);$t.includes(C.key)&&X.reverse(),ra(X)}),onBlur:L(t.onBlur,C=>{C.currentTarget.contains(C.target)||(window.clearTimeout(F.current),D.current="")}),onPointerMove:L(t.onPointerMove,ve(C=>{const W=C.target,$=_.current!==C.clientX;if(C.currentTarget.contains(W)&&$){const y=C.clientX>_.current?"right":"left";S.current=y,_.current=C.clientX}}))})})})})})})});Kt.displayName=q;var Vs="MenuGroup",dt=o.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"group",...s,ref:r})});dt.displayName=Vs;var Zs="MenuLabel",Vt=o.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{...s,ref:r})});Vt.displayName=Zs;var Pe="MenuItem",wt="menu.itemSelect",$e=o.forwardRef((t,r)=>{const{disabled:n=!1,onSelect:s,...a}=t,c=o.useRef(null),l=ze(Pe,t.__scopeMenu),i=ct(Pe,t.__scopeMenu),m=xe(r,c),g=o.useRef(!1),d=()=>{const u=c.current;if(!n&&u){const f=new CustomEvent(wt,{bubbles:!0,cancelable:!0});u.addEventListener(wt,I=>s?.(I),{once:!0}),Sr(u,f),f.defaultPrevented?g.current=!1:l.onClose()}};return e.jsx(Zt,{...a,ref:m,disabled:n,onClick:L(t.onClick,d),onPointerDown:u=>{t.onPointerDown?.(u),g.current=!0},onPointerUp:L(t.onPointerUp,u=>{g.current||u.currentTarget?.click()}),onKeyDown:L(t.onKeyDown,u=>{const f=i.searchRef.current!=="";n||f&&u.key===" "||Xe.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});$e.displayName=Pe;var Zt=o.forwardRef((t,r)=>{const{__scopeMenu:n,disabled:s=!1,textValue:a,...c}=t,l=ct(Pe,n),i=Bt(n),m=o.useRef(null),g=xe(r,m),[d,u]=o.useState(!1),[f,I]=o.useState("");return o.useEffect(()=>{const b=m.current;b&&I((b.textContent??"").trim())},[c.children]),e.jsx(fe.ItemSlot,{scope:n,disabled:s,textValue:a??f,children:e.jsx(Cs,{asChild:!0,...i,focusable:!s,children:e.jsx(re.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...c,ref:g,onPointerMove:L(t.onPointerMove,ve(b=>{s?l.onItemLeave(b):(l.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:L(t.onPointerLeave,ve(b=>l.onItemLeave(b))),onFocus:L(t.onFocus,()=>u(!0)),onBlur:L(t.onBlur,()=>u(!1))})})})}),Ys="MenuCheckboxItem",Yt=o.forwardRef((t,r)=>{const{checked:n=!1,onCheckedChange:s,...a}=t;return e.jsx(er,{scope:t.__scopeMenu,checked:n,children:e.jsx($e,{role:"menuitemcheckbox","aria-checked":Te(n)?"mixed":n,...a,ref:r,"data-state":xt(n),onSelect:L(a.onSelect,()=>s?.(Te(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Yt.displayName=Ys;var qt="MenuRadioGroup",[qs,Js]=oe(qt,{value:void 0,onValueChange:()=>{}}),Jt=o.forwardRef((t,r)=>{const{value:n,onValueChange:s,...a}=t,c=rt(s);return e.jsx(qs,{scope:t.__scopeMenu,value:n,onValueChange:c,children:e.jsx(dt,{...a,ref:r})})});Jt.displayName=qt;var Qt="MenuRadioItem",Xt=o.forwardRef((t,r)=>{const{value:n,...s}=t,a=Js(Qt,t.__scopeMenu),c=n===a.value;return e.jsx(er,{scope:t.__scopeMenu,checked:c,children:e.jsx($e,{role:"menuitemradio","aria-checked":c,...s,ref:r,"data-state":xt(c),onSelect:L(s.onSelect,()=>a.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Xt.displayName=Qt;var ut="MenuItemIndicator",[er,Qs]=oe(ut,{checked:!1}),tr=o.forwardRef((t,r)=>{const{__scopeMenu:n,forceMount:s,...a}=t,c=Qs(ut,n);return e.jsx(Oe,{present:s||Te(c.checked)||c.checked===!0,children:e.jsx(re.span,{...a,ref:r,"data-state":xt(c.checked)})})});tr.displayName=ut;var Xs="MenuSeparator",rr=o.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t;return e.jsx(re.div,{role:"separator","aria-orientation":"horizontal",...s,ref:r})});rr.displayName=Xs;var ea="MenuArrow",nr=o.forwardRef((t,r)=>{const{__scopeMenu:n,...s}=t,a=Fe(n);return e.jsx(Kr,{...a,...s,ref:r})});nr.displayName=ea;var ta="MenuSub",[Uo,sr]=oe(ta),he="MenuSubTrigger",ar=o.forwardRef((t,r)=>{const n=ie(he,t.__scopeMenu),s=ze(he,t.__scopeMenu),a=sr(he,t.__scopeMenu),c=ct(he,t.__scopeMenu),l=o.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:m}=c,g={__scopeMenu:t.__scopeMenu},d=o.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return o.useEffect(()=>d,[d]),o.useEffect(()=>{const u=i.current;return()=>{window.clearTimeout(u),m(null)}},[i,m]),e.jsx(ot,{asChild:!0,...g,children:e.jsx(Zt,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":cr(n.open),...t,ref:nt(r,a.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:L(t.onPointerMove,ve(u=>{c.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!l.current&&(c.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:L(t.onPointerLeave,ve(u=>{d();const f=n.content?.getBoundingClientRect();if(f){const I=n.content?.dataset.side,b=I==="right",k=b?-5:5,v=f[b?"left":"right"],p=f[b?"right":"left"];c.onPointerGraceIntentChange({area:[{x:u.clientX+k,y:u.clientY},{x:v,y:f.top},{x:p,y:f.top},{x:p,y:f.bottom},{x:v,y:f.bottom}],side:I}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(u),u.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:L(t.onKeyDown,u=>{const f=c.searchRef.current!=="";t.disabled||f&&u.key===" "||Ts[s.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});ar.displayName=he;var or="MenuSubContent",ir=o.forwardRef((t,r)=>{const n=Ht(q,t.__scopeMenu),{forceMount:s=n.forceMount,...a}=t,c=ie(q,t.__scopeMenu),l=ze(q,t.__scopeMenu),i=sr(or,t.__scopeMenu),m=o.useRef(null),g=xe(r,m);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Oe,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:e.jsx(lt,{id:i.contentId,"aria-labelledby":i.triggerId,...a,ref:g,align:"start",side:l.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{l.isUsingKeyboardRef.current&&m.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:L(t.onFocusOutside,d=>{d.target!==i.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:L(t.onEscapeKeyDown,d=>{l.onClose(),d.preventDefault()}),onKeyDown:L(t.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),f=As[l.dir].includes(d.key);u&&f&&(c.onOpenChange(!1),i.trigger?.focus(),d.preventDefault())})})})})})});ir.displayName=or;function cr(t){return t?"open":"closed"}function Te(t){return t==="indeterminate"}function xt(t){return Te(t)?"indeterminate":t?"checked":"unchecked"}function ra(t){const r=document.activeElement;for(const n of t)if(n===r||(n.focus(),document.activeElement!==r))return}function na(t,r){return t.map((n,s)=>t[(r+s)%t.length])}function sa(t,r,n){const a=r.length>1&&Array.from(r).every(g=>g===r[0])?r[0]:r,c=n?t.indexOf(n):-1;let l=na(t,Math.max(c,0));a.length===1&&(l=l.filter(g=>g!==n));const m=l.find(g=>g.toLowerCase().startsWith(a.toLowerCase()));return m!==n?m:void 0}function aa(t,r){const{x:n,y:s}=t;let a=!1;for(let c=0,l=r.length-1;c<r.length;l=c++){const i=r[c],m=r[l],g=i.x,d=i.y,u=m.x,f=m.y;d>s!=f>s&&n<(u-g)*(s-d)/(f-d)+g&&(a=!a)}return a}function oa(t,r){if(!r)return!1;const n={x:t.clientX,y:t.clientY};return aa(n,r)}function ve(t){return r=>r.pointerType==="mouse"?t(r):void 0}var ia=Gt,ca=ot,la=Wt,da=Kt,ua=dt,xa=Vt,ma=$e,pa=Yt,ha=Jt,ba=Xt,ga=tr,fa=rr,va=nr,wa=ar,ka=ir,Ue="DropdownMenu",[ja]=tt(Ue,[Ut]),V=Ut(),[ya,lr]=ja(Ue),dr=t=>{const{__scopeDropdownMenu:r,children:n,dir:s,open:a,defaultOpen:c,onOpenChange:l,modal:i=!0}=t,m=V(r),g=o.useRef(null),[d,u]=yt({prop:a,defaultProp:c??!1,onChange:l,caller:Ue});return e.jsx(ya,{scope:r,triggerId:qe(),triggerRef:g,contentId:qe(),open:d,onOpenChange:u,onOpenToggle:o.useCallback(()=>u(f=>!f),[u]),modal:i,children:e.jsx(ia,{...m,open:d,onOpenChange:u,dir:s,modal:i,children:n})})};dr.displayName=Ue;var ur="DropdownMenuTrigger",xr=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...a}=t,c=lr(ur,n),l=V(n);return e.jsx(ca,{asChild:!0,...l,children:e.jsx(re.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...a,ref:nt(r,c.triggerRef),onPointerDown:L(t.onPointerDown,i=>{!s&&i.button===0&&i.ctrlKey===!1&&(c.onOpenToggle(),c.open||i.preventDefault())}),onKeyDown:L(t.onKeyDown,i=>{s||(["Enter"," "].includes(i.key)&&c.onOpenToggle(),i.key==="ArrowDown"&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});xr.displayName=ur;var za="DropdownMenuPortal",mr=t=>{const{__scopeDropdownMenu:r,...n}=t,s=V(r);return e.jsx(la,{...s,...n})};mr.displayName=za;var pr="DropdownMenuContent",hr=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=lr(pr,n),c=V(n),l=o.useRef(!1);return e.jsx(da,{id:a.contentId,"aria-labelledby":a.triggerId,...c,...s,ref:r,onCloseAutoFocus:L(t.onCloseAutoFocus,i=>{l.current||a.triggerRef.current?.focus(),l.current=!1,i.preventDefault()}),onInteractOutside:L(t.onInteractOutside,i=>{const m=i.detail.originalEvent,g=m.button===0&&m.ctrlKey===!0,d=m.button===2||g;(!a.modal||d)&&(l.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hr.displayName=pr;var Na="DropdownMenuGroup",Ca=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ua,{...a,...s,ref:r})});Ca.displayName=Na;var Sa="DropdownMenuLabel",Ia=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(xa,{...a,...s,ref:r})});Ia.displayName=Sa;var Ma="DropdownMenuItem",br=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ma,{...a,...s,ref:r})});br.displayName=Ma;var Ea="DropdownMenuCheckboxItem",Ra=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(pa,{...a,...s,ref:r})});Ra.displayName=Ea;var Da="DropdownMenuRadioGroup",_a=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ha,{...a,...s,ref:r})});_a.displayName=Da;var Pa="DropdownMenuRadioItem",Ta=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ba,{...a,...s,ref:r})});Ta.displayName=Pa;var Aa="DropdownMenuItemIndicator",La=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ga,{...a,...s,ref:r})});La.displayName=Aa;var Oa="DropdownMenuSeparator",gr=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(fa,{...a,...s,ref:r})});gr.displayName=Oa;var Fa="DropdownMenuArrow",$a=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(va,{...a,...s,ref:r})});$a.displayName=Fa;var Ua="DropdownMenuSubTrigger",Ba=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(wa,{...a,...s,ref:r})});Ba.displayName=Ua;var Ga="DropdownMenuSubContent",Ha=o.forwardRef((t,r)=>{const{__scopeDropdownMenu:n,...s}=t,a=V(n);return e.jsx(ka,{...a,...s,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ha.displayName=Ga;var Wa=dr,Ka=xr,Va=mr,Za=hr,Ya=br,qa=gr;function Ja({...t}){return e.jsx(Wa,{"data-slot":"dropdown-menu",...t})}function Qa({...t}){return e.jsx(Ka,{"data-slot":"dropdown-menu-trigger",...t})}function Xa({className:t,sideOffset:r=4,...n}){return e.jsx(Va,{children:e.jsx(Za,{"data-slot":"dropdown-menu-content",sideOffset:r,className:T("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...n})})}function Me({className:t,inset:r,variant:n="default",...s}){return e.jsx(Ya,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":n,className:T("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function eo({className:t,...r}){return e.jsx(qa,{"data-slot":"dropdown-menu-separator",className:T("bg-border -mx-1 my-1 h-px",t),...r})}function to({incident:t,onBack:r,onExport:n,onGenerateReport:s,onEdit:a,onDelete:c,canEdit:l}){if(!t)return null;const i=m=>{switch(m?.toLowerCase()){case"resolved":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"succeed":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"closed":return"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700";case"open":return"bg-blue-500/15 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"pending":return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800";default:return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800"}};return e.jsx("div",{className:"px-3 md:px-5 py-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:r,className:"mt-0.5 p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all active:scale-95 lg:hidden shrink-0",children:e.jsx(en,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(we,{size:10}),t.ticket||"NO-TICKET"]}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-600",children:"•"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(et,{size:10}),t.createdAt?Mt(new Date(t.createdAt),"dd MMM yy"):"-"]})]}),e.jsx("h1",{className:"text-base md:text-lg font-black text-zinc-900 dark:text-zinc-100 leading-tight truncate",children:t.subject}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 flex-wrap",children:[e.jsx(Re,{variant:"outline",className:T("rounded-md border text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5",i(t.status)),children:t.status}),e.jsx(Re,{variant:"outline",className:"rounded-md border-zinc-200 dark:border-zinc-700 text-[9px] font-bold text-zinc-500 bg-zinc-50 dark:bg-zinc-900 px-1.5 py-0.5",children:t.type}),t.project&&e.jsx(Re,{variant:"secondary",className:"rounded-md text-[9px] font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5",children:t.project})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[e.jsx(me,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Export CSV",children:e.jsx(De,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8 text-zinc-400 hover:text-indigo-500",title:"Generate Report",children:e.jsx(Ze,{size:14})}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-800 mx-0.5"}),e.jsx(me,{variant:"ghost",size:"icon",onClick:a,className:"h-8 w-8 text-zinc-400 hover:text-zinc-900 dark:hover:text-white",title:"Edit Details",children:e.jsx(de,{size:14})}),e.jsx(me,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 text-zinc-400 hover:text-red-600",title:"Delete Case",children:e.jsx(ae,{size:14})})]})]}),e.jsxs(Ja,{children:[e.jsx(Qa,{asChild:!0,className:"md:hidden",children:e.jsx(me,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-400",children:e.jsx(mn,{size:16})})}),e.jsxs(Xa,{align:"end",className:"w-44",children:[e.jsxs(Me,{onClick:n,className:"gap-2",children:[e.jsx(De,{size:14}),"Export CSV"]}),e.jsxs(Me,{onClick:s,className:"gap-2",children:[e.jsx(Ze,{size:14}),"Generate Report"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx(eo,{}),e.jsxs(Me,{onClick:a,className:"gap-2",children:[e.jsx(de,{size:14}),"Edit Details"]}),e.jsxs(Me,{onClick:c,className:"gap-2 text-red-600 focus:text-red-600",children:[e.jsx(ae,{size:14}),"Delete Case"]})]})]})]})]})]})})}function ro({incident:t,isLoading:r,onUpdateIncident:n,onAddEvent:s,onDeleteEvent:a,onUpdateEvent:c,onReorderEvent:l,onDeleteIncident:i,onBack:m,canEdit:g}){const{currentUser:d}=zt(),u=o.useRef(null),f=o.useRef(null),[I,b]=o.useState(!1),[k,v]=o.useState(!1),[p,z]=o.useState(null),[M,w]=o.useState(!1),[N,U]=o.useState(""),A=o.useMemo(()=>t?.events?[...t.events].sort((x,S)=>{if(typeof x.order=="number"&&typeof S.order=="number"&&x.order!==S.order)return x.order-S.order;const _=`${x.date||"1970-01-01"}T${x.time||"00:00"}`,h=`${S.date||"1970-01-01"}T${S.time||"00:00"}`;return _<h?1:_>h?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-6 shadow-xl shadow-zinc-200/50 dark:shadow-zinc-950/50",children:e.jsx(le,{size:32,className:"text-zinc-300 dark:text-zinc-600"})}),e.jsx("p",{className:"font-bold text-zinc-400 dark:text-zinc-600 uppercase tracking-widest text-xs text-center",children:"Select an incident to view details"})]})]});const O=(x,S)=>{const _=[...A],h=S==="up"?x-1:x+1;if(h<0||h>=_.length)return;[_[x],_[h]]=[_[h],_[x]];const j=_.map((P,E)=>({...P,order:E}));l&&l(t.id,j)},F=x=>{const S=typeof d=="object"?d?.name:d;n(t.id,{...x,updatedBy:S})},D=async()=>{if(t)try{const x=$=>{if($==null)return"";const y=String($);return y.includes(",")||y.includes(`
`)||y.includes('"')?`"${y.replace(/"/g,'""')}"`:y},S=[...t.events||[]].sort(($,y)=>{const Z=`${$.date||"1970-01-01"}T${$.time||"00:00"}`,Y=`${y.date||"1970-01-01"}T${y.time||"00:00"}`;return Z<Y?-1:Z>Y?1:0}),_=[`Incident,${x(t.subject)}`,`Project,${x(t.project)}`,`Ticket ID,${x(t.ticket)}`,`Current Status,${x(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],h=["Date","Time","Status","Description","Images"].join(","),j=S.map($=>{const y=$.date?new Date($.date).toLocaleDateString("en-GB"):"-",Z=$.time||"-",Y=x($.statusOnLine||""),ce=x($.desc||$.title||""),X=x(($.imageUrls||[]).join(" ; "));return[y,Z,Y,ce,X].join(",")}),P="\uFEFF"+[..._,h,...j].join(`
`),E=new Blob([P],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(E),W=document.createElement("a");W.href=C,W.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(C)}catch(x){console.error("Export failed:",x),alert("Failed to export CSV. Please check console.")}},B=()=>{if(!t)return;let x=`[INCIDENT REPORT]
`;x+=`Project : ${t.project||"-"}
`,x+=`Ticket  : ${t.ticket||"-"}
`,x+=`Subject : ${t.subject||"-"}
`,x+=`Status  : ${t.status||"-"}

`,x+=`[DETAILS]
`,x+=`Impact     : ${t.impact||"-"}
`,x+=`Root Cause : ${t.root_cause||"-"}
`,x+=`Action     : ${t.action||"-"}

`,x+=`[TIMELINE]
`;const S=[...t.events||[]].sort((h,j)=>{const P=`${h.date||"1970-01-01"}T${h.time||"00:00"}`,E=`${j.date||"1970-01-01"}T${j.time||"00:00"}`;return P<E?-1:P>E?1:0});let _="";S.forEach(h=>{h.date!==_&&(x+=`
--- ${h.date?new Date(h.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,_=h.date);const j=h.time||"--:--",P=h.statusOnLine?` [${h.statusOnLine}]`:"";x+=`${j}${P} - ${h.desc||h.title}
`}),U(x),w(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 z-20 bg-white dark:bg-[#0e0e11] border-b border-zinc-100 dark:border-zinc-800 relative shadow-sm",children:e.jsx(to,{incident:t,onUpdate:F,onBack:m,onDelete:()=>i(t.id),onEdit:()=>v(!0),onGenerateReport:B,onExport:D,canEdit:g})}),e.jsx("div",{ref:f,className:"flex-1 overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar bg-zinc-50/50 dark:bg-[#09090b] relative min-h-0",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsxs("div",{className:"w-32 h-32 bg-zinc-100 dark:bg-zinc-900 rounded-full flex items-center justify-center mb-6 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-zinc-200 dark:border-zinc-800 animate-spin-slow",style:{animationDuration:"20s"}}),e.jsx(tn,{size:48,className:"text-zinc-300 dark:text-zinc-600 opacity-80",strokeWidth:1})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-1",children:"No Timeline Events"}),e.jsx("p",{className:"text-xs text-zinc-400 max-w-xs text-center mb-8",children:"This case has no operational records yet. Start by adding your first update."}),g&&e.jsxs("button",{onClick:()=>{z(null),b(!0)},className:"flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl text-xs font-bold uppercase tracking-wider shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all",children:[e.jsx(be,{size:16}),"Initialize Log"]})]}):e.jsxs("div",{className:"flex flex-col pb-36 relative max-w-4xl mx-auto min-h-full",children:[A.map((x,S)=>{const _=S===0||x.date!==A[S-1].date;let h="-";try{h=x.date?new Date(x.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{h="-"}return e.jsx(is,{event:x,index:S,isLastItem:S===A.length-1,showDateHeader:_,dateLabel:h,onMove:O,onEdit:j=>{z(j),b(!0)},onDelete:j=>a(t.id,j),canEdit:g},x.id)}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"absolute bottom-8 right-8 flex flex-col gap-4 z-40 items-end",children:g&&A.length>0&&!r&&e.jsx("button",{onClick:()=>{z(null),b(!0)},className:"w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl shadow-xl shadow-indigo-600/30 hover:scale-105 hover:rotate-90 transition-all duration-300 z-30 flex items-center justify-center active:scale-90",title:"Add Update",children:e.jsx(be,{size:28,strokeWidth:3})})}),e.jsx(ds,{isOpen:I,onClose:()=>b(!1),initialData:p,onDelete:x=>a(t.id,x),onSubmit:x=>{const S=typeof d=="object"?d?.name:d,_={...x};p?(_.updatedBy=S,c(t.id,p.id,_)):(_.createdBy=S,s(t.id,_)),b(!1)}}),e.jsx(us,{isOpen:M,onClose:()=>w(!1),text:N,incident:t}),e.jsx(ms,{isOpen:k,onClose:()=>v(!1),incident:t,onUpdate:F,onDelete:()=>i(t.id),onExport:D})]})}const no=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},so=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-blue-500 bg-blue-50/50 dark:bg-blue-500/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},Ke=o.memo(({label:t,value:r,icon:n,colorClass:s})=>{const a=n;return e.jsxs("div",{className:"flex-1 p-4 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:T("p-1.5 rounded-lg shrink-0",s),children:e.jsx(a,{size:12})}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})}),Ve=o.memo(({title:t,icon:r,children:n,accentColor:s="text-zinc-400"})=>{const a=r;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase text-zinc-400 flex items-center gap-2 tracking-[0.3em] px-1",children:[e.jsx(a,{size:12,className:s})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-[2rem] shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:n})]})]})});function ao({log:t,onAddToIncident:r,onClose:n}){if(!t)return null;const s=t.createdAt?Mt(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsxs(Le,{isOpen:!0,onClose:n,size:"lg",bodyClassName:"p-8 space-y-10",className:"max-h-[90vh]",header:e.jsx("div",{className:"w-full flex justify-between items-start",children:e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-lg",children:e.jsx(we,{size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500 uppercase tracking-[0.3em]",children:"Operational Log"}),e.jsx("h2",{className:"text-3xl font-black text-zinc-900 dark:text-white tracking-tighter leading-none",children:t.ticketNumber})]})]}),e.jsx("button",{onClick:n,className:"w-10 h-10 flex items-center justify-center rounded-full bg-zinc-50 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all active:scale-90",children:e.jsx(ne,{size:20})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(et,{size:12})," ",s]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(ge,{size:12})," ",t.type]}),e.jsx("div",{className:T("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-widest",no(t.status)),children:t.status})]})]})}),footer:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-16 bg-zinc-950 dark:bg-white text-white dark:text-black rounded-[1.5rem] text-[12px] font-black uppercase tracking-[0.3em] flex items-center justify-center gap-3 shadow-2xl transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Et,{size:18,className:"fill-current group-hover:animate-pulse"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[10px] font-bold text-zinc-400 uppercase tracking-widest opacity-60",children:"System will reconcile this log into a global incident archive."})]}),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(Ke,{label:"Severity",value:t.severity||"Low",icon:Ae,colorClass:so(t.severity)}),e.jsx(Ke,{label:"Hierarchy",value:t.category||"N/A",icon:Ye,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(Ke,{label:"Sub-Class",value:t.subCategory||"N/A",icon:nn,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(Ve,{title:"Record Description",icon:rn,accentColor:"text-blue-500",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ve,{title:"Action Deployed",icon:le,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200 italic",children:t.action||"No defensive actions recorded."})}),e.jsx(Ve,{title:"Resolution Status",icon:ge,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-white dark:bg-zinc-900/50 rounded-[2.5rem] border border-zinc-100 dark:border-zinc-900 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-lg font-black shadow-lg shadow-black/10 transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(Mr,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-[0.3em]",children:"Lead Engineer"}),e.jsxs("p",{className:"text-base font-black text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-zinc-300 group-hover:text-blue-500 transition-colors",children:[e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Profile Archive"}),e.jsx(sn,{size:14})]})]})]})}const oo=o.memo(({label:t,value:r,variant:n})=>{const s={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${s[n]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:r}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});oo.displayName="StatBox";const io=o.memo(({item:t,type:r})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${r==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticket]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.subject})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${r==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:r==="new"?"New":"Update"})]}));io.displayName="PreviewRow";function Bo(){const{currentUser:t}=zt(),r=Er(t,[mt.LEAD,mt.ENGINEER]),{toast:n}=Rr(),[s,a]=o.useState("incidents"),{incidents:c,filteredIncidents:l,selectedId:i,setSelectedId:m,loading:g,error:d,stats:u,searchTerm:f,setSearchTerm:I,filterStatus:b,setFilterStatus:k,filterType:v,setFilterType:p,clearFilters:z,hasActiveFilters:M}=$n(),{sortedEvents:w,loading:N}=Un(i),{logs:U,loading:A,stats:O}=Dr(),[F,D]=o.useState(null),[B,x]=o.useState({isOpen:!1}),[S,_]=o.useState(!1),[h,j]=o.useState(!1),P=c.find(R=>R.id===i),E=o.useCallback((R,G="success")=>{n({description:R,variant:G==="error"?"destructive":"default"})},[n]),C=async()=>{j(!0);try{const R=typeof t=="object"?t:{name:"Admin"},G=await J.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:R,impact:"",root_cause:"",action:""});a("incidents"),m(G),E("Case created successfully")}catch(R){console.error(R),E("Failed to create incident","error")}finally{j(!1)}},W=async R=>{if(R){j(!0);try{const G=typeof t=="object"?t:{name:"System"},te={subject:R.shortDesc||R.details||`Ticket #${R.ticketNumber}`,ticket:R.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(R.type)?R.type:"Incident",status:"Open",priority:R.severity||"Medium",createdBy:G,impact:"",root_cause:R.details||"",action:R.action||""},Ne=await J.createIncident(te,R.ticketNumber);E(`Ticket #${R.ticketNumber} promoted to Case`),a("incidents"),m(Ne)}catch(G){console.error(G),E("Failed to promote ticket","error")}finally{j(!1)}}},$=R=>{x({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await J.deleteIncident(R),i===R&&m(null),x({isOpen:!1}),E("Case deleted")}catch(G){console.error(G),E("Failed to delete","error")}}})},y=async R=>{if(!R||R.length===0){E("No data to export","error");return}E("Preparing export...","info");try{const G="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",te=R.map(async ee=>{const Be=`"${ft(ee.createdAt)}","${pe(ee.project)}","${pe(ee.ticket)}","${pe(ee.type)}","${ee.status}","${pe(ee.subject)}","${ee.createdBy?.name||ee.createdBy||""}"`;try{const Ge=await J.getEvents(ee.id);return Ge.length>0?Ge.map(Ce=>{const vr=ft(Ce.date),wr=pe(Ce.desc||Ce.title);return`${Be},"${vr}","${Ce.time||"-"}","${wr}"`}).join(`
`)+`
,,,,,,,,,`:`${Be},"-","-","-"
,,,,,,,,,`}catch{return`${Be},"Error fetching events","-","-"
,,,,,,,,,`}}),Ne=await Promise.all(te),fr=[G,...Ne].join(`
`);Bn(fr,`CaseExport_${new Date().toISOString().split("T")[0]}`),E("Export completed")}catch(G){console.error(G),E("Failed to export data","error")}},Z=async(R,G)=>{try{await J.updateIncident(R,G),E("Incident updated")}catch{E("Update failed","error")}},Y=async(R,G)=>{try{await J.createEvent(R,G),E("Timeline updated")}catch{E("Failed to add event","error")}},ce=async(R,G,te)=>{try{await J.updateEvent(R,G,te),E("Event updated")}catch{E("Failed to update event","error")}},X=async(R,G)=>J.reorderEvents(R,G),K=async(R,G)=>{x({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await J.deleteEvent(R,G),E("Event removed")}catch{E("Failed to remove event","error")}finally{x({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx(kt,{isOpen:B.isOpen,onClose:()=>x({isOpen:!1}),...B}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${i||F?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(Yn,{filteredIncidents:l,stats:u,loading:g,error:d,logs:U,logsLoading:A,logStats:O,selectedId:i,selectedLogId:F?.ticketNumber,onSelect:R=>{a("incidents"),m(R)},onSelectLog:D,onAddIncident:C,onDeleteIncident:$,onExportCSV:y,viewMode:s,onViewModeChange:R=>{a(R),R==="incidents"&&D(null),R==="logs"&&m(null)},searchTerm:f,setSearchTerm:I,filterStatus:b,setFilterStatus:k,filterType:v,setFilterType:p,clearFilters:z,hasActiveFilters:M,canEdit:r})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${i||F?"flex w-full":"hidden lg:flex"}
      `,children:s==="incidents"&&i?e.jsx(ro,{incident:P?{...P,events:w}:null,isLoading:N,onBack:()=>m(null),onUpdateIncident:Z,onAddEvent:Y,onUpdateEvent:ce,onDeleteEvent:K,onDeleteIncident:$,onReorderEvent:X,saving:h,canEdit:r}):s==="logs"&&F?e.jsx(ao,{log:F,onAddToIncident:W,onClose:()=>D(null),canEdit:r}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-24 h-24 bg-zinc-100 dark:bg-zinc-900 rounded-3xl flex items-center justify-center mb-6 shadow-inner",children:e.jsx(In,{size:48,strokeWidth:1,className:"text-zinc-400 dark:text-zinc-500 opacity-50"})}),e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-2 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{Bo as default};
