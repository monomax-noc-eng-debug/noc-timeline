import{d as W,b as X,r as x,j as e,F as Y,y,C as J,R as $,L as H,X as Z,g as O,f as I,p as ee,w as te}from"./index-BFEWtwhJ.js";import{C as se}from"./formatters-DpnTxRTe.js";import{D as _}from"./database-4IflcLbJ.js";import{C as D,a as ae}from"./sliders-horizontal-iwKFpgUC.js";import{A as re}from"./arrow-right-Br0XfVuf.js";import{S as ne}from"./save-CToUh0ov.js";import{C as ie}from"./cloud-download-DowHwPwg.js";import{L as le}from"./layers-qYC9K1Me.js";import"./format-DU8rxv2E.js";import"./addYears-C7ezsmVv.js";import"./setYear-BV4xPqlg.js";import"./chevron-right-DVovX0bV.js";import"./chevron-down-qX9YY_vo.js";import"./TimeInput-BnbwFigf.js";import"./configService-D_rl3Y87.js";import"./rotate-ccw-DgI1qe1m.js";const ce=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 13V7",key:"h0r20n"}],["path",{d:"M9 17h6",key:"r8uit2"}]],de=W("file-diff",ce),B="https://script.google.com/macros/s/AKfycbx5ngxY4YuUCQsyGjjudXuuTX5bWU-yZIT-osINDoKQJpO3Jjgs8Yp6hV0GoGUdL0ni/exec",M=x.memo(({label:r,value:n,colorClass:v,icon:b})=>{const m=b;return e.jsxs("div",{className:y("flex-1 p-4 rounded-lg border transition-all hover:-translate-y-1 bg-white dark:bg-zinc-900",v),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-current opacity-20",children:e.jsx(m,{size:12,className:"opacity-100"})}),e.jsx("span",{className:"text-xl font-black tabular-nums tracking-tighter",children:n})]}),e.jsx("p",{className:"text-[8px] font-medium opacity-60",children:r})]})}),U=x.memo(({item:r,type:n})=>e.jsxs("div",{className:"group px-5 py-3.5 bg-white dark:bg-transparent flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-white/[0.02] transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[e.jsx("div",{className:y("w-1.5 h-8 rounded-full shrink-0 transition-transform group-hover:scale-y-110",n==="new"?"bg-emerald-400":"bg-amber-400")}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("h4",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 tracking-tight truncate max-w-[200px]",children:r.match}),r.isMerged&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-[#0078D4]/10 text-[#0078D4] text-[6px] font-semibolder border border-[#0078D4]/20",children:[e.jsx(le,{size:8})," Merged"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1",children:[e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest",children:r.league||"Event"}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-zinc-200 dark:bg-zinc-800"}),e.jsx("span",{className:"text-[9px] font-mono font-bold text-zinc-500",children:r.time}),r.channel&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-zinc-200 dark:bg-zinc-800"}),e.jsx("span",{className:"text-[9px] font-bold text-[#0078D4] uppercase truncate max-w-[120px]",children:r.channel})]})]})]})]}),e.jsx("div",{className:y("shrink-0 px-2.5 py-1 rounded-full text-[8px] font-medium border transition-colors",n==="new"?"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20":"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20"),children:n==="new"?"Add":"Edit"})]}));function Se({isOpen:r,onClose:n,onSyncComplete:v}){const{currentUser:b}=X(),[m,P]=x.useState("daily"),[A,V]=x.useState(new Date().toISOString().split("T")[0]),[R,q]=x.useState(new Date().toISOString().slice(0,7)),[h,p]=x.useState("input"),[a,E]=x.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[T,w]=x.useState(null),F=()=>{p("input"),E({newItems:[],updatedItems:[],uptodateItems:[]}),w(null)},K=async()=>{p("analyzing"),w(null);const s=m==="daily"?A:R;try{const u=await fetch(`${B}?date=${s}`,{method:"GET",mode:"cors"});if(!u.ok)throw new Error(`Fetch Failed: ${u.statusText}`);const k=await u.json(),f=Array.isArray(k)?k:k.data||[];if(f.length===0)throw new Error("No operational records found for this period.");const c=new Map;f.forEach(t=>{const i=t.match||t.title||"",j=t.time||t.startTime||"",d=t.startDate||"",G=i.toLowerCase().replace(/\s/g,""),C=`${d}|${j}|${G}`;if(c.has(C)){const l=c.get(C),o=t.channel||"";l.isMerged=!0,o&&!l.channel.includes(o)&&(l.channel=l.channel?`${l.channel}, ${o}`:o)}else{let l=i,o="";if(i.includes(" vs ")){const z=i.split(" vs ");l=z[0].trim(),o=z[1]?.trim()||""}else if(i.includes(" - ")){const z=i.split(" - ");l=z[0].trim(),o=z[1]?.trim()||""}c.set(C,{id:t.id?.toString(),time:j,league:t.league||t.calendar||"",match:i,teamA:l,teamB:o,channel:t.channel||"",startDate:d,isMerged:!1})}});const N=Array.from(c.values()).filter(t=>t.id),S=[],g=[],L=[];await Promise.all(N.map(async t=>{const i=O(I,"schedules",t.id),j=await ee(i);if(!j.exists())S.push(t);else{const d=j.data();d.startTime!==t.time||d.title!==t.match||d.channel!==t.channel||d.startDate!==t.startDate?g.push({...t,_prev:d}):L.push(t)}})),E({newItems:S,updatedItems:g,uptodateItems:L}),p("review")}catch(u){w(u.message),p("input")}},Q=async()=>{p("saving");try{const s=te(I),u=[...a.newItems,...a.updatedItems],f=(typeof b=="object"?b?.name:b)||"System Sync";u.forEach(c=>{const N=O(I,"schedules",c.id),{_prev:S,...g}=c;s.set(N,{...g,title:g.match,startTime:g.time,updatedAt:new Date().toISOString(),updatedBy:f,...c._prev?{}:{hasStartStat:!1,hasEndStat:!1,createdAt:new Date().toISOString(),createdBy:f}},{merge:!0})}),await s.commit(),v&&v(),p("success"),setTimeout(()=>{n(),F()},2e3)}catch(s){w("Commit Failed: "+s.message),p("review")}};return r?e.jsxs(Y,{isOpen:r,onClose:n,size:"2xl",showCloseButton:!1,headerClassName:"px-8 py-6 border-b border-zinc-50 dark:border-zinc-900 flex justify-between items-center bg-white dark:bg-[#0a0a0a]",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg flex items-center justify-center shadow-lg",children:e.jsx(ie,{size:22})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-zinc-900 dark:text-zinc-100",children:"Sync Portal"}),e.jsx("p",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:"Global Record Synchronization"})]})]}),e.jsx("button",{onClick:n,className:"w-10 h-10 flex items-center justify-center text-zinc-400 hover:text-zinc-900 dark:hover:text-white bg-zinc-50 dark:bg-zinc-900 rounded-full transition-all active:scale-90",children:e.jsx(Z,{size:20})})]}),bodyClassName:"flex-1 overflow-y-auto custom-scrollbar p-8 bg-[#fdfdfd] dark:bg-[#050505]",footerClassName:"shrink-0 p-8 border-t border-zinc-50 dark:border-zinc-900 flex flex-col sm:flex-row justify-between items-center gap-6 bg-white dark:bg-[#0a0a0a]",footer:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-zinc-100 dark:border-zinc-800 flex items-center justify-center text-zinc-300",children:e.jsx(_,{size:14})}),e.jsxs("div",{className:"hidden xs:block",children:[e.jsx("p",{className:"text-[8px] font-semibold text-zinc-400 tracking-widest",children:"Active System"}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-800 dark:text-zinc-200",children:"Firebase Edge v4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[h==="input"&&e.jsxs("button",{onClick:K,className:"flex-1 sm:flex-none h-14 px-10 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg font-semibold text-[11px]  shadow-2xl hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3 group overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),"Analyze ",e.jsx(re,{size:14,className:"group-hover:translate-x-1 transition-transform"})]}),h==="review"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:F,className:"h-14 px-8 rounded-lg font-semibold text-[10px] tracking-widest text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-all flex items-center gap-2",children:[e.jsx(ae,{size:16})," Back"]}),e.jsxs("button",{onClick:Q,disabled:a.newItems.length===0&&a.updatedItems.length===0,className:"flex-1 sm:flex-none h-14 px-10 bg-[#0078D4] text-white rounded-lg font-semibold text-[11px]  shadow-lg hover:scale-105 active:scale-95 transition-all disabled:opacity-30 disabled:scale-100 flex items-center justify-center gap-3",children:[e.jsx(ne,{size:14})," Commit"]})]}),h==="saving"&&e.jsxs("div",{className:"h-14 px-10 flex items-center gap-4 text-[10px] font-semibold text-zinc-400 bg-zinc-50 dark:bg-zinc-900 rounded-lg",children:[e.jsx(H,{size:16,className:"animate-spin"})," Recording Data"]})]})]}),children:[h==="input"&&e.jsxs("div",{className:"space-y-10 animate-in fade-in slide-in-from-left-4 duration-500",children:[e.jsx("div",{className:"bg-zinc-50 dark:bg-zinc-900/50 p-1.5 rounded-lg border border-zinc-100 dark:border-zinc-800 flex items-center",children:["daily","monthly"].map(s=>e.jsxs("button",{onClick:()=>P(s),className:y("flex-1 h-11 rounded-lg text-[10px] font-medium transition-all",m===s?"bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-sm ring-1 ring-zinc-200/50 dark:ring-zinc-700":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300"),children:[s," Range"]},s))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:"Temporal Target"}),e.jsx(se,{size:12,className:"text-zinc-300"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:m==="daily"?"date":"month",value:m==="daily"?A:R,onChange:s=>m==="daily"?V(s.target.value):q(s.target.value),className:"w-full h-16 px-6 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-lg font-mono font-black text-lg text-zinc-900 dark:text-zinc-100 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4]/50 transition-all placeholder:text-zinc-300"}),e.jsx("div",{className:"absolute inset-0 rounded-lg ring-1 ring-inset ring-transparent group-hover:ring-zinc-200 dark:group-hover:ring-zinc-700 pointer-events-none transition-all"})]}),e.jsx("p",{className:"text-[10px] text-zinc-400 font-medium px-1 italic",children:"Selecting a range outside the current cycle may require longer processing time."})]}),T&&e.jsxs("div",{className:"p-5 bg-rose-50 dark:bg-rose-500/10 text-rose-600 dark:text-rose-400 text-[10px] font-black rounded-lg flex items-center gap-4 border border-rose-100 dark:border-rose-500/20 animate-shake",children:[e.jsx("div",{className:"p-2 bg-rose-200/30 dark:bg-rose-500/20 rounded-lg",children:e.jsx(J,{size:14})}),e.jsx("span",{className:"uppercase tracking-tight leading-relaxed",children:T})]})]}),h==="analyzing"&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-center space-y-8 animate-in zoom-in-95 duration-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 blur-3xl bg-[#0078D4]/20 animate-pulse scale-150"}),e.jsx("div",{className:"w-20 h-20 rounded-lg border-4 border-zinc-100 dark:border-zinc-900 flex items-center justify-center bg-white dark:bg-zinc-950 relative",children:e.jsx($,{size:32,className:"animate-spin text-zinc-900 dark:text-white",strokeWidth:2.5})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-zinc-900 dark:text-zinc-100",children:"Analyzing Stream"}),e.jsx("p",{className:"text-[10px] text-zinc-400 font-bold uppercase tracking-widest",children:"Validating Schema Reconciliation"})]})]}),h==="review"&&e.jsxs("div",{className:"space-y-10 animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(M,{label:"Inbound",value:a.newItems.length,icon:_,colorClass:"text-emerald-500 border-emerald-100 dark:border-emerald-900/40 shadow-sm"}),e.jsx(M,{label:"Mutation",value:a.updatedItems.length,icon:$,colorClass:"text-amber-500 border-amber-100 dark:border-amber-900/40 shadow-sm"}),e.jsx(M,{label:"Stable",value:a.uptodateItems.length,icon:D,colorClass:"text-zinc-400 border-zinc-100 dark:border-zinc-800"})]}),a.newItems.length>0||a.updatedItems.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("h4",{className:"text-[10px] font-semibold text-zinc-400 flex items-center gap-2",children:[e.jsx(de,{size:12})," Staging Queue"]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-zinc-100 dark:bg-zinc-900 text-[8px] font-black text-zinc-500 uppercase",children:[a.newItems.length+a.updatedItems.length," Changes Detected"]})]}),e.jsx("div",{className:"bg-white dark:bg-[#0c0c0c] border border-zinc-100 dark:border-zinc-900 rounded-lg overflow-hidden shadow-2xl shadow-zinc-200/20 dark:shadow-none",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-50 dark:divide-zinc-900/50",children:[a.newItems.map(s=>e.jsx(U,{item:s,type:"new"},s.id)),a.updatedItems.map(s=>e.jsx(U,{item:s,type:"update"},s.id))]})})]}):e.jsxs("div",{className:"py-20 text-center border-2 border-dashed border-zinc-100 dark:border-zinc-900 rounded-lg bg-zinc-50/40 dark:bg-zinc-900/20 group hover:border-zinc-300 transition-colors",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg flex items-center justify-center text-emerald-500 group-hover:scale-110 transition-transform",children:e.jsx(D,{size:32})}),e.jsx("h3",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Dataset Harmonized"}),e.jsx("p",{className:"text-[10px] font-bold uppercase  text-zinc-400 mt-2",children:"Remote source matches local system"})]})]}),h==="success"&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-700",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500 blur-3xl opacity-30 animate-pulse scale-150"}),e.jsxs("div",{className:"w-24 h-24 bg-zinc-950 dark:bg-white rounded-lg flex items-center justify-center text-white dark:text-black shadow-2xl relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500 translate-y-full group-hover:translate-y-0 transition-transform duration-500"}),e.jsx(D,{size:40,className:"relative z-10",strokeWidth:2.5})]})]}),e.jsx("h3",{className:"text-2xl font-semibold text-zinc-900 dark:text-white",children:"Sync Sequence Complete"}),e.jsx("p",{className:"text-[10px] font-black text-zinc-400 mt-3 uppercase ",children:"Operational archives updated successfully"})]})]}):null}export{Se as default};
