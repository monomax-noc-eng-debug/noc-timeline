import{c as Se,k as ct,f as Ge,l as Ve,r as v,a as Ye,j as e,X as ye,L as Ne,b as de,F as ot,T as Ze,h as lt,u as dt,C as ut,g as Me,e as ht,A as xt}from"./index-B5gZUy_b.js";import{t as ke,u as Je,U as Xe,a as pt}from"./useTicketOptions-CjlqhcHA.js";import{u as mt}from"./useConfigs-DkTlm5wr.js";import{c as ft}from"./configService-Bpcp19QX.js";import{p as _e}from"./parse-B7oZ5ZXB.js";import{i as Ce,f as xe}from"./format-B568ns5f.js";import{a as et}from"./addYears-Ds2_z7Vb.js";import{i as bt}from"./incidentService-DcJgIx8b.js";import{C as Ee}from"./cloud-download-B-eN11rg.js";import{C as gt}from"./circle-alert-CaNzur3n.js";import{R as Fe,D as kt}from"./refresh-cw-ND0mNJLp.js";import{C as Te}from"./circle-check-DyaCxfhJ.js";import{A as yt}from"./arrow-right-BDuAE9MA.js";import{u as vt}from"./useTeam-CEyFYT0q.js";import{T as zt}from"./tag-BiwUdZ_o.js";import{P as jt}from"./panels-top-left-ADktj7f5.js";import{S as wt}from"./save-DSxoUrLg.js";import{Z as tt}from"./zap-DOh-sc34.js";import{T as rt}from"./trash-2-BnvYA_d1.js";import{P as Nt}from"./plus-BnYRYgUJ.js";import{S as _t}from"./search-C_CHO80W.js";import{S as Pe}from"./sliders-horizontal-CooVqGG4.js";import{G as Ct}from"./globe-e-JqAXjx.js";import"./useBaseQuery-Bu4CR-PA.js";import"./firebaseConfig-hLvP2kJq.js";import"./addMonths-C-BMKM1V.js";const St=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],Dt=Se("circle-arrow-down",St);const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Tt=Se("info",Et);const At=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Rt=Se("shield-alert",At);const Ot=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Oe=Se("square-pen",Ot);var ve={exports:{}};var Lt=ve.exports,Ue;function It(){return Ue||(Ue=1,(function(a,l){((x,i)=>{a.exports=i()})(Lt,function x(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},T,D=!i.document&&!!i.postMessage,u=i.IS_PAPA_WORKER||!1,m={},R=0,o={};function K(r){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var s=ie(t);s.chunkSize=parseInt(s.chunkSize),t.step||t.chunk||(s.chunkSize=null),this._handle=new ee(s),(this._handle.streamer=this)._config=s}).call(this,r),this.parseChunk=function(t,s){var n=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<n){let k=this._config.newline;k||(c=this._config.quoteChar||'"',k=this._handle.guessLineEndings(t,c)),t=[...t.split(k).slice(n)].join(k)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&(c=this._config.beforeFirstChunk(t))!==void 0&&(t=c),this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+t,c=(this._partialLine="",this._handle.parse(n,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=c.meta.cursor,n=(this._finished||(this._partialLine=n.substring(t-this._baseIndex),this._baseIndex=t),c&&c.data&&(this._rowCount+=c.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),u)i.postMessage({results:c,workerId:o.WORKER_ID,finished:n});else if(E(this._config.chunk)&&!s){if(this._config.chunk(c,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=c=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(c.data),this._completeResults.errors=this._completeResults.errors.concat(c.errors),this._completeResults.meta=c.meta),this._completed||!n||!E(this._config.complete)||c&&c.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),n||c&&c.meta.paused||this._nextChunk(),c}this._halted=!0},this._sendError=function(t){E(this._config.error)?this._config.error(t):u&&this._config.error&&i.postMessage({workerId:o.WORKER_ID,error:t,finished:!1})}}function A(r){var t;(r=r||{}).chunkSize||(r.chunkSize=o.RemoteChunkSize),K.call(this,r),this._nextChunk=D?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(s){this._input=s,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),D||(t.onload=J(this._chunkLoaded,this),t.onerror=J(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!D),this._config.downloadRequestHeaders){var s,n=this._config.downloadRequestHeaders;for(s in n)t.setRequestHeader(s,n[s])}var c;this._config.chunkSize&&(c=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+c));try{t.send(this._config.downloadRequestBody)}catch(k){this._chunkError(k.message)}D&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(s=>(s=s.getResponseHeader("Content-Range"))!==null?parseInt(s.substring(s.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(s){s=t.statusText||s,this._sendError(new Error(s))}}function re(r){(r=r||{}).chunkSize||(r.chunkSize=o.LocalChunkSize),K.call(this,r);var t,s,n=typeof FileReader<"u";this.stream=function(c){this._input=c,s=c.slice||c.webkitSlice||c.mozSlice,n?((t=new FileReader).onload=J(this._chunkLoaded,this),t.onerror=J(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var c=this._input,k=(this._config.chunkSize&&(k=Math.min(this._start+this._config.chunkSize,this._input.size),c=s.call(c,this._start,k)),t.readAsText(c,this._config.encoding));n||this._chunkLoaded({target:{result:k}})},this._chunkLoaded=function(c){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(c.target.result)},this._chunkError=function(){this._sendError(t.error)}}function F(r){var t;K.call(this,r=r||{}),this.stream=function(s){return t=s,this._nextChunk()},this._nextChunk=function(){var s,n;if(!this._finished)return s=this._config.chunkSize,t=s?(n=t.substring(0,s),t.substring(s)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function f(r){K.call(this,r=r||{});var t=[],s=!0,n=!1;this.pause=function(){K.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){K.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(c){this._input=c,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):s=!0},this._streamData=J(function(c){try{t.push(typeof c=="string"?c:c.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(k){this._streamError(k)}},this),this._streamError=J(function(c){this._streamCleanUp(),this._sendError(c)},this),this._streamEnd=J(function(){this._streamCleanUp(),n=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ee(r){var t,s,n,c,k=Math.pow(2,53),P=-k,se=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Y=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,w=this,L=0,p=0,G=!1,y=!1,N=[],d={data:[],errors:[],meta:{}};function q(b){return r.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function B(){if(d&&n&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),n=!1),r.skipEmptyLines&&(d.data=d.data.filter(function(g){return!q(g)})),Q()){let g=function($,V){E(r.transformHeader)&&($=r.transformHeader($,V)),N.push($)};if(d)if(Array.isArray(d.data[0])){for(var b=0;Q()&&b<d.data.length;b++)d.data[b].forEach(g);d.data.splice(0,1)}else d.data.forEach(g)}function _(g,$){for(var V=r.header?{}:[],O=0;O<g.length;O++){var M=O,S=g[O],S=((ne,z)=>(U=>(r.dynamicTypingFunction&&r.dynamicTyping[U]===void 0&&(r.dynamicTyping[U]=r.dynamicTypingFunction(U)),(r.dynamicTyping[U]||r.dynamicTyping)===!0))(ne)?z==="true"||z==="TRUE"||z!=="false"&&z!=="FALSE"&&((U=>{if(se.test(U)&&(U=parseFloat(U),P<U&&U<k))return 1})(z)?parseFloat(z):Y.test(z)?new Date(z):z===""?null:z):z)(M=r.header?O>=N.length?"__parsed_extra":N[O]:M,S=r.transform?r.transform(S,M):S);M==="__parsed_extra"?(V[M]=V[M]||[],V[M].push(S)):V[M]=S}return r.header&&(O>N.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+N.length+" fields but parsed "+O,p+$):O<N.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+N.length+" fields but parsed "+O,p+$)),V}var I;d&&(r.header||r.dynamicTyping||r.transform)&&(I=1,!d.data.length||Array.isArray(d.data[0])?(d.data=d.data.map(_),I=d.data.length):d.data=_(d.data,0),r.header&&d.meta&&(d.meta.fields=N),p+=I)}function Q(){return r.header&&N.length===0}function h(b,_,I,g){b={type:b,code:_,message:I},g!==void 0&&(b.row=g),d.errors.push(b)}E(r.step)&&(c=r.step,r.step=function(b){d=b,Q()?B():(B(),d.data.length!==0&&(L+=b.data.length,r.preview&&L>r.preview?s.abort():(d.data=d.data[0],c(d,w))))}),this.parse=function(b,_,I){var g=r.quoteChar||'"',g=(r.newline||(r.newline=this.guessLineEndings(b,g)),n=!1,r.delimiter?E(r.delimiter)&&(r.delimiter=r.delimiter(b),d.meta.delimiter=r.delimiter):((g=(($,V,O,M,S)=>{var ne,z,U,he;S=S||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var pe=0;pe<S.length;pe++){for(var ce,fe=S[pe],X=0,oe=0,Z=0,ae=(U=void 0,new W({comments:M,delimiter:fe,newline:V,preview:10}).parse($)),ue=0;ue<ae.data.length;ue++)O&&q(ae.data[ue])?Z++:(ce=ae.data[ue].length,oe+=ce,U===void 0?U=ce:0<ce&&(X+=Math.abs(ce-U),U=ce));0<ae.data.length&&(oe/=ae.data.length-Z),(z===void 0||X<=z)&&(he===void 0||he<oe)&&1.99<oe&&(z=X,ne=fe,he=oe)}return{successful:!!(r.delimiter=ne),bestDelimiter:ne}})(b,r.newline,r.skipEmptyLines,r.comments,r.delimitersToGuess)).successful?r.delimiter=g.bestDelimiter:(n=!0,r.delimiter=o.DefaultDelimiter),d.meta.delimiter=r.delimiter),ie(r));return r.preview&&r.header&&g.preview++,t=b,s=new W(g),d=s.parse(t,_,I),B(),G?{meta:{paused:!0}}:d||{meta:{paused:!1}}},this.paused=function(){return G},this.pause=function(){G=!0,s.abort(),t=E(r.chunk)?"":t.substring(s.getCharIndex())},this.resume=function(){w.streamer._halted?(G=!1,w.streamer.parseChunk(t,!0)):setTimeout(w.resume,3)},this.aborted=function(){return y},this.abort=function(){y=!0,s.abort(),d.meta.aborted=!0,E(r.complete)&&r.complete(d),t=""},this.guessLineEndings=function($,g){$=$.substring(0,1048576);var g=new RegExp(C(g)+"([^]*?)"+C(g),"gm"),I=($=$.replace(g,"")).split("\r"),g=$.split(`
`),$=1<g.length&&g[0].length<I[0].length;if(I.length===1||$)return`
`;for(var V=0,O=0;O<I.length;O++)I[O][0]===`
`&&V++;return V>=I.length/2?`\r
`:"\r"}}function C(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function W(r){var t=(r=r||{}).delimiter,s=r.newline,n=r.comments,c=r.step,k=r.preview,P=r.fastMode,se=null,Y=!1,w=r.quoteChar==null?'"':r.quoteChar,L=w;if(r.escapeChar!==void 0&&(L=r.escapeChar),(typeof t!="string"||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||-1<o.BAD_DELIMITERS.indexOf(n))&&(n=!1),s!==`
`&&s!=="\r"&&s!==`\r
`&&(s=`
`);var p=0,G=!1;this.parse=function(y,N,d){if(typeof y!="string")throw new Error("Input must be a string");var q=y.length,B=t.length,Q=s.length,h=n.length,b=E(c),_=[],I=[],g=[],$=p=0;if(!y)return X();if(P||P!==!1&&y.indexOf(w)===-1){for(var V=y.split(s),O=0;O<V.length;O++){if(g=V[O],p+=g.length,O!==V.length-1)p+=s.length;else if(d)return X();if(!n||g.substring(0,h)!==n){if(b){if(_=[],he(g.split(t)),oe(),G)return X()}else he(g.split(t));if(k&&k<=O)return _=_.slice(0,k),X(!0)}}return X()}for(var M=y.indexOf(t,p),S=y.indexOf(s,p),ne=new RegExp(C(L)+C(w),"g"),z=y.indexOf(w,p);;)if(y[p]===w)for(z=p,p++;;){if((z=y.indexOf(w,z+1))===-1)return d||I.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:p}),ce();if(z===q-1)return ce(y.substring(p,z).replace(ne,w));if(w===L&&y[z+1]===L)z++;else if(w===L||z===0||y[z-1]!==L){M!==-1&&M<z+1&&(M=y.indexOf(t,z+1));var U=pe((S=S!==-1&&S<z+1?y.indexOf(s,z+1):S)===-1?M:Math.min(M,S));if(y.substr(z+1+U,B)===t){g.push(y.substring(p,z).replace(ne,w)),y[p=z+1+U+B]!==w&&(z=y.indexOf(w,p)),M=y.indexOf(t,p),S=y.indexOf(s,p);break}if(U=pe(S),y.substring(z+1+U,z+1+U+Q)===s){if(g.push(y.substring(p,z).replace(ne,w)),fe(z+1+U+Q),M=y.indexOf(t,p),z=y.indexOf(w,p),b&&(oe(),G))return X();if(k&&_.length>=k)return X(!0);break}I.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:p}),z++}}else if(n&&g.length===0&&y.substring(p,p+h)===n){if(S===-1)return X();p=S+Q,S=y.indexOf(s,p),M=y.indexOf(t,p)}else if(M!==-1&&(M<S||S===-1))g.push(y.substring(p,M)),p=M+B,M=y.indexOf(t,p);else{if(S===-1)break;if(g.push(y.substring(p,S)),fe(S+Q),b&&(oe(),G))return X();if(k&&_.length>=k)return X(!0)}return ce();function he(Z){_.push(Z),$=p}function pe(Z){var ae=0;return ae=Z!==-1&&(Z=y.substring(z+1,Z))&&Z.trim()===""?Z.length:ae}function ce(Z){return d||(Z===void 0&&(Z=y.substring(p)),g.push(Z),p=q,he(g),b&&oe()),X()}function fe(Z){p=Z,he(g),g=[],S=y.indexOf(s,p)}function X(Z){if(r.header&&!N&&_.length&&!Y){var ae=_[0],ue=Object.create(null),De=new Set(ae);let Le=!1;for(let me=0;me<ae.length;me++){let le=ae[me];if(ue[le=E(r.transformHeader)?r.transformHeader(le,me):le]){let be,Ie=ue[le];for(;be=le+"_"+Ie,Ie++,De.has(be););De.add(be),ae[me]=be,ue[le]++,Le=!0,(se=se===null?{}:se)[be]=le}else ue[le]=1,ae[me]=le;De.add(le)}Le&&console.warn("Duplicate headers found and renamed."),Y=!0}return{data:_,errors:I,meta:{delimiter:t,linebreak:s,aborted:G,truncated:!!Z,cursor:$+(N||0),renamedHeaders:se}}}function oe(){c(X()),_=[],I=[]}},this.abort=function(){G=!0},this.getCharIndex=function(){return p}}function te(r){var t=r.data,s=m[t.workerId],n=!1;if(t.error)s.userError(t.error,t.file);else if(t.results&&t.results.data){var c={abort:function(){n=!0,j(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:H,resume:H};if(E(s.userStep)){for(var k=0;k<t.results.data.length&&(s.userStep({data:t.results.data[k],errors:t.results.errors,meta:t.results.meta},c),!n);k++);delete t.results}else E(s.userChunk)&&(s.userChunk(t.results,c,t.file),delete t.results)}t.finished&&!n&&j(t.workerId,t.results)}function j(r,t){var s=m[r];E(s.userComplete)&&s.userComplete(t),s.terminate(),delete m[r]}function H(){throw new Error("Not implemented.")}function ie(r){if(typeof r!="object"||r===null)return r;var t,s=Array.isArray(r)?[]:{};for(t in r)s[t]=ie(r[t]);return s}function J(r,t){return function(){r.apply(t,arguments)}}function E(r){return typeof r=="function"}return o.parse=function(r,t){var s=(t=t||{}).dynamicTyping||!1;if(E(s)&&(t.dynamicTypingFunction=s,s={}),t.dynamicTyping=s,t.transform=!!E(t.transform)&&t.transform,!t.worker||!o.WORKERS_SUPPORTED)return s=null,o.NODE_STREAM_INPUT,typeof r=="string"?(r=(n=>n.charCodeAt(0)!==65279?n:n.slice(1))(r),s=new(t.download?A:F)(t)):r.readable===!0&&E(r.read)&&E(r.on)?s=new f(t):(i.File&&r instanceof File||r instanceof Object)&&(s=new re(t)),s.stream(r);(s=(()=>{var n;return!!o.WORKERS_SUPPORTED&&(n=(()=>{var c=i.URL||i.webkitURL||null,k=x.toString();return o.BLOB_URL||(o.BLOB_URL=c.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",k,")();"],{type:"text/javascript"})))})(),(n=new i.Worker(n)).onmessage=te,n.id=R++,m[n.id]=n)})()).userStep=t.step,s.userChunk=t.chunk,s.userComplete=t.complete,s.userError=t.error,t.step=E(t.step),t.chunk=E(t.chunk),t.complete=E(t.complete),t.error=E(t.error),delete t.worker,s.postMessage({input:r,config:t,workerId:s.id})},o.unparse=function(r,t){var s=!1,n=!0,c=",",k=`\r
`,P='"',se=P+P,Y=!1,w=null,L=!1,p=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||o.BAD_DELIMITERS.filter(function(N){return t.delimiter.indexOf(N)!==-1}).length||(c=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(s=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(Y=t.skipEmptyLines),typeof t.newline=="string"&&(k=t.newline),typeof t.quoteChar=="string"&&(P=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");w=t.columns}t.escapeChar!==void 0&&(se=t.escapeChar+P),t.escapeFormulae instanceof RegExp?L=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(L=/^[=+\-@\t\r].*$/)}})(),new RegExp(C(P),"g"));if(typeof r=="string"&&(r=JSON.parse(r)),Array.isArray(r)){if(!r.length||Array.isArray(r[0]))return G(null,r,Y);if(typeof r[0]=="object")return G(w||Object.keys(r[0]),r,Y)}else if(typeof r=="object")return typeof r.data=="string"&&(r.data=JSON.parse(r.data)),Array.isArray(r.data)&&(r.fields||(r.fields=r.meta&&r.meta.fields||w),r.fields||(r.fields=Array.isArray(r.data[0])?r.fields:typeof r.data[0]=="object"?Object.keys(r.data[0]):[]),Array.isArray(r.data[0])||typeof r.data[0]=="object"||(r.data=[r.data])),G(r.fields||[],r.data||[],Y);throw new Error("Unable to serialize unrecognized input");function G(N,d,q){var B="",Q=(typeof N=="string"&&(N=JSON.parse(N)),typeof d=="string"&&(d=JSON.parse(d)),Array.isArray(N)&&0<N.length),h=!Array.isArray(d[0]);if(Q&&n){for(var b=0;b<N.length;b++)0<b&&(B+=c),B+=y(N[b],b);0<d.length&&(B+=k)}for(var _=0;_<d.length;_++){var I=(Q?N:d[_]).length,g=!1,$=Q?Object.keys(d[_]).length===0:d[_].length===0;if(q&&!Q&&(g=q==="greedy"?d[_].join("").trim()==="":d[_].length===1&&d[_][0].length===0),q==="greedy"&&Q){for(var V=[],O=0;O<I;O++){var M=h?N[O]:O;V.push(d[_][M])}g=V.join("").trim()===""}if(!g){for(var S=0;S<I;S++){0<S&&!$&&(B+=c);var ne=Q&&h?N[S]:S;B+=y(d[_][ne],S)}_<d.length-1&&(!q||0<I&&!$)&&(B+=k)}}return B}function y(N,d){var q,B;return N==null?"":N.constructor===Date?JSON.stringify(N).slice(1,25):(B=!1,L&&typeof N=="string"&&L.test(N)&&(N="'"+N,B=!0),q=N.toString().replace(p,se),(B=B||s===!0||typeof s=="function"&&s(N,d)||Array.isArray(s)&&s[d]||((Q,h)=>{for(var b=0;b<h.length;b++)if(-1<Q.indexOf(h[b]))return!0;return!1})(q,o.BAD_DELIMITERS)||-1<q.indexOf(c)||q.charAt(0)===" "||q.charAt(q.length-1)===" ")?P+q+P:q)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!D&&!!i.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=W,o.ParserHandle=ee,o.NetworkStreamer=A,o.FileStreamer=re,o.StringStreamer=F,o.ReadableStreamStreamer=f,i.jQuery&&((T=i.jQuery).fn.parse=function(r){var t=r.config||{},s=[];return this.each(function(k){if(!(T(this).prop("tagName").toUpperCase()==="INPUT"&&T(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var P=0;P<this.files.length;P++)s.push({file:this.files[P],inputElem:this,instanceConfig:T.extend({},t)})}),n(),this;function n(){if(s.length===0)E(r.complete)&&r.complete();else{var k,P,se,Y,w=s[0];if(E(r.before)){var L=r.before(w.file,w.inputElem);if(typeof L=="object"){if(L.action==="abort")return k="AbortError",P=w.file,se=w.inputElem,Y=L.reason,void(E(r.error)&&r.error({name:k},P,se,Y));if(L.action==="skip")return void c();typeof L.config=="object"&&(w.instanceConfig=T.extend(w.instanceConfig,L.config))}else if(L==="skip")return void c()}var p=w.instanceConfig.complete;w.instanceConfig.complete=function(G){E(p)&&p(G,w.file,w.inputElem),c()},o.parse(w.file,w.instanceConfig)}}function c(){s.splice(0,1),n()}}),u&&(i.onmessage=function(r){r=r.data,o.WORKER_ID===void 0&&r&&(o.WORKER_ID=r.workerId),typeof r.input=="string"?i.postMessage({workerId:o.WORKER_ID,results:o.parse(r.input,r.config),finished:!0}):(i.File&&r.input instanceof File||r.input instanceof Object)&&(r=o.parse(r.input,r.config))&&i.postMessage({workerId:o.WORKER_ID,results:r,finished:!0})}),(A.prototype=Object.create(K.prototype)).constructor=A,(re.prototype=Object.create(K.prototype)).constructor=re,(F.prototype=Object.create(F.prototype)).constructor=F,(f.prototype=Object.create(K.prototype)).constructor=f,o})})(ve)),ve.exports}var Mt=It();const Ft=ct(Mt),qe="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Be=a=>{if(!a)return new Date().toISOString();const l=a.trim();let x=_e(l,"d/M/yy",new Date);if(Ce(x))return x.getFullYear()<2e3&&(x=et(x,100),x.getFullYear()<2e3&&x.setFullYear(2e3+parseInt(l.split(/[-/]/)[2]))),x.toISOString();if(x=_e(l,"d/M/yyyy",new Date),Ce(x))return x.toISOString();const i=new Date(l);return isNaN(i.getTime())?new Date().toISOString():i.toISOString()},Pt=a=>{const{configs:l,loading:x}=mt(),i=l.ticketSync,{toast:T}=Ge(),D=Ve(),u=v.useRef(!1);v.useEffect(()=>{if(x||!i?.autoSync||!qe||!a||a.length===0)return;const m=async()=>{if(u.current)return;const o=new Date,K=o.toISOString().split("T")[0];if(i.lastSync===K)return;const[A,re]=(i.syncTime||"08:00").split(":"),F=new Date;if(F.setHours(parseInt(A),parseInt(re),0,0),o>=F){console.log("Adding Auto-Sync to Queue..."),u.current=!0;try{const f=await fetch(qe);if(!f.ok)throw new Error("Failed to fetch CSV");const ee=await f.text();Ft.parse(ee,{header:!0,skipEmptyLines:!0,transformHeader:C=>C.trim(),complete:async C=>{try{const te=C.data.map(j=>({ticketNumber:j["Ticket Number"]||j["Ticket No"]||"",shortDesc:j["Short Description & Detail"]||j.Detail||j.Description||"",status:j.Status||"Open",type:j["Ticket Type"]||"Incident",assign:j.Assign||"Unassigned",details:j.Detail||"",action:j.Ation||j.Action||"",resolvedDetail:j["Resolved detail"]||"",remark:j.Remark||"",date:Be(j.Date),createdAt:Be(j.Date)})).filter(j=>j.ticketNumber).filter(j=>{const H=a.find(ie=>ie.ticketNumber===j.ticketNumber);return H?H.status!==j.status||H.shortDesc!==j.shortDesc||H.assign!==j.assign||H.action!==j.action||(H.details||"")!==j.details||(H.remark||"")!==j.remark||(H.type||"Incident")!==j.type||(H.resolvedDetail||"")!==j.resolvedDetail:!0});te.length>0?(await ke.importLogsFromSheet(te),D.invalidateQueries({queryKey:["ticketLogs"]}),T({title:"Auto Sync Completed",description:`Synced ${te.length} updates from Sheet.`})):console.log("Auto Sync: No updates found."),await ft.updateConfigs({...l,ticketSync:{...i,lastSync:K}})}catch(W){console.error("Auto Sync Parse Error:",W)}finally{u.current=!1}},error:C=>{console.error("Auto Sync CSV Error:",C),u.current=!1}})}catch(f){console.error("Auto Sync Fetch Error:",f),u.current=!1}}},R=setInterval(m,6e4);return m(),()=>clearInterval(R)},[i,a,D,l,x,T])},$e="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Ke=a=>{if(!a)return new Date().toISOString();const l=new Date(a);if(!isNaN(l.getTime()))return l.toISOString();const x=String(a).trim();let i=_e(x,"d/M/yy",new Date);return Ce(i)?(i.getFullYear()<2e3&&(i=et(i,100),i.getFullYear()<2e3&&i.setFullYear(2e3+parseInt(x.split(/[-/]/)[2]))),i.toISOString()):(i=_e(x,"d/M/yyyy",new Date),Ce(i)?i.toISOString():new Date().toISOString())},ze=v.memo(({label:a,value:l,variant:x})=>{const i={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${i[x]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:l}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:a})]})});ze.displayName="StatBox";const Ae=v.memo(({item:a,type:l})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${l==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",a.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:a.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${l==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:l==="new"?"New":"Update"})]}));Ae.displayName="PreviewRow";function Ut({isOpen:a,onClose:l,onSyncComplete:x,currentLogs:i}){const{ticketConfig:T,setTicketConfig:D}=Ye(),[u,m]=v.useState("input"),[R,o]=v.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[K,A]=v.useState(null),re=v.useCallback(()=>{m("input"),o({newItems:[],updatedItems:[],uptodateItems:[]}),A(null)},[]),F=v.useCallback(async()=>{m("analyzing"),A(null);try{const C=await fetch($e);if(!C.ok)throw new Error("Failed to fetch data from Apps Script ("+C.status+")");const W=await C.json();if(W.status==="error")throw new Error(W.message||"Unknown Script Error");const te=Array.isArray(W)?W:W.data||[];if(te.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const j=te.map(t=>({ticketNumber:t.ticketNo||t.ticketNumber||"",shortDesc:t.subject||t.shortDescription||t.description||"",status:t.status||"Open",type:t.ticketType||t.type||"Incident",assign:t.assignee||t.assign||"Unassigned",details:t.description||t.detail||"",action:t.actionTaken||t.action||"",resolvedDetail:t.resolutionNote||t.resolvedDetail||"",remark:t.remark||"",severity:t.severity||"Low",category:t.category||"",subCategory:t.subCategory||"",date:Ke(t.date||t.ticketDate||t.createdAt),createdAt:Ke(t.date||t.ticketDate||t.createdAt)})).filter(t=>t.ticketNumber),H=Array.from(j.reduce((t,s)=>{const n=String(s.ticketNumber).trim();return t.set(n,{...s,ticketNumber:n}),t},new Map).values()),ie=[],J=[],E=[];H.forEach(t=>{const s=i.find(n=>String(n.ticketNumber).trim()===t.ticketNumber);s?s.status!==t.status||s.shortDesc!==t.shortDesc||s.assign!==t.assign||s.action!==t.action||(s.details||"")!==t.details||(s.remark||"")!==t.remark||(s.type||"Incident")!==t.type||(s.resolvedDetail||"")!==t.resolvedDetail||(s.category||"")!==t.category||(s.subCategory||"")!==t.subCategory||(s.severity||"Low")!==t.severity?J.push({...t,_prev:s}):E.push(t):ie.push(t)});const r=(t,s)=>new Date(s.createdAt||0)-new Date(t.createdAt||0);o({newItems:ie.sort(r),updatedItems:J.sort(r),uptodateItems:E.sort(r)}),m("review")}catch(C){console.error(C),A("Sync Error: "+C.message),m("input")}},[i]),f=v.useCallback(async()=>{m("saving");try{const W=[...R.newItems,...R.updatedItems].map(({_prev:te,...j})=>j);W.length>0&&await ke.importLogsFromSheet(W),x&&x(W.length),setTimeout(()=>{l(),re()},1500),m("success")}catch(C){A("Database Error: "+C.message),m("review")}},[R.newItems,R.updatedItems,x,l,re]);if(!a)return null;const ee=R.newItems.length+R.updatedItems.length;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-950 w-full max-w-lg rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Ee,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Live Sync Manager"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"External Database Connector"})]})]}),e.jsx("button",{onClick:l,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(ye,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:e.jsxs(e.Fragment,{children:[u==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(Ee,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),K&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(gt,{size:14})," ",K]})]}),u==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(Ne,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),u==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(ze,{label:"New",value:R.newItems.length,variant:"new"}),e.jsx(ze,{label:"Updates",value:R.updatedItems.length,variant:"update"}),e.jsx(ze,{label:"Unchanged",value:R.uptodateItems.length,variant:"unchanged"})]}),ee>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest",children:"Pending Sync Records"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[ee," items to process"]})]}),e.jsxs("button",{onClick:F,disabled:u==="analyzing",className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95",title:"Re-fetch latest data",children:[e.jsx(Fe,{size:12,className:u==="analyzing"?"animate-spin":""})," Refresh"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-[1.5rem] overflow-hidden shadow-inner",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[R.newItems.map(C=>e.jsx(Ae,{item:C,type:"new"},C.ticketNumber)),R.updatedItems.map(C=>e.jsx(Ae,{item:C,type:"update"},C.ticketNumber))]})})]}):e.jsxs("div",{className:"py-10 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Te,{size:32,className:"mx-auto mb-3 text-emerald-500/40"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-tight",children:"System Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1 max-w-[200px] mx-auto leading-relaxed",children:"Your local database matches the remote Google Sheets source."}),e.jsxs("button",{onClick:F,className:"mt-6 flex items-center gap-1.5 px-4 py-2 mx-auto bg-white dark:bg-zinc-800 rounded-xl text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95 shadow-sm",children:[e.jsx(Fe,{size:12})," Force Re-Check"]})]})]}),u==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Te,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})}),e.jsxs("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",children:[u==="input"&&e.jsxs("button",{onClick:F,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(yt,{size:14})]}),u==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:re,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:f,disabled:ee===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(kt,{size:14})," Confirm Sync"]})]}),u==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(Ne,{size:14,className:"animate-spin"})," Updating Database..."]}),u==="success"&&e.jsx("button",{onClick:l,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})]})]})})}const je=v.memo(({label:a,required:l,icon:x,...i})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[x&&e.jsx(x,{size:10,className:"text-primary/70",strokeWidth:3}),a," ",l&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{...i,className:de("w-full h-11 px-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none disabled:opacity-50",i.className)})]}));je.displayName="ModernInput";const ge=v.memo(({label:a,value:l,onChange:x,options:i,required:T,icon:D})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[D&&e.jsx(D,{size:10,className:"text-primary/70",strokeWidth:3}),a," ",T&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:l,onChange:u=>x(u.target.value),className:de("w-full h-11 px-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none"),children:[e.jsx("option",{value:"",children:"Select..."}),i.map(u=>e.jsx("option",{value:u,children:u},u))]})]}));ge.displayName="ModernSelect";const we=v.memo(({label:a,icon:l,...x})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[l&&e.jsx(l,{size:10,className:"text-primary/70",strokeWidth:3}),a]}),e.jsx("textarea",{...x,className:de("w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none",x.className)})]}));we.displayName="ModernTextarea";const Re=v.memo(({label:a,value:l,onChange:x,options:i,colorMap:T={}})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1",children:a}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(D=>{const u=l===D,m=D?.toLowerCase()||"zinc",R=T[m]||"zinc",o={red:"bg-rose-500 text-white shadow-lg shadow-rose-500/30",orange:"bg-orange-500 text-white shadow-lg shadow-orange-500/30",amber:"bg-amber-500 text-white shadow-lg shadow-amber-500/30",emerald:"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30",blue:"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30",purple:"bg-purple-600 text-white shadow-lg shadow-purple-500/30",zinc:"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg"}[R];return e.jsx("button",{type:"button",onClick:()=>x(D),className:de("h-10 px-4 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-300 active:scale-95",u?o:"bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:border-zinc-300"),children:D},D)})})]}));Re.displayName="ModernPillPicker";const We={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",assign:"",remark:""};function qt({isOpen:a,onClose:l,initialData:x,onSubmit:i,isSubmitting:T}){const{ticketOptions:D}=Je(),{team:u}=vt(),[m,R]=v.useState(We),o={open:"red",pending:"amber",succeed:"emerald",closed:"zinc"},K={low:"emerald",medium:"blue",high:"orange",critical:"red"};v.useEffect(()=>(a&&(R(x||We),document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[x,a]);const A=v.useCallback((f,ee)=>{R(C=>({...C,[f]:ee}))},[]),re=v.useCallback(f=>{f.preventDefault(),i(m)},[m,i]);if(!a)return null;const F=!!x;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-zinc-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-[#0c0c0e] rounded-[2.5rem] border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[95vh] animate-in zoom-in-95 duration-400",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:de("w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transform -rotate-3",F?"bg-amber-100 dark:bg-amber-500/20 text-amber-600":"bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600"),children:e.jsx(ot,{size:22,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:F?"Edit Ticket":"Create New Ticket"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:de("w-1.5 h-1.5 rounded-full",F?"bg-amber-500":"bg-indigo-500")}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:F?`Modifying Record ${m.ticketNumber}`:"Deploying Operational Log"})]})]})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 flex items-center justify-center rounded-2xl hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-90",children:e.jsx(ye,{size:20,strokeWidth:2.5})})]}),e.jsxs("form",{id:"ticket-form",onSubmit:re,className:"flex-1 overflow-y-auto custom-scrollbar px-8 py-6 pb-12 space-y-8",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"01. Identity & Routing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(je,{label:"Ticket Number",icon:zt,required:!0,disabled:F,value:m.ticketNumber,onChange:f=>A("ticketNumber",f.target.value),placeholder:""}),e.jsx(ge,{label:"Log Assignee",icon:Xe,value:m.assign,onChange:f=>A("assign",f),options:u.map(f=>f.name)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ge,{label:"Type",icon:jt,value:m.type,onChange:f=>A("type",f),options:D.types||[]}),e.jsx(ge,{label:"Category",value:m.category,onChange:f=>A("category",f),options:D.categories||[]}),e.jsx(ge,{label:"Sub-Category",value:m.subCategory,onChange:f=>A("subCategory",f),options:D.subCategories||[]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"02. Priority & State"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Re,{label:"Current Status",value:m.status,onChange:f=>A("status",f),options:D.statuses||[],colorMap:o}),e.jsx(Re,{label:"Operational Severity",value:m.severity,onChange:f=>A("severity",f),options:D.severities||[],colorMap:K})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"03. Incident Narrative"}),e.jsx(je,{label:"Subject Brief",icon:Tt,required:!0,value:m.shortDesc,onChange:f=>A("shortDesc",f.target.value),placeholder:""}),e.jsx(we,{label:"Deep System Details",rows:4,value:m.details,onChange:f=>A("details",f.target.value),placeholder:""})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"04. Action Taken & Closure"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(we,{label:"Mitigation Steps",rows:4,value:m.action,onChange:f=>A("action",f.target.value),placeholder:""}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(je,{label:"Resolution Result",value:m.resolvedDetail,onChange:f=>A("resolvedDetail",f.target.value),placeholder:""}),e.jsx(we,{label:"Operator Remarks",rows:2,value:m.remark,onChange:f=>A("remark",f.target.value),placeholder:""})]})]})]})]}),e.jsxs("div",{className:"px-8 py-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/40 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"opacity-70 text-rose-600 dark:text-rose-500",children:"*"})," Field Persistence Required"]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 md:flex-none h-12 px-6 rounded-2xl text-xs font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-200/50 dark:hover:bg-zinc-800 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:T,className:de("flex-1 md:flex-none flex items-center justify-center gap-2 h-12 px-8 rounded-2xl text-xs font-black uppercase tracking-widest text-white shadow-xl shadow-primary/20","transition-all active:scale-95 disabled:opacity-50",F?"bg-amber-500 hover:bg-amber-600":"bg-primary hover:brightness-110"),children:T?e.jsx(Ne,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:16,strokeWidth:2.5}),F?"Update Log":"Commit Ticket"]})})]})]})]})})}const Bt=a=>{switch(a?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},He=a=>{switch(a?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},st=v.memo(({date:a})=>{const l=a?new Date(a):new Date;return e.jsxs("div",{className:"w-10 h-10 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:xe(l,"MMM")}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:xe(l,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5",children:xe(l,"yy")})]})});st.displayName="DateBox";const at=v.memo(({log:a,onClick:l,onSendToIncident:x,onEdit:i,onDelete:T,canEdit:D})=>e.jsxs("tr",{onClick:l,className:"group hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer border-b border-zinc-100 dark:border-zinc-800 last:border-0",children:[e.jsx("td",{className:"py-4 pl-6 pr-3 whitespace-nowrap",children:e.jsx(st,{date:a.createdAt})}),e.jsx("td",{className:"py-4 px-3 whitespace-nowrap",children:e.jsxs("span",{className:"font-mono text-xs font-black text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-950/30 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-900/50 shadow-sm",children:["#",a.ticketNumber]})}),e.jsx("td",{className:"py-4 px-3 w-full",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-1 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:a.shortDesc||a.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md border ${Bt(a.status)} shadow-sm`,children:a.status}),e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx(Ze,{size:10,className:He(a.severity)}),e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${He(a.severity)}`,children:a.severity||"Low"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-4 h-4 rounded-md bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-[8px] font-black text-zinc-600 dark:text-zinc-300 shadow-inner",children:a.assign?a.assign.charAt(0).toUpperCase():e.jsx(Xe,{size:10})}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 truncate max-w-[120px]",children:a.assign||"Unassigned"})]}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-100/50 dark:bg-zinc-800/30 px-1.5 py-0.5 rounded",children:a.type})]})]})}),e.jsx("td",{className:"py-4 pl-3 pr-6 text-right whitespace-nowrap",children:D&&e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),x(a,u)},className:"p-1.5 text-zinc-400 hover:text-amber-500 hover:bg-amber-50 rounded-md",title:"Add to Timeline",children:e.jsx(tt,{size:16})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),i(a)},className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-blue-50 rounded-md",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),T(a.ticketNumber)},className:"p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 rounded-md",children:e.jsx(rt,{size:16})})]})})]}));at.displayName="TicketTableRow";function $t({logs:a,onLogClick:l,onSendToIncident:x,onEdit:i,onDelete:T,canEdit:D}){return e.jsx("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:[e.jsx("th",{className:"py-4 pl-6 pr-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Date"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Ticket ID"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Operational Summary & Metadata"}),e.jsx("th",{className:"py-4 pl-3 pr-6 text-right text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:a.map(u=>e.jsx(at,{log:u,onClick:()=>l(u),onSendToIncident:x,onEdit:i,onDelete:T,canEdit:D},u.id))})]})})})}const Kt=a=>{switch(a?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Qe=a=>{switch(a?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},it=v.memo(({date:a})=>{const l=a?new Date(a):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:xe(l,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:xe(l,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:xe(l,"yy")})]})});it.displayName="DateBox";const nt=v.memo(({log:a,onClick:l,onEdit:x,canEdit:i})=>e.jsx("div",{onClick:l,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] p-4 shadow-sm hover:shadow-md transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(it,{date:a.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 text-[10px] sm:text-xs font-black rounded-lg border border-blue-100 dark:border-blue-800",children:["#",a.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-black px-2 py-0.5 rounded-full border ${Kt(a.status)} shadow-sm`,children:a.status})]}),i&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:T=>{T.stopPropagation(),x(a)},className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:e.jsx(Oe,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:a.shortDesc||a.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500 shadow-inner",children:a.assign?a.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:a.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:12,className:Qe(a.severity)}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${Qe(a.severity)}`,children:a.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-400 font-bold bg-zinc-50 dark:bg-zinc-800/50 px-2 py-0.5 rounded-lg",children:a.type})]})]})]})}));nt.displayName="MobileTicketCard";function Wt({logs:a,onLogClick:l,onEdit:x,canEdit:i}){return e.jsx("div",{className:"md:hidden space-y-4",children:a.map(T=>e.jsx(nt,{log:T,onClick:()=>l(T),onEdit:x,canEdit:i},T.id))})}const Ht=({log:a,onClose:l,onSendToIncident:x,onEdit:i,onDelete:T,canEdit:D})=>{if(!a)return null;const u=a.createdAt?xe(new Date(a.createdAt),"dd MMM yyyy"):"-",m=o=>{switch(o?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},R=o=>{switch(o?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:l,children:e.jsxs("div",{className:"w-[95vw] sm:w-full max-w-xl bg-white dark:bg-zinc-950 rounded-t-2xl sm:rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[85vh] shadow-2xl animate-in slide-in-from-bottom-10 sm:zoom-in-95 duration-200",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"px-5 sm:px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-lg sm:text-xl font-black text-zinc-900 dark:text-white",children:["#",a.ticketNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ht,{size:11})," ",u]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rt,{size:11})," ",a.type]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${m(a.status)}`,children:a.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[D&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:i,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:T,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(rt,{size:14})})]}),e.jsx("button",{onClick:l,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(ye,{size:16})})]})]}),e.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${R(a.severity)}`,children:a.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:a.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:a.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono max-h-48 overflow-y-auto custom-scrollbar",children:a.details||a.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(xt,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:a.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Te,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:a.resolvedDetail||"Pending"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:a.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:a.assign||"Unassigned"})]})]}),D&&e.jsxs("button",{onClick:()=>{x(),l()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(tt,{size:14})," Add to Timeline"]})]})]})})};function kr(){const{logs:a,loading:l,loadingMore:x,hasMore:i,loadMore:T,stats:D}=pt(),{toast:u}=Ge(),{currentUser:m}=Ye(),R=lt(m,[Me.LEAD,Me.ENGINEER]),{ticketOptions:o}=Je(),K=dt(),A=Ve(),[re,F]=v.useState(!1),[f,ee]=v.useState(""),[C,W]=v.useState("All"),[te,j]=v.useState("All"),[H,ie]=v.useState(null),J=v.useDeferredValue(f),[E,r]=v.useState(!1),[t,s]=v.useState(null),[n,c]=v.useState(!1),[k,P]=v.useState(null),[se,Y]=v.useState(!1);Pt(a);const w=v.useCallback(()=>{s(null),r(!0)},[]),L=v.useCallback(h=>{s(h),r(!0)},[]),p=v.useCallback(async h=>{c(!0);try{t?(await ke.updateLog(t.ticketNumber,h),u({title:"Updated",description:"Ticket updated successfully."})):(await ke.createLog(h),u({title:"Created",description:"New ticket created."})),A.invalidateQueries(["ticketLogs"]),r(!1),s(null),ie(null)}catch(b){console.error(b),u({variant:"destructive",title:"Error",description:b.message})}finally{c(!1)}},[t,A,u]),G=v.useCallback(h=>{P(h)},[]),y=v.useCallback(async()=>{if(k)try{await ke.deleteLog(k),u({title:"Deleted",description:"Ticket deleted."}),A.invalidateQueries(["ticketLogs"]),ie(null)}catch(h){u({variant:"destructive",title:"Error",description:h.message})}finally{P(null)}},[k,A,u]),N=v.useCallback(async(h,b)=>{if(b&&b.stopPropagation(),!m){u({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const _=typeof m=="object"&&m!==null?{name:m.name,id:m.id,role:m.role}:{name:m},I={subject:h.shortDesc||h.details||"New Incident from Log",ticket:h.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(h.type)?h.type:"Incident",status:"Open",createdBy:_,impact:"",root_cause:h.details||"",action:h.action||""};await bt.createIncident(I),u({title:"Successfully Added",description:`Ticket #${h.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>K("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(_){console.error(_),u({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[m,K,u]),d=v.useMemo(()=>a.filter(h=>{const b=h.ticketNumber?.toLowerCase().includes(J.toLowerCase())||h.shortDesc?.toLowerCase().includes(J.toLowerCase())||h.details&&h.details.toLowerCase().includes(J.toLowerCase()),_=C==="All"||h.status===C,I=te==="All"||h.type===te;return b&&_&&I}).sort((h,b)=>new Date(b.createdAt||0)-new Date(h.createdAt||0)),[a,J,C,te]),q=C!=="All"||te!=="All",B=v.useCallback(()=>{W("All"),j("All"),ee("")},[]),Q=v.useCallback(h=>{ie(h)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-zinc-950 transition-colors",children:[e.jsx("div",{className:"shrink-0 py-5 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[9px] font-bold rounded uppercase tracking-wider",children:"System Log"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[D.total," Records"]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Ticket Management"})]}),R&&e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:w,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Nt,{size:16})," New Ticket"]}),e.jsxs("button",{onClick:()=>F(!0),disabled:l,className:"flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Ee,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(_t,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"",value:f,onChange:h=>ee(h.target.value),className:"w-full h-10 pl-10 pr-9 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),f&&e.jsx("button",{onClick:()=>ee(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ye,{size:14})})]}),e.jsxs("button",{onClick:()=>Y(!0),className:de("h-10 px-3 flex items-center justify-center rounded-xl transition-all border",q?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 border-blue-200 dark:border-blue-800":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent"),children:[e.jsx(Pe,{size:18}),q&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-blue-500 rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:l?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ct,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{ee(""),W("All"),j("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{logs:d,onLogClick:Q,onSendToIncident:N,onEdit:L,onDelete:G,canEdit:R}),e.jsx(Wt,{logs:d,onLogClick:Q,onEdit:L,canEdit:R}),i&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:T,disabled:x,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:x?e.jsx(Ne,{className:"animate-spin",size:16}):e.jsx(Dt,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),H&&e.jsx(Ht,{log:H,onClose:()=>ie(null),onSendToIncident:()=>N(H),onEdit:()=>L(H),onDelete:()=>G(H.ticketNumber),canEdit:R}),e.jsx(qt,{isOpen:E,onClose:()=>r(!1),initialData:t,onSubmit:p,isSubmitting:n}),e.jsx(ut,{isOpen:!!k,onClose:()=>P(null),onConfirm:y,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${k}? This action cannot be undone.`,isDanger:!0}),e.jsx(Ut,{isOpen:re,onClose:()=>F(!1),currentLogs:a,onSyncComplete:h=>{u({title:"Sync Completed",description:`Updated ${h} records.`}),A.invalidateQueries({queryKey:["ticketLogs"]}),F(!1)}}),se&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>Y(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-[2.5rem] p-8 shadow-2xl animate-in slide-in-from-bottom duration-400 max-w-2xl mx-auto w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-500/20 text-blue-600 flex items-center justify-center",children:e.jsx(Pe,{size:20})}),e.jsx("h3",{className:"text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>Y(!1),className:"w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 rounded-2xl text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(ye,{size:20,strokeWidth:2.5})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Current Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...o.statuses].map(h=>e.jsx("button",{onClick:()=>W(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",C===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Log Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...o.types].map(h=>e.jsx("button",{onClick:()=>j(h),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",te===h?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:h},h))})]})]}),e.jsxs("div",{className:"mt-10 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>{B(),Y(!1)},className:"flex-1 h-12 rounded-2xl text-xs font-black uppercase tracking-widest text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/50 transition-colors",children:"Reset Filters"}),e.jsx("button",{onClick:()=>Y(!1),className:"flex-[2] h-12 rounded-2xl bg-blue-600 text-white text-xs font-black uppercase tracking-widest shadow-xl shadow-blue-500/30 hover:brightness-110 active:scale-95 transition-all",children:"Apply Constraints"})]})]})]})]})}export{kr as default};
