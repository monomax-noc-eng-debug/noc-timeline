import{d as Se,y as nt,a as Ge,z as Ve,r as z,j as e,X as ye,L as Ne,e as de,F as ct,U as Ye,T as Ze,b as ot,t as lt,u as dt,C as ut,v as Me,g as ht,A as xt}from"./index-CVSuKyb2.js";import{t as ke,u as Je,a as pt,i as mt}from"./useTicketOptions-Csv3hkwI.js";import{u as ft}from"./useConfigs-CJGFkdqh.js";import{c as bt}from"./configService-CpUaQNct.js";import{p as _e}from"./parse-Bk6ren_S.js";import{i as Ce,f as xe}from"./format-B568ns5f.js";import{a as Xe}from"./addYears-RECKJz7f.js";import{C as Ee}from"./cloud-download-V5nbQ3nV.js";import{C as gt}from"./circle-alert-DWWqJlwb.js";import{R as Fe}from"./refresh-cw-5RuPOYzI.js";import{C as Te}from"./circle-check-RvjUJsWJ.js";import{A as kt}from"./useBaseQuery-BQBxf117.js";import{D as yt}from"./database-BuF-JmEy.js";import{u as vt}from"./useTeam-CptNjko-.js";import{T as zt}from"./tag-Diu4gxcO.js";import{P as jt}from"./panels-top-left-DCYipF6a.js";import{S as wt}from"./save-wtsRD9Qh.js";import{Z as et}from"./zap-aUtH-8M4.js";import{T as tt}from"./trash-2-Dogq7gi1.js";import{P as Nt}from"./plus-DKQv81sk.js";import{S as _t}from"./search-DQvZtxdF.js";import{S as Pe}from"./sliders-horizontal-DwVMUcOB.js";import{G as Ct}from"./globe-lwTZAOiZ.js";import"./firebaseConfig-Cp-1Ewx5.js";import"./addMonths-BfoHT1ak.js";const St=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]],Dt=Se("circle-arrow-down",St);const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Tt=Se("info",Et);const At=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Rt=Se("shield-alert",At);const Ot=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Oe=Se("square-pen",Ot);var ve={exports:{}};var Lt=ve.exports,Ue;function It(){return Ue||(Ue=1,(function(s,u){((p,n)=>{s.exports=n()})(Lt,function p(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},j,w=!n.document&&!!n.postMessage,m=n.IS_PAPA_WORKER||!1,y={},H=0,c={};function A(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(r){var a=ae(r);a.chunkSize=parseInt(a.chunkSize),r.step||r.chunk||(a.chunkSize=null),this._handle=new K(a),(this._handle.streamer=this)._config=a}).call(this,t),this.parseChunk=function(r,a){var d=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<d){let k=this._config.newline;k||(o=this._config.quoteChar||'"',k=this._handle.guessLineEndings(r,o)),r=[...r.split(k).slice(d)].join(k)}this.isFirstChunk&&i(this._config.beforeFirstChunk)&&(o=this._config.beforeFirstChunk(r))!==void 0&&(r=o),this.isFirstChunk=!1,this._halted=!1;var d=this._partialLine+r,o=(this._partialLine="",this._handle.parse(d,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(r=o.meta.cursor,d=(this._finished||(this._partialLine=d.substring(r-this._baseIndex),this._baseIndex=r),o&&o.data&&(this._rowCount+=o.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),m)n.postMessage({results:o,workerId:c.WORKER_ID,finished:d});else if(i(this._config.chunk)&&!a){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!d||!i(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),d||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(r){i(this._config.error)?this._config.error(r):m&&this._config.error&&n.postMessage({workerId:c.WORKER_ID,error:r,finished:!1})}}function T(t){var r;(t=t||{}).chunkSize||(t.chunkSize=c.RemoteChunkSize),A.call(this,t),this._nextChunk=w?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),w||(r.onload=J(this._chunkLoaded,this),r.onerror=J(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!w),this._config.downloadRequestHeaders){var a,d=this._config.downloadRequestHeaders;for(a in d)r.setRequestHeader(a,d[a])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,r.setRequestHeader("Range","bytes="+this._start+"-"+o));try{r.send(this._config.downloadRequestBody)}catch(k){this._chunkError(k.message)}w&&r.status===0&&this._chunkError()}},this._chunkLoaded=function(){r.readyState===4&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize||r.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(r),this.parseChunk(r.responseText)))},this._chunkError=function(a){a=r.statusText||a,this._sendError(new Error(a))}}function ie(t){(t=t||{}).chunkSize||(t.chunkSize=c.LocalChunkSize),A.call(this,t);var r,a,d=typeof FileReader<"u";this.stream=function(o){this._input=o,a=o.slice||o.webkitSlice||o.mozSlice,d?((r=new FileReader).onload=J(this._chunkLoaded,this),r.onerror=J(this._chunkError,this)):r=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var o=this._input,k=(this._config.chunkSize&&(k=Math.min(this._start+this._config.chunkSize,this._input.size),o=a.call(o,this._start,k)),r.readAsText(o,this._config.encoding));d||this._chunkLoaded({target:{result:k}})},this._chunkLoaded=function(o){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(o.target.result)},this._chunkError=function(){this._sendError(r.error)}}function M(t){var r;A.call(this,t=t||{}),this.stream=function(a){return r=a,this._nextChunk()},this._nextChunk=function(){var a,d;if(!this._finished)return a=this._config.chunkSize,r=a?(d=r.substring(0,a),r.substring(a)):(d=r,""),this._finished=!r,this.parseChunk(d)}}function l(t){A.call(this,t=t||{});var r=[],a=!0,d=!1;this.pause=function(){A.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){A.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(o){this._input=o,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){d&&r.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):a=!0},this._streamData=J(function(o){try{r.push(typeof o=="string"?o:o.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(k){this._streamError(k)}},this),this._streamError=J(function(o){this._streamCleanUp(),this._sendError(o)},this),this._streamEnd=J(function(){this._streamCleanUp(),d=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function K(t){var r,a,d,o,k=Math.pow(2,53),P=-k,te=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Y=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,_=this,O=0,f=0,G=!1,v=!1,C=[],h={data:[],errors:[],meta:{}};function q(b){return t.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function B(){if(h&&d&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),d=!1),t.skipEmptyLines&&(h.data=h.data.filter(function(g){return!q(g)})),Q()){let g=function($,V){i(t.transformHeader)&&($=t.transformHeader($,V)),C.push($)};if(h)if(Array.isArray(h.data[0])){for(var b=0;Q()&&b<h.data.length;b++)h.data[b].forEach(g);h.data.splice(0,1)}else h.data.forEach(g)}function D(g,$){for(var V=t.header?{}:[],R=0;R<g.length;R++){var I=R,E=g[R],E=((ne,N)=>(U=>(t.dynamicTypingFunction&&t.dynamicTyping[U]===void 0&&(t.dynamicTyping[U]=t.dynamicTypingFunction(U)),(t.dynamicTyping[U]||t.dynamicTyping)===!0))(ne)?N==="true"||N==="TRUE"||N!=="false"&&N!=="FALSE"&&((U=>{if(te.test(U)&&(U=parseFloat(U),P<U&&U<k))return 1})(N)?parseFloat(N):Y.test(N)?new Date(N):N===""?null:N):N)(I=t.header?R>=C.length?"__parsed_extra":C[R]:I,E=t.transform?t.transform(E,I):E);I==="__parsed_extra"?(V[I]=V[I]||[],V[I].push(E)):V[I]=E}return t.header&&(R>C.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+R,f+$):R<C.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+R,f+$)),V}var L;h&&(t.header||t.dynamicTyping||t.transform)&&(L=1,!h.data.length||Array.isArray(h.data[0])?(h.data=h.data.map(D),L=h.data.length):h.data=D(h.data,0),t.header&&h.meta&&(h.meta.fields=C),f+=L)}function Q(){return t.header&&C.length===0}function x(b,D,L,g){b={type:b,code:D,message:L},g!==void 0&&(b.row=g),h.errors.push(b)}i(t.step)&&(o=t.step,t.step=function(b){h=b,Q()?B():(B(),h.data.length!==0&&(O+=b.data.length,t.preview&&O>t.preview?a.abort():(h.data=h.data[0],o(h,_))))}),this.parse=function(b,D,L){var g=t.quoteChar||'"',g=(t.newline||(t.newline=this.guessLineEndings(b,g)),d=!1,t.delimiter?i(t.delimiter)&&(t.delimiter=t.delimiter(b),h.meta.delimiter=t.delimiter):((g=(($,V,R,I,E)=>{var ne,N,U,he;E=E||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var pe=0;pe<E.length;pe++){for(var ce,fe=E[pe],X=0,oe=0,Z=0,re=(U=void 0,new ee({comments:I,delimiter:fe,newline:V,preview:10}).parse($)),ue=0;ue<re.data.length;ue++)R&&q(re.data[ue])?Z++:(ce=re.data[ue].length,oe+=ce,U===void 0?U=ce:0<ce&&(X+=Math.abs(ce-U),U=ce));0<re.data.length&&(oe/=re.data.length-Z),(N===void 0||X<=N)&&(he===void 0||he<oe)&&1.99<oe&&(N=X,ne=fe,he=oe)}return{successful:!!(t.delimiter=ne),bestDelimiter:ne}})(b,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=g.bestDelimiter:(d=!0,t.delimiter=c.DefaultDelimiter),h.meta.delimiter=t.delimiter),ae(t));return t.preview&&t.header&&g.preview++,r=b,a=new ee(g),h=a.parse(r,D,L),B(),G?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return G},this.pause=function(){G=!0,a.abort(),r=i(t.chunk)?"":r.substring(a.getCharIndex())},this.resume=function(){_.streamer._halted?(G=!1,_.streamer.parseChunk(r,!0)):setTimeout(_.resume,3)},this.aborted=function(){return v},this.abort=function(){v=!0,a.abort(),h.meta.aborted=!0,i(t.complete)&&t.complete(h),r=""},this.guessLineEndings=function($,g){$=$.substring(0,1048576);var g=new RegExp(F(g)+"([^]*?)"+F(g),"gm"),L=($=$.replace(g,"")).split("\r"),g=$.split(`
`),$=1<g.length&&g[0].length<L[0].length;if(L.length===1||$)return`
`;for(var V=0,R=0;R<L.length;R++)L[R][0]===`
`&&V++;return V>=L.length/2?`\r
`:"\r"}}function F(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ee(t){var r=(t=t||{}).delimiter,a=t.newline,d=t.comments,o=t.step,k=t.preview,P=t.fastMode,te=null,Y=!1,_=t.quoteChar==null?'"':t.quoteChar,O=_;if(t.escapeChar!==void 0&&(O=t.escapeChar),(typeof r!="string"||-1<c.BAD_DELIMITERS.indexOf(r))&&(r=","),d===r)throw new Error("Comment character same as delimiter");d===!0?d="#":(typeof d!="string"||-1<c.BAD_DELIMITERS.indexOf(d))&&(d=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var f=0,G=!1;this.parse=function(v,C,h){if(typeof v!="string")throw new Error("Input must be a string");var q=v.length,B=r.length,Q=a.length,x=d.length,b=i(o),D=[],L=[],g=[],$=f=0;if(!v)return X();if(P||P!==!1&&v.indexOf(_)===-1){for(var V=v.split(a),R=0;R<V.length;R++){if(g=V[R],f+=g.length,R!==V.length-1)f+=a.length;else if(h)return X();if(!d||g.substring(0,x)!==d){if(b){if(D=[],he(g.split(r)),oe(),G)return X()}else he(g.split(r));if(k&&k<=R)return D=D.slice(0,k),X(!0)}}return X()}for(var I=v.indexOf(r,f),E=v.indexOf(a,f),ne=new RegExp(F(O)+F(_),"g"),N=v.indexOf(_,f);;)if(v[f]===_)for(N=f,f++;;){if((N=v.indexOf(_,N+1))===-1)return h||L.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:D.length,index:f}),ce();if(N===q-1)return ce(v.substring(f,N).replace(ne,_));if(_===O&&v[N+1]===O)N++;else if(_===O||N===0||v[N-1]!==O){I!==-1&&I<N+1&&(I=v.indexOf(r,N+1));var U=pe((E=E!==-1&&E<N+1?v.indexOf(a,N+1):E)===-1?I:Math.min(I,E));if(v.substr(N+1+U,B)===r){g.push(v.substring(f,N).replace(ne,_)),v[f=N+1+U+B]!==_&&(N=v.indexOf(_,f)),I=v.indexOf(r,f),E=v.indexOf(a,f);break}if(U=pe(E),v.substring(N+1+U,N+1+U+Q)===a){if(g.push(v.substring(f,N).replace(ne,_)),fe(N+1+U+Q),I=v.indexOf(r,f),N=v.indexOf(_,f),b&&(oe(),G))return X();if(k&&D.length>=k)return X(!0);break}L.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:D.length,index:f}),N++}}else if(d&&g.length===0&&v.substring(f,f+x)===d){if(E===-1)return X();f=E+Q,E=v.indexOf(a,f),I=v.indexOf(r,f)}else if(I!==-1&&(I<E||E===-1))g.push(v.substring(f,I)),f=I+B,I=v.indexOf(r,f);else{if(E===-1)break;if(g.push(v.substring(f,E)),fe(E+Q),b&&(oe(),G))return X();if(k&&D.length>=k)return X(!0)}return ce();function he(Z){D.push(Z),$=f}function pe(Z){var re=0;return re=Z!==-1&&(Z=v.substring(N+1,Z))&&Z.trim()===""?Z.length:re}function ce(Z){return h||(Z===void 0&&(Z=v.substring(f)),g.push(Z),f=q,he(g),b&&oe()),X()}function fe(Z){f=Z,he(g),g=[],E=v.indexOf(a,f)}function X(Z){if(t.header&&!C&&D.length&&!Y){var re=D[0],ue=Object.create(null),De=new Set(re);let Le=!1;for(let me=0;me<re.length;me++){let le=re[me];if(ue[le=i(t.transformHeader)?t.transformHeader(le,me):le]){let be,Ie=ue[le];for(;be=le+"_"+Ie,Ie++,De.has(be););De.add(be),re[me]=be,ue[le]++,Le=!0,(te=te===null?{}:te)[be]=le}else ue[le]=1,re[me]=le;De.add(le)}Le&&console.warn("Duplicate headers found and renamed."),Y=!0}return{data:D,errors:L,meta:{delimiter:r,linebreak:a,aborted:G,truncated:!!Z,cursor:$+(C||0),renamedHeaders:te}}}function oe(){o(X()),D=[],L=[]}},this.abort=function(){G=!0},this.getCharIndex=function(){return f}}function se(t){var r=t.data,a=y[r.workerId],d=!1;if(r.error)a.userError(r.error,r.file);else if(r.results&&r.results.data){var o={abort:function(){d=!0,S(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:W,resume:W};if(i(a.userStep)){for(var k=0;k<r.results.data.length&&(a.userStep({data:r.results.data[k],errors:r.results.errors,meta:r.results.meta},o),!d);k++);delete r.results}else i(a.userChunk)&&(a.userChunk(r.results,o,r.file),delete r.results)}r.finished&&!d&&S(r.workerId,r.results)}function S(t,r){var a=y[t];i(a.userComplete)&&a.userComplete(r),a.terminate(),delete y[t]}function W(){throw new Error("Not implemented.")}function ae(t){if(typeof t!="object"||t===null)return t;var r,a=Array.isArray(t)?[]:{};for(r in t)a[r]=ae(t[r]);return a}function J(t,r){return function(){t.apply(r,arguments)}}function i(t){return typeof t=="function"}return c.parse=function(t,r){var a=(r=r||{}).dynamicTyping||!1;if(i(a)&&(r.dynamicTypingFunction=a,a={}),r.dynamicTyping=a,r.transform=!!i(r.transform)&&r.transform,!r.worker||!c.WORKERS_SUPPORTED)return a=null,c.NODE_STREAM_INPUT,typeof t=="string"?(t=(d=>d.charCodeAt(0)!==65279?d:d.slice(1))(t),a=new(r.download?T:M)(r)):t.readable===!0&&i(t.read)&&i(t.on)?a=new l(r):(n.File&&t instanceof File||t instanceof Object)&&(a=new ie(r)),a.stream(t);(a=(()=>{var d;return!!c.WORKERS_SUPPORTED&&(d=(()=>{var o=n.URL||n.webkitURL||null,k=p.toString();return c.BLOB_URL||(c.BLOB_URL=o.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",k,")();"],{type:"text/javascript"})))})(),(d=new n.Worker(d)).onmessage=se,d.id=H++,y[d.id]=d)})()).userStep=r.step,a.userChunk=r.chunk,a.userComplete=r.complete,a.userError=r.error,r.step=i(r.step),r.chunk=i(r.chunk),r.complete=i(r.complete),r.error=i(r.error),delete r.worker,a.postMessage({input:t,config:r,workerId:a.id})},c.unparse=function(t,r){var a=!1,d=!0,o=",",k=`\r
`,P='"',te=P+P,Y=!1,_=null,O=!1,f=((()=>{if(typeof r=="object"){if(typeof r.delimiter!="string"||c.BAD_DELIMITERS.filter(function(C){return r.delimiter.indexOf(C)!==-1}).length||(o=r.delimiter),typeof r.quotes!="boolean"&&typeof r.quotes!="function"&&!Array.isArray(r.quotes)||(a=r.quotes),typeof r.skipEmptyLines!="boolean"&&typeof r.skipEmptyLines!="string"||(Y=r.skipEmptyLines),typeof r.newline=="string"&&(k=r.newline),typeof r.quoteChar=="string"&&(P=r.quoteChar),typeof r.header=="boolean"&&(d=r.header),Array.isArray(r.columns)){if(r.columns.length===0)throw new Error("Option columns is empty");_=r.columns}r.escapeChar!==void 0&&(te=r.escapeChar+P),r.escapeFormulae instanceof RegExp?O=r.escapeFormulae:typeof r.escapeFormulae=="boolean"&&r.escapeFormulae&&(O=/^[=+\-@\t\r].*$/)}})(),new RegExp(F(P),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return G(null,t,Y);if(typeof t[0]=="object")return G(_||Object.keys(t[0]),t,Y)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||_),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),G(t.fields||[],t.data||[],Y);throw new Error("Unable to serialize unrecognized input");function G(C,h,q){var B="",Q=(typeof C=="string"&&(C=JSON.parse(C)),typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(C)&&0<C.length),x=!Array.isArray(h[0]);if(Q&&d){for(var b=0;b<C.length;b++)0<b&&(B+=o),B+=v(C[b],b);0<h.length&&(B+=k)}for(var D=0;D<h.length;D++){var L=(Q?C:h[D]).length,g=!1,$=Q?Object.keys(h[D]).length===0:h[D].length===0;if(q&&!Q&&(g=q==="greedy"?h[D].join("").trim()==="":h[D].length===1&&h[D][0].length===0),q==="greedy"&&Q){for(var V=[],R=0;R<L;R++){var I=x?C[R]:R;V.push(h[D][I])}g=V.join("").trim()===""}if(!g){for(var E=0;E<L;E++){0<E&&!$&&(B+=o);var ne=Q&&x?C[E]:E;B+=v(h[D][ne],E)}D<h.length-1&&(!q||0<L&&!$)&&(B+=k)}}return B}function v(C,h){var q,B;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(B=!1,O&&typeof C=="string"&&O.test(C)&&(C="'"+C,B=!0),q=C.toString().replace(f,te),(B=B||a===!0||typeof a=="function"&&a(C,h)||Array.isArray(a)&&a[h]||((Q,x)=>{for(var b=0;b<x.length;b++)if(-1<Q.indexOf(x[b]))return!0;return!1})(q,c.BAD_DELIMITERS)||-1<q.indexOf(o)||q.charAt(0)===" "||q.charAt(q.length-1)===" ")?P+q+P:q)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!w&&!!n.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=ee,c.ParserHandle=K,c.NetworkStreamer=T,c.FileStreamer=ie,c.StringStreamer=M,c.ReadableStreamStreamer=l,n.jQuery&&((j=n.jQuery).fn.parse=function(t){var r=t.config||{},a=[];return this.each(function(k){if(!(j(this).prop("tagName").toUpperCase()==="INPUT"&&j(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var P=0;P<this.files.length;P++)a.push({file:this.files[P],inputElem:this,instanceConfig:j.extend({},r)})}),d(),this;function d(){if(a.length===0)i(t.complete)&&t.complete();else{var k,P,te,Y,_=a[0];if(i(t.before)){var O=t.before(_.file,_.inputElem);if(typeof O=="object"){if(O.action==="abort")return k="AbortError",P=_.file,te=_.inputElem,Y=O.reason,void(i(t.error)&&t.error({name:k},P,te,Y));if(O.action==="skip")return void o();typeof O.config=="object"&&(_.instanceConfig=j.extend(_.instanceConfig,O.config))}else if(O==="skip")return void o()}var f=_.instanceConfig.complete;_.instanceConfig.complete=function(G){i(f)&&f(G,_.file,_.inputElem),o()},c.parse(_.file,_.instanceConfig)}}function o(){a.splice(0,1),d()}}),m&&(n.onmessage=function(t){t=t.data,c.WORKER_ID===void 0&&t&&(c.WORKER_ID=t.workerId),typeof t.input=="string"?n.postMessage({workerId:c.WORKER_ID,results:c.parse(t.input,t.config),finished:!0}):(n.File&&t.input instanceof File||t.input instanceof Object)&&(t=c.parse(t.input,t.config))&&n.postMessage({workerId:c.WORKER_ID,results:t,finished:!0})}),(T.prototype=Object.create(A.prototype)).constructor=T,(ie.prototype=Object.create(A.prototype)).constructor=ie,(M.prototype=Object.create(M.prototype)).constructor=M,(l.prototype=Object.create(A.prototype)).constructor=l,c})})(ve)),ve.exports}var Mt=It();const Ft=nt(Mt),qe="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Be=s=>{if(!s)return new Date().toISOString();const u=s.trim();let p=_e(u,"d/M/yy",new Date);if(Ce(p))return p.getFullYear()<2e3&&(p=Xe(p,100),p.getFullYear()<2e3&&p.setFullYear(2e3+parseInt(u.split(/[-/]/)[2]))),p.toISOString();if(p=_e(u,"d/M/yyyy",new Date),Ce(p))return p.toISOString();const n=new Date(u);return isNaN(n.getTime())?new Date().toISOString():n.toISOString()},Pt=s=>{const{configs:u,loading:p}=ft(),n=u.ticketSync,{toast:j}=Ge(),w=Ve(),m=z.useRef(!1);z.useEffect(()=>{if(p||!n?.autoSync||!qe||!s||s.length===0)return;const y=async()=>{if(m.current)return;const c=new Date,A=c.toISOString().split("T")[0];if(n.lastSync===A)return;const[T,ie]=(n.syncTime||"08:00").split(":"),M=new Date;if(M.setHours(parseInt(T),parseInt(ie),0,0),c>=M){m.current=!0;try{const l=await fetch(qe);if(!l.ok)throw new Error("Failed to fetch CSV");const K=await l.text();Ft.parse(K,{header:!0,skipEmptyLines:!0,transformHeader:F=>F.trim(),complete:async F=>{try{const se=F.data.map(S=>({ticketNumber:S["Ticket Number"]||S["Ticket No"]||"",shortDesc:S["Short Description & Detail"]||S.Detail||S.Description||"",status:S.Status||"Open",type:S["Ticket Type"]||"Incident",assign:S.Assign||"Unassigned",details:S.Detail||"",action:S.Ation||S.Action||"",resolvedDetail:S["Resolved detail"]||"",remark:S.Remark||"",date:Be(S.Date),createdAt:Be(S.Date)})).filter(S=>S.ticketNumber).filter(S=>{const W=s.find(ae=>ae.ticketNumber===S.ticketNumber);return W?W.status!==S.status||W.shortDesc!==S.shortDesc||W.assign!==S.assign||W.action!==S.action||(W.details||"")!==S.details||(W.remark||"")!==S.remark||(W.type||"Incident")!==S.type||(W.resolvedDetail||"")!==S.resolvedDetail:!0});se.length>0&&(await ke.importLogsFromSheet(se),w.invalidateQueries({queryKey:["ticketLogs"]}),j({title:"Auto Sync Completed",description:`Synced ${se.length} updates from Sheet.`})),await bt.updateConfigs({...u,ticketSync:{...n,lastSync:A}})}catch(ee){console.error("Auto Sync Parse Error:",ee)}finally{m.current=!1}},error:F=>{console.error("Auto Sync CSV Error:",F),m.current=!1}})}catch(l){console.error("Auto Sync Fetch Error:",l),m.current=!1}}},H=setInterval(y,6e4);return y(),()=>clearInterval(H)},[n,s,w,u,p,j])},$e="https://script.google.com/macros/s/AKfycbx9UZBOfgKbXPIn_WFK8U35t2t9bd1G4VDVJ6vOcyjKPLz2If9ABgb-NjxBMB9LdD3Z/exec",Ke=s=>{if(!s)return new Date().toISOString();const u=new Date(s);if(!isNaN(u.getTime()))return u.toISOString();const p=String(s).trim();let n=_e(p,"d/M/yy",new Date);return Ce(n)?(n.getFullYear()<2e3&&(n=Xe(n,100),n.getFullYear()<2e3&&n.setFullYear(2e3+parseInt(p.split(/[-/]/)[2]))),n.toISOString()):(n=_e(p,"d/M/yyyy",new Date),Ce(n)?n.toISOString():new Date().toISOString())},ze=z.memo(({label:s,value:u,variant:p})=>{const n={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${n[p]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:u}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:s})]})});ze.displayName="StatBox";const Ae=z.memo(({item:s,type:u})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${u==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",s.ticketNumber]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:s.shortDesc})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${u==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:u==="new"?"New":"Update"})]}));Ae.displayName="PreviewRow";function Ut({isOpen:s,onClose:u,onSyncComplete:p,currentLogs:n}){const[j,w]=z.useState("input"),[m,y]=z.useState({newItems:[],updatedItems:[],uptodateItems:[]}),[H,c]=z.useState(null),A=z.useCallback(()=>{w("input"),y({newItems:[],updatedItems:[],uptodateItems:[]}),c(null)},[]),T=z.useCallback(async()=>{w("analyzing"),c(null);try{const l=await fetch($e);if(!l.ok)throw new Error("Failed to fetch data from Apps Script ("+l.status+")");const K=await l.json();if(K.status==="error")throw new Error(K.message||"Unknown Script Error");const F=Array.isArray(K)?K:K.data||[];if(F.length===0)throw new Error("No data received (Sheet might be empty or Name mismatch)");const ee=F.map(i=>({ticketNumber:i.ticketNo||i.ticketNumber||"",shortDesc:i.subject||i.shortDescription||i.description||"",status:i.status||"Open",type:i.ticketType||i.type||"Incident",assign:i.assignee||i.assign||"Unassigned",details:i.description||i.detail||"",action:i.actionTaken||i.action||"",resolvedDetail:i.resolutionNote||i.resolvedDetail||"",remark:i.remark||"",severity:i.severity||"Low",category:i.category||"",subCategory:i.subCategory||"",date:Ke(i.date||i.ticketDate||i.createdAt),createdAt:Ke(i.date||i.ticketDate||i.createdAt)})).filter(i=>i.ticketNumber),se=Array.from(ee.reduce((i,t)=>{const r=String(t.ticketNumber).trim();return i.set(r,{...t,ticketNumber:r}),i},new Map).values()),S=[],W=[],ae=[];se.forEach(i=>{const t=n.find(r=>String(r.ticketNumber).trim()===i.ticketNumber);t?t.status!==i.status||t.shortDesc!==i.shortDesc||t.assign!==i.assign||t.action!==i.action||(t.details||"")!==i.details||(t.remark||"")!==i.remark||(t.type||"Incident")!==i.type||(t.resolvedDetail||"")!==i.resolvedDetail||(t.category||"")!==i.category||(t.subCategory||"")!==i.subCategory||(t.severity||"Low")!==i.severity?W.push({...i,_prev:t}):ae.push(i):S.push(i)});const J=(i,t)=>new Date(t.createdAt||0)-new Date(i.createdAt||0);y({newItems:S.sort(J),updatedItems:W.sort(J),uptodateItems:ae.sort(J)}),w("review")}catch(l){console.error(l),c("Sync Error: "+l.message),w("input")}},[n]),ie=z.useCallback(async()=>{w("saving");try{const K=[...m.newItems,...m.updatedItems].map(({_prev:F,...ee})=>ee);K.length>0&&await ke.importLogsFromSheet(K),p&&p(K.length),setTimeout(()=>{u(),A()},1500),w("success")}catch(l){c("Database Error: "+l.message),w("review")}},[m.newItems,m.updatedItems,p,u,A]);if(!s)return null;const M=m.newItems.length+m.updatedItems.length;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 animate-in fade-in duration-150",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-950 w-full max-w-lg rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-xl overflow-hidden flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center bg-zinc-50 dark:bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-zinc-900 dark:bg-white rounded-lg",children:e.jsx(Ee,{size:16,className:"text-white dark:text-zinc-900"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-black text-zinc-900 dark:text-white",children:"Live Sync Manager"}),e.jsx("p",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest mt-0.5",children:"External Database Connector"})]})]}),e.jsx("button",{onClick:u,className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg text-zinc-400 transition-colors",children:e.jsx(ye,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-5",children:e.jsxs(e.Fragment,{children:[j==="input"&&e.jsxs("div",{className:"text-center py-8 animate-in fade-in duration-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-950/30 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(Ee,{size:24,className:"text-blue-500"})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Ready to Sync"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs mx-auto",children:"Fetch latest tickets from Google Sheets. Review before saving."}),H&&e.jsxs("div",{className:"mt-4 p-2.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 text-xs font-medium rounded-lg flex items-center gap-2 justify-center",children:[e.jsx(gt,{size:14})," ",H]})]}),j==="analyzing"&&e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center animate-in fade-in duration-200",children:[e.jsx(Ne,{size:32,className:"animate-spin text-blue-500 mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Analyzing Data..."}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Comparing Remote vs Database"})]}),j==="review"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in duration-200",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(ze,{label:"New",value:m.newItems.length,variant:"new"}),e.jsx(ze,{label:"Updates",value:m.updatedItems.length,variant:"update"}),e.jsx(ze,{label:"Unchanged",value:m.uptodateItems.length,variant:"unchanged"})]}),M>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[9px] font-black uppercase text-zinc-400 tracking-widest",children:"Pending Sync Records"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[M," items to process"]})]}),e.jsxs("button",{onClick:T,disabled:j==="analyzing",className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95",title:"Re-fetch latest data",children:[e.jsx(Fe,{size:12,className:j==="analyzing"?"animate-spin":""})," Refresh"]})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-[1.5rem] overflow-hidden shadow-inner",children:e.jsxs("div",{className:"max-h-[320px] overflow-y-auto custom-scrollbar divide-y divide-zinc-100 dark:divide-zinc-800",children:[m.newItems.map(l=>e.jsx(Ae,{item:l,type:"new"},l.ticketNumber)),m.updatedItems.map(l=>e.jsx(Ae,{item:l,type:"update"},l.ticketNumber))]})})]}):e.jsxs("div",{className:"py-10 text-center border border-dashed border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] bg-zinc-50/50 dark:bg-zinc-900/30",children:[e.jsx(Te,{size:32,className:"mx-auto mb-3 text-emerald-500/40"}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-white uppercase tracking-tight",children:"System Synchronized"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1 max-w-[200px] mx-auto leading-relaxed",children:"Your local database matches the remote Google Sheets source."}),e.jsxs("button",{onClick:T,className:"mt-6 flex items-center gap-1.5 px-4 py-2 mx-auto bg-white dark:bg-zinc-800 rounded-xl text-zinc-500 hover:text-blue-500 transition-all font-black text-[9px] uppercase border border-zinc-200/50 dark:border-zinc-700/50 active:scale-95 shadow-sm",children:[e.jsx(Fe,{size:12})," Force Re-Check"]})]})]}),j==="success"&&e.jsxs("div",{className:"py-10 flex flex-col items-center justify-center text-center animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-14 h-14 bg-emerald-500 rounded-xl flex items-center justify-center text-white mb-4",children:e.jsx(Te,{size:28,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white",children:"Sync Complete"}),e.jsx("p",{className:"text-xs text-zinc-400 mt-1",children:"Database updated successfully"})]})]})}),e.jsxs("div",{className:"shrink-0 px-5 py-4 border-t border-zinc-100 dark:border-zinc-800 flex justify-end gap-2 bg-zinc-50/50 dark:bg-zinc-900/30",children:[j==="input"&&e.jsxs("button",{onClick:T,className:"px-5 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-[0.98] transition-all flex items-center gap-2",children:["Fetch & Analyze ",e.jsx(kt,{size:14})]}),j==="review"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Back"}),e.jsxs("button",{onClick:ie,disabled:M===0,className:"px-5 py-2 bg-blue-500 text-white rounded-lg text-xs font-bold hover:bg-blue-600 active:scale-[0.98] transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx(yt,{size:14})," Confirm Sync"]})]}),j==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-xs font-medium text-zinc-400",children:[e.jsx(Ne,{size:14,className:"animate-spin"})," Updating Database..."]}),j==="success"&&e.jsx("button",{onClick:u,className:"px-4 py-2 text-xs font-bold text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:"Close"})]})]})})}const je=z.memo(({label:s,required:u,icon:p,...n})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[p&&e.jsx(p,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",u&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{...n,className:de("w-full h-11 px-4 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none disabled:opacity-50",n.className)})]}));je.displayName="ModernInput";const ge=z.memo(({label:s,value:u,onChange:p,options:n,required:j,icon:w})=>e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[w&&e.jsx(w,{size:10,className:"text-primary/70",strokeWidth:3}),s," ",j&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("select",{value:u,onChange:m=>p(m.target.value),className:de("w-full h-11 px-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all cursor-pointer","text-zinc-900 dark:text-white focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none"),children:[e.jsx("option",{value:"",children:"Select..."}),n.map(m=>e.jsx("option",{value:m,children:m},m))]})]}));ge.displayName="ModernSelect";const we=z.memo(({label:s,icon:u,...p})=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1 flex items-center gap-1.5",children:[u&&e.jsx(u,{size:10,className:"text-primary/70",strokeWidth:3}),s]}),e.jsx("textarea",{...p,className:de("w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl text-sm transition-all resize-none","text-zinc-900 dark:text-white placeholder:text-zinc-400 focus:bg-white dark:focus:bg-zinc-950","focus:ring-2 focus:ring-primary/20 focus:border-primary focus:outline-none",p.className)})]}));we.displayName="ModernTextarea";const Re=z.memo(({label:s,value:u,onChange:p,options:n,colorMap:j={}})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-zinc-500 dark:text-zinc-400 tracking-widest ml-1",children:s}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(w=>{const m=u===w,y=w?.toLowerCase()||"zinc",H=j[y]||"zinc",c={red:"bg-rose-500 text-white shadow-lg shadow-rose-500/30",orange:"bg-orange-500 text-white shadow-lg shadow-orange-500/30",amber:"bg-amber-500 text-white shadow-lg shadow-amber-500/30",emerald:"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30",blue:"bg-indigo-600 text-white shadow-lg shadow-indigo-500/30",purple:"bg-purple-600 text-white shadow-lg shadow-purple-500/30",zinc:"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 shadow-lg"}[H];return e.jsx("button",{type:"button",onClick:()=>p(w),className:de("h-10 px-4 rounded-xl text-[11px] font-black uppercase tracking-wider transition-all duration-300 active:scale-95",m?c:"bg-white dark:bg-zinc-800 border border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:border-zinc-300"),children:w},w)})})]}));Re.displayName="ModernPillPicker";const We={ticketNumber:"",type:"Incident",status:"Open",severity:"Low",category:"",subCategory:"",shortDesc:"",details:"",action:"",resolvedDetail:"",assign:"",remark:""};function qt({isOpen:s,onClose:u,initialData:p,onSubmit:n,isSubmitting:j}){const{ticketOptions:w}=Je(),{team:m}=vt(),[y,H]=z.useState(We),c={open:"red",pending:"amber",succeed:"emerald",closed:"zinc"},A={low:"emerald",medium:"blue",high:"orange",critical:"red"};z.useEffect(()=>{let l=!0;return s&&setTimeout(()=>{l&&(H(p||We),document.body.style.overflow="hidden")},0),()=>{l=!1,document.body.style.overflow=""}},[p,s]);const T=z.useCallback((l,K)=>{H(F=>({...F,[l]:K}))},[]),ie=z.useCallback(l=>{l.preventDefault(),n(y)},[y,n]);if(!s)return null;const M=!!p;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-zinc-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-[#0c0c0e] rounded-[2.5rem] border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[95vh] animate-in zoom-in-95 duration-400",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-zinc-100 dark:border-zinc-800 flex items-center justify-between relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:de("w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transform -rotate-3",M?"bg-amber-100 dark:bg-amber-500/20 text-amber-600":"bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600"),children:e.jsx(ct,{size:22,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:M?"Edit Ticket":"Create New Ticket"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:de("w-1.5 h-1.5 rounded-full",M?"bg-amber-500":"bg-indigo-500")}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:M?`Modifying Record ${y.ticketNumber}`:"Deploying Operational Log"})]})]})]}),e.jsx("button",{onClick:u,className:"w-10 h-10 flex items-center justify-center rounded-2xl hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-90",children:e.jsx(ye,{size:20,strokeWidth:2.5})})]}),e.jsxs("form",{id:"ticket-form",onSubmit:ie,className:"flex-1 overflow-y-auto custom-scrollbar px-8 py-6 pb-12 space-y-8",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"01. Identity & Routing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(je,{label:"Ticket Number",icon:zt,required:!0,disabled:M,value:y.ticketNumber,onChange:l=>T("ticketNumber",l.target.value),placeholder:""}),e.jsx(ge,{label:"Log Assignee",icon:Ye,value:y.assign,onChange:l=>T("assign",l),options:m.map(l=>l.name)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ge,{label:"Type",icon:jt,value:y.type,onChange:l=>T("type",l),options:w.types||[]}),e.jsx(ge,{label:"Category",value:y.category,onChange:l=>T("category",l),options:w.categories||[]}),e.jsx(ge,{label:"Sub-Category",value:y.subCategory,onChange:l=>T("subCategory",l),options:w.subCategories||[]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"02. Priority & State"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Re,{label:"Current Status",value:y.status,onChange:l=>T("status",l),options:w.statuses||[],colorMap:c}),e.jsx(Re,{label:"Operational Severity",value:y.severity,onChange:l=>T("severity",l),options:w.severities||[],colorMap:A})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"03. Incident Narrative"}),e.jsx(je,{label:"Subject Brief",icon:Tt,required:!0,value:y.shortDesc,onChange:l=>T("shortDesc",l.target.value),placeholder:""}),e.jsx(we,{label:"Deep System Details",rows:4,value:y.details,onChange:l=>T("details",l.target.value),placeholder:""})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h3",{className:"text-[10px] font-black text-primary uppercase tracking-[0.2em] border-b border-primary/10 pb-2",children:"04. Action Taken & Closure"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(we,{label:"Mitigation Steps",rows:4,value:y.action,onChange:l=>T("action",l.target.value),placeholder:""}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(je,{label:"Resolution Result",value:y.resolvedDetail,onChange:l=>T("resolvedDetail",l.target.value),placeholder:""}),e.jsx(we,{label:"Operator Remarks",rows:2,value:y.remark,onChange:l=>T("remark",l.target.value),placeholder:""})]})]})]})]}),e.jsxs("div",{className:"px-8 py-6 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/40 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-rose-500 animate-pulse"}),e.jsx("span",{className:"opacity-70 text-rose-600 dark:text-rose-500",children:"*"})," Field Persistence Required"]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 md:flex-none h-12 px-6 rounded-2xl text-xs font-black uppercase tracking-widest text-zinc-500 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-200/50 dark:hover:bg-zinc-800 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",form:"ticket-form",disabled:j,className:de("flex-1 md:flex-none flex items-center justify-center gap-2 h-12 px-8 rounded-2xl text-xs font-black uppercase tracking-widest text-white shadow-xl shadow-primary/20","transition-all active:scale-95 disabled:opacity-50",M?"bg-amber-500 hover:bg-amber-600":"bg-primary hover:brightness-110"),children:j?e.jsx(Ne,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{size:16,strokeWidth:2.5}),M?"Update Log":"Commit Ticket"]})})]})]})]})})}const Bt=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},He=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},rt=z.memo(({date:s})=>{const u=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:xe(u,"MMM")}),e.jsx("span",{className:"text-sm font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:xe(u,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5",children:xe(u,"yy")})]})});rt.displayName="DateBox";const st=z.memo(({log:s,onLogClick:u,onSendToIncident:p,onEdit:n,onDelete:j,canEdit:w})=>{const m=()=>u(s),y=A=>{A.stopPropagation(),p(s,A)},H=A=>{A.stopPropagation(),n(s)},c=A=>{A.stopPropagation(),j(s.ticketNumber)};return e.jsxs("tr",{onClick:m,className:"group hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer border-b border-zinc-100 dark:border-zinc-800 last:border-0",children:[e.jsx("td",{className:"py-4 pl-6 pr-3 whitespace-nowrap",children:e.jsx(rt,{date:s.createdAt})}),e.jsx("td",{className:"py-4 px-3 whitespace-nowrap",children:e.jsxs("span",{className:"font-mono text-xs font-black text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-950/30 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-900/50 shadow-sm",children:["#",s.ticketNumber]})}),e.jsx("td",{className:"py-4 px-3 w-full",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-1 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md border ${Bt(s.status)} shadow-sm`,children:s.status}),e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx(Ze,{size:10,className:He(s.severity)}),e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${He(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-1.5 py-0.5 rounded-md bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-4 h-4 rounded-md bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-[8px] font-black text-zinc-600 dark:text-zinc-300 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():e.jsx(Ye,{size:10})}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 truncate max-w-[120px]",children:s.assign||"Unassigned"})]}),e.jsx("span",{className:"text-[9px] font-bold text-zinc-400 uppercase tracking-widest bg-zinc-100/50 dark:bg-zinc-800/30 px-1.5 py-0.5 rounded",children:s.type})]})]})}),e.jsx("td",{className:"py-4 pl-3 pr-6 text-right whitespace-nowrap",children:w&&e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:y,className:"p-1.5 text-zinc-400 hover:text-amber-500 hover:bg-amber-50 rounded-md",title:"Add to Timeline",children:e.jsx(et,{size:16})}),e.jsx("button",{onClick:H,className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-blue-50 rounded-md",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:c,className:"p-1.5 text-zinc-400 hover:text-red-500 hover:bg-red-50 rounded-md",children:e.jsx(tt,{size:16})})]})})]})});st.displayName="TicketTableRow";function $t({logs:s,onLogClick:u,onSendToIncident:p,onEdit:n,onDelete:j,canEdit:w}){return e.jsx("div",{className:"hidden md:block bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-zinc-50 dark:bg-zinc-800/50 border-b border-zinc-200 dark:border-zinc-800",children:[e.jsx("th",{className:"py-4 pl-6 pr-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Date"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Ticket ID"}),e.jsx("th",{className:"py-4 px-3 text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Operational Summary & Metadata"}),e.jsx("th",{className:"py-4 pl-3 pr-6 text-right text-[10px] uppercase font-bold text-zinc-400 tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-zinc-100 dark:divide-zinc-800",children:s.map(m=>e.jsx(st,{log:m,onLogClick:u,onSendToIncident:p,onEdit:n,onDelete:j,canEdit:w},m.id))})]})})})}const Kt=s=>{switch(s?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},Qe=s=>{switch(s?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}},at=z.memo(({date:s})=>{const u=s?new Date(s):new Date;return e.jsxs("div",{className:"w-10 h-10 sm:w-11 sm:h-11 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200/60 dark:border-zinc-700/60 flex flex-col items-center justify-center shrink-0 shadow-sm",children:[e.jsx("span",{className:"text-[8px] sm:text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase leading-none",children:xe(u,"MMM")}),e.jsx("span",{className:"text-sm sm:text-base font-black text-zinc-900 dark:text-white leading-none mt-0.5",children:xe(u,"dd")}),e.jsx("span",{className:"text-[7px] font-bold text-zinc-300 dark:text-zinc-600 leading-none mt-0.5 hidden sm:block",children:xe(u,"yy")})]})});at.displayName="DateBox";const it=z.memo(({log:s,onClick:u,onEdit:p,canEdit:n})=>e.jsx("div",{onClick:u,className:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-[1.5rem] p-4 shadow-sm hover:shadow-md transition-all active:scale-[0.99] group overflow-hidden",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx(at,{date:s.createdAt}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 text-[10px] sm:text-xs font-black rounded-lg border border-blue-100 dark:border-blue-800",children:["#",s.ticketNumber]}),e.jsx("span",{className:`text-[9px] sm:text-[10px] uppercase font-black px-2 py-0.5 rounded-full border ${Kt(s.status)} shadow-sm`,children:s.status})]}),n&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:j=>{j.stopPropagation(),p(s)},className:"p-1.5 text-zinc-400 hover:text-blue-500 hover:bg-zinc-50 dark:hover:bg-zinc-800 rounded-lg transition-colors",children:e.jsx(Oe,{size:14})})})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 line-clamp-2 leading-tight mb-2",children:s.shortDesc||s.details||"No Description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-3 border-t border-zinc-100 dark:border-zinc-800/50",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-5 h-5 rounded-lg bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500 shadow-inner",children:s.assign?s.assign.charAt(0).toUpperCase():"U"}),e.jsx("span",{className:"text-[11px] font-medium text-zinc-500 truncate max-w-[70px]",children:s.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{size:12,className:Qe(s.severity)}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${Qe(s.severity)}`,children:s.severity||"Low"})]}),e.jsx("div",{className:"ml-auto text-[10px] text-zinc-400 font-bold bg-zinc-50 dark:bg-zinc-800/50 px-2 py-0.5 rounded-lg",children:s.type})]})]})]})}));it.displayName="MobileTicketCard";function Wt({logs:s,onLogClick:u,onEdit:p,canEdit:n}){return e.jsx("div",{className:"md:hidden space-y-4",children:s.map(j=>e.jsx(it,{log:j,onClick:()=>u(j),onEdit:p,canEdit:n},j.id))})}const Ht=({log:s,onClose:u,onSendToIncident:p,onEdit:n,onDelete:j,canEdit:w})=>{if(!s)return null;const m=s.createdAt?xe(new Date(s.createdAt),"dd MMM yyyy"):"-",y=c=>{switch(c?.toLowerCase()){case"open":return"bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900/50";case"pending":return"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50";case"succeed":return"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50";default:return"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"}},H=c=>{switch(c?.toLowerCase()){case"critical":return"text-red-500";case"high":return"text-orange-500";case"medium":return"text-blue-500";case"low":return"text-emerald-500";default:return"text-zinc-400"}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:u,children:e.jsxs("div",{className:"w-[95vw] sm:w-full max-w-xl bg-white dark:bg-zinc-950 rounded-t-2xl sm:rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[85vh] shadow-2xl animate-in slide-in-from-bottom-10 sm:zoom-in-95 duration-200",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"px-5 sm:px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-blue-500 text-white text-[9px] font-bold rounded",children:"TICKET"}),e.jsxs("span",{className:"text-lg sm:text-xl font-black text-zinc-900 dark:text-white",children:["#",s.ticketNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[10px] text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ht,{size:11})," ",m]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rt,{size:11})," ",s.type]}),e.jsx("span",{className:"hidden sm:inline",children:""}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border ${y(s.status)}`,children:s.status})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-blue-500 hover:text-white transition-colors",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:j,className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-zinc-400 hover:bg-red-500 hover:text-white transition-colors",children:e.jsx(tt,{size:14})})]}),e.jsx("button",{onClick:u,className:"p-2 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors",children:e.jsx(ye,{size:16})})]})]}),e.jsxs("div",{className:"p-5 sm:p-6 overflow-y-auto custom-scrollbar space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Severity"}),e.jsx("span",{className:`text-sm font-bold ${H(s.severity)}`,children:s.severity||"Low"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.category||"-"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-lg bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[9px] font-bold uppercase text-zinc-400 block",children:"Sub Category"}),e.jsx("span",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-200 truncate",children:s.subCategory||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 tracking-wide",children:"Description"}),e.jsx("div",{className:"p-4 bg-zinc-50 dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-mono max-h-48 overflow-y-auto custom-scrollbar",children:s.details||s.shortDesc||"No details available"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(xt,{size:12,className:"text-blue-500"})," Action Taken"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.action||"No action recorded"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-bold uppercase text-zinc-400 mb-2 flex items-center gap-1.5",children:[e.jsx(Te,{size:12,className:"text-emerald-500"})," Resolution"]}),e.jsx("p",{className:"text-sm text-zinc-600 dark:text-zinc-300",children:s.resolvedDetail||"Pending"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-zinc-100 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center text-xs font-bold",children:s.assign?.[0]?.toUpperCase()||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[9px] font-bold uppercase text-zinc-400",children:"Assignee"}),e.jsx("div",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:s.assign||"Unassigned"})]})]}),w&&e.jsxs("button",{onClick:()=>{p(),u()},className:"flex items-center gap-2 px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-lg text-xs font-bold hover:opacity-90 active:scale-95 transition-all",children:[e.jsx(et,{size:14})," Add to Timeline"]})]})]})})};function gr(){const{logs:s,loading:u,loadingMore:p,hasMore:n,loadMore:j,stats:w}=pt(),{toast:m}=Ge(),{currentUser:y}=ot(),H=lt(y,[Me.LEAD,Me.ENGINEER]),{ticketOptions:c}=Je(),A=dt(),T=Ve(),[ie,M]=z.useState(!1),[l,K]=z.useState(""),[F,ee]=z.useState("All"),[se,S]=z.useState("All"),[W,ae]=z.useState(null),J=z.useDeferredValue(l),[i,t]=z.useState(!1),[r,a]=z.useState(null),[d,o]=z.useState(!1),[k,P]=z.useState(null),[te,Y]=z.useState(!1);Pt(s);const _=z.useCallback(()=>{a(null),t(!0)},[]),O=z.useCallback(x=>{a(x),t(!0)},[]),f=z.useCallback(async x=>{o(!0);try{r?(await ke.updateLog(r.ticketNumber,x),m({title:"Updated",description:"Ticket updated successfully."})):(await ke.createLog(x),m({title:"Created",description:"New ticket created."})),T.invalidateQueries(["ticketLogs"]),t(!1),a(null),ae(null)}catch(b){console.error(b),m({variant:"destructive",title:"Error",description:b.message})}finally{o(!1)}},[r,T,m]),G=z.useCallback(x=>{P(x)},[]),v=z.useCallback(async()=>{if(k)try{await ke.deleteLog(k),m({title:"Deleted",description:"Ticket deleted."}),T.invalidateQueries(["ticketLogs"]),ae(null)}catch(x){m({variant:"destructive",title:"Error",description:x.message})}finally{P(null)}},[k,T,m]),C=z.useCallback(async(x,b)=>{if(b&&b.stopPropagation(),!y){m({variant:"destructive",title:"Auth Required",description:"Please login first."});return}try{const D=typeof y=="object"&&y!==null?{name:y.name,id:y.id,role:y.role}:{name:y},L={subject:x.shortDesc||x.details||"New Incident from Log",ticket:x.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(x.type)?x.type:"Incident",status:"Open",createdBy:D,impact:"",root_cause:x.details||"",action:x.action||""};await mt.createIncident(L),m({title:"Successfully Added",description:`Ticket #${x.ticketNumber} is now in Ticket Timeline.`,action:e.jsx("button",{onClick:()=>A("/incidents"),className:"px-2.5 py-1 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded text-[9px] font-bold",children:"Go Now"})})}catch(D){console.error(D),m({variant:"destructive",title:"Error",description:"Failed to add to ticket timeline."})}},[y,A,m]),h=z.useMemo(()=>s.filter(x=>{const b=x.ticketNumber?.toLowerCase().includes(J.toLowerCase())||x.shortDesc?.toLowerCase().includes(J.toLowerCase())||x.details&&x.details.toLowerCase().includes(J.toLowerCase()),D=F==="All"||x.status===F,L=se==="All"||x.type===se;return b&&D&&L}).sort((x,b)=>new Date(b.createdAt||0)-new Date(x.createdAt||0)),[s,J,F,se]),q=F!=="All"||se!=="All",B=z.useCallback(()=>{ee("All"),S("All"),K("")},[]),Q=z.useCallback(x=>{ae(x)},[]);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-black transition-colors",children:[e.jsx("div",{className:"shrink-0 py-5 px-4 sm:px-6 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 text-[9px] font-bold rounded uppercase tracking-wider",children:"System Log"}),e.jsxs("span",{className:"text-[10px] font-bold text-zinc-400",children:[w.total," Records"]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-black text-zinc-900 dark:text-white tracking-tight",children:"Ticket Management"})]}),H&&e.jsxs("div",{className:"flex items-center gap-2 self-start sm:self-auto w-full sm:w-auto",children:[e.jsxs("button",{onClick:_,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-blue-600 text-white hover:bg-blue-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Nt,{size:16})," New Ticket"]}),e.jsxs("button",{onClick:()=>M(!0),disabled:u,className:"flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-700 active:scale-95 transition-all shadow-sm",children:[e.jsx(Ee,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Sync"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(_t,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"",value:l,onChange:x=>K(x.target.value),className:"w-full h-10 pl-10 pr-9 bg-zinc-100 dark:bg-zinc-800 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-blue-500/20 text-zinc-900 dark:text-white placeholder:text-zinc-400 transition-all"}),l&&e.jsx("button",{onClick:()=>K(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-500",children:e.jsx(ye,{size:14})})]}),e.jsxs("button",{onClick:()=>Y(!0),className:de("h-10 px-3 flex items-center justify-center rounded-xl transition-all border",q?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 border-blue-200 dark:border-blue-800":"bg-zinc-100 dark:bg-zinc-800 text-zinc-500 border-transparent"),children:[e.jsx(Pe,{size:18}),q&&e.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-blue-500 rounded-full"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-3",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-zinc-200 dark:border-zinc-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs font-medium text-zinc-400",children:"Loading tickets..."})]}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] gap-4 text-zinc-300 dark:text-zinc-700",children:[e.jsx(Ct,{size:60,strokeWidth:1}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"No records found"}),e.jsx("button",{onClick:()=>{K(""),ee("All"),S("All")},className:"px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-medium text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-colors",children:"Reset Filters"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{logs:h,onLogClick:Q,onSendToIncident:C,onEdit:O,onDelete:G,canEdit:H}),e.jsx(Wt,{logs:h,onLogClick:Q,onEdit:O,canEdit:H}),n&&e.jsx("div",{className:"pt-8 pb-16 flex justify-center",children:e.jsxs("button",{onClick:j,disabled:p,className:"flex flex-col items-center gap-2 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors disabled:opacity-40",children:[e.jsx("div",{className:"w-9 h-9 rounded-full border border-zinc-200 dark:border-zinc-700 flex items-center justify-center hover:scale-105 transition-transform",children:p?e.jsx(Ne,{className:"animate-spin",size:16}):e.jsx(Dt,{size:16})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Load More"})]})})]})})}),W&&e.jsx(Ht,{log:W,onClose:()=>ae(null),onSendToIncident:()=>C(W),onEdit:()=>O(W),onDelete:()=>G(W.ticketNumber),canEdit:H}),e.jsx(qt,{isOpen:i,onClose:()=>t(!1),initialData:r,onSubmit:f,isSubmitting:d}),e.jsx(ut,{isOpen:!!k,onClose:()=>P(null),onConfirm:v,title:"Delete Confirmation",message:`Are you sure you want to delete ticket #${k}? This action cannot be undone.`,isDanger:!0}),e.jsx(Ut,{isOpen:ie,onClose:()=>M(!1),currentLogs:s,onSyncComplete:x=>{m({title:"Sync Completed",description:`Updated ${x} records.`}),T.invalidateQueries({queryKey:["ticketLogs"]}),M(!1)}}),te&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>Y(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-[2.5rem] p-8 shadow-2xl animate-in slide-in-from-bottom duration-400 max-w-2xl mx-auto w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-500/20 text-blue-600 flex items-center justify-center",children:e.jsx(Pe,{size:20})}),e.jsx("h3",{className:"text-xl font-black text-zinc-900 dark:text-white uppercase tracking-tight",children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>Y(!1),className:"w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 rounded-2xl text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(ye,{size:20,strokeWidth:2.5})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Current Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...c.statuses].map(x=>e.jsx("button",{onClick:()=>ee(x),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",F===x?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-[0.2em] block mb-4 ml-1",children:"Log Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...c.types].map(x=>e.jsx("button",{onClick:()=>S(x),className:de("h-10 px-5 rounded-xl text-xs font-black uppercase tracking-wider transition-all duration-200 border",se===x?"bg-zinc-900 text-white dark:bg-white dark:text-zinc-900 border-transparent shadow-lg":"bg-zinc-50 dark:bg-zinc-800 border-zinc-100 dark:border-zinc-700 text-zinc-500 hover:border-zinc-300"),children:x},x))})]})]}),e.jsxs("div",{className:"mt-10 flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>{B(),Y(!1)},className:"flex-1 h-12 rounded-2xl text-xs font-black uppercase tracking-widest text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/50 transition-colors",children:"Reset Filters"}),e.jsx("button",{onClick:()=>Y(!1),className:"flex-[2] h-12 rounded-2xl bg-blue-600 text-white text-xs font-black uppercase tracking-widest shadow-xl shadow-blue-500/30 hover:brightness-110 active:scale-95 transition-all",children:"Apply Constraints"})]})]})]})]})}export{gr as default};
