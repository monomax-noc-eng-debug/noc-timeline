import{j as v,d as n,b as d,q as h,c as l,m,g as D,u as w,h as S,s as g,a as u,o as E,l as O}from"./firebaseConfig-hLvP2kJq.js";const a="incidents",p="events",I={subscribeIncidents:(e,t=100)=>{const r=h(l(n,a),u("updatedAt","desc"),O(t));return E(r,o=>{const s=o.docs.map(c=>{const i=c.data();return{id:c.id,...i,status:i.status||"Open",type:i.type||"Incident",project:i.project||"MONOMAX",_sortTime:new Date(i.updatedAt||i.createdAt||0).getTime()}});e(s)},o=>{console.error("Incidents subscription error:",o),e([])})},subscribeEvents:(e,t)=>{const r=h(l(n,a,e,p),u("order","asc"),u("date","desc"),u("time","desc"));return E(r,o=>{const s=o.docs.map(c=>({id:c.id,...c.data(),imageUrls:c.data().imageUrls||[]}));t(s)},o=>{console.error("Events subscription error:",o),t([])})},createIncident:async(e,t=null)=>{try{const r={...e,status:e.status||"Open",type:e.type||"Incident",priority:e.priority||"Medium",project:e.project||"MONOMAX",eventCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t?(await g(d(n,a,t),r),{id:t}):await S(l(n,a),r)}catch(r){throw console.error("Create incident error:",r),new Error("Failed to create incident")}},updateIncident:async(e,t)=>{try{await w(d(n,a,e),{...t,updatedAt:new Date().toISOString()})}catch(r){throw console.error("Update incident error:",r),new Error("Failed to update incident")}},deleteIncident:async e=>{try{const t=l(n,a,e,p),r=await m(t),o=v(n);r.docs.forEach(s=>{o.delete(s.ref)}),o.delete(d(n,a,e)),await o.commit()}catch(t){throw console.error("Delete incident error:",t),new Error("Failed to delete incident")}},createEvent:async(e,t)=>{try{const r=await S(l(n,a,e,p),{...t,order:t.order??-Date.now(),imageUrls:t.imageUrls||[],createdAt:new Date().toISOString()});return await w(d(n,a,e),{updatedAt:new Date().toISOString()}),r}catch(r){throw console.error("Create event error:",r),new Error("Failed to create event")}},updateEvent:async(e,t,r)=>{try{await w(d(n,a,e,p,t),{...r,updatedAt:new Date().toISOString()}),await w(d(n,a,e),{updatedAt:new Date().toISOString()})}catch(o){throw console.error("Update event error:",o),new Error("Failed to update event")}},deleteEvent:async(e,t)=>{try{await D(d(n,a,e,p,t)),await w(d(n,a,e),{updatedAt:new Date().toISOString()})}catch(r){throw console.error("Delete event error:",r),new Error("Failed to delete event")}},getEvents:async e=>{try{const t=h(l(n,a,e,p));return(await m(t)).docs.map(s=>({id:s.id,...s.data()})).sort((s,c)=>{const i=s.date||"1970-01-01",y=c.date||"1970-01-01";return i!==y?i.localeCompare(y):(s.time||"00:00").localeCompare(c.time||"00:00")})}catch(t){return console.error("Get events error:",t),[]}},reorderEvents:async(e,t)=>{try{const r=v(n);t.forEach(o=>{const s=d(n,a,e,p,o.id);r.update(s,{order:o.order})}),await r.commit()}catch(r){throw console.error("Reorder events error:",r),new Error("Failed to reorder events")}}};export{I as i};
