import{d as W,r as a,j as e,C as P,ai as Re,X as ie,J as re,H as vr,L as De,ao as ft,F as _e,A as ce,G as lt,I as Ze,al as Ke,ar as jr,as as wr,ap as kr,af as Qe,at as gt,ag as te,ah as T,ad as ue,ae as vt,au as Je,av as et,aw as Te,ax as zr,ay as yr,az as Nr,B as xe,b as jt,U as Cr,P as Dr,a as Sr,Q as dt}from"./index-C3czKcPY.js";import{i as Z}from"./incidentService-hSnMctO1.js";import{u as wt,S as Mr,a as Ir}from"./useTicketOptions-O6WAl--4.js";import{b as kt,D as Ve,a as Er,g as tt,I as zt,C as Rr,B as _r,u as Tr,d as Ar}from"./driveUpload-D3Mp_gcv.js";import{H as ve}from"./hash-C64pZ5YP.js";import{T as ne,P as be}from"./trash-2-B1eE1hNZ.js";import{C as yt}from"./chevron-right-Ch1Og8Bl.js";import{L as He}from"./layers-1BXcnLjO.js";import{S as Pr}from"./search-DCEkWZIL.js";import{C as Or,P as le}from"./pen-line-ChAF7eKQ.js";import{C as Lr}from"./chevron-down-Oe6pi4Dz.js";import{C as de}from"./clock-z-v43bZh.js";import{C as Me}from"./circle-check-BBL36_JP.js";import{D as Fr,f as $r,u as We,d as Nt,R as Ur,A as Br,h as Gr,e as Kr,g as Vr,F as Hr,i as Wr,j as Xr}from"./formatters-kIzuffS5.js";import{T as qr}from"./TimeInput-EBwNXEqU.js";import{u as ut}from"./setYear-850W9rN9.js";import{P as Ct}from"./panels-top-left-3xTkezJA.js";import{S as Dt}from"./save-P60SZD5d.js";import{S as he}from"./shield-check-HSuy0hy3.js";import{k as Yr,a as St}from"./format-DPgh7KlH.js";import{C as Zr}from"./check-F4gu04fC.js";import{C as Qr}from"./copy-ZZRjUofR.js";import{c as Jr}from"./configService-BE8VHHI1.js";import{Z as Mt}from"./zap-Bo1WTbTg.js";import{A as en}from"./arrow-left-or5DTtCM.js";import{H as tn,L as rn}from"./layout-list-Dp_dTeIp.js";import{T as nn}from"./tag-Dki7gCbV.js";import{A as sn}from"./arrow-right-zQ-P0s3d.js";import"./useBaseQuery-C-SPIq1p.js";import"./addYears-Wkomck9s.js";import"./index-QYqCDngJ.js";import"./rotate-ccw-DHJdR8Te.js";const an=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],on=W("circle-x",an);const cn=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],ln=W("ellipsis",cn);const dn=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],un=W("file-plus-corner",dn);const xn=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],mn=W("fingerprint-pattern",xn);const pn=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],bn=W("flag",pn);const hn=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],xt=W("folder-kanban",hn);const fn=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],gn=W("image-plus",fn);const vn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],jn=W("image",vn);const wn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],mt=W("inbox",wn);const kn=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],zn=W("layout-dashboard",kn);const yn=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Nn=W("link",yn);const Cn=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Xe=W("message-square",Cn);const Dn=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Sn=W("workflow",Dn);const Mn=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],In=W("wrench",Mn),En=()=>{const[t,n]=a.useState([]),[r,s]=a.useState(null),[o,c]=a.useState(!0),[l,i]=a.useState(null),[x,h]=a.useState(""),[d,u]=a.useState("All"),[g,D]=a.useState("All");a.useEffect(()=>{c(!0),i(null);const N=Z.subscribeIncidents(C=>{const M=(C||[]).map(I=>({...I,_searchString:`${I.subject||""} ${I.project||""} ${I.ticket||""} ${I.createdBy&&typeof I.createdBy=="object"?I.createdBy.name:I.createdBy||""} ${I.status||""} ${I.type||""}`.toLowerCase()}));n(M),c(!1),i(null)},C=>{console.error("useIncidents error:",C),i(C.message||"Failed to connect to database"),c(!1)});return()=>{typeof N=="function"&&N()}},[]);const p=a.useMemo(()=>{const N=x.toLowerCase().trim();return t.filter(M=>{const I=!N||(M._searchString||"").includes(N),$=d==="All"||M.status===d,A=g==="All"||M.type===g;return I&&$&&A}).sort((M,I)=>{const $=M.createdAt?new Date(M.createdAt).getTime():0;return(I.createdAt?new Date(I.createdAt).getTime():0)-$})},[t,x,d,g]),S=a.useMemo(()=>{const N={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((C,M)=>{C.total++;const I=M.status?.replace(/\s+/g,"").replace(/^\w/,$=>$.toLowerCase());return C[I]!==void 0?C[I]++:M.status==="In Progress"&&C.inProgress++,C},N)},[t]),v=a.useCallback(()=>{h(""),u("All"),D("All")},[]);return{incidents:t,filteredIncidents:p,selectedId:r,setSelectedId:s,loading:o,error:l,searchTerm:x,setSearchTerm:h,filterStatus:d,setFilterStatus:u,filterType:g,setFilterType:D,clearFilters:v,hasActiveFilters:!!x||d!=="All"||g!=="All",stats:S}},Rn=t=>{const[n,r]=a.useState([]),[s,o]=a.useState(!1);a.useEffect(()=>{if(!t){setTimeout(()=>{r([])},0);return}const l=Z.subscribeEvents(t,i=>{const x=(i||[]).map(h=>({...h,_sortTime:new Date(`${h.date||"1970-01-01"}T${h.time||"00:00"}`).getTime()}));r(x),o(!1)});return()=>l&&l()},[t]);const c=a.useMemo(()=>[...n].sort((l,i)=>i._sortTime-l._sortTime),[n]);return{events:n,sortedEvents:c,loading:s}},me=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),pt=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},_n=(t,n)=>{const r=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s;const c=n.endsWith(".csv")?n:`${n}.csv`;o.download=c,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(s)},0)},Tn=t=>{switch(t){case"Open":return{accent:"open",text:"text-rose-600",bg:"bg-rose-50 dark:bg-rose-500/10",border:"border-rose-200 dark:border-rose-500/20"};case"In Progress":return{accent:"blue",text:"text-[#0078D4]",bg:"bg-[#0078D4]/10 dark:bg-[#0078D4]/20",border:"border-[#0078D4]/20 dark:border-[#0078D4]/30"};case"Monitoring":case"Pending":return{accent:"pending",text:"text-amber-600",bg:"bg-amber-50 dark:bg-amber-500/10",border:"border-amber-200 dark:border-amber-500/20"};case"Succeed":case"Resolved":return{accent:"resolved",text:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-500/10",border:"border-emerald-200 dark:border-emerald-500/20"};case"Closed":return{accent:"closed",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"};default:return{accent:"none",text:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800",border:"border-zinc-200 dark:border-zinc-700"}}},An=a.memo(({incident:t,isSelected:n,onClick:r,onDelete:s})=>{const o=Tn(t.status),c=t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs(kt,{variant:"interactive",selected:n,accent:n?"blue":o.accent,showAccent:!1,size:"sm",onClick:r,className:P("group flex flex-col gap-2 mb-2 rounded-lg border transition-all duration-200",n?"bg-white dark:bg-zinc-900 border-[#0078D4] ring-1 ring-[#0078D4]/20 shadow-md z-10":"border-zinc-200 dark:border-zinc-800 hover:border-[#0078D4] hover:shadow-sm bg-white dark:bg-zinc-900"),children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-wrap",children:[e.jsx("div",{className:P("w-2 h-2 rounded-full shrink-0",o.accent==="open"?"bg-rose-600":o.accent==="blue"?"bg-[#0078D4]":o.accent==="pending"?"bg-amber-500":o.accent==="resolved"?"bg-emerald-600":"bg-zinc-400")}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold uppercase bg-zinc-50 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-200 dark:border-zinc-700",children:t.project||"CORE"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase",children:t.type}),e.jsx("span",{className:"text-[10px] text-zinc-300 dark:text-zinc-700",children:"•"}),e.jsxs("span",{className:"text-[10px] font-medium text-zinc-400 uppercase flex items-center gap-1",children:[e.jsx(ve,{size:10}),t.ticket||"-"]}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase ml-auto sm:ml-0",children:c})]}),!n&&e.jsx("button",{onClick:l=>{l.stopPropagation(),s(t.id)},className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:e.jsx(ne,{size:12})})]}),e.jsx("div",{className:"pr-4",children:e.jsx("h3",{className:P("text-sm font-bold leading-snug line-clamp-2 transition-colors",n?"text-zinc-900 dark:text-white":"text-zinc-700 dark:text-zinc-300 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.subject||"Untitled Incident"})}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:P("text-[10px] font-bold uppercase px-2 py-0.5 rounded-full border",o.bg,o.text,o.border),children:t.status}),n&&e.jsx(yt,{size:14,className:"text-[#0078D4]"})]})]})}),Pn=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},On=t=>{switch(t?.toLowerCase()){case"open":return"open";case"pending":return"pending";case"succeed":return"resolved";default:return"none"}},bt=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},Ln=a.memo(({log:t,isSelected:n,onClick:r})=>{const s=t.createdAt?new Date(t.createdAt):null,o=s?s.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs(kt,{variant:"interactive",selected:n,accent:n?"primary":On(t.status),showAccent:!0,size:"md",onClick:r,className:P("group mb-3",!n&&"hover:-translate-y-1"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:P("px-2.5 py-1 rounded-lg text-[9px] font-mediumst border",Pn(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:o})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:P("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",n?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(Re,{size:10,className:P("shrink-0",bt(t.severity))}),e.jsx("span",{className:P("text-[9px] font-mediumst",bt(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(yt,{size:18,className:"text-zinc-300"})})]})});function Fn(t,n){const[r,s]=a.useState(t);return a.useEffect(()=>{const o=setTimeout(()=>s(t),n);return()=>clearTimeout(o)},[t,n]),r}const $n=({filteredIncidents:t,selectedId:n,onSelect:r,onAddIncident:s,onDeleteIncident:o,onExportCSV:c,onSync:l,stats:i,logs:x,selectedLogId:h,onSelectLog:d,logsLoading:u,viewMode:g,onViewModeChange:D,searchTerm:p,setSearchTerm:S,filterStatus:v,setFilterStatus:m,filterType:N,setFilterType:C,clearFilters:M,hasActiveFilters:I,loading:$,error:A,canEdit:O})=>{const{ticketOptions:U}=wt(),[B,G]=a.useState(p),f=Fn(B,300),[_,E]=a.useState(!1);a.useEffect(()=>{S(f)},[f,S]),a.useEffect(()=>{G(p)},[p]);const[b,k]=a.useState(20),R=a.useRef(null),z=g==="logs",w=z?x:t,K=z?u:$;a.useEffect(()=>{k(20)},[w?.length,g,v,N,f]),a.useEffect(()=>{const j=new IntersectionObserver(X=>{X[0].isIntersecting&&w?.length>b&&k(q=>q+20)},{threshold:.1});return R.current&&j.observe(R.current),()=>j.disconnect()},[w,b]);const L=j=>{m(j===v?"All":j)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsxs("header",{className:"shrink-0 bg-white dark:bg-[#09090b] border-b border-zinc-200 dark:border-zinc-800 z-20 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-md flex items-center justify-center shrink-0 transition-colors bg-[#0078D4] text-white",children:z?e.jsx(mt,{size:16}):e.jsx(He,{size:16})}),e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 rounded-md p-0.5",children:[e.jsx("button",{onClick:()=>D("incidents"),className:`px-3 py-1.5 rounded-sm text-[10px] font-semibold uppercase tracking-wide transition-all ${z?"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300":"bg-white dark:bg-zinc-900 text-[#0078D4] shadow-sm"}`,children:"Cases"}),e.jsx("button",{onClick:()=>D("logs"),className:`px-3 py-1.5 rounded-sm text-[10px] font-semibold uppercase tracking-wide transition-all ${z?"bg-white dark:bg-zinc-900 text-[#0078D4] shadow-sm":"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"}`,children:"Logs"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex items-center gap-1.5",children:!z&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>c(t),className:"hidden sm:flex w-8 h-8 items-center justify-center rounded-lg text-zinc-500 hover:text-[#0078D4] hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",title:"Export CSV",children:e.jsx(Ve,{size:16})}),O&&e.jsxs("button",{onClick:s,className:"flex items-center gap-1.5 h-8 px-3 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-md text-[10px] font-semibold uppercase tracking-wide shadow-sm transition-all",children:[e.jsx(un,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"New"})]})]})})]}),e.jsxs("div",{className:"flex gap-2 px-3 pb-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Pr,{size:14,className:"absolute left-2.5 top-1/2 -translate-y-1/2 text-zinc-400 group-focus-within:text-[#0078D4] transition-colors"}),e.jsx("input",{type:"text",value:B,onChange:j=>G(j.target.value),placeholder:z?"Search logs...":"Search cases...",className:"w-full h-8 pl-8 pr-7 rounded-lg bg-zinc-100 dark:bg-zinc-900 border-transparent text-xs font-normal focus:bg-white focus:ring-1 focus:ring-[#0078D4] text-zinc-900 dark:text-white placeholder:text-zinc-500 transition-all"}),B&&e.jsx("button",{onClick:()=>G(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-red-600",children:e.jsx(ie,{size:12})})]}),e.jsx("button",{onClick:()=>E(!0),className:`h-8 w-8 flex items-center justify-center rounded-lg transition-all ${I?"bg-[#deecf9] text-[#0078D4] border border-[#0078D4]/20":"bg-white dark:bg-zinc-900 text-zinc-600 border border-zinc-200 dark:border-zinc-800"}`,children:e.jsx(Mr,{size:14})})]}),!z&&i&&e.jsx("div",{className:"flex gap-1.5 px-3 pb-2 overflow-x-auto no-scrollbar",children:[{label:"Open",count:i.open,color:"bg-red-500"},{label:"Pending",count:i.pending,color:"bg-amber-500"},{label:"Resolved",count:i.resolved,color:"bg-emerald-500"}].map(j=>e.jsxs("button",{onClick:()=>L(j.label),className:`flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-semibold uppercase tracking-wide transition-all whitespace-nowrap shrink-0 border ${v===j.label?"bg-white text-zinc-900 border-zinc-300 shadow-sm":"bg-zinc-50 text-zinc-500 border-transparent hover:bg-zinc-100"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${j.color}`}),j.label,e.jsxs("span",{className:"opacity-50",children:["(",j.count,")"]})]},j.label))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:A&&!z?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(re,{className:"text-red-600",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:A})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(vr,{size:12}),"Retry"]})]}):K&&b===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(De,{className:"animate-spin text-[#0078D4]",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):w?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[z?e.jsx(mt,{size:40,strokeWidth:1}):e.jsx(He,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),I&&e.jsx("button",{onClick:M,className:"mt-2 text-xs text-[#0078D4] font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[w.slice(0,b).map(j=>z?e.jsx(Ln,{log:j,isSelected:h===(j.ticketNumber||j.id),onClick:()=>d(j)},j.ticketNumber||j.id):e.jsx(An,{incident:j,isSelected:n===j.id,onClick:()=>r(j.id),onDelete:o},j.id)),e.jsx("div",{ref:R,className:"h-4 w-full"})]})}),_&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>E(!1)}),e.jsxs("div",{className:"relative mt-auto bg-white dark:bg-zinc-900 rounded-t-xl p-5 shadow-2xl animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("h3",{className:"text-base font-bold text-zinc-900 dark:text-white",children:"Filters"}),e.jsx("button",{onClick:()=>E(!1),className:"p-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-full text-zinc-600 hover:text-zinc-900",children:e.jsx(ie,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...U.statuses].map(j=>e.jsx("button",{onClick:()=>m(j),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${v===j?"bg-[#0078D4] text-white dark:bg-[#0078D4] dark:text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...U.types].map(j=>e.jsx("button",{onClick:()=>C(j),className:`px-3 py-2 rounded-lg text-xs font-bold transition-all ${N===j?"bg-[#0078D4] text-white dark:bg-[#0078D4] dark:text-white":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400"}`,children:j},j))})]})]}),e.jsxs("div",{className:"mt-6 flex gap-2",children:[e.jsx("button",{onClick:()=>{M(),E(!1)},className:"flex-1 py-3 text-red-600 font-bold bg-red-50 dark:bg-red-900/20 rounded-lg hover:bg-red-100 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>E(!1),className:"flex-[2] py-3 bg-[#0078D4] text-white font-bold rounded-lg shadow-lg shadow-[#0078D4]/30 hover:bg-[#106EBE] transition-colors text-sm",children:"Apply"})]})]})]}),!z&&O&&e.jsx("button",{onClick:s,className:"md:hidden absolute bottom-5 right-5 z-40 w-12 h-12 bg-[#0078D4] text-white rounded-full shadow-xl shadow-[#0078D4]/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(be,{size:22})})]})},Un=a.memo($n),Bn=t=>{const n=t.type?.toLowerCase()||"",r=t.desc?.toLowerCase()||"",s={message:Xe,alert:re,check:Me,clock:de,update:le},o=t.iconType?s[t.iconType]:null;return n==="create"||r.includes("created")?{icon:o||be,colorClass:"text-white bg-[#0078D4] border-[#0078D4]"}:n==="update"||r.includes("updated")?{icon:o||le,colorClass:"text-amber-700 bg-amber-100 border-amber-200 dark:bg-amber-900/40 dark:text-amber-400 dark:border-amber-800"}:n==="status_change"||r.includes("resolved")||r.includes("closed")||r.includes("succeed")?{icon:o||Me,colorClass:"text-emerald-700 bg-emerald-100 border-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-400 dark:border-emerald-800"}:n==="alert"||r.includes("alert")||r.includes("error")||r.includes("failed")?{icon:o||re,colorClass:"text-rose-700 bg-rose-100 border-rose-200 dark:bg-rose-900/40 dark:text-rose-400 dark:border-rose-800"}:{icon:o||Xe,colorClass:"text-zinc-500 bg-zinc-100 dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700"}},Gn=t=>{switch(t){case"rose":return"bg-rose-50 text-rose-700 border-rose-200 dark:bg-rose-900/40 dark:text-rose-300 dark:border-rose-800";case"emerald":return"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/40 dark:text-emerald-300 dark:border-emerald-800";case"white":default:return"bg-zinc-50 text-zinc-600 border-zinc-200 dark:bg-zinc-800 dark:text-zinc-400 dark:border-zinc-700"}},Kn=t=>{switch(t){case"rose":return"text-rose-600 bg-rose-50 border-rose-200 dark:bg-rose-900/20 dark:border-rose-800";case"emerald":return"text-emerald-600 bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-800";case"white":return"text-zinc-500 bg-white border-zinc-200 dark:bg-zinc-800 dark:border-zinc-700";default:return null}},Vn=({src:t,index:n,onClick:r,className:s})=>{const[o,c]=a.useState(!1),[l,i]=a.useState(null);return a.useEffect(()=>{c(!1)},[t]),a.useEffect(()=>{if(!t){i(null);return}let x=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(x=URL.createObjectURL(t),i(x)):typeof t=="string"&&i(tt(t)),()=>{x&&URL.revokeObjectURL(x)}},[t]),o||!l?e.jsx("div",{className:P(s,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(zt,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>r(t),className:P("relative group/img overflow-hidden cursor-zoom-in",s),children:[e.jsx("img",{src:l,alt:`evidence-${n}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>c(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(jn,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function Hn({event:t,index:n,isLastItem:r,onEdit:s,onDelete:o,onMove:c}){const[l,i]=a.useState(null),{icon:x,colorClass:h}=Bn(t),u=Kn(t.statusOnLineColor)||h,D=(t.date?new Date(t.date):new Date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),p=t.time||"00:00";let S=(t.imageUrls||[]).filter(v=>v);return!S.length&&t.image&&(S=[t.image]),e.jsxs("div",{className:"group relative flex w-full gap-4 pb-8",children:[e.jsx("div",{className:"relative shrink-0 w-4 flex flex-col items-center",children:e.jsx("div",{className:P("absolute left-1/2 -translate-x-1/2 w-[1px] bg-zinc-300 dark:bg-zinc-700 z-0",n===0?"top-4":"-top-4",r?"bottom-auto h-12":"-bottom-4")})}),e.jsx("div",{className:"flex flex-col items-end shrink-0 w-14 pt-1 relative",children:e.jsxs("div",{className:"flex flex-col items-end w-full pr-1 relative z-10 transition-transform group-hover:scale-105",children:[e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 tabular-nums leading-none tracking-tight",children:p}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 uppercase mt-1 leading-none",children:D})]})}),e.jsxs("div",{className:"relative shrink-0 flex flex-col items-center pt-1 h-full",children:[t.statusOnLine&&e.jsx("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 z-30 whitespace-nowrap pb-1",children:e.jsx("div",{className:P("text-[9px] font-bold uppercase px-2.5 py-0.5 rounded border shadow-sm bg-white dark:bg-black",Gn(t.statusOnLineColor||"white")),children:t.statusOnLine})}),e.jsx("div",{className:P("w-8 h-8 rounded-full flex items-center justify-center border-2 shadow-sm z-20 transition-all duration-300 bg-white dark:bg-[#09090b]",u),children:e.jsx(x,{size:14,strokeWidth:2.5})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative bg-white dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 hover:border-[#0078D4] dark:hover:border-[#0078D4] transition-all duration-300 group/card",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2 pb-2 border-b border-zinc-100 dark:border-zinc-800/50 border-dashed",children:[e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-white leading-snug break-words",children:t.title||"Operational Update"}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 opacity-100 sm:opacity-0 group-hover/card:opacity-100 transition-opacity",children:[c&&e.jsxs("div",{className:"hidden sm:flex items-center bg-zinc-100 dark:bg-zinc-800/50 rounded-lg p-0.5 border border-zinc-200 dark:border-zinc-700 mr-2",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),c(n,"up")},className:"p-1 hover:text-[#0078D4] hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Or,{size:12})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),c(n,"down")},className:"p-1 hover:text-[#0078D4] hover:bg-white dark:hover:bg-zinc-700 rounded transition-colors",children:e.jsx(Lr,{size:12})})]}),e.jsx("button",{onClick:()=>s(t),className:"p-1.5 text-zinc-400 hover:text-[#0078D4] hover:bg-[#0078D4]/10 dark:hover:bg-[#0078D4]/20 rounded-lg transition-colors",title:"Edit",children:e.jsx(le,{size:14})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 text-zinc-400 hover:text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition-colors",title:"Delete",children:e.jsx(ne,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap font-normal break-words max-w-full",children:t.desc||t.details}),S.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-2 border-t border-zinc-100 dark:border-zinc-800/50 border-dashed",children:S.map((v,m)=>e.jsx(Vn,{index:m,src:v,onClick:i,className:"w-20 h-20 rounded-lg border border-zinc-200 dark:border-zinc-700 shadow-sm"},m))}),(t.updatedBy||t.createdBy)&&e.jsx("div",{className:"mt-3 flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded bg-zinc-50 dark:bg-zinc-800/50 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#0078D4] flex items-center justify-center text-[7px] font-bold text-white shadow-sm",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-semibold text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})})]})}),e.jsx(Er,{isOpen:!!l,onClose:()=>i(null),imageUrl:l,allImages:S})]})}const Wn=a.memo(Hn),$e=a.memo(({label:t,icon:n})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[n&&e.jsx(n,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),Xn=a.memo(({error:t,className:n,...r})=>e.jsx("input",{...r,className:P("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-[#0078D4]/50 focus:ring-4 focus:ring-[#0078D4]/5",t?"border-rose-500":"",n)})),Ne=a.memo(({children:t,title:n,icon:r,badge:s})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[r&&e.jsx(r,{size:14,className:"text-zinc-400 group-hover/row:text-[#0078D4] transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase ",children:n})]}),s&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:s})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function qn({isOpen:t,onClose:n,initialData:r,incidentId:s,onSave:o}){const c=a.useRef(null),[l,i]=a.useState({date:null,time:"",desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"}),[x,h]=a.useState({}),[d,u]=a.useState(!1),[g,D]=a.useState(""),[p,S]=a.useState(!1),[v,m]=a.useState(0),[N,C]=a.useState(null),[M,I]=a.useState({}),$=a.useRef(null),[A,O]=a.useState({isOpen:!1,type:null,index:null});a.useEffect(()=>{if(r){let b=r.imageUrls||[];!b.length&&r.image&&(b=[r.image]),i({date:r.date&&Yr(ut(r.date))?ut(r.date):null,time:r.time||"",desc:r.desc||r.title||"",imageUrls:b,iconType:r.iconType||"message",statusOnLineColor:r.statusOnLineColor||"white"})}else i({date:new Date,time:"",desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"});h({}),D(""),I({})},[r,t]);const U=b=>{const k=b||g.trim();k&&!l.imageUrls.includes(k)&&(i(R=>({...R,imageUrls:[...R.imageUrls,k]})),D(""))},B=b=>{const k=l.imageUrls[b];i(R=>({...R,imageUrls:R.imageUrls.filter((z,w)=>w!==b)})),k?.includes("drive.google.com")&&Ar(k).catch(console.error)},G=async b=>{const k=b.target.files?.[0];if(k){b.target.value=null,S(!0),m(0),C(null),$.current=new AbortController;try{const R=await Tr(k,z=>m(z),$.current.signal);R?.webViewLink&&U(R.webViewLink)}catch(R){R.name!=="AbortError"&&C(R.message||"Upload failed")}finally{S(!1),m(0)}}},f=()=>{$.current?.abort(),S(!1),m(0)},_=async b=>{b.preventDefault();const k={};if(l.desc?.trim()||(k.desc=!0),Object.keys(k).length){h(k);return}u(!0);try{await o({...l,date:l.date?$r(l.date):null,id:r?.id}),n()}catch(R){console.error("Failed to save event:",R)}finally{u(!1)}},E=async()=>{if(A.type==="image")B(A.index);else if(A.type==="item"){u(!0);try{await o({...r,_delete:!0}),n()}finally{u(!1)}}O({isOpen:!1,type:null,index:null})};return e.jsxs(e.Fragment,{children:[e.jsx(ft,{isOpen:A.isOpen,onClose:()=>O({isOpen:!1,type:null,index:null}),title:A.type==="image"?"Remove Asset?":"Delete Record?",message:A.type==="image"?"This asset will be permanently removed.":"This record will be permanently deleted.",confirmLabel:A.type==="image"?"Remove":"Delete",isDanger:!0,onConfirm:E}),e.jsx(_e,{isOpen:t,onClose:n,isLoading:d,size:"md",showCloseButton:!1,headerClassName:"p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#0078D4] text-white flex items-center justify-center shadow-lg",children:e.jsx(he,{size:20,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:r?"Edit Operation":"New Deployment"})]}),e.jsx("button",{onClick:n,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(ie,{size:18})})]}),footerClassName:"p-6 pt-2 flex items-center gap-3 border-t-0",footer:e.jsxs(e.Fragment,{children:[r&&e.jsx("button",{type:"button",onClick:()=>O({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-lg bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(ne,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:d||p,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[d?e.jsx(De,{size:18,className:"animate-spin"}):e.jsx(Dt,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Commit Record"})]})]}),bodyClassName:"p-6 space-y-8",children:e.jsxs("form",{id:"event-form",onSubmit:_,className:"space-y-8",children:[e.jsx(Ne,{title:"Temporal Matrix",icon:de,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx($e,{label:"Deployment Date"}),e.jsx(Fr,{date:l.date,setDate:b=>i({...l,date:b}),placeholder:"Select date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx($e,{label:"Sync Time"}),e.jsx(qr,{value:l.time,onChange:b=>i({...l,time:b.target.value})})]})]})}),e.jsx(Ne,{title:"Visual Personalization",icon:mn,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-lg border border-zinc-100 dark:border-white/5",children:[e.jsx($e,{label:"Marker Status",icon:ve}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(b=>e.jsx("button",{type:"button",onClick:()=>i({...l,statusOnLineColor:b}),className:P("w-5 h-5 rounded-full border-2 transition-all",b==="white"?"bg-white border-zinc-200":b==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",l.statusOnLineColor===b?"ring-4 ring-[#0078D4]/20 scale-110 shadow-lg border-[#0078D4]":"opacity-30 border-transparent")},b))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg",children:[{id:"message",icon:Xe},{id:"alert",icon:re},{id:"check",icon:Me},{id:"clock",icon:de},{id:"update",icon:le},{id:"activity",icon:ce}].map(b=>e.jsx("button",{type:"button",onClick:()=>i({...l,iconType:b.id}),className:P("h-9 flex items-center justify-center rounded-lg transition-all",l.iconType===b.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(b.icon,{size:14,strokeWidth:2.5})},b.id))})]})}),e.jsx(Ne,{title:"Operational Narrative",icon:Ct,children:e.jsx("textarea",{className:P("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",x.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:l.desc,onChange:b=>i({...l,desc:b.target.value})})}),e.jsx(Ne,{title:"Intelligence Evidence",icon:gn,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(Xn,{placeholder:"Asset URL...",value:g,onChange:b=>D(b.target.value)}),e.jsx(Nn,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>U(),disabled:!g,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(be,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>c.current.click(),disabled:p,className:"h-10 w-10 flex items-center justify-center bg-[#0078D4] text-white rounded-lg transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:G}),p?e.jsx(De,{size:16,className:"animate-spin"}):e.jsx(Rr,{size:16})]})]}),(p||N)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-lg p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:p?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{size:12,className:"animate-spin text-[#0078D4]"}),e.jsx("span",{className:"text-[9px] font-medium text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-[#0078D4] tabular-nums",children:[Math.round(v),"%"]}),e.jsx("button",{type:"button",onClick:f,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(_r,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300 ease-out",style:{width:`${v}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(re,{size:12}),e.jsx("span",{className:"text-[9px] font-medium",children:N})]})}),l.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:l.imageUrls.map((b,k)=>e.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[M[k]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(zt,{size:16})}):e.jsx("img",{src:tt(b),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>I(R=>({...R,[k]:!0}))}),e.jsx("button",{type:"button",onClick:R=>{R.stopPropagation(),O({isOpen:!0,type:"image",index:k})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(ne,{size:16})})]},k))})]})})]})})]})}function Yn({isOpen:t,onClose:n,text:r,incident:s}){const[o,c]=lt.useState(!1),[l,i]=lt.useState("preview"),x=a.useMemo(()=>{if(s)return{meta:{Project:s.project||"-",Subject:s.subject||"-",Status:s.status||"-",Ticket:s.ticket||"-"},details:{Impact:s.impact||"-","Root Cause":s.root_cause||"-","Action Taken":s.action||"-"},timeline:(s.events||[]).map(p=>({date:p.date?new Date(p.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:p.time,desc:p.desc||p.title,originalDate:p.date,imageUrls:p.imageUrls||(p.image?[p.image]:[])}))};if(!r)return null;const d={meta:{},details:{},timeline:[]},u=r.split(`
`);let g=!1,D="";return u.forEach(p=>{const S=p.trim();if(!S)return;const v=p.indexOf(":");if(!g&&v!==-1&&v<20){const m=p.substring(0,v).trim(),N=p.substring(v+1).trim();["Project","Subject","Status","Ticket"].includes(m)?d.meta[m]=N:(["Impact","Root Cause","Action Taken"].includes(m),d.details[m]=N)}else if(g=!0,S.length<20&&/\d/.test(S)&&!S.includes("-"))D=S;else{const N=S.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*น\.)?\s*(.*)/);N?d.timeline.push({date:D,time:N[1],desc:N[2]||""}):d.timeline.push({date:D,time:null,desc:S})}}),d},[r,s]),h=async()=>{try{await navigator.clipboard.writeText(r),c(!0),setTimeout(()=>{c(!1),n()},1e3)}catch(d){console.error("Failed to copy:",d);const u=document.createElement("textarea");u.value=r,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),c(!0),setTimeout(()=>{c(!1),n()},1e3)}};return t?e.jsx(_e,{isOpen:t,onClose:n,size:"2xl",showCloseButton:!1,headerClassName:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-sm",children:e.jsx(Ke,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>i("preview"),className:`text-[10px] font-medium px-2 py-0.5 rounded-md transition-all ${l==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>i("raw"),className:`text-[10px] font-medium px-2 py-0.5 rounded-md transition-all ${l==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:n,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(ie,{size:20})})]}),bodyClassName:"p-0 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",footerClassName:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",footer:e.jsx("button",{onClick:h,disabled:o,className:`flex items-center gap-2 px-6 py-2.5 rounded-lg text-xs font-medium transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${o?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Zr,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Qr,{size:16})," Copy to Clipboard"]})}),children:l==="raw"?e.jsx("textarea",{readOnly:!0,value:r,className:"w-full h-full min-h-[50vh] p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x?.meta&&Object.entries(x.meta).map(([d,u])=>e.jsxs("div",{className:"p-4 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 block mb-1",children:d}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:u})]},d))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-medium text-zinc-400 flex items-center gap-2",children:[e.jsx(ce,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:x?.details&&Object.entries(x.details).map(([d,u])=>{let g=ce;return d.includes("Impact")&&(g=Re),d.includes("Root")&&(g=Sn),d.includes("Action")&&(g=In),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(g,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500",children:d})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:u==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):u})]},d)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-medium text-zinc-400 flex items-center gap-2",children:[e.jsx(de,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),x?.timeline.map((d,u)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(u===0||d.date!==x.timeline[u-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(Ze,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:d.date})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[d.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:d.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:d.desc}),d.imageUrls&&d.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:d.imageUrls.map((g,D)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:tt(g),alt:`Evidence ${D+1}`,className:"w-full h-full object-cover",onError:p=>{p.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},D))})]})]},u)),x?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}):null}function Zn(){const[t,n]=a.useState([]),[r,s]=a.useState(!0);return a.useEffect(()=>{const o=Jr.subscribeProjects(c=>{n(c),s(!1)});return()=>o()},[]),{projects:t,loading:r}}function Qn({isOpen:t,onClose:n,incident:r,onUpdate:s,onDelete:o}){const{ticketOptions:c}=wt(),{projects:l}=Zn(),[i,x]=a.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});a.useEffect(()=>{r&&setTimeout(()=>{x({subject:r.subject||"",project:r.project||"",type:r.type||"Incident",ticket:r.ticket||"",status:r.status||"Open",priority:r.priority||"Medium",impact:r.impact||"",root_cause:r.root_cause||"",action:r.action||""})},0)},[r,t]);const h=i.subject?.includes("|")&&i.subject?.includes("-"),d=m=>{let N={subject:m};if(m.includes("|")&&m.includes("-")){const C=m.split("|").map(M=>M.trim());if(C.length>=2){const M=C[0].split("-").map(I=>I.trim());if(M.length>=2){N.ticket=M[0],N.project=M[1];const I=c?.types||["Incident","Request","Maintenance"];N.type=I.find($=>$.toLowerCase()===C[1].toLowerCase())||C[1],C.length>=3&&(N.subject=C.slice(2).join(" | "))}}}x(C=>({...C,...N}))};if(!t)return null;const u=m=>{m.preventDefault(),s(i),n()},g=m=>{const N={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:re},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:de},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:Me},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:on}};return N[m]||N.Open},D=m=>{const N={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-[#0078D4]",bg:"bg-[#0078D4]/10"}};return N[m]||N.Medium},p="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",S="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] outline-none transition-all",v="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-xs font-medium focus:ring-4 focus:ring-[#0078D4]/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx(_e,{isOpen:t,onClose:n,size:"lg",showCloseButton:!1,headerClassName:"px-6 py-5 bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(he,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:n,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(ie,{size:18})})]}),footerClassName:"p-6 pt-2 border-t border-zinc-100 dark:border-white/5 flex items-center justify-between",footer:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:o,className:"h-11 px-5 rounded-lg bg-rose-500/10 text-rose-500 font-semibold text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(ne,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:n,className:"h-11 px-6 rounded-lg text-[9px] font-medium text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",form:"incident-form",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[9px] font-medium shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(Dt,{size:14})," Commit Changes"]})]})]}),bodyClassName:"p-6",children:e.jsxs("form",{id:"incident-form",onSubmit:u,className:"space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-lg bg-[#0078D4]/5 border border-[#0078D4]/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:P(p,"text-[#0078D4]"),children:[e.jsx(Ct,{size:10})," Protocol Signature (Subject)"]}),h&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Mt,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-lg p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4]/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:i.subject,onChange:m=>d(m.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(ce,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:P(v,g(i.status).color),value:i.status,onChange:m=>x({...i,status:m.target.value}),children:(c.statuses||["Open","Pending","Succeed","Closed"]).map(m=>e.jsx("option",{value:m,className:"bg-white dark:bg-zinc-950",children:m},m))}),e.jsx(de,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(bn,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:P(v,D(i.priority).color),value:i.priority,onChange:m=>x({...i,priority:m.target.value}),children:(c.severities||["Critical","High","Medium","Low"]).map(m=>e.jsx("option",{value:m,className:"bg-white dark:bg-zinc-950",children:m},m))}),e.jsx(Re,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(ve,{size:10,className:"text-[#0078D4]"})," Ticket Identity"]}),e.jsx("input",{type:"text",className:S,value:i.ticket,onChange:m=>x({...i,ticket:m.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(xt,{size:10,className:"text-[#0078D4]"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:v,value:i.project,onChange:m=>x({...i,project:m.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(l&&l.length>0?l:["MONOMAX","MONO29","3BB GIGATV"]).map(m=>e.jsx("option",{value:m,className:"bg-white dark:bg-zinc-950",children:m},m))]}),e.jsx(xt,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(re,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[80px] resize-none transition-all",value:i.impact,onChange:m=>x({...i,impact:m.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(jr,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:i.root_cause,onChange:m=>x({...i,root_cause:m.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:p,children:[e.jsx(he,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:i.action,onChange:m=>x({...i,action:m.target.value}),placeholder:""})]})]})]})]})})}const It=kr("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Se({className:t,variant:n,asChild:r=!1,...s}){const o=r?wr:"span";return e.jsx(o,{"data-slot":"badge",className:P(It({variant:n}),t),...s})}Se.variants=It;var Jn=a.createContext(void 0);function Et(t){const n=a.useContext(Jn);return t||n||"ltr"}var Ue="rovingFocusGroup.onEntryFocus",es={bubbles:!1,cancelable:!0},je="RovingFocusGroup",[qe,Rt,ts]=gt(je),[rs,_t]=Qe(je,[ts]),[ns,ss]=rs(je),Tt=a.forwardRef((t,n)=>e.jsx(qe.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(qe.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(as,{...t,ref:n})})}));Tt.displayName=je;var as=a.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:r,orientation:s,loop:o=!1,dir:c,currentTabStopId:l,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:x,onEntryFocus:h,preventScrollOnEntryFocus:d=!1,...u}=t,g=a.useRef(null),D=ue(n,g),p=Et(c),[S,v]=vt({prop:l,defaultProp:i??null,onChange:x,caller:je}),[m,N]=a.useState(!1),C=Je(h),M=Rt(r),I=a.useRef(!1),[$,A]=a.useState(0);return a.useEffect(()=>{const O=g.current;if(O)return O.addEventListener(Ue,C),()=>O.removeEventListener(Ue,C)},[C]),e.jsx(ns,{scope:r,orientation:s,dir:p,loop:o,currentTabStopId:S,onItemFocus:a.useCallback(O=>v(O),[v]),onItemShiftTab:a.useCallback(()=>N(!0),[]),onFocusableItemAdd:a.useCallback(()=>A(O=>O+1),[]),onFocusableItemRemove:a.useCallback(()=>A(O=>O-1),[]),children:e.jsx(te.div,{tabIndex:m||$===0?-1:0,"data-orientation":s,...u,ref:D,style:{outline:"none",...t.style},onMouseDown:T(t.onMouseDown,()=>{I.current=!0}),onFocus:T(t.onFocus,O=>{const U=!I.current;if(O.target===O.currentTarget&&U&&!m){const B=new CustomEvent(Ue,es);if(O.currentTarget.dispatchEvent(B),!B.defaultPrevented){const G=M().filter(k=>k.focusable),f=G.find(k=>k.active),_=G.find(k=>k.id===S),b=[f,_,...G].filter(Boolean).map(k=>k.ref.current);Ot(b,d)}}I.current=!1}),onBlur:T(t.onBlur,()=>N(!1))})})}),At="RovingFocusGroupItem",Pt=a.forwardRef((t,n)=>{const{__scopeRovingFocusGroup:r,focusable:s=!0,active:o=!1,tabStopId:c,children:l,...i}=t,x=We(),h=c||x,d=ss(At,r),u=d.currentTabStopId===h,g=Rt(r),{onFocusableItemAdd:D,onFocusableItemRemove:p,currentTabStopId:S}=d;return a.useEffect(()=>{if(s)return D(),()=>p()},[s,D,p]),e.jsx(qe.ItemSlot,{scope:r,id:h,focusable:s,active:o,children:e.jsx(te.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...i,ref:n,onMouseDown:T(t.onMouseDown,v=>{s?d.onItemFocus(h):v.preventDefault()}),onFocus:T(t.onFocus,()=>d.onItemFocus(h)),onKeyDown:T(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){d.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const m=cs(v,d.orientation,d.dir);if(m!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let C=g().filter(M=>M.focusable).map(M=>M.ref.current);if(m==="last")C.reverse();else if(m==="prev"||m==="next"){m==="prev"&&C.reverse();const M=C.indexOf(v.currentTarget);C=d.loop?ls(C,M+1):C.slice(M+1)}setTimeout(()=>Ot(C))}}),children:typeof l=="function"?l({isCurrentTabStop:u,hasTabStop:S!=null}):l})})});Pt.displayName=At;var os={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function is(t,n){return n!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function cs(t,n,r){const s=is(t.key,r);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return os[s]}function Ot(t,n=!1){const r=document.activeElement;for(const s of t)if(s===r||(s.focus({preventScroll:n}),document.activeElement!==r))return}function ls(t,n){return t.map((r,s)=>t[(n+s)%t.length])}var ds=Tt,us=Pt;function xs(t){const n=ms(t),r=a.forwardRef((s,o)=>{const{children:c,...l}=s,i=a.Children.toArray(c),x=i.find(bs);if(x){const h=x.props.children,d=i.map(u=>u===x?a.Children.count(h)>1?a.Children.only(null):a.isValidElement(h)?h.props.children:null:u);return e.jsx(n,{...l,ref:o,children:a.isValidElement(h)?a.cloneElement(h,void 0,d):null})}return e.jsx(n,{...l,ref:o,children:c})});return r.displayName=`${t}.Slot`,r}function ms(t){const n=a.forwardRef((r,s)=>{const{children:o,...c}=r;if(a.isValidElement(o)){const l=fs(o),i=hs(c,o.props);return o.type!==a.Fragment&&(i.ref=s?et(s,l):l),a.cloneElement(o,i)}return a.Children.count(o)>1?a.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var ps=Symbol("radix.slottable");function bs(t){return a.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ps}function hs(t,n){const r={...n};for(const s in n){const o=t[s],c=n[s];/^on[A-Z]/.test(s)?o&&c?r[s]=(...i)=>{const x=c(...i);return o(...i),x}:o&&(r[s]=o):s==="style"?r[s]={...o,...c}:s==="className"&&(r[s]=[o,c].filter(Boolean).join(" "))}return{...t,...r}}function fs(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=n&&"isReactWarning"in n&&n.isReactWarning;return r?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=n&&"isReactWarning"in n&&n.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Ye=["Enter"," "],gs=["ArrowDown","PageUp","Home"],Lt=["ArrowUp","PageDown","End"],vs=[...gs,...Lt],js={ltr:[...Ye,"ArrowRight"],rtl:[...Ye,"ArrowLeft"]},ws={ltr:["ArrowLeft"],rtl:["ArrowRight"]},we="Menu",[fe,ks,zs]=gt(we),[se,Ft]=Qe(we,[zs,Nt,_t]),Ae=Nt(),$t=_t(),[ys,ae]=se(we),[Ns,ke]=se(we),Ut=t=>{const{__scopeMenu:n,open:r=!1,children:s,dir:o,onOpenChange:c,modal:l=!0}=t,i=Ae(n),[x,h]=a.useState(null),d=a.useRef(!1),u=Je(c),g=Et(o);return a.useEffect(()=>{const D=()=>{d.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>d.current=!1;return document.addEventListener("keydown",D,{capture:!0}),()=>{document.removeEventListener("keydown",D,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),e.jsx(Ur,{...i,children:e.jsx(ys,{scope:n,open:r,onOpenChange:u,content:x,onContentChange:h,children:e.jsx(Ns,{scope:n,onClose:a.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:g,modal:l,children:s})})})};Ut.displayName=we;var Cs="MenuAnchor",rt=a.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t,o=Ae(r);return e.jsx(Br,{...o,...s,ref:n})});rt.displayName=Cs;var nt="MenuPortal",[Ds,Bt]=se(nt,{forceMount:void 0}),Gt=t=>{const{__scopeMenu:n,forceMount:r,children:s,container:o}=t,c=ae(nt,n);return e.jsx(Ds,{scope:n,forceMount:r,children:e.jsx(Te,{present:r||c.open,children:e.jsx(zr,{asChild:!0,container:o,children:s})})})};Gt.displayName=nt;var Y="MenuContent",[Ss,st]=se(Y),Kt=a.forwardRef((t,n)=>{const r=Bt(Y,t.__scopeMenu),{forceMount:s=r.forceMount,...o}=t,c=ae(Y,t.__scopeMenu),l=ke(Y,t.__scopeMenu);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Te,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:l.modal?e.jsx(Ms,{...o,ref:n}):e.jsx(Is,{...o,ref:n})})})})}),Ms=a.forwardRef((t,n)=>{const r=ae(Y,t.__scopeMenu),s=a.useRef(null),o=ue(n,s);return a.useEffect(()=>{const c=s.current;if(c)return Gr(c)},[]),e.jsx(at,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:T(t.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),Is=a.forwardRef((t,n)=>{const r=ae(Y,t.__scopeMenu);return e.jsx(at,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Es=xs("MenuContent.ScrollLock"),at=a.forwardRef((t,n)=>{const{__scopeMenu:r,loop:s=!1,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:l,disableOutsidePointerEvents:i,onEntryFocus:x,onEscapeKeyDown:h,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:g,onDismiss:D,disableOutsideScroll:p,...S}=t,v=ae(Y,r),m=ke(Y,r),N=Ae(r),C=$t(r),M=ks(r),[I,$]=a.useState(null),A=a.useRef(null),O=ue(n,A,v.onContentChange),U=a.useRef(0),B=a.useRef(""),G=a.useRef(0),f=a.useRef(null),_=a.useRef("right"),E=a.useRef(0),b=p?Vr:a.Fragment,k=p?{as:Es,allowPinchZoom:!0}:void 0,R=w=>{const K=B.current+w,L=M().filter(V=>!V.disabled),j=document.activeElement,X=L.find(V=>V.ref.current===j)?.textValue,q=L.map(V=>V.textValue),oe=Gs(q,K,X),Q=L.find(V=>V.textValue===oe)?.ref.current;(function V(y){B.current=y,window.clearTimeout(U.current),y!==""&&(U.current=window.setTimeout(()=>V(""),1e3))})(K),Q&&setTimeout(()=>Q.focus())};a.useEffect(()=>()=>window.clearTimeout(U.current),[]),Kr();const z=a.useCallback(w=>_.current===f.current?.side&&Vs(w,f.current?.area),[]);return e.jsx(Ss,{scope:r,searchRef:B,onItemEnter:a.useCallback(w=>{z(w)&&w.preventDefault()},[z]),onItemLeave:a.useCallback(w=>{z(w)||(A.current?.focus(),$(null))},[z]),onTriggerLeave:a.useCallback(w=>{z(w)&&w.preventDefault()},[z]),pointerGraceTimerRef:G,onPointerGraceIntentChange:a.useCallback(w=>{f.current=w},[]),children:e.jsx(b,{...k,children:e.jsx(Hr,{asChild:!0,trapped:o,onMountAutoFocus:T(c,w=>{w.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:l,children:e.jsx(Nr,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:h,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:g,onDismiss:D,children:e.jsx(ds,{asChild:!0,...C,dir:m.dir,orientation:"vertical",loop:s,currentTabStopId:I,onCurrentTabStopIdChange:$,onEntryFocus:T(x,w=>{m.isUsingKeyboardRef.current||w.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(Wr,{role:"menu","aria-orientation":"vertical","data-state":or(v.open),"data-radix-menu-content":"",dir:m.dir,...N,...S,ref:O,style:{outline:"none",...S.style},onKeyDown:T(S.onKeyDown,w=>{const L=w.target.closest("[data-radix-menu-content]")===w.currentTarget,j=w.ctrlKey||w.altKey||w.metaKey,X=w.key.length===1;L&&(w.key==="Tab"&&w.preventDefault(),!j&&X&&R(w.key));const q=A.current;if(w.target!==q||!vs.includes(w.key))return;w.preventDefault();const Q=M().filter(V=>!V.disabled).map(V=>V.ref.current);Lt.includes(w.key)&&Q.reverse(),Us(Q)}),onBlur:T(t.onBlur,w=>{w.currentTarget.contains(w.target)||(window.clearTimeout(U.current),B.current="")}),onPointerMove:T(t.onPointerMove,ge(w=>{const K=w.target,L=E.current!==w.clientX;if(w.currentTarget.contains(K)&&L){const j=w.clientX>E.current?"right":"left";_.current=j,E.current=w.clientX}}))})})})})})})});Kt.displayName=Y;var Rs="MenuGroup",ot=a.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(te.div,{role:"group",...s,ref:n})});ot.displayName=Rs;var _s="MenuLabel",Vt=a.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(te.div,{...s,ref:n})});Vt.displayName=_s;var Ie="MenuItem",ht="menu.itemSelect",Pe=a.forwardRef((t,n)=>{const{disabled:r=!1,onSelect:s,...o}=t,c=a.useRef(null),l=ke(Ie,t.__scopeMenu),i=st(Ie,t.__scopeMenu),x=ue(n,c),h=a.useRef(!1),d=()=>{const u=c.current;if(!r&&u){const g=new CustomEvent(ht,{bubbles:!0,cancelable:!0});u.addEventListener(ht,D=>s?.(D),{once:!0}),yr(u,g),g.defaultPrevented?h.current=!1:l.onClose()}};return e.jsx(Ht,{...o,ref:x,disabled:r,onClick:T(t.onClick,d),onPointerDown:u=>{t.onPointerDown?.(u),h.current=!0},onPointerUp:T(t.onPointerUp,u=>{h.current||u.currentTarget?.click()}),onKeyDown:T(t.onKeyDown,u=>{const g=i.searchRef.current!=="";r||g&&u.key===" "||Ye.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Pe.displayName=Ie;var Ht=a.forwardRef((t,n)=>{const{__scopeMenu:r,disabled:s=!1,textValue:o,...c}=t,l=st(Ie,r),i=$t(r),x=a.useRef(null),h=ue(n,x),[d,u]=a.useState(!1),[g,D]=a.useState("");return a.useEffect(()=>{const p=x.current;p&&D((p.textContent??"").trim())},[c.children]),e.jsx(fe.ItemSlot,{scope:r,disabled:s,textValue:o??g,children:e.jsx(us,{asChild:!0,...i,focusable:!s,children:e.jsx(te.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...c,ref:h,onPointerMove:T(t.onPointerMove,ge(p=>{s?l.onItemLeave(p):(l.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:T(t.onPointerLeave,ge(p=>l.onItemLeave(p))),onFocus:T(t.onFocus,()=>u(!0)),onBlur:T(t.onBlur,()=>u(!1))})})})}),Ts="MenuCheckboxItem",Wt=a.forwardRef((t,n)=>{const{checked:r=!1,onCheckedChange:s,...o}=t;return e.jsx(Qt,{scope:t.__scopeMenu,checked:r,children:e.jsx(Pe,{role:"menuitemcheckbox","aria-checked":Ee(r)?"mixed":r,...o,ref:n,"data-state":ct(r),onSelect:T(o.onSelect,()=>s?.(Ee(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Wt.displayName=Ts;var Xt="MenuRadioGroup",[As,Ps]=se(Xt,{value:void 0,onValueChange:()=>{}}),qt=a.forwardRef((t,n)=>{const{value:r,onValueChange:s,...o}=t,c=Je(s);return e.jsx(As,{scope:t.__scopeMenu,value:r,onValueChange:c,children:e.jsx(ot,{...o,ref:n})})});qt.displayName=Xt;var Yt="MenuRadioItem",Zt=a.forwardRef((t,n)=>{const{value:r,...s}=t,o=Ps(Yt,t.__scopeMenu),c=r===o.value;return e.jsx(Qt,{scope:t.__scopeMenu,checked:c,children:e.jsx(Pe,{role:"menuitemradio","aria-checked":c,...s,ref:n,"data-state":ct(c),onSelect:T(s.onSelect,()=>o.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Zt.displayName=Yt;var it="MenuItemIndicator",[Qt,Os]=se(it,{checked:!1}),Jt=a.forwardRef((t,n)=>{const{__scopeMenu:r,forceMount:s,...o}=t,c=Os(it,r);return e.jsx(Te,{present:s||Ee(c.checked)||c.checked===!0,children:e.jsx(te.span,{...o,ref:n,"data-state":ct(c.checked)})})});Jt.displayName=it;var Ls="MenuSeparator",er=a.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t;return e.jsx(te.div,{role:"separator","aria-orientation":"horizontal",...s,ref:n})});er.displayName=Ls;var Fs="MenuArrow",tr=a.forwardRef((t,n)=>{const{__scopeMenu:r,...s}=t,o=Ae(r);return e.jsx(Xr,{...o,...s,ref:n})});tr.displayName=Fs;var $s="MenuSub",[So,rr]=se($s),pe="MenuSubTrigger",nr=a.forwardRef((t,n)=>{const r=ae(pe,t.__scopeMenu),s=ke(pe,t.__scopeMenu),o=rr(pe,t.__scopeMenu),c=st(pe,t.__scopeMenu),l=a.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:x}=c,h={__scopeMenu:t.__scopeMenu},d=a.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return a.useEffect(()=>d,[d]),a.useEffect(()=>{const u=i.current;return()=>{window.clearTimeout(u),x(null)}},[i,x]),e.jsx(rt,{asChild:!0,...h,children:e.jsx(Ht,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":o.contentId,"data-state":or(r.open),...t,ref:et(n,o.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:T(t.onPointerMove,ge(u=>{c.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!r.open&&!l.current&&(c.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{r.onOpenChange(!0),d()},100))})),onPointerLeave:T(t.onPointerLeave,ge(u=>{d();const g=r.content?.getBoundingClientRect();if(g){const D=r.content?.dataset.side,p=D==="right",S=p?-5:5,v=g[p?"left":"right"],m=g[p?"right":"left"];c.onPointerGraceIntentChange({area:[{x:u.clientX+S,y:u.clientY},{x:v,y:g.top},{x:m,y:g.top},{x:m,y:g.bottom},{x:v,y:g.bottom}],side:D}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(u),u.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:T(t.onKeyDown,u=>{const g=c.searchRef.current!=="";t.disabled||g&&u.key===" "||js[s.dir].includes(u.key)&&(r.onOpenChange(!0),r.content?.focus(),u.preventDefault())})})})});nr.displayName=pe;var sr="MenuSubContent",ar=a.forwardRef((t,n)=>{const r=Bt(Y,t.__scopeMenu),{forceMount:s=r.forceMount,...o}=t,c=ae(Y,t.__scopeMenu),l=ke(Y,t.__scopeMenu),i=rr(sr,t.__scopeMenu),x=a.useRef(null),h=ue(n,x);return e.jsx(fe.Provider,{scope:t.__scopeMenu,children:e.jsx(Te,{present:s||c.open,children:e.jsx(fe.Slot,{scope:t.__scopeMenu,children:e.jsx(at,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:h,align:"start",side:l.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{l.isUsingKeyboardRef.current&&x.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:T(t.onFocusOutside,d=>{d.target!==i.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:T(t.onEscapeKeyDown,d=>{l.onClose(),d.preventDefault()}),onKeyDown:T(t.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),g=ws[l.dir].includes(d.key);u&&g&&(c.onOpenChange(!1),i.trigger?.focus(),d.preventDefault())})})})})})});ar.displayName=sr;function or(t){return t?"open":"closed"}function Ee(t){return t==="indeterminate"}function ct(t){return Ee(t)?"indeterminate":t?"checked":"unchecked"}function Us(t){const n=document.activeElement;for(const r of t)if(r===n||(r.focus(),document.activeElement!==n))return}function Bs(t,n){return t.map((r,s)=>t[(n+s)%t.length])}function Gs(t,n,r){const o=n.length>1&&Array.from(n).every(h=>h===n[0])?n[0]:n,c=r?t.indexOf(r):-1;let l=Bs(t,Math.max(c,0));o.length===1&&(l=l.filter(h=>h!==r));const x=l.find(h=>h.toLowerCase().startsWith(o.toLowerCase()));return x!==r?x:void 0}function Ks(t,n){const{x:r,y:s}=t;let o=!1;for(let c=0,l=n.length-1;c<n.length;l=c++){const i=n[c],x=n[l],h=i.x,d=i.y,u=x.x,g=x.y;d>s!=g>s&&r<(u-h)*(s-d)/(g-d)+h&&(o=!o)}return o}function Vs(t,n){if(!n)return!1;const r={x:t.clientX,y:t.clientY};return Ks(r,n)}function ge(t){return n=>n.pointerType==="mouse"?t(n):void 0}var Hs=Ut,Ws=rt,Xs=Gt,qs=Kt,Ys=ot,Zs=Vt,Qs=Pe,Js=Wt,ea=qt,ta=Zt,ra=Jt,na=er,sa=tr,aa=nr,oa=ar,Oe="DropdownMenu",[ia]=Qe(Oe,[Ft]),H=Ft(),[ca,ir]=ia(Oe),cr=t=>{const{__scopeDropdownMenu:n,children:r,dir:s,open:o,defaultOpen:c,onOpenChange:l,modal:i=!0}=t,x=H(n),h=a.useRef(null),[d,u]=vt({prop:o,defaultProp:c??!1,onChange:l,caller:Oe});return e.jsx(ca,{scope:n,triggerId:We(),triggerRef:h,contentId:We(),open:d,onOpenChange:u,onOpenToggle:a.useCallback(()=>u(g=>!g),[u]),modal:i,children:e.jsx(Hs,{...x,open:d,onOpenChange:u,dir:s,modal:i,children:r})})};cr.displayName=Oe;var lr="DropdownMenuTrigger",dr=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,disabled:s=!1,...o}=t,c=ir(lr,r),l=H(r);return e.jsx(Ws,{asChild:!0,...l,children:e.jsx(te.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:et(n,c.triggerRef),onPointerDown:T(t.onPointerDown,i=>{!s&&i.button===0&&i.ctrlKey===!1&&(c.onOpenToggle(),c.open||i.preventDefault())}),onKeyDown:T(t.onKeyDown,i=>{s||(["Enter"," "].includes(i.key)&&c.onOpenToggle(),i.key==="ArrowDown"&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});dr.displayName=lr;var la="DropdownMenuPortal",ur=t=>{const{__scopeDropdownMenu:n,...r}=t,s=H(n);return e.jsx(Xs,{...s,...r})};ur.displayName=la;var xr="DropdownMenuContent",mr=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=ir(xr,r),c=H(r),l=a.useRef(!1);return e.jsx(qs,{id:o.contentId,"aria-labelledby":o.triggerId,...c,...s,ref:n,onCloseAutoFocus:T(t.onCloseAutoFocus,i=>{l.current||o.triggerRef.current?.focus(),l.current=!1,i.preventDefault()}),onInteractOutside:T(t.onInteractOutside,i=>{const x=i.detail.originalEvent,h=x.button===0&&x.ctrlKey===!0,d=x.button===2||h;(!o.modal||d)&&(l.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});mr.displayName=xr;var da="DropdownMenuGroup",ua=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(Ys,{...o,...s,ref:n})});ua.displayName=da;var xa="DropdownMenuLabel",ma=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(Zs,{...o,...s,ref:n})});ma.displayName=xa;var pa="DropdownMenuItem",pr=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(Qs,{...o,...s,ref:n})});pr.displayName=pa;var ba="DropdownMenuCheckboxItem",ha=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(Js,{...o,...s,ref:n})});ha.displayName=ba;var fa="DropdownMenuRadioGroup",ga=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(ea,{...o,...s,ref:n})});ga.displayName=fa;var va="DropdownMenuRadioItem",ja=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(ta,{...o,...s,ref:n})});ja.displayName=va;var wa="DropdownMenuItemIndicator",ka=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(ra,{...o,...s,ref:n})});ka.displayName=wa;var za="DropdownMenuSeparator",br=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(na,{...o,...s,ref:n})});br.displayName=za;var ya="DropdownMenuArrow",Na=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(sa,{...o,...s,ref:n})});Na.displayName=ya;var Ca="DropdownMenuSubTrigger",Da=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(aa,{...o,...s,ref:n})});Da.displayName=Ca;var Sa="DropdownMenuSubContent",Ma=a.forwardRef((t,n)=>{const{__scopeDropdownMenu:r,...s}=t,o=H(r);return e.jsx(oa,{...o,...s,ref:n,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ma.displayName=Sa;var Ia=cr,Ea=dr,Ra=ur,_a=mr,Ta=pr,Aa=br;function Pa({...t}){return e.jsx(Ia,{"data-slot":"dropdown-menu",...t})}function Oa({...t}){return e.jsx(Ea,{"data-slot":"dropdown-menu-trigger",...t})}function La({className:t,sideOffset:n=4,...r}){return e.jsx(Ra,{children:e.jsx(_a,{"data-slot":"dropdown-menu-content",sideOffset:n,className:P("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...r})})}function Ce({className:t,inset:n,variant:r="default",...s}){return e.jsx(Ta,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":r,className:P("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function Fa({className:t,...n}){return e.jsx(Aa,{"data-slot":"dropdown-menu-separator",className:P("bg-border -mx-1 my-1 h-px",t),...n})}function $a({incident:t,onBack:n,onExport:r,onGenerateReport:s,onEdit:o,onDelete:c,canEdit:l}){if(!t)return null;const i=x=>{switch(x?.toLowerCase()){case"resolved":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"succeed":return"bg-emerald-500/15 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800";case"closed":return"bg-zinc-100 text-zinc-600 dark:bg-zinc-800 dark:text-zinc-400 border-zinc-200 dark:border-zinc-700";case"open":return"bg-[#0078D4]/15 text-[#0078D4] dark:text-[#4ba0e8] border-[#0078D4]/30 dark:border-[#0078D4]/50";case"pending":return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800";default:return"bg-amber-500/15 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-800"}};return e.jsx("div",{className:"px-3 md:px-5 py-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:n,className:"mt-0.5 p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-all active:scale-95 lg:hidden shrink-0",children:e.jsx(en,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-zinc-400 uppercase tracking-wider mb-1",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(ve,{size:10}),t.ticket||"NO-TICKET"]}),e.jsx("span",{className:"text-zinc-300 dark:text-zinc-600",children:"•"}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(Ze,{size:10}),t.createdAt?St(new Date(t.createdAt),"dd MMM yy"):"-"]})]}),e.jsx("h1",{className:"text-base md:text-lg font-black text-zinc-900 dark:text-zinc-100 leading-tight truncate",children:t.subject}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 flex-wrap",children:[e.jsx(Se,{variant:"outline",className:P("rounded-md border text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5",i(t.status)),children:t.status}),e.jsx(Se,{variant:"outline",className:"rounded-md border-zinc-200 dark:border-zinc-700 text-[9px] font-bold text-zinc-500 bg-zinc-50 dark:bg-zinc-900 px-1.5 py-0.5",children:t.type}),t.project&&e.jsx(Se,{variant:"secondary",className:"rounded-md text-[9px] font-bold bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 px-1.5 py-0.5",children:t.project})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[e.jsx(xe,{variant:"ghost",size:"icon",onClick:r,className:"h-8 w-8 text-zinc-400 hover:text-[#0078D4]",title:"Export CSV",children:e.jsx(Ve,{size:14})}),e.jsx(xe,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8 text-zinc-400 hover:text-[#0078D4]",title:"Generate Report",children:e.jsx(Ke,{size:14})}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-5 bg-zinc-200 dark:bg-zinc-800 mx-0.5"}),e.jsx(xe,{variant:"ghost",size:"icon",onClick:o,className:"h-8 w-8 text-zinc-400 hover:text-zinc-900 dark:hover:text-white",title:"Edit Details",children:e.jsx(le,{size:14})}),e.jsx(xe,{variant:"ghost",size:"icon",onClick:c,className:"h-8 w-8 text-zinc-400 hover:text-red-600",title:"Delete Case",children:e.jsx(ne,{size:14})})]})]}),e.jsxs(Pa,{children:[e.jsx(Oa,{asChild:!0,className:"md:hidden",children:e.jsx(xe,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-400",children:e.jsx(ln,{size:16})})}),e.jsxs(La,{align:"end",className:"w-44",children:[e.jsxs(Ce,{onClick:r,className:"gap-2",children:[e.jsx(Ve,{size:14}),"Export CSV"]}),e.jsxs(Ce,{onClick:s,className:"gap-2",children:[e.jsx(Ke,{size:14}),"Generate Report"]}),l&&e.jsxs(e.Fragment,{children:[e.jsx(Fa,{}),e.jsxs(Ce,{onClick:o,className:"gap-2",children:[e.jsx(le,{size:14}),"Edit Details"]}),e.jsxs(Ce,{onClick:c,className:"gap-2 text-red-600 focus:text-red-600",children:[e.jsx(ne,{size:14}),"Delete Case"]})]})]})]})]})]})})}function Ua({incident:t,isLoading:n,onUpdateIncident:r,onAddEvent:s,onDeleteEvent:o,onUpdateEvent:c,onReorderEvent:l,onDeleteIncident:i,onBack:x,canEdit:h}){const{currentUser:d}=jt(),u=a.useRef(null),g=a.useRef(null),[D,p]=a.useState(!1),[S,v]=a.useState(!1),[m,N]=a.useState(null),[C,M]=a.useState(!1),[I,$]=a.useState(""),A=a.useMemo(()=>t?.events?[...t.events].sort((f,_)=>{if(typeof f.order=="number"&&typeof _.order=="number"&&f.order!==_.order)return f.order-_.order;const E=`${f.date||"1970-01-01"}T${f.time||"00:00"}`,b=`${_.date||"1970-01-01"}T${_.time||"00:00"}`;return E<b?1:E>b?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(ce,{size:24,className:"text-[#0078D4]"})}),e.jsx("p",{className:"font-semibold text-zinc-600 dark:text-zinc-400 text-sm",children:"Select an incident to view details"})]})]});const O=(f,_)=>{const E=[...A],b=_==="up"?f-1:f+1;if(b<0||b>=E.length)return;[E[f],E[b]]=[E[b],E[f]];const k=E.map((R,z)=>({...R,order:z}));l&&l(t.id,k)},U=f=>{const _=typeof d=="object"?d?.name:d;r(t.id,{...f,updatedBy:_})},B=async()=>{if(t)try{const f=L=>{if(L==null)return"";const j=String(L);return j.includes(",")||j.includes(`
`)||j.includes('"')?`"${j.replace(/"/g,'""')}"`:j},_=[...t.events||[]].sort((L,j)=>{const X=`${L.date||"1970-01-01"}T${L.time||"00:00"}`,q=`${j.date||"1970-01-01"}T${j.time||"00:00"}`;return X<q?-1:X>q?1:0}),E=[`Incident,${f(t.subject)}`,`Project,${f(t.project)}`,`Ticket ID,${f(t.ticket)}`,`Current Status,${f(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],b=["Date","Time","Status","Description","Images"].join(","),k=_.map(L=>{const j=L.date?new Date(L.date).toLocaleDateString("en-GB"):"-",X=L.time||"-",q=f(L.statusOnLine||""),oe=f(L.desc||L.title||""),Q=f((L.imageUrls||[]).join(" ; "));return[j,X,q,oe,Q].join(",")}),R="\uFEFF"+[...E,b,...k].join(`
`),z=new Blob([R],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(z),K=document.createElement("a");K.href=w,K.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(K),K.click(),document.body.removeChild(K),window.URL.revokeObjectURL(w)}catch(f){console.error("Export failed:",f),alert("Failed to export CSV. Please check console.")}},G=()=>{if(!t)return;let f=`[INCIDENT REPORT]
`;f+=`Project : ${t.project||"-"}
`,f+=`Ticket  : ${t.ticket||"-"}
`,f+=`Subject : ${t.subject||"-"}
`,f+=`Status  : ${t.status||"-"}

`,f+=`[DETAILS]
`,f+=`Impact     : ${t.impact||"-"}
`,f+=`Root Cause : ${t.root_cause||"-"}
`,f+=`Action     : ${t.action||"-"}

`,f+=`[TIMELINE]
`;const _=[...t.events||[]].sort((b,k)=>{const R=`${b.date||"1970-01-01"}T${b.time||"00:00"}`,z=`${k.date||"1970-01-01"}T${k.time||"00:00"}`;return R<z?-1:R>z?1:0});let E="";_.forEach(b=>{b.date!==E&&(f+=`
--- ${b.date?new Date(b.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,E=b.date);const k=b.time||"--:--",R=b.statusOnLine?` [${b.statusOnLine}]`:"";f+=`${k}${R} - ${b.desc||b.title}
`}),$(f),M(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 z-20 bg-white dark:bg-[#0e0e11] border-b border-zinc-100 dark:border-zinc-800 relative shadow-sm",children:e.jsx($a,{incident:t,onUpdate:U,onBack:x,onDelete:()=>i(t.id),onEdit:()=>v(!0),onGenerateReport:G,onExport:B,canEdit:h})}),e.jsx("div",{ref:g,className:"flex-1 overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar bg-zinc-50/50 dark:bg-[#09090b] relative min-h-0",children:n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-300 dark:text-zinc-700 pb-20",children:[e.jsx("div",{className:"w-20 h-20 bg-white dark:bg-zinc-900 rounded-lg border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 relative shadow-sm",children:e.jsx(tn,{size:32,className:"text-zinc-400 dark:text-zinc-600",strokeWidth:1.5})}),e.jsx("h3",{className:"text-sm font-bold text-zinc-600 dark:text-zinc-400 uppercase tracking-wide mb-1",children:"No Timeline Events"}),e.jsx("p",{className:"text-xs font-medium text-zinc-500 max-w-xs text-center mb-6 leading-relaxed",children:"This case has no operational records yet. Start by adding your first update."}),h&&e.jsxs("button",{onClick:()=>{N(null),p(!0)},className:"flex items-center gap-2 px-4 py-2 bg-[#0078D4] text-white rounded-md text-xs font-bold uppercase tracking-wide shadow-sm hover:bg-[#106EBE] transition-all",children:[e.jsx(be,{size:16,strokeWidth:2.5}),"Initialize Log"]})]}):e.jsxs("div",{className:"flex flex-col pb-36 relative max-w-4xl mx-auto min-h-full",children:[A.map((f,_)=>{const E=_===0||f.date!==A[_-1].date;let b="-";try{b=f.date?new Date(f.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{b="-"}return e.jsx(Wn,{event:f,index:_,isLastItem:_===A.length-1,showDateHeader:E,dateLabel:b,onMove:O,onEdit:k=>{N(k),p(!0)},onDelete:k=>o(t.id,k),canEdit:h},f.id)}),e.jsx("div",{ref:u})]})}),e.jsx("div",{className:"absolute bottom-8 right-8 flex flex-col gap-4 z-40 items-end",children:h&&A.length>0&&!n&&e.jsx("button",{onClick:()=>{N(null),p(!0)},className:"w-12 h-12 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-30 flex items-center justify-center active:scale-95",title:"Add Update",children:e.jsx(be,{size:24,strokeWidth:2.5})})}),e.jsx(qn,{isOpen:D,onClose:()=>p(!1),initialData:m,onDelete:f=>o(t.id,f),onSubmit:f=>{const _=typeof d=="object"?d?.name:d,E={...f};m?(E.updatedBy=_,c(t.id,m.id,E)):(E.createdBy=_,s(t.id,E)),p(!1)}}),e.jsx(Yn,{isOpen:C,onClose:()=>M(!1),text:I,incident:t}),e.jsx(Qn,{isOpen:S,onClose:()=>v(!1),incident:t,onUpdate:U,onDelete:()=>i(t.id),onExport:B})]})}const Ba=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},Ga=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-[#0078D4] bg-[#0078D4]/10 dark:bg-[#0078D4]/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},Be=a.memo(({label:t,value:n,icon:r,colorClass:s})=>{const o=r;return e.jsxs("div",{className:"flex-1 p-4 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:P("p-1.5 rounded-lg shrink-0",s),children:e.jsx(o,{size:12})}),e.jsx("span",{className:"text-[9px] font-semibold text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:n||"-"})]})}),Ge=a.memo(({title:t,icon:n,children:r,accentColor:s="text-zinc-400"})=>{const o=n;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-semibold text-zinc-400 flex items-center gap-2 px-1",children:[e.jsx(o,{size:12,className:s})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-lg shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:r})]})]})});function Ka({log:t,onAddToIncident:n,onClose:r}){if(!t)return null;const s=t.createdAt?St(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsxs(_e,{isOpen:!0,onClose:r,size:"lg",bodyClassName:"p-8 space-y-10",className:"max-h-[90vh]",header:e.jsx("div",{className:"w-full flex justify-between items-start",children:e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-lg",children:e.jsx(ve,{size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-[#0078D4] uppercase",children:"Operational Log"}),e.jsx("h2",{className:"text-3xl font-black text-zinc-900 dark:text-white tracking-tighter leading-none",children:t.ticketNumber})]})]}),e.jsx("button",{onClick:r,className:"w-10 h-10 flex items-center justify-center rounded-full bg-zinc-50 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all active:scale-90",children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(Ze,{size:12})," ",s]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(he,{size:12})," ",t.type]}),e.jsx("div",{className:P("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-widest",Ba(t.status)),children:t.status})]})]})}),footer:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs("button",{onClick:()=>n(t),className:"w-full h-16 bg-zinc-950 dark:bg-white text-white dark:text-black rounded-[1.5rem] text-[12px] font-semibold flex items-center justify-center gap-3 shadow-2xl transition-all hover:scale-[1.02] active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"}),e.jsx(Mt,{size:18,className:"fill-current group-hover:animate-pulse"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[10px] font-bold text-zinc-400 uppercase tracking-widest opacity-60",children:"System will reconcile this log into a global incident archive."})]}),children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(Be,{label:"Severity",value:t.severity||"Low",icon:Re,colorClass:Ga(t.severity)}),e.jsx(Be,{label:"Hierarchy",value:t.category||"N/A",icon:He,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(Be,{label:"Sub-Class",value:t.subCategory||"N/A",icon:nn,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(Ge,{title:"Record Description",icon:rn,accentColor:"text-[#0078D4]",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ge,{title:"Action Deployed",icon:ce,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200 italic",children:t.action||"No defensive actions recorded."})}),e.jsx(Ge,{title:"Resolution Status",icon:he,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-bold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-white dark:bg-zinc-900/50 rounded-[2.5rem] border border-zinc-100 dark:border-zinc-900 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-lg font-black shadow-lg shadow-black/10 transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(Cr,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400",children:"Lead Engineer"}),e.jsxs("p",{className:"text-base font-black text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 text-zinc-300 group-hover:text-[#0078D4] transition-colors",children:[e.jsx("span",{className:"text-[8px] font-mediumst",children:"Profile Archive"}),e.jsx(sn,{size:14})]})]})]})}const Va=a.memo(({label:t,value:n,variant:r})=>{const s={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${s[r]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:n}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});Va.displayName="StatBox";const Ha=a.memo(({item:t,type:n})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${n==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticket]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.subject})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${n==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:n==="new"?"New":"Update"})]}));Ha.displayName="PreviewRow";function Mo(){const{currentUser:t}=jt(),n=Dr(t,[dt.LEAD,dt.ENGINEER]),{toast:r}=Sr(),[s,o]=a.useState("incidents"),{incidents:c,filteredIncidents:l,selectedId:i,setSelectedId:x,loading:h,error:d,stats:u,searchTerm:g,setSearchTerm:D,filterStatus:p,setFilterStatus:S,filterType:v,setFilterType:m,clearFilters:N,hasActiveFilters:C}=En(),{sortedEvents:M,loading:I}=Rn(i),{logs:$,loading:A,stats:O}=Ir(),[U,B]=a.useState(null),[G,f]=a.useState({isOpen:!1}),[_,E]=a.useState(!1),[b,k]=a.useState(!1),R=c.find(y=>y.id===i),z=a.useCallback((y,F="success")=>{r({description:y,variant:F==="error"?"destructive":"default"})},[r]),w=async()=>{k(!0);try{const y=typeof t=="object"?t:{name:"Admin"},F=await Z.createIncident({subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:y,impact:"",root_cause:"",action:""});o("incidents"),x(F),z("Case created successfully")}catch(y){console.error(y),z("Failed to create incident","error")}finally{k(!1)}},K=async y=>{if(y){k(!0);try{const F=typeof t=="object"?t:{name:"System"},ee={subject:y.shortDesc||y.details||`Ticket #${y.ticketNumber}`,ticket:y.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(y.type)?y.type:"Incident",status:"Open",priority:y.severity||"Medium",createdBy:F,impact:"",root_cause:y.details||"",action:y.action||""},ze=await Z.createIncident(ee,y.ticketNumber);z(`Ticket #${y.ticketNumber} promoted to Case`),o("incidents"),x(ze)}catch(F){console.error(F),z("Failed to promote ticket","error")}finally{k(!1)}}},L=y=>{f({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await Z.deleteIncident(y),i===y&&x(null),f({isOpen:!1}),z("Case deleted")}catch(F){console.error(F),z("Failed to delete","error")}}})},j=async y=>{if(!y||y.length===0){z("No data to export","error");return}z("Preparing export...","info");try{const F="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",ee=y.map(async J=>{const Le=`"${pt(J.createdAt)}","${me(J.project)}","${me(J.ticket)}","${me(J.type)}","${J.status}","${me(J.subject)}","${J.createdBy?.name||J.createdBy||""}"`;try{const Fe=await Z.getEvents(J.id);return Fe.length>0?Fe.map(ye=>{const fr=pt(ye.date),gr=me(ye.desc||ye.title);return`${Le},"${fr}","${ye.time||"-"}","${gr}"`}).join(`
`)+`
,,,,,,,,,`:`${Le},"-","-","-"
,,,,,,,,,`}catch{return`${Le},"Error fetching events","-","-"
,,,,,,,,,`}}),ze=await Promise.all(ee),hr=[F,...ze].join(`
`);_n(hr,`CaseExport_${new Date().toISOString().split("T")[0]}`),z("Export completed")}catch(F){console.error(F),z("Failed to export data","error")}},X=async(y,F)=>{try{await Z.updateIncident(y,F),z("Incident updated")}catch{z("Update failed","error")}},q=async(y,F)=>{try{await Z.createEvent(y,F),z("Timeline updated")}catch{z("Failed to add event","error")}},oe=async(y,F,ee)=>{try{await Z.updateEvent(y,F,ee),z("Event updated")}catch{z("Failed to update event","error")}},Q=async(y,F)=>Z.reorderEvents(y,F),V=async(y,F)=>{f({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await Z.deleteEvent(y,F),z("Event removed")}catch{z("Failed to remove event","error")}finally{f({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx(ft,{isOpen:G.isOpen,onClose:()=>f({isOpen:!1}),...G}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${i||U?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(Un,{filteredIncidents:l,stats:u,loading:h,error:d,logs:$,logsLoading:A,logStats:O,selectedId:i,selectedLogId:U?.ticketNumber,onSelect:y=>{o("incidents"),x(y)},onSelectLog:B,onAddIncident:w,onDeleteIncident:L,onExportCSV:j,viewMode:s,onViewModeChange:y=>{o(y),y==="incidents"&&B(null),y==="logs"&&x(null)},searchTerm:g,setSearchTerm:D,filterStatus:p,setFilterStatus:S,filterType:v,setFilterType:m,clearFilters:N,hasActiveFilters:C,canEdit:n})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${i||U?"flex w-full":"hidden lg:flex"}
      `,children:s==="incidents"&&i?e.jsx(Ua,{incident:R?{...R,events:M}:null,isLoading:I,onBack:()=>x(null),onUpdateIncident:X,onAddEvent:q,onUpdateEvent:oe,onDeleteEvent:V,onDeleteIncident:L,onReorderEvent:Q,saving:b,canEdit:n}):s==="logs"&&U?e.jsx(Ka,{log:U,onAddToIncident:K,onClose:()=>B(null),canEdit:n}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-20 h-20 bg-zinc-100 dark:bg-zinc-900 rounded-lg flex items-center justify-center mb-4 shadow-sm",children:e.jsx(zn,{size:40,strokeWidth:1.5,className:"text-zinc-400 dark:text-zinc-500"})}),e.jsx("h3",{className:"text-lg font-bold uppercase tracking-wide text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-1 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{Mo as default};
