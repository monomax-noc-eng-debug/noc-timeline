import{d as V,r as a,j as e,y,ap as Le,ai as de,C as X,R as Je,L as ce,X as re,F as ze,O as Ae,J as ye,K as Qe,al as Ye,Z as Oe,aq as et,b as $e,U as tt,N as st,a as rt,P as Ne}from"./index-BFEWtwhJ.js";import{i as q}from"./incidentService-B6Q9IEZj.js";import{I as Ce,F as at,u as nt}from"./useTicketLog-paVOWVN_.js";import{H as Q}from"./hash-DmiTfhO3.js";import{T as te,P as ke}from"./trash-2-DeAKwTRc.js";import{C as it}from"./chevron-right-DVovX0bV.js";import{u as Me,F as ct,S as Se}from"./FilterBar-B7acpHUP.js";import{D as Re,a as ot,b as Ue,g as ve,I as Pe,C as lt,B as dt,u as xt,d as mt}from"./driveUpload-BPcOS6Dp.js";import{L as fe}from"./layers-qYC9K1Me.js";import{C as ut}from"./chevron-down-qX9YY_vo.js";import{P as oe,H as bt,L as ht}from"./pen-line-BEUyYOJm.js";import{C as Z,c as gt}from"./configService-D_rl3Y87.js";import{C as le,a as pt}from"./sliders-horizontal-iwKFpgUC.js";import{D as ft,f as jt,C as we}from"./formatters-DpnTxRTe.js";import{T as zt}from"./TimeInput-BnbwFigf.js";import{p as De}from"./setYear-BV4xPqlg.js";import{A as Y}from"./activity-CgZXiaul.js";import{P as Fe}from"./panels-top-left-C7ECsTKU.js";import{S as Be}from"./save-CToUh0ov.js";import{S as se}from"./shield-check-DlyofA7e.js";import{i as kt,f as _e}from"./format-DU8rxv2E.js";import{C as vt}from"./copy-BM3IQUw7.js";import{T as Ve}from"./tag-Bs9kkiC0.js";import"./useBaseQuery-BL-GicvM.js";import"./search-Caa-NJMl.js";import"./addYears-C7ezsmVv.js";import"./rotate-ccw-DgI1qe1m.js";const wt=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],yt=V("chevron-up",wt);const Nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ct=V("circle-x",Nt);const St=[["path",{d:"M11.35 22H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v5.35",key:"17jvcc"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M14 19h6",key:"bvotb8"}],["path",{d:"M17 16v6",key:"18yu1i"}]],Dt=V("file-plus-corner",St);const It=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],Et=V("file",It);const Tt=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],Lt=V("fingerprint-pattern",Tt);const At=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],Ie=V("folder-kanban",At);const Ot=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],$t=V("image-plus",Ot);const Mt=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Rt=V("layout-dashboard",Mt);const Ut=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Pt=V("link",Ut);const Ft=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],je=V("message-square",Ft);const Bt=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],_t=V("workflow",Bt);const Vt=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Ht=V("wrench",Vt),qt=()=>{const[t,r]=a.useState([]),[s,l]=a.useState(null),[o,b]=a.useState(!0),[x,n]=a.useState(null),[h,I]=a.useState(""),[m,g]=a.useState("All"),[N,$]=a.useState("All");a.useEffect(()=>{b(!0),n(null);const w=q.subscribeIncidents(c=>{const k=(c||[]).map(v=>({...v,_searchString:`${v.subject||""} ${v.project||""} ${v.ticket||""} ${v.createdBy&&typeof v.createdBy=="object"?v.createdBy.name:v.createdBy||""} ${v.status||""} ${v.type||""}`.toLowerCase()}));r(k),b(!1),n(null)},c=>{console.error("useIncidents error:",c),n(c.message||"Failed to connect to database"),b(!1)});return()=>{typeof w=="function"&&w()}},[]);const f=a.useMemo(()=>{const w=h.toLowerCase().trim();return t.filter(k=>{const v=!w||(k._searchString||"").includes(w),R=m==="All"||k.status===m,L=N==="All"||k.type===N;return v&&R&&L}).sort((k,v)=>{const R=k.createdAt?new Date(k.createdAt).getTime():0;return(v.createdAt?new Date(v.createdAt).getTime():0)-R})},[t,h,m,N]),M=a.useMemo(()=>{const w={total:0,open:0,inProgress:0,pending:0,monitoring:0,succeed:0,resolved:0,closed:0};return t.reduce((c,k)=>{c.total++;const v=k.status?.replace(/\s+/g,"").replace(/^\w/,R=>R.toLowerCase());return c[v]!==void 0?c[v]++:k.status==="In Progress"&&c.inProgress++,c},w)},[t]),S=a.useCallback(()=>{I(""),g("All"),$("All")},[]);return{incidents:t,filteredIncidents:f,selectedId:s,setSelectedId:l,loading:o,error:x,searchTerm:h,setSearchTerm:I,filterStatus:m,setFilterStatus:g,filterType:N,setFilterType:$,clearFilters:S,hasActiveFilters:!!h||m!=="All"||N!=="All",stats:M}},Wt=t=>{const[r,s]=a.useState([]),[l,o]=a.useState(!1);a.useEffect(()=>{if(!t){setTimeout(()=>{s([])},0);return}const x=q.subscribeEvents(t,n=>{const h=(n||[]).map(I=>({...I,_sortTime:new Date(`${I.date||"1970-01-01"}T${I.time||"00:00"}`).getTime()}));s(h),o(!1)});return()=>x&&x()},[t]);const b=a.useMemo(()=>[...r].sort((x,n)=>n._sortTime-x._sortTime),[r]);return{events:r,sortedEvents:b,loading:l}},ee=t=>t==null?"":String(t).replace(/"/g,'""').replace(/\n/g," "),Ee=t=>{if(!t)return"-";try{return new Date(t).toLocaleDateString("en-GB")}catch{return"-"}},Gt=(t,r)=>{const s=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),o=document.createElement("a");o.href=l;const b=r.endsWith(".csv")?r:`${r}.csv`;o.download=b,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(l)},0)},Kt=t=>{switch(t){case"Open":return{border:"border-l-rose-500",dot:"bg-rose-500",text:"text-rose-600 dark:text-rose-400",bg:"bg-rose-500/10"};case"In Progress":return{border:"border-l-[#0078D4]",dot:"bg-[#0078D4]",text:"text-[#0078D4] dark:text-blue-400",bg:"bg-[#0078D4]/10"};case"Monitoring":case"Pending":return{border:"border-l-amber-500",dot:"bg-amber-500",text:"text-amber-600 dark:text-amber-400",bg:"bg-amber-500/10"};case"Succeed":case"Resolved":return{border:"border-l-emerald-500",dot:"bg-emerald-500",text:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-500/10"};case"Closed":return{border:"border-l-zinc-500",dot:"bg-zinc-500",text:"text-zinc-500 dark:text-zinc-400",bg:"bg-zinc-500/10"};default:return{border:"border-l-zinc-400",dot:"bg-zinc-400",text:"text-zinc-500 dark:text-zinc-400",bg:"bg-zinc-500/10"}}},Xt=a.memo(({incident:t,isSelected:r,onClick:s,onDelete:l})=>{const o=Kt(t.status);let b="--",x="";try{if(t.createdAt){const n=new Date(t.createdAt);b=n.getDate(),x=n.toLocaleString("default",{month:"short"}).toUpperCase()}}catch{}return e.jsxs("div",{onClick:s,className:y("group relative flex items-stretch gap-4 p-4 mb-2 cursor-pointer transition-all duration-200 overflow-hidden","rounded-xl border","bg-zinc-100 dark:bg-zinc-900/80","border-zinc-200/50 dark:border-zinc-800","hover:bg-zinc-200/50 dark:hover:bg-zinc-800/80","border-l-4",o.border,r&&"ring-2 ring-[#0078D4] ring-offset-2 ring-offset-white dark:ring-offset-black"),children:[e.jsxs("div",{className:"shrink-0 flex flex-col items-center justify-center w-12 text-center",children:[e.jsx("span",{className:"text-2xl font-black text-zinc-800 dark:text-zinc-100 leading-none tracking-tight",children:b}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-widest",children:x})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono text-zinc-500 dark:text-zinc-400 flex items-center gap-1",children:[e.jsx(Q,{size:12}),t.ticket||"-"]}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold uppercase bg-zinc-200 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 border border-zinc-300 dark:border-zinc-700",children:t.project||"CORE"})]}),e.jsx("h3",{className:"text-sm font-bold text-zinc-800 dark:text-zinc-100 line-clamp-2 leading-snug",children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:y("inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide border",o.bg,o.text,t.status==="Open"?"border-rose-500/30":t.status==="In Progress"?"border-[#0078D4]/30":t.status==="Pending"||t.status==="Monitoring"?"border-amber-500/30":t.status==="Resolved"||t.status==="Succeed"?"border-emerald-500/30":"border-zinc-500/30"),children:[e.jsx("span",{className:y("w-1.5 h-1.5 rounded-full",o.dot)}),t.status]}),t.type&&e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium text-zinc-500 dark:text-zinc-400 bg-zinc-200/50 dark:bg-zinc-800/50 border border-zinc-300/50 dark:border-zinc-700/50",children:t.type})]})]}),e.jsx("div",{className:y("shrink-0 flex items-center justify-center transition-opacity",r?"opacity-100":"opacity-0 group-hover:opacity-100"),children:e.jsx("button",{onClick:n=>{n.stopPropagation(),l(t.id)},className:"p-1.5 rounded-lg text-zinc-400 hover:text-rose-600 hover:bg-rose-500/10 transition-colors",title:"Delete Case",children:e.jsx(te,{size:16,strokeWidth:2})})})]})}),Zt=Le("relative rounded-lg transition-all duration-150 overflow-hidden",{variants:{variant:{default:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800",interactive:"bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 hover:shadow-lg hover:border-zinc-300 dark:hover:border-zinc-700 active:scale-[0.99] cursor-pointer",flat:"bg-white dark:bg-zinc-900",ghost:"bg-transparent hover:bg-zinc-50 dark:hover:bg-zinc-900"},status:{none:"",live:"border-red-500 shadow-lg shadow-red-500/20",soon:"border-orange-400 shadow-lg shadow-orange-500/10",finished:"border-emerald-500/30 dark:border-emerald-500/20",upcoming:"border-zinc-200 dark:border-zinc-800",normal:"border-emerald-500/30 dark:border-emerald-500/20",issues:"border-red-500/30 dark:border-red-500/20",open:"border-rose-500/30 dark:border-rose-500/20",pending:"border-amber-500/30 dark:border-amber-500/20",resolved:"border-emerald-500/30 dark:border-emerald-500/20"},selected:{true:"bg-white dark:bg-zinc-800/80 border-[#0078D4]/50 shadow-md scale-[1.01] z-10",false:""},size:{sm:"p-3",md:"p-4",lg:"p-5 sm:p-6"}},defaultVariants:{variant:"default",status:"none",selected:!1,size:"md"}}),Jt=Le("absolute left-0 top-0 bottom-0 w-1.5 transition-colors",{variants:{accent:{none:"bg-transparent",live:"bg-red-500 animate-pulse",soon:"bg-orange-500",finished:"bg-emerald-500",upcoming:"bg-zinc-300 dark:bg-zinc-700",normal:"bg-emerald-500",issues:"bg-red-500",blue:"bg-[#0078D4]",indigo:"bg-[#0078D4]",open:"bg-rose-500",pending:"bg-amber-500",resolved:"bg-emerald-500",closed:"bg-zinc-400"}},defaultVariants:{accent:"none"}}),He=a.memo(({children:t,className:r,onClick:s,variant:l="default",status:o="none",accent:b="none",selected:x=!1,size:n="md",showAccent:h=!1,...I})=>{const m=h&&b==="none"?o:b;return e.jsxs("div",{className:y(Zt({variant:l,status:o,selected:x,size:n}),m!=="none"&&"pl-4",r),onClick:s,role:s?"button":void 0,tabIndex:s?0:void 0,onKeyDown:s?g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),s(g))}:void 0,...I,children:[m!=="none"&&e.jsx("div",{className:y(Jt({accent:m}))}),t]})});He.displayName="Card";const Qt=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},Yt=t=>{switch(t?.toLowerCase()){case"open":return"open";case"pending":return"pending";case"succeed":return"resolved";default:return"none"}},Te=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500";case"high":return"text-orange-500";case"medium":return"text-[#0078D4]";case"low":return"text-emerald-500";default:return"text-zinc-400"}},es=a.memo(({log:t,isSelected:r,onClick:s})=>{const l=t.createdAt?new Date(t.createdAt):null,o=l?l.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-";return e.jsxs(He,{variant:"interactive",selected:r,accent:r?"primary":Yt(t.status),showAccent:!0,size:"md",onClick:s,className:y("group mb-3",!r&&"hover:-translate-y-1"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2.5 py-1 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black shadow-lg",children:e.jsxs("span",{className:"text-[10px] font-black tracking-tight tabular-nums uppercase",children:["#",t.ticketNumber]})}),e.jsx("div",{className:y("px-2.5 py-1 rounded-lg text-[9px] font-mediumst border",Qt(t.status)),children:t.status||"LOG"})]}),e.jsx("span",{className:"text-[10px] text-zinc-300 font-bold uppercase tracking-widest",children:o})]}),e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:y("text-sm font-black leading-tight line-clamp-2 min-h-[2.5rem] transition-colors",r?"text-zinc-900 dark:text-white":"text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"),children:t.shortDesc||t.details||"Zero Telemetry Records"})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-zinc-50 dark:border-zinc-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center text-[9px] font-black text-zinc-500",children:(t.assign||t.updatedBy||"u").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-bold text-zinc-400 dark:text-zinc-500 truncate max-w-[100px] uppercase tracking-wide",children:t.assign||"Unassigned"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 rounded-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800 transition-transform group-hover:scale-105",children:[e.jsx(de,{size:10,className:y("shrink-0",Te(t.severity))}),e.jsx("span",{className:y("text-[9px] font-mediumst",Te(t.severity)),children:t.severity||"Low"})]})]}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 hidden lg:block",children:e.jsx(it,{size:18,className:"text-zinc-300"})})]})});function ts(t,r){const[s,l]=a.useState(t);return a.useEffect(()=>{const o=setTimeout(()=>l(t),r);return()=>clearTimeout(o)},[t,r]),s}const ss=({filteredIncidents:t,selectedId:r,onSelect:s,onAddIncident:l,onDeleteIncident:o,onExportCSV:b,onSync:x,stats:n,logs:h,selectedLogId:I,onSelectLog:m,logsLoading:g,viewMode:N,onViewModeChange:$,searchTerm:f,setSearchTerm:M,filterStatus:S,setFilterStatus:D,filterType:w,setFilterType:c,clearFilters:k,hasActiveFilters:v,loading:R,error:L,canEdit:P})=>{const{ticketOptions:F}=Me(),[H,W]=a.useState(f),d=ts(H,300),[E,C]=a.useState(!1);a.useEffect(()=>{M(d)},[d,M]),a.useEffect(()=>{W(f)},[f]);const[i,z]=a.useState(20),j=a.useRef(null),A=N==="logs",B=A?h:t,T=A?g:R;return a.useEffect(()=>{z(20)},[B?.length,N,S,w,d]),a.useEffect(()=>{const p=new IntersectionObserver(U=>{U[0].isIntersecting&&B?.length>i&&z(G=>G+20)},{threshold:.1});return j.current&&p.observe(j.current),()=>p.disconnect()},[B,i]),e.jsxs("div",{className:"flex flex-col h-full bg-zinc-50 dark:bg-[#09090b] relative w-full border-r border-zinc-200 dark:border-zinc-800",children:[e.jsx(ct,{icon:A?Ce:fe,className:"sticky top-0",viewToggle:e.jsxs("div",{className:"flex bg-zinc-100 dark:bg-zinc-800 rounded-md p-0.5",children:[e.jsx("button",{onClick:()=>$("incidents"),className:y("px-3 py-1.5 rounded-sm text-[10px] font-semibold uppercase tracking-wide transition-all",A?"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300":"bg-white dark:bg-zinc-900 text-[#0078D4] shadow-sm"),children:"Cases"}),e.jsx("button",{onClick:()=>$("logs"),className:y("px-3 py-1.5 rounded-sm text-[10px] font-semibold uppercase tracking-wide transition-all",A?"bg-white dark:bg-zinc-900 text-[#0078D4] shadow-sm":"text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"),children:"Logs"})]}),searchTerm:H,onSearch:W,searchPlaceholder:A?"Search logs...":"Search cases...",isFilterActive:v,onFilterClick:()=>C(!0),quickFilters:[],actions:A?[]:[{label:"",icon:Re,onClick:()=>b(t),title:"Export CSV",variant:"ghost"},...P?[{label:"New",icon:Dt,onClick:l,variant:"primary"}]:[]]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar",children:L&&!A?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3 text-center px-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(X,{className:"text-red-600",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100",children:"Connection Error"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1 max-w-xs",children:L})]}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 rounded-lg text-xs font-bold text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors",children:[e.jsx(Je,{size:12}),"Retry"]})]}):T&&i===20?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx(ce,{className:"animate-spin text-[#0078D4]",size:28}),e.jsx("p",{className:"text-[10px] font-bold text-zinc-400 uppercase tracking-wide",children:"Loading data..."})]}):B?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-400 opacity-60",children:[A?e.jsx(Ce,{size:40,strokeWidth:1}):e.jsx(fe,{size:40,strokeWidth:1}),e.jsx("p",{className:"text-sm font-medium mt-2",children:"No records found"}),v&&e.jsx("button",{onClick:k,className:"mt-2 text-xs text-[#0078D4] font-bold hover:underline",children:"Clear Filters"})]}):e.jsxs("div",{className:"flex flex-col gap-2 pb-20 md:pb-4 w-full",children:[B.slice(0,i).map(p=>A?e.jsx(es,{log:p,isSelected:I===(p.ticketNumber||p.id),onClick:()=>m(p)},p.ticketNumber||p.id):e.jsx(Xt,{incident:p,isSelected:r===p.id,onClick:()=>s(p.id),onDelete:o},p.id)),e.jsx("div",{ref:j,className:"h-4 w-full"})]})}),E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto transition-opacity",onClick:()=>C(!1)}),e.jsxs("div",{className:"relative w-full sm:w-[400px] bg-white dark:bg-zinc-900 rounded-t-xl sm:rounded-xl p-5 shadow-2xl animate-in slide-in-from-bottom sm:zoom-in-95 duration-300 pointer-events-auto m-0 sm:m-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsxs("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-[#0078D4]",children:[e.jsx("line",{x1:"4",x2:"4",y1:"21",y2:"14"}),e.jsx("line",{x1:"4",x2:"4",y1:"10",y2:"3"}),e.jsx("line",{x1:"12",x2:"12",y1:"21",y2:"12"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"3"}),e.jsx("line",{x1:"20",x2:"20",y1:"21",y2:"16"}),e.jsx("line",{x1:"20",x2:"20",y1:"12",y2:"3"}),e.jsx("line",{x1:"2",x2:"6",y1:"14",y2:"14"}),e.jsx("line",{x1:"10",x2:"14",y1:"8",y2:"8"}),e.jsx("line",{x1:"18",x2:"22",y1:"16",y2:"16"})]}),"Filters"]}),e.jsx("button",{onClick:()=>C(!1),className:"p-2 bg-zinc-100 dark:bg-zinc-800 rounded-full text-zinc-600 hover:text-zinc-900 transition-colors",children:e.jsx(re,{size:16})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.statuses].map(p=>{const U=p==="All"?n?.open+n?.pending+n?.resolved:n?.[p.toLowerCase()];return e.jsxs("button",{onClick:()=>D(p),className:y("px-3 py-2 rounded-lg text-xs font-bold transition-all border flex items-center gap-1.5",S===p?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:[p,U!==void 0&&!isNaN(U)&&e.jsxs("span",{className:"opacity-60 text-[10px]",children:["(",U,")"]})]},p)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase block mb-2",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["All",...F.types].map(p=>e.jsx("button",{onClick:()=>c(p),className:y("px-3 py-2 rounded-lg text-xs font-bold transition-all border",w===p?"bg-[#0078D4] text-white border-transparent":"bg-white dark:bg-zinc-800 border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-700"),children:p},p))})]})]}),e.jsxs("div",{className:"mt-8 flex gap-3",children:[e.jsx("button",{onClick:()=>{k(),C(!1)},className:"flex-1 py-2.5 text-zinc-600 font-bold bg-zinc-100 dark:bg-zinc-800 rounded-lg hover:bg-zinc-200 transition-colors text-sm",children:"Reset"}),e.jsx("button",{onClick:()=>C(!1),className:"flex-[2] py-2.5 bg-[#0078D4] text-white font-bold rounded-lg shadow-lg shadow-[#0078D4]/20 hover:bg-[#106EBE] transition-colors text-sm",children:"Apply Filters"})]})]})]}),!A&&P&&e.jsx("button",{onClick:l,className:"md:hidden absolute bottom-5 right-5 z-40 w-12 h-12 bg-[#0078D4] text-white rounded-full shadow-xl shadow-[#0078D4]/30 flex items-center justify-center active:scale-95 transition-transform",children:e.jsx(ke,{size:22})})]})},rs=a.memo(ss),as=t=>{const r=t.type?.toLowerCase()||"",s=(t.desc||t.details||"").toLowerCase(),l=(t.title||"").toLowerCase();let o="default";r==="create"||l.includes("create")||s.includes("created")?o="create":r==="update"||l.includes("update")||s.includes("updated")||s.includes("edit")?o="update":r==="status_change"||s.includes("resolved")||s.includes("succeed")||s.includes("completed")||s.includes("closed")?o="resolved":r==="alert"||s.includes("alert")||s.includes("error")||s.includes("failed")||s.includes("critical")?o="alert":r==="image"||s.includes("evidence")||s.includes("photo")||s.includes("upload")?o="evidence":(s.includes("pending")||s.includes("wait"))&&(o="pending");const b={create:{icon:ke,color:"bg-[#0078D4]",text:"text-[#0078D4]",border:"border-[#0078D4]",lightBg:"bg-[#0078D4]/10",label:"Created"},update:{icon:oe,color:"bg-amber-500",text:"text-amber-600",border:"border-amber-500",lightBg:"bg-amber-500/10",label:"Update"},resolved:{icon:le,color:"bg-emerald-600",text:"text-emerald-700",border:"border-emerald-600",lightBg:"bg-emerald-600/10",label:"Resolved"},alert:{icon:X,color:"bg-rose-600",text:"text-rose-700",border:"border-rose-600",lightBg:"bg-rose-600/10",label:"Alert"},evidence:{icon:Ue,color:"bg-indigo-500",text:"text-indigo-600",border:"border-indigo-500",lightBg:"bg-indigo-500/10",label:"Evidence"},pending:{icon:Z,color:"bg-orange-500",text:"text-orange-600",border:"border-orange-500",lightBg:"bg-orange-500/10",label:"Pending"},default:{icon:je,color:"bg-zinc-400",text:"text-zinc-500",border:"border-zinc-400",lightBg:"bg-zinc-400/10",label:"Note"}},x=b[o]||b.default;if(t.iconType){const n={message:je,alert:X,check:le,clock:Z,update:oe};n[t.iconType]&&(x.icon=n[t.iconType])}return{...x,label:t.statusOnLine||x.label}},ns=({src:t,index:r,onClick:s,className:l})=>{const[o,b]=a.useState(!1),[x,n]=a.useState(null);return a.useEffect(()=>{b(!1)},[t]),a.useEffect(()=>{if(!t){n(null);return}let h=null;return typeof t=="object"&&(t instanceof File||t instanceof Blob)?(h=URL.createObjectURL(t),n(h)):typeof t=="string"&&n(ve(t)),()=>{h&&URL.revokeObjectURL(h)}},[t]),o||!x?e.jsx("div",{className:y(l,"flex flex-col items-center justify-center bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 cursor-not-allowed rounded-lg"),title:"Image failed to load",children:e.jsx(Pe,{className:"text-zinc-400 mb-1",size:14})}):e.jsxs("button",{onClick:()=>s(t),className:y("relative group/img overflow-hidden cursor-zoom-in",l),children:[e.jsx("img",{src:x,alt:`evidence-${r}`,className:"h-full w-full object-cover transition-transform duration-500 group-hover/img:scale-110",onError:()=>b(!0),loading:"lazy",referrerPolicy:"no-referrer"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/img:bg-black/20 transition-all flex items-center justify-center pointer-events-none",children:e.jsx(Ue,{size:14,className:"text-white opacity-0 group-hover/img:opacity-100 transform translate-y-2 group-hover/img:translate-y-0 transition-all duration-300"})})]})};function is({event:t,index:r,isLastItem:s,onEdit:l,onDelete:o,onMove:b,showDateHeader:x,dateLabel:n}){const[h,I]=a.useState(null),{icon:m,color:g,text:N,border:$,lightBg:f,label:M}=as(t),S=t.time||"00:00";let D=(t.imageUrls||[]).filter(w=>w);return!D.length&&t.image&&(D=[t.image]),e.jsxs("div",{className:"relative group flex gap-6 pb-2 pl-2",children:[x&&e.jsxs("div",{className:"absolute -top-3 left-0 right-0 flex items-center gap-4 z-10 mb-6",children:[e.jsx("div",{className:"w-4 flex justify-center"}),e.jsx("div",{className:"bg-zinc-100 dark:bg-zinc-800/80 px-3 py-1 rounded-full border border-zinc-200 dark:border-zinc-700 text-xs font-bold text-zinc-600 dark:text-zinc-400 shadow-sm backdrop-blur-sm",children:n})]}),e.jsxs("div",{className:"relative flex flex-col items-center shrink-0 w-8 pt-2",children:[e.jsx("div",{className:y("absolute top-0 bottom-0 w-[2px] z-0","bg-zinc-200 dark:bg-zinc-800",r===0&&!x?"top-4":"-top-6",s&&"bottom-auto h-full")}),e.jsx("div",{className:y("relative w-4 h-4 rounded-[4px] z-20 flex items-center justify-center shadow-sm transition-all duration-300",g),children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full opacity-90"})})]}),e.jsxs("div",{className:y("flex-1 min-w-0 pb-8 relative",x&&"mt-8"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-bold font-mono text-zinc-500 dark:text-zinc-400 tabular-nums bg-zinc-100 dark:bg-zinc-800 px-1.5 rounded",children:S}),e.jsx("span",{className:y("text-[10px] font-bold uppercase tracking-wide",N),children:M})]}),e.jsxs("div",{className:y("relative bg-white dark:bg-zinc-900 border rounded-lg p-4 shadow-sm transition-all duration-200 group/card","border-l-4",$.replace("border-","border-l-"),"border-y-zinc-200 border-r-zinc-200 dark:border-y-zinc-800 dark:border-r-zinc-800","hover:shadow-md hover:bg-zinc-50/50 dark:hover:bg-zinc-800/50"),children:[e.jsxs("div",{className:"flex justify-between items-start gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:y("p-1.5 rounded-full shrink-0",f),children:e.jsx(m,{size:14,className:N})}),e.jsx("h4",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 leading-tight",children:t.title||"Update"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 opacity-0 group-hover/card:opacity-100 transition-opacity",children:[b&&e.jsxs("div",{className:"flex flex-col mr-1",children:[e.jsx("button",{onClick:()=>b(r,"up"),className:"p-0.5 hover:text-[#0078D4]",children:e.jsx(yt,{size:12})}),e.jsx("button",{onClick:()=>b(r,"down"),className:"p-0.5 hover:text-[#0078D4]",children:e.jsx(ut,{size:12})})]}),e.jsx("button",{onClick:()=>l(t),className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-[#0078D4]",title:"Edit",children:e.jsx(oe,{size:14})}),e.jsx("button",{onClick:()=>o(t.id),className:"p-1.5 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded text-zinc-400 hover:text-rose-600",title:"Delete",children:e.jsx(te,{size:14})})]})]}),e.jsx("div",{className:"text-sm text-zinc-600 dark:text-zinc-300 leading-relaxed whitespace-pre-wrap pl-9 break-words",children:t.desc||t.details}),D.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3 pl-9",children:D.map((w,c)=>e.jsx(ns,{index:c,src:w,onClick:I,className:"w-16 h-16 rounded border border-zinc-200 dark:border-zinc-700 shadow-sm hover:ring-2 ring-offset-1 ring-[#0078D4]"},c))}),(t.updatedBy||t.createdBy)&&e.jsxs("div",{className:"mt-3 pl-9 flex items-center gap-1.5 opacity-60 hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-[#0078D4] text-white flex items-center justify-center text-[8px] font-bold",children:(t.updatedBy||t.createdBy||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500 dark:text-zinc-400",children:t.updatedBy||t.createdBy})]})]})]}),e.jsx(ot,{isOpen:!!h,onClose:()=>I(null),imageUrl:h,allImages:D})]})}const cs=a.memo(is),he=a.memo(({label:t,icon:r})=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 ml-0.5",children:[r&&e.jsx(r,{size:10,className:"text-zinc-400"}),e.jsx("span",{className:"text-[9px] font-black text-zinc-400 uppercase tracking-widest leading-none",children:t})]})),os=a.memo(({error:t,className:r,...s})=>e.jsx("input",{...s,className:y("w-full h-10 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg px-4 text-sm font-bold transition-all duration-300 outline-none","focus:bg-white dark:focus:bg-zinc-900 focus:border-[#0078D4]/50 focus:ring-4 focus:ring-[#0078D4]/5",t?"border-rose-500":"",r)})),ie=a.memo(({children:t,title:r,icon:s,badge:l})=>e.jsxs("div",{className:"group/row space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-50 dark:border-white/5 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[s&&e.jsx(s,{size:14,className:"text-zinc-400 group-hover/row:text-[#0078D4] transition-colors"}),e.jsx("h4",{className:"text-[10px] font-black text-zinc-900 dark:text-zinc-400 uppercase ",children:r})]}),l&&e.jsx("span",{className:"text-[8px] font-black text-zinc-300 uppercase tracking-widest",children:l})]}),e.jsx("div",{className:"animate-in fade-in duration-500",children:t})]}));function ls({isOpen:t,onClose:r,initialData:s,incidentId:l,onSave:o}){const b=a.useRef(null),[x,n]=a.useState({date:null,time:"",desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"}),[h,I]=a.useState({}),[m,g]=a.useState(!1),[N,$]=a.useState(""),[f,M]=a.useState(!1),[S,D]=a.useState(0),[w,c]=a.useState(null),[k,v]=a.useState({}),R=a.useRef(null),[L,P]=a.useState({isOpen:!1,type:null,index:null});a.useEffect(()=>{if(s){let i=s.imageUrls||[];!i.length&&s.image&&(i=[s.image]),n({date:s.date&&kt(De(s.date))?De(s.date):null,time:s.time||"",desc:s.desc||s.title||"",imageUrls:i,iconType:s.iconType||"message",statusOnLineColor:s.statusOnLineColor||"white"})}else n({date:new Date,time:_e(new Date,"HH:mm"),desc:"",imageUrls:[],iconType:"message",statusOnLineColor:"white"});I({}),$(""),v({})},[s,t]);const F=i=>{const z=i||N.trim();z&&!x.imageUrls.includes(z)&&(n(j=>({...j,imageUrls:[...j.imageUrls,z]})),$(""))},H=i=>{const z=x.imageUrls[i];n(j=>({...j,imageUrls:j.imageUrls.filter((A,B)=>B!==i)})),z?.includes("drive.google.com")&&mt(z).catch(console.error)},W=async i=>{const z=i.target.files?.[0];if(z){i.target.value=null,M(!0),D(0),c(null),R.current=new AbortController;try{const j=await xt(z);console.log("Upload Result:",j);const A=j?.webViewLink||j?.url||j?.link;A?F(A):(console.error("Upload successful but no URL found in response:",j),c("Upload succeeded but returned no URL"))}catch(j){j.name!=="AbortError"&&c(j.message||"Upload failed")}finally{M(!1),D(100)}}},d=()=>{R.current?.abort(),M(!1),D(0)},E=async i=>{i.preventDefault();const z={};if(x.desc?.trim()||(z.desc=!0),Object.keys(z).length){I(z);return}g(!0);try{await o({...x,date:x.date?jt(x.date):null,id:s?.id}),r()}catch(j){console.error("Failed to save event:",j)}finally{g(!1)}},C=async()=>{if(L.type==="image")H(L.index);else if(L.type==="item"){g(!0);try{await o({...s,_delete:!0}),r()}finally{g(!1)}}P({isOpen:!1,type:null,index:null})};return e.jsxs(e.Fragment,{children:[e.jsx(ze,{isOpen:t,onClose:r,isLoading:m,size:"md",showCloseButton:!1,headerClassName:"p-6 pb-4 flex justify-between items-center border-b border-zinc-50 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#0078D4] text-white flex items-center justify-center shadow-lg",children:e.jsx(se,{size:20,strokeWidth:2.5})}),e.jsx("h3",{className:"text-lg font-black text-zinc-900 dark:text-white uppercase tracking-wider",children:s?"Edit Operation":"New Deployment"})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-zinc-50 dark:bg-white/5 text-zinc-400 hover:text-rose-500 transition-all",children:e.jsx(re,{size:18})})]}),footerClassName:"p-6 pt-2 flex items-center gap-3 border-t-0",footer:e.jsxs(e.Fragment,{children:[s&&e.jsx("button",{type:"button",onClick:()=>P({isOpen:!0,type:"item"}),className:"w-12 h-14 flex items-center justify-center rounded-lg bg-rose-50 dark:bg-rose-500/10 text-rose-500 hover:bg-rose-100 dark:hover:bg-rose-500/20 transition-all active:scale-95 shrink-0",title:"Purge Record",children:e.jsx(te,{size:20})}),e.jsxs("button",{type:"submit",form:"event-form",disabled:m||f,className:"flex-1 h-14 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[m?e.jsx(ce,{size:18,className:"animate-spin"}):e.jsx(Be,{size:18,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-semibold",children:"Commit Record"})]})]}),bodyClassName:"p-6 space-y-8",children:e.jsxs("form",{id:"event-form",onSubmit:E,className:"space-y-8",children:[e.jsx(ie,{title:"Temporal Matrix",icon:Z,children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(he,{label:"Deployment Date"}),e.jsx(ft,{date:x.date,setDate:i=>n({...x,date:i}),placeholder:"Select date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(he,{label:"Sync Time"}),e.jsx(zt,{value:x.time,onChange:i=>n({...x,time:i.target.value})})]})]})}),e.jsx(ie,{title:"Visual Personalization",icon:Lt,children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-50 dark:bg-white/5 p-3 rounded-lg border border-zinc-100 dark:border-white/5",children:[e.jsx(he,{label:"Marker Status",icon:Q}),e.jsx("div",{className:"flex gap-2",children:["white","rose","emerald"].map(i=>e.jsx("button",{type:"button",onClick:()=>n({...x,statusOnLineColor:i}),className:y("w-5 h-5 rounded-full border-2 transition-all",i==="white"?"bg-white border-zinc-200":i==="rose"?"bg-rose-500 border-rose-600":"bg-emerald-500 border-emerald-600",x.statusOnLineColor===i?"ring-4 ring-[#0078D4]/20 scale-110 shadow-lg border-[#0078D4]":"opacity-30 border-transparent")},i))})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 p-2 bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg",children:[{id:"message",icon:je},{id:"alert",icon:X},{id:"check",icon:le},{id:"clock",icon:Z},{id:"update",icon:oe},{id:"activity",icon:Y}].map(i=>e.jsx("button",{type:"button",onClick:()=>n({...x,iconType:i.id}),className:y("h-9 flex items-center justify-center rounded-lg transition-all",x.iconType===i.id?"bg-zinc-900 dark:bg-white text-white dark:text-black shadow-md scale-105":"text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-200"),children:e.jsx(i.icon,{size:14,strokeWidth:2.5})},i.id))})]})}),e.jsx(ie,{title:"Operational Narrative",icon:Fe,children:e.jsx("textarea",{className:y("w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-sm font-bold placeholder:text-zinc-400 text-zinc-900 dark:text-white outline-none min-h-[120px] resize-none transition-all focus:bg-white dark:focus:bg-zinc-900",h.desc?"border-rose-500 ring-4 ring-rose-500/5":""),placeholder:"Enter mission narrative and technical synchronization details...",value:x.desc,onChange:i=>n({...x,desc:i.target.value})})}),e.jsx(ie,{title:"Intelligence Evidence",icon:$t,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx(os,{placeholder:"Asset URL...",value:N,onChange:i=>$(i.target.value)}),e.jsx(Pt,{size:12,className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-zinc-300"})]}),e.jsx("button",{type:"button",onClick:()=>F(),disabled:!N,className:"h-10 w-10 flex items-center justify-center bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg transition-all active:scale-95 disabled:opacity-20 shadow-lg",children:e.jsx(ke,{size:18,strokeWidth:3})}),e.jsxs("button",{type:"button",onClick:()=>b.current.click(),disabled:f,className:"h-10 w-10 flex items-center justify-center bg-[#0078D4] text-white rounded-lg transition-all active:scale-95 shadow-lg relative overflow-hidden",children:[e.jsx("input",{type:"file",ref:b,className:"hidden",accept:"image/*",onChange:W}),f?e.jsx(ce,{size:16,className:"animate-spin"}):e.jsx(lt,{size:16})]})]}),(f||w)&&e.jsx("div",{className:"bg-zinc-50 dark:bg-white/5 rounded-lg p-3 border border-zinc-100 dark:border-white/5 animate-in slide-in-from-top-2",children:f?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:12,className:"animate-spin text-[#0078D4]"}),e.jsx("span",{className:"text-[9px] font-medium text-zinc-500",children:"Transmitting Asset"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-[9px] font-black text-[#0078D4] tabular-nums",children:[Math.round(S),"%"]}),e.jsx("button",{type:"button",onClick:d,className:"p-1.5 rounded-md bg-rose-50 text-rose-500 hover:bg-rose-100 border border-rose-200 shadow-sm shrink-0 transition-colors",children:e.jsx(dt,{size:10,strokeWidth:3})})]})]}),e.jsx("div",{className:"h-1.5 w-full bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0078D4] transition-all duration-300 ease-out",style:{width:`${S}%`}})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-rose-500 px-1",children:[e.jsx(X,{size:12}),e.jsx("span",{className:"text-[9px] font-medium",children:w})]})}),x.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-2 pt-1",children:x.imageUrls.map((i,z)=>e.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/10 shadow-sm hover:scale-105 transition-all",children:[k[z]?e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-300 bg-zinc-100 dark:bg-zinc-800/50",children:e.jsx(Pe,{size:16})}):e.jsx("img",{src:ve(i),className:"w-full h-full object-cover",alt:"intelligence-asset",referrerPolicy:"no-referrer",onError:()=>v(j=>({...j,[z]:!0}))}),e.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),P({isOpen:!0,type:"image",index:z})},className:"absolute inset-0 bg-rose-500/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]",children:e.jsx(te,{size:16})})]},z))})]})})]})}),e.jsx(Ae,{isOpen:L.isOpen,onClose:()=>P({isOpen:!1,type:null,index:null}),title:L.type==="image"?"Remove Asset?":"Delete Record?",message:L.type==="image"?"This asset will be permanently removed.":"This record will be permanently deleted.",confirmLabel:L.type==="image"?"Remove":"Delete",isDanger:!0,onConfirm:C})]})}function ds({isOpen:t,onClose:r,text:s,incident:l}){const[o,b]=ye.useState(!1),[x,n]=ye.useState("preview"),h=a.useMemo(()=>{if(l)return{meta:{Project:l.project||"-",Subject:l.subject||"-",Status:l.status||"-",Ticket:l.ticket||"-"},details:{Impact:l.impact||"-","Root Cause":l.root_cause||"-","Action Taken":l.action||"-"},timeline:(l.events||[]).map(f=>({date:f.date?new Date(f.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-",time:f.time,desc:f.desc||f.title,originalDate:f.date,imageUrls:f.imageUrls||(f.image?[f.image]:[])}))};if(!s)return null;const m={meta:{},details:{},timeline:[]},g=s.split(`
`);let N=!1,$="";return g.forEach(f=>{const M=f.trim();if(!M)return;const S=f.indexOf(":");if(!N&&S!==-1&&S<20){const D=f.substring(0,S).trim(),w=f.substring(S+1).trim();["Project","Subject","Status","Ticket"].includes(D)?m.meta[D]=w:(["Impact","Root Cause","Action Taken"].includes(D),m.details[D]=w)}else if(N=!0,M.length<20&&/\d/.test(M)&&!M.includes("-"))$=M;else{const w=M.match(/^(\d{1,2}:\d{2})(?:\s*:|\s*-|\s*à¸™\.)?\s*(.*)/);w?m.timeline.push({date:$,time:w[1],desc:w[2]||""}):m.timeline.push({date:$,time:null,desc:M})}}),m},[s,l]),I=async()=>{try{await navigator.clipboard.writeText(s),b(!0),setTimeout(()=>{b(!1),r()},1e3)}catch(m){console.error("Failed to copy:",m);const g=document.createElement("textarea");g.value=s,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),b(!0),setTimeout(()=>{b(!1),r()},1e3)}};return t?e.jsx(ze,{isOpen:t,onClose:r,size:"2xl",showCloseButton:!1,headerClassName:"flex justify-between items-center px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/50 backdrop-blur-md",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-sm",children:e.jsx(Ye,{size:24,className:"text-zinc-900 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg text-zinc-900 dark:text-white uppercase tracking-tight",children:"Report Preview"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>n("preview"),className:`text-[10px] font-medium px-2 py-0.5 rounded-md transition-all ${x==="preview"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Visual"}),e.jsx("div",{className:"w-[1px] h-3 bg-zinc-300 dark:bg-zinc-700"}),e.jsx("button",{onClick:()=>n("raw"),className:`text-[10px] font-medium px-2 py-0.5 rounded-md transition-all ${x==="raw"?"bg-zinc-900 text-white dark:bg-white dark:text-black":"text-zinc-400 hover:text-zinc-600"}`,children:"Raw Text"})]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-zinc-400 hover:text-black dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors",children:e.jsx(re,{size:20})})]}),bodyClassName:"p-0 overflow-y-auto custom-scrollbar bg-white dark:bg-[#09090b]",footerClassName:"p-5 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-[#09090b] flex justify-end gap-3 z-10",footer:e.jsx("button",{onClick:I,disabled:o,className:`flex items-center gap-2 px-6 py-2.5 rounded-lg text-xs font-medium transition-all shadow-lg hover:-translate-y-0.5 active:translate-y-0 ${o?"bg-emerald-500 text-white shadow-emerald-500/20":"bg-zinc-900 dark:bg-white text-white dark:text-black hover:shadow-xl"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{size:16})," Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(vt,{size:16})," Copy to Clipboard"]})}),children:x==="raw"?e.jsx("textarea",{readOnly:!0,value:s,className:"w-full h-full min-h-[50vh] p-6 font-mono text-xs font-medium text-zinc-600 dark:text-zinc-300 bg-transparent resize-none border-none outline-none leading-relaxed"}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h?.meta&&Object.entries(h.meta).map(([m,g])=>e.jsxs("div",{className:"p-4 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[e.jsx("span",{className:"text-[10px] font-medium text-zinc-400 block mb-1",children:m}),e.jsx("span",{className:"text-sm font-bold text-zinc-900 dark:text-white block truncate",children:g})]},m))}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xs font-medium text-zinc-400 flex items-center gap-2",children:[e.jsx(Y,{size:14})," Incident Details"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:h?.details&&Object.entries(h.details).map(([m,g])=>{let N=Y;return m.includes("Impact")&&(N=de),m.includes("Root")&&(N=_t),m.includes("Action")&&(N=Ht),e.jsxs("div",{className:"relative pl-4 border-l-2 border-zinc-200 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(N,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-medium text-zinc-500",children:m})]}),e.jsx("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 font-medium whitespace-pre-wrap leading-relaxed",children:g==="-"?e.jsx("span",{className:"text-zinc-300 italic",children:"No description provided"}):g})]},m)})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("h4",{className:"text-xs font-medium text-zinc-400 flex items-center gap-2",children:[e.jsx(Z,{size:14})," Timeline"]}),e.jsxs("div",{className:"relative space-y-6",children:[e.jsx("div",{className:"absolute top-2 bottom-2 left-[7px] w-[2px] bg-zinc-100 dark:bg-zinc-800"}),h?.timeline.map((m,g)=>e.jsxs("div",{className:"relative pl-8",children:[e.jsx("div",{className:"absolute left-[2px] top-[6px] w-3 h-3 rounded-full border-2 border-white dark:border-black bg-zinc-300 dark:bg-zinc-700 z-10"}),(g===0||m.date!==h.timeline[g-1].date)&&e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(we,{size:12,className:"text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-widest",children:m.date})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-zinc-50 dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800",children:[m.time&&e.jsx("span",{className:"block text-xs font-black text-zinc-900 dark:text-white mb-0.5",children:m.time}),e.jsx("span",{className:"block text-xs text-zinc-600 dark:text-zinc-400",children:m.desc}),m.imageUrls&&m.imageUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 mt-3",children:m.imageUrls.map((N,$)=>e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border border-zinc-100 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:e.jsx("img",{src:ve(N),alt:`Evidence ${$+1}`,className:"w-full h-full object-cover",onError:f=>{f.target.src="https://placehold.co/400?text=Image+Load+Failed"}})},$))})]})]},g)),h?.timeline.length===0&&e.jsx("div",{className:"text-center py-8 text-zinc-400 text-xs italic",children:"No timeline events recorded."})]})]})]})}):null}function xs(){const[t,r]=a.useState([]),[s,l]=a.useState(!0);return a.useEffect(()=>{const o=gt.subscribeProjects(b=>{r(b),l(!1)});return()=>o()},[]),{projects:t,loading:s}}function ms({isOpen:t,onClose:r,incident:s,onUpdate:l,onDelete:o}){const{ticketOptions:b}=Me(),{projects:x}=xs(),[n,h]=a.useState({subject:"",project:"",type:"Incident",ticket:"",status:"Open",priority:"Medium",impact:"",root_cause:"",action:""});a.useEffect(()=>{s&&setTimeout(()=>{h({subject:s.subject||"",project:s.project||"",type:s.type||"Incident",ticket:s.ticket||"",status:s.status||"Open",priority:s.priority||"Medium",impact:s.impact||"",root_cause:s.root_cause||"",action:s.action||""})},0)},[s,t]);const I=n.subject?.includes("|")&&n.subject?.includes("-"),m=c=>{let k={subject:c};if(c.includes("|")&&c.includes("-")){const v=c.split("|").map(R=>R.trim());if(v.length>=2){const R=v[0].split("-").map(L=>L.trim());if(R.length>=2){k.ticket=R[0],k.project=R[1];const L=b?.types||["Incident","Request","Maintenance"];k.type=L.find(P=>P.toLowerCase()===v[1].toLowerCase())||v[1],v.length>=3&&(k.subject=v.slice(2).join(" | "))}}}h(v=>({...v,...k}))},[g,N]=a.useState({});if(!t)return null;const $=c=>{c.preventDefault();const k={};if(n.ticket?.trim()||(k.ticket="Ticket Identity is required"),Object.keys(k).length>0){N(k);return}l(n),r()},f=c=>{const k={Open:{color:"text-rose-500",bg:"bg-rose-500/10",icon:X},Pending:{color:"text-orange-500",bg:"bg-orange-500/10",icon:Z},Succeed:{color:"text-emerald-500",bg:"bg-emerald-500/10",icon:le},Closed:{color:"text-zinc-500",bg:"bg-zinc-100 dark:bg-zinc-800/50",icon:Ct}};return k[c]||k.Open},M=c=>{const k={Critical:{color:"text-red-500",bg:"bg-red-500/10"},High:{color:"text-orange-500",bg:"bg-orange-500/10"},Medium:{color:"text-amber-500",bg:"bg-amber-500/10"},Low:{color:"text-[#0078D4]",bg:"bg-[#0078D4]/10"}};return k[c]||k.Medium},S="block text-[9px] font-black text-zinc-400 dark:text-zinc-500 uppercase tracking-widest mb-2 flex items-center gap-2 ml-1",D="w-full h-11 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-sm font-bold text-zinc-900 dark:text-zinc-100 focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] outline-none transition-all",w="w-full h-11 bg-white dark:bg-zinc-950 border border-zinc-200 dark:border-zinc-800 rounded-lg px-4 text-xs font-medium focus:ring-4 focus:ring-[#0078D4]/5 outline-none transition-all cursor-pointer appearance-none";return e.jsx(ze,{isOpen:t,onClose:r,size:"lg",showCloseButton:!1,headerClassName:"px-6 py-5 bg-zinc-50/50 dark:bg-white/5 border-b border-zinc-100 dark:border-white/5",header:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-900 dark:bg-white flex items-center justify-center shadow-lg",children:e.jsx(se,{size:20,className:"text-white dark:text-black"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-zinc-900 dark:text-white leading-none",children:"Intelligence Hub"}),e.jsx("p",{className:"text-[8px] text-zinc-400 font-bold uppercase tracking-widest mt-1.5 opacity-60",children:"System Configuration Unit"})]})]}),e.jsx("button",{onClick:r,className:"w-9 h-9 flex items-center justify-center rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 text-zinc-400 hover:text-rose-500 transition-all active:scale-95",children:e.jsx(re,{size:18})})]}),footerClassName:"p-6 pt-2 border-t border-zinc-100 dark:border-white/5 flex items-center justify-between",footer:e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:o,className:"h-11 px-5 rounded-lg bg-rose-500/10 text-rose-500 font-semibold text-[9px] tracking-widest hover:bg-rose-500/20 transition-all flex items-center gap-2",children:[e.jsx(te,{size:14})," Purge Hub"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:r,className:"h-11 px-6 rounded-lg text-[9px] font-medium text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all",children:"Abort"}),e.jsxs("button",{type:"submit",form:"incident-form",className:"h-11 px-8 bg-zinc-900 dark:bg-white text-white dark:text-black rounded-lg text-[9px] font-medium shadow-xl hover:scale-[1.02] active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(Be,{size:14})," Commit Changes"]})]})]}),bodyClassName:"p-6",children:e.jsxs("form",{id:"incident-form",onSubmit:$,className:"space-y-8",children:[e.jsxs("div",{className:"p-5 rounded-lg bg-[#0078D4]/5 border border-[#0078D4]/10 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:y(S,"text-[#0078D4]"),children:[e.jsx(Fe,{size:10})," Protocol Signature (Subject)"]}),I&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsx(Oe,{size:8,className:"text-emerald-500 fill-emerald-500"}),e.jsx("span",{className:"text-[7px] font-black text-emerald-500 uppercase tracking-widest",children:"Auto-Parse Active"})]})]}),e.jsx("textarea",{className:"w-full bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-white/10 rounded-lg p-4 text-sm font-black text-zinc-900 dark:text-white outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4]/50 min-h-[60px] resize-none transition-all uppercase leading-snug",value:n.subject,onChange:c=>m(c.target.value),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(Y,{size:10,className:"text-rose-500"})," Operational Status"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:y(w,f(n.status).color),value:n.status,onChange:c=>h({...n,status:c.target.value}),children:(b.statuses||["Open","Pending","Succeed","Closed"]).map(c=>e.jsx("option",{value:c,className:"bg-white dark:bg-zinc-950",children:c},c))}),e.jsx(Z,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(at,{size:10,className:"text-amber-500"})," Criticality Level"]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{className:y(w,M(n.priority).color),value:n.priority,onChange:c=>h({...n,priority:c.target.value}),children:(b.severities||["Critical","High","Medium","Low"]).map(c=>e.jsx("option",{value:c,className:"bg-white dark:bg-zinc-950",children:c},c))}),e.jsx(de,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"space-y-4 p-5 rounded-lg bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(Q,{size:10,className:"text-[#0078D4]"})," Ticket Identity",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",className:y(D,g.ticket&&"border-red-400 focus:border-red-500 focus:ring-red-500/10"),value:n.ticket,onChange:c=>{h({...n,ticket:c.target.value}),g.ticket&&N({...g,ticket:null})},placeholder:"e.g. SVR123456"}),g.ticket&&e.jsx("p",{className:"text-[10px] text-red-500 font-bold mt-1 ml-1",children:g.ticket})]}),e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(Ie,{size:10,className:"text-[#0078D4]"})," Project Reference"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:w,value:n.project,onChange:c=>h({...n,project:c.target.value}),children:[e.jsx("option",{value:"",disabled:!0,className:"bg-white dark:bg-zinc-950",children:"Select Project"}),(x&&x.length>0?x:["MONOMAX","MONO29","3BB GIGATV"]).map(c=>e.jsx("option",{value:c,className:"bg-white dark:bg-zinc-950",children:c},c))]}),e.jsx(Ie,{size:12,className:"absolute right-4 top-1/2 -translate-y-1/2 text-zinc-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(X,{size:10,className:"text-rose-500"})," Impact Assessment"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[80px] resize-none transition-all",value:n.impact,onChange:c=>h({...n,impact:c.target.value}),placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(et,{size:10})," Root Cause"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:n.root_cause,onChange:c=>h({...n,root_cause:c.target.value}),placeholder:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:S,children:[e.jsx(se,{size:10})," Remediation"]}),e.jsx("textarea",{className:"w-full bg-zinc-50 dark:bg-white/5 border border-zinc-100 dark:border-white/5 rounded-lg p-4 text-xs font-bold text-zinc-800 dark:text-zinc-200 outline-none focus:ring-4 focus:ring-[#0078D4]/5 focus:border-[#0078D4] min-h-[100px] resize-none transition-all",value:n.action,onChange:c=>h({...n,action:c.target.value}),placeholder:""})]})]})]})]})})}function us({incident:t,isLoading:r,onUpdateIncident:s,onAddEvent:l,onDeleteEvent:o,onUpdateEvent:b,onReorderEvent:x,onDeleteIncident:n,onBack:h,canEdit:I}){const{currentUser:m}=$e(),g=a.useRef(null),N=a.useRef(null),[$,f]=a.useState(!1),[M,S]=a.useState(!1),[D,w]=a.useState(null),[c,k]=a.useState(!1),[v,R]=a.useState(""),L=a.useMemo(()=>t?.events?[...t.events].sort((d,E)=>{if(typeof d.order=="number"&&typeof E.order=="number"&&d.order!==E.order)return d.order-E.order;const C=`${d.date||"1970-01-01"}T${d.time||"00:00"}`,i=`${E.date||"1970-01-01"}T${E.time||"00:00"}`;return C<i?1:C>i?-1:0}):[],[t]);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(Y,{size:24,className:"text-[#0078D4]"})}),e.jsx("p",{className:"font-semibold text-zinc-600 dark:text-zinc-400 text-sm",children:"Select an incident to view details"})]})]});const P=(d,E)=>{const C=[...L],i=E==="up"?d-1:d+1;if(i<0||i>=C.length)return;[C[d],C[i]]=[C[i],C[d]];const z=C.map((j,A)=>({...j,order:A}));x&&x(t.id,z)},F=d=>{const E=typeof m=="object"?m?.name:m;s(t.id,{...d,updatedBy:E})},H=async()=>{if(t)try{const d=p=>{if(p==null)return"";const U=String(p);return U.includes(",")||U.includes(`
`)||U.includes('"')?`"${U.replace(/"/g,'""')}"`:U},E=[...t.events||[]].sort((p,U)=>{const G=`${p.date||"1970-01-01"}T${p.time||"00:00"}`,J=`${U.date||"1970-01-01"}T${U.time||"00:00"}`;return G<J?-1:G>J?1:0}),C=[`Incident,${d(t.subject)}`,`Project,${d(t.project)}`,`Ticket ID,${d(t.ticket)}`,`Current Status,${d(t.status)}`,`Export Date,${new Date().toLocaleString("th-TH")}`,""],i=["Date","Time","Status","Description","Images"].join(","),z=E.map(p=>{const U=p.date?new Date(p.date).toLocaleDateString("en-GB"):"-",G=p.time||"-",J=d(p.statusOnLine||""),xe=d(p.desc||p.title||""),me=d((p.imageUrls||[]).join(" ; "));return[U,G,J,xe,me].join(",")}),j="\uFEFF"+[...C,i,...z].join(`
`),A=new Blob([j],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(A),T=document.createElement("a");T.href=B,T.download=`Incident_${t.ticket||"Log"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(B)}catch(d){console.error("Export failed:",d),alert("Failed to export CSV. Please check console.")}},W=()=>{if(!t)return;let d=`[INCIDENT REPORT]
`;d+=`Project : ${t.project||"-"}
`,d+=`Ticket  : ${t.ticket||"-"}
`,d+=`Subject : ${t.subject||"-"}
`,d+=`Status  : ${t.status||"-"}

`,d+=`[DETAILS]
`,d+=`Impact     : ${t.impact||"-"}
`,d+=`Root Cause : ${t.root_cause||"-"}
`,d+=`Action     : ${t.action||"-"}

`,d+=`[TIMELINE]
`;const E=[...t.events||[]].sort((i,z)=>{const j=`${i.date||"1970-01-01"}T${i.time||"00:00"}`,A=`${z.date||"1970-01-01"}T${z.time||"00:00"}`;return j<A?-1:j>A?1:0});let C="";E.forEach(i=>{i.date!==C&&(d+=`
--- ${i.date?new Date(i.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Unknown Date"} ---
`,C=i.date);const z=i.time||"--:--",j=i.statusOnLine?` [${i.statusOnLine}]`:"";d+=`${z}${j} - ${i.desc||i.title}
`}),R(d),k(!0)};return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-zinc-50 dark:bg-[#0e0e11] border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-[#0078D4] text-white px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider",children:t.status}),e.jsxs("span",{className:"text-zinc-400 text-xs font-medium uppercase flex items-center gap-1",children:[e.jsx(Q,{size:12}),t.ticket||"NO-TICKET"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:W,className:"p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-md transition-colors",title:"Generate Text Report",children:e.jsx(Et,{size:16})}),e.jsx("button",{onClick:H,className:"p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200 hover:bg-zinc-200 dark:hover:bg-zinc-800 rounded-md transition-colors",title:"Export CSV",children:e.jsx(Re,{size:16})}),I&&e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-md text-xs font-bold transition-colors ml-1",children:[e.jsx(Se,{size:14}),"Edit Case"]})]})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-zinc-900 dark:text-white leading-tight",children:t.subject||"Untitled Incident"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-zinc-500 dark:text-zinc-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(we,{size:12}),"Created: ",t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB"):"-"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Ve,{size:12}),t.project||"CORE"]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden relative bg-white dark:bg-[#0e0e11]",children:[e.jsx("div",{ref:N,className:"h-full overflow-y-auto px-4 md:px-8 py-6 custom-scrollbar",children:r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-400 gap-4",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-zinc-200 border-t-[#0078D4] rounded-full animate-spin"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest animate-pulse",children:"Syncing..."})]}):L.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-zinc-300 dark:text-zinc-700 mt-10",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-50 dark:bg-zinc-900 rounded-lg border border-zinc-100 dark:border-zinc-800 flex items-center justify-center mb-3",children:e.jsx(bt,{size:28,className:"text-zinc-400 dark:text-zinc-600"})}),e.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wide",children:"No Timeline Events"}),e.jsx("p",{className:"text-[10px] text-zinc-400 mt-1",children:"Add an update to start tracking this case."})]}):e.jsxs("div",{className:"flex flex-col pb-20 relative max-w-4xl mx-auto min-h-full",children:[L.map((d,E)=>{const C=E===0||d.date!==L[E-1].date;let i="-";try{i=d.date?new Date(d.date).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"}):"-"}catch{i="-"}return e.jsx(cs,{event:d,index:E,isLastItem:E===L.length-1,showDateHeader:C,dateLabel:i,onMove:P,onEdit:z=>{w(z),f(!0)},onDelete:z=>o(t.id,z),canEdit:I},d.id)}),e.jsx("div",{ref:g})]})}),e.jsx("div",{className:"absolute bottom-6 right-6 z-30",children:I&&!r&&t?.id&&e.jsx("button",{onClick:()=>{w(null),f(!0)},className:"w-11 h-11 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-full shadow-lg shadow-[#0078D4]/20 hover:shadow-xl transition-all duration-300 flex items-center justify-center active:scale-95",title:"Add Timeline Update",children:e.jsx(Se,{size:20})})})]}),e.jsx(ls,{isOpen:$,onClose:()=>f(!1),initialData:D,onDelete:d=>t?.id&&o(t.id,d),incidentId:t?.id,onSave:d=>{if(!t?.id){console.error("Cannot save event: Incident ID is missing"),f(!1);return}const E=typeof m=="object"?m?.name:m,C={...d};D?(C.updatedBy=E,b(t.id,D.id,C)):(C.createdBy=E,l(t.id,C)),f(!1)}}),e.jsx(ds,{isOpen:c,onClose:()=>k(!1),text:v,incident:t}),e.jsx(ms,{isOpen:M,onClose:()=>S(!1),incident:t,onUpdate:F,onDelete:()=>n(t.id),onExport:H})]})}const bs=t=>{switch(t?.toLowerCase()){case"open":return"bg-rose-50 text-rose-600 border-rose-100 dark:bg-rose-500/10 dark:text-rose-400 dark:border-rose-500/20";case"pending":return"bg-amber-50 text-amber-600 border-amber-100 dark:bg-amber-500/10 dark:text-amber-400 dark:border-amber-500/20";case"succeed":return"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-500/10 dark:text-emerald-400 dark:border-emerald-500/20";default:return"bg-zinc-50 text-zinc-500 border-zinc-200 dark:bg-zinc-800/50 dark:text-zinc-400 dark:border-zinc-800"}},hs=t=>{switch(t?.toLowerCase()){case"critical":return"text-rose-500 bg-rose-50/50 dark:bg-rose-500/10";case"high":return"text-orange-500 bg-orange-50/50 dark:bg-orange-500/10";case"medium":return"text-[#0078D4] bg-[#0078D4]/10 dark:bg-[#0078D4]/10";case"low":return"text-emerald-500 bg-emerald-50/50 dark:bg-emerald-500/10";default:return"text-zinc-400 bg-zinc-50/50 dark:bg-zinc-800/50"}},ge=a.memo(({label:t,value:r,icon:s,colorClass:l})=>{const o=s;return e.jsxs("div",{className:"flex-1 p-4 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 shadow-sm transition-all hover:shadow-md group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:y("p-1.5 rounded-lg shrink-0",l),children:e.jsx(o,{size:12})}),e.jsx("span",{className:"text-[9px] font-semibold text-zinc-400",children:t})]}),e.jsx("p",{className:"text-xs font-black text-zinc-900 dark:text-zinc-100 uppercase tracking-tight truncate",children:r||"-"})]})}),pe=a.memo(({title:t,icon:r,children:s,accentColor:l="text-zinc-400"})=>{const o=r;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-[10px] font-semibold text-zinc-400 flex items-center gap-2 px-1",children:[e.jsx(o,{size:12,className:l})," ",t]}),e.jsxs("div",{className:"p-5 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800/50 rounded-lg shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1.5 h-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-current transition-colors opacity-30"}),e.jsx("div",{className:"relative pl-2",children:s})]})]})});function gs({log:t,onAddToIncident:r,onClose:s,canEdit:l}){if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full bg-zinc-50 dark:bg-[#09090b] transition-colors relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-zinc-200/50 dark:bg-grid-zinc-800/20 [mask-image:linear-gradient(to_bottom,white,transparent)] pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(Q,{size:24,className:"text-[#0078D4]"})}),e.jsx("p",{className:"font-semibold text-zinc-600 dark:text-zinc-400 text-sm",children:"Select a log to view details"})]})]});const o=t.createdAt?_e(new Date(t.createdAt),"dd MMM yyyy HH:mm"):"-";return e.jsxs("div",{className:"flex flex-col h-full w-full bg-white dark:bg-[#0e0e11] relative transition-colors duration-300 overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 z-20 bg-zinc-50 dark:bg-[#0e0e11] border-b border-zinc-200 dark:border-zinc-800 p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"lg:hidden w-9 h-9 flex items-center justify-center rounded-lg bg-zinc-100 dark:bg-zinc-900 text-zinc-500 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(pt,{size:20})}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-900 dark:bg-white text-white dark:text-black flex items-center justify-center shadow-md",children:e.jsx(Q,{size:20,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-[#0078D4] uppercase tracking-wider",children:"Operational Log"}),e.jsx("h2",{className:"text-xl font-black text-zinc-900 dark:text-white tracking-tight leading-none",children:t.ticketNumber})]})]}),e.jsx("button",{onClick:s,className:"hidden lg:flex w-9 h-9 items-center justify-center rounded-lg bg-zinc-100 dark:bg-zinc-900 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all",children:e.jsx(re,{size:18})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(we,{size:12})," ",o]}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 text-[10px] font-bold text-zinc-500 flex items-center gap-1.5 uppercase",children:[e.jsx(se,{size:12})," ",t.type]}),e.jsx("div",{className:y("px-3 py-1 rounded-full text-[10px] font-black border uppercase tracking-wider",bs(t.status)),children:t.status})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(ge,{label:"Severity",value:t.severity||"Low",icon:de,colorClass:hs(t.severity)}),e.jsx(ge,{label:"Hierarchy",value:t.category||"N/A",icon:fe,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"}),e.jsx(ge,{label:"Sub-Class",value:t.subCategory||"N/A",icon:Ve,colorClass:"bg-zinc-50 text-zinc-400 dark:bg-zinc-800"})]}),e.jsx(pe,{title:"Record Description",icon:ht,accentColor:"text-[#0078D4]",children:e.jsx("div",{className:"text-sm md:text-base text-zinc-600 dark:text-zinc-300 leading-relaxed font-mono whitespace-pre-wrap selection:bg-blue-100 dark:selection:bg-blue-900",children:t.details||t.shortDesc||"Zero telemetry records available."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(pe,{title:"Action Deployed",icon:Y,accentColor:"text-orange-500",children:e.jsx("p",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-200",children:t.action||"No defensive actions recorded."})}),e.jsx(pe,{title:"Resolution Status",icon:se,accentColor:"text-emerald-500",children:e.jsx("p",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-200",children:t.resolvedDetail||"Archive pending reconciliation."})})]}),e.jsx("div",{className:"flex items-center justify-between p-5 bg-white dark:bg-zinc-900/50 rounded-xl border border-zinc-100 dark:border-zinc-800 transition-all hover:bg-zinc-50 dark:hover:bg-zinc-900 group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-zinc-950 dark:bg-white text-white dark:text-black flex items-center justify-center text-base font-black shadow-md transition-transform group-hover:scale-105",children:t.assign?.[0]?.toUpperCase()||e.jsx(tt,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-zinc-400",children:"Lead Engineer"}),e.jsxs("p",{className:"text-sm font-bold text-zinc-900 dark:text-zinc-100 truncate",children:["@",t.assign||"Unassigned"]})]})]})})]}),l&&e.jsxs("div",{className:"shrink-0 p-6 bg-white dark:bg-[#0a0a0a] border-t border-zinc-100 dark:border-zinc-900",children:[e.jsxs("button",{onClick:()=>r(t),className:"w-full h-12 bg-[#0078D4] hover:bg-[#106EBE] text-white rounded-lg text-xs font-bold flex items-center justify-center gap-2 shadow-lg shadow-[#0078D4]/20 transition-all active:scale-[0.98]",children:[e.jsx(Oe,{size:16,className:"fill-current"}),"Escalate to Incident"]}),e.jsx("p",{className:"text-center text-[9px] font-medium text-zinc-400 mt-3",children:"This will create a new case from this log entry."})]})]})}const ps=a.memo(({label:t,value:r,variant:s})=>{const l={new:"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-900/50",update:"bg-amber-50 dark:bg-amber-950/30 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-900/50",unchanged:"bg-zinc-50 dark:bg-zinc-900/50 text-zinc-500 border-zinc-200 dark:border-zinc-800"};return e.jsxs("div",{className:`px-3 py-2.5 rounded-lg border text-center ${l[s]}`,children:[e.jsx("span",{className:"text-xl font-black block",children:r}),e.jsx("span",{className:"text-[8px] font-bold uppercase tracking-wider opacity-70",children:t})]})});ps.displayName="StatBox";const fs=a.memo(({item:t,type:r})=>e.jsxs("div",{className:"px-3 py-2 flex items-center justify-between hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:`w-0.5 h-5 rounded-full shrink-0 ${r==="new"?"bg-emerald-500":"bg-amber-500"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs font-bold text-zinc-800 dark:text-zinc-100 truncate",children:["#",t.ticket]}),e.jsx("div",{className:"text-[10px] text-zinc-400 truncate",children:t.subject})]})]}),e.jsx("span",{className:`shrink-0 px-1.5 py-0.5 rounded text-[7px] font-bold uppercase ${r==="new"?"bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400":"bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"}`,children:r==="new"?"New":"Update"})]}));fs.displayName="PreviewRow";function Ks(){const{currentUser:t}=$e(),r=st(t,[Ne.LEAD,Ne.ENGINEER]),{toast:s}=rt(),[l,o]=a.useState("incidents"),{incidents:b,filteredIncidents:x,selectedId:n,setSelectedId:h,loading:I,error:m,stats:g,searchTerm:N,setSearchTerm:$,filterStatus:f,setFilterStatus:M,filterType:S,setFilterType:D,clearFilters:w,hasActiveFilters:c}=qt(),{sortedEvents:k,loading:v}=Wt(n),{logs:R,loading:L,stats:P}=nt(),[F,H]=a.useState(null),[W,d]=a.useState({isOpen:!1}),[E,C]=a.useState(!1),[i,z]=a.useState(!1),[j,A]=a.useState(null),B=j&&j.id===n&&!b.find(u=>u.id===n)?j:b.find(u=>u.id===n);a.useEffect(()=>{j&&b.find(u=>u.id===j.id)&&A(null)},[b,j]);const T=a.useCallback((u,O="success")=>{s({description:u,variant:O==="error"?"destructive":"default"})},[s]),p=async()=>{z(!0);try{const O={subject:"New Incident",project:"MONOMAX",status:"Open",type:"Incident",ticket:"",createdBy:typeof t=="object"?t:{name:"Admin"},impact:"",root_cause:"",action:""},_=await q.createIncident(O);A({...O,id:_,events:[],createdAt:new Date().toISOString()}),o("incidents"),h(_),T("Case created successfully")}catch(u){console.error(u),T("Failed to create incident","error")}finally{z(!1)}},U=async u=>{if(u){z(!0);try{const O=typeof t=="object"?t:{name:"System"},_={subject:u.shortDesc||u.details||`Ticket #${u.ticketNumber}`,ticket:u.ticketNumber||"",project:"MONOMAX",type:["Incident","Request","Maintenance"].includes(u.type)?u.type:"Incident",status:"Open",priority:u.severity||"Medium",createdBy:O,impact:"",root_cause:u.details||"",action:u.action||""},ae=await q.createIncident(_,u.ticketNumber);T(`Ticket #${u.ticketNumber} promoted to Case`),o("incidents"),h(ae)}catch(O){console.error(O),T("Failed to promote ticket","error")}finally{z(!1)}}},G=u=>{d({isOpen:!0,title:"Delete Case?",message:"This action cannot be undone. All timeline events will be permanently deleted.",isDanger:!0,onConfirm:async()=>{try{await q.deleteIncident(u),n===u&&h(null),d({isOpen:!1}),T("Case deleted")}catch(O){console.error(O),T("Failed to delete","error")}}})},J=async u=>{if(!u||u.length===0){T("No data to export","error");return}T("Preparing export...","info");try{const O="IncidentDate,Project,Ticket,Type,Status,Subject,CreatedBy,EventDate,EventTime,EventDescription",_=u.map(async K=>{const ue=`"${Ee(K.createdAt)}","${ee(K.project)}","${ee(K.ticket)}","${ee(K.type)}","${K.status}","${ee(K.subject)}","${K.createdBy?.name||K.createdBy||""}"`;try{const be=await q.getEvents(K.id);return be.length>0?be.map(ne=>{const Xe=Ee(ne.date),Ze=ee(ne.desc||ne.title);return`${ue},"${Xe}","${ne.time||"-"}","${Ze}"`}).join(`
`)+`
,,,,,,,,,`:`${ue},"-","-","-"
,,,,,,,,,`}catch{return`${ue},"Error fetching events","-","-"
,,,,,,,,,`}}),ae=await Promise.all(_),Ke=[O,...ae].join(`
`);Gt(Ke,`CaseExport_${new Date().toISOString().split("T")[0]}`),T("Export completed")}catch(O){console.error(O),T("Failed to export data","error")}},xe=async(u,O)=>{try{await q.updateIncident(u,O),T("Incident updated")}catch{T("Update failed","error")}},me=async(u,O)=>{try{console.log("TimelinePage: Adding event",u,O),await q.createEvent(u,O),T("Timeline updated")}catch(_){console.error("TimelinePage: Failed to add event",_),T("Failed to add event","error")}},qe=async(u,O,_)=>{try{await q.updateEvent(u,O,_),T("Event updated")}catch{T("Failed to update event","error")}},We=async(u,O)=>q.reorderEvents(u,O),Ge=async(u,O)=>{d({isOpen:!0,title:"Delete Event?",message:"This event will be removed.",isDanger:!0,onConfirm:async()=>{try{await q.deleteEvent(u,O),T("Event removed")}catch{T("Failed to remove event","error")}finally{d({isOpen:!1})}}})};return e.jsxs("div",{className:"flex w-full h-full bg-zinc-50 dark:bg-black overflow-hidden relative",children:[e.jsx(Ae,{isOpen:W.isOpen,onClose:()=>d({isOpen:!1}),...W}),e.jsx("div",{className:`
        flex-shrink-0 h-full flex flex-col border-r border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900 transition-all duration-300 z-10
        lg:w-[380px] xl:w-[420px]
        ${n||F?"hidden lg:flex":"w-full flex"}
      `,children:e.jsx(rs,{filteredIncidents:x,stats:g,loading:I,error:m,logs:R,logsLoading:L,logStats:P,selectedId:n,selectedLogId:F?.ticketNumber,onSelect:u=>{o("incidents"),h(u)},onSelectLog:H,onAddIncident:p,onDeleteIncident:G,onExportCSV:J,viewMode:l,onViewModeChange:u=>{o(u),u==="incidents"&&H(null),u==="logs"&&h(null)},searchTerm:N,setSearchTerm:$,filterStatus:f,setFilterStatus:M,filterType:S,setFilterType:D,clearFilters:w,hasActiveFilters:c,canEdit:r})}),e.jsx("div",{className:`
        flex-1 h-full relative overflow-hidden bg-zinc-50/50 dark:bg-black
        ${n||F?"flex w-full":"hidden lg:flex"}
      `,children:l==="incidents"&&n?e.jsx(us,{incident:B?{...B,events:k}:null,isLoading:v,onBack:()=>h(null),onUpdateIncident:xe,onAddEvent:me,onUpdateEvent:qe,onDeleteEvent:Ge,onDeleteIncident:G,onReorderEvent:We,saving:i,canEdit:r}):l==="logs"&&F?e.jsx(gs,{log:F,onAddToIncident:U,onClose:()=>H(null),canEdit:r}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-zinc-500 dark:text-zinc-400 select-none p-8 text-center animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-20 h-20 bg-zinc-100 dark:bg-zinc-900 rounded-lg flex items-center justify-center mb-4 shadow-sm",children:e.jsx(Rt,{size:40,strokeWidth:1.5,className:"text-zinc-400 dark:text-zinc-500"})}),e.jsx("h3",{className:"text-lg font-bold uppercase tracking-wide text-zinc-600 dark:text-zinc-400",children:"No Selection"}),e.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-zinc-400 mt-1 max-w-xs mx-auto leading-relaxed",children:"Select a case from the list to view its timeline, or choose a log from the inbox to process."})]})})]})}export{Ks as default};
